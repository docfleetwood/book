<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>An Introduction to Quantitative Text Analysis for Linguistics - 5&nbsp; Acquire</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../part_3/6_curate.html" rel="next">
<link href="../part_3/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../site_libs/quarto-contrib/kbd/kbd.js"></script>
<link href="../site_libs/quarto-contrib/kbd/kbd.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><link rel="stylesheet" href="../assets/css/mini.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span id="sec-acquire-chapter" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire</span></span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">An Introduction to Quantitative Text Analysis for Linguistics</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/qtalr/book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../qtalr-manuscript.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part_1/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Orientation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_1/1_text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part_2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_2/2_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_2/3_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_2/4_research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Research</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part_3/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_3/5_acquire.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_3/6_curate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_3/7_transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part_4/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_4/8_explore.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Explore</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_4/9_predict.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Predict</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_4/10_infer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Infer</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part_5/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part_5/11_contribute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Contribute</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#downloads" id="toc-downloads" class="nav-link active" data-scroll-target="#downloads"><span class="header-section-number">5.1</span> Downloads</a>
  <ul class="collapse">
<li><a href="#manual" id="toc-manual" class="nav-link" data-scroll-target="#manual">Manual</a></li>
  <li><a href="#programmatic" id="toc-programmatic" class="nav-link" data-scroll-target="#programmatic">Programmatic</a></li>
  </ul>
</li>
  <li><a href="#sec-apis" id="toc-sec-apis" class="nav-link" data-scroll-target="#sec-apis"><span class="header-section-number">5.2</span> APIs</a></li>
  <li><a href="#activities" id="toc-activities" class="nav-link" data-scroll-target="#activities">Activities</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/qtalr/book/blob/main/part_3/5_acquire.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/qtalr/book/edit/main/part_3/5_acquire.qmd" target="_blank" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/qtalr/book/issues" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block"><span id="sec-acquire-chapter" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><blockquote class="blockquote">
<p>The scariest moment is always just before you start.</p>
<p>— Stephen King</p>
</blockquote>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-list-alt" aria-label="list-alt"></i> Outcomes</strong></p>
<ul>
<li>Identify common strategies for acquiring corpus data.</li>
<li>Describe how to organize and document data acquisition to support reproducibility.</li>
<li>Recall R programming concepts and strategies relevant to acquiring data.</li>
</ul>
</div>
</div>
</div>
<p>As we start down the path to executing our research blueprint, our first step is to acquire the primary data that will be employed in the project. This chapter covers two commonly-used strategies for acquiring corpus data: downloads and APIs. We will encounter various file formats and folder structures in the process and we will address how to effectively organize our data for subsequent processing. Crucial to our efforts is the process of documenting our data. We will learn to provide data origin information to ensure key characteristics of the data and its source are documented. Along the way, we will explore R coding concepts including control statements and custom functions relevant to the task of acquiring data. By the end of this chapter, you will not only be adept at acquiring data from diverse sources but also capable of documenting it comprehensively, enabling you to replicate the process in the future.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-terminal" aria-label="terminal"></i> Lessons</strong></p>
<p><strong>What</strong>: <a href="https://github.com/qtalr/lessons">Control Statements, Custom Functions</a><br><strong>How</strong>: In an R console, load <code>swirl</code>, run <code>swirl()</code>, and follow prompts to select the lesson.<br><strong>Why</strong>: To recognize the logic behind code that can make dynamic choices and to recall how functions serve to produce efficient, reusable, and more legible code.</p>
</div>
</div>
</div>
<section id="downloads" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="downloads">
<span class="header-section-number">5.1</span> Downloads</h2>
<p>The most common and straightforward method for acquiring corpus data is through direct downloads. In a nutshell, this method involves navigating to a website, locating the data, and downloading it to your computing environment. In some cases access to the data requires manual intervention and in others the process can be implemented programmatically. The data may be contained in a single file or multiple files. The files may be compressed or uncompressed. The data may be hierarchically organized or not. Each resource will have its own unique characteristics that will influence the process of acquiring the data. In this section we will work through a few examples to demonstrate the general process of acquiring data through downloads.</p>
<section id="manual" class="level3"><h3 class="anchored" data-anchor-id="manual">Manual</h3>
<p>In contrast to the other data acquisition methods we will cover in this chapter, <strong>manual downloads</strong> require human intervention. This means that manual downloads are non-reproducible in a strict sense and require that we keep track of and document our procedure. It is a very common for research projects to acquire data through manual downloads as many data resources require some legwork before they are accessible for downloading. These can be resources that require institutional or private licensing and fees, require authorization/ registration, and/ or are only accessible via resource search interfaces.</p>
<p>The resource we will use for this demonstration is the <a href="http://cedel2.learnercorpora.com/">Corpus Escrito del Español como L2 (CEDEL2)</a> <span class="citation" data-cites="Lozano2009">(<a href="../references.html#ref-Lozano2009" role="doc-biblioref">Lozano 2009</a>)</span>, a corpus of Spanish learner writing. It includes L2 writing from students with a variety of L1 backgrounds. For comparative puposes it also includes native writing for Spanish, English, and several other languages.</p>
<p>The CEDEL2 corpus is a freely available resource, but to access the data you must first use a search interface to select the relevant characteristics of the data of interest. Following the search/ download link you can find a search interface that allows the user to select the subcorpus and filter the results by a set of attributes, seen in <a href="#fig-ad-cedel2-search" class="quarto-xref">Figure&nbsp;<span>5.1</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ad-cedel2-search" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ad-cedel2-search-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/ad-cedel2-search.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ad-cedel2-search-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.1: Search and download interface for the CEDEL2 Corpus
</figcaption></figure>
</div>
</div>
</div>
<p>For this example let’s assume that we want to acquire data to use in a study comparing the use of the Spanish preterite and imperfect past tense aspect in written texts by English L1 learners of Spanish to native Spanish speakers. To acquire data for such a project, we will first select the subcorpus “Learners of L2 Spanish”. We will set the results to provide full texts and filter the results to “L1 English - L2 Spanish”. Additionally, we will set the medium to “Written”. This will provide us with a set of texts for the L2 learners that we can use for our study. The search parameters and results are shown in <a href="#fig-ad-cedel2-results" class="quarto-xref">Figure&nbsp;<span>5.2</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ad-cedel2-results" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ad-cedel2-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/ad-cedel2-results.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ad-cedel2-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.2: Search results for the CEDEL2 Corpus
</figcaption></figure>
</div>
</div>
</div>
<p>The ‘Download’ link now appears for this search criteria. Following this link will provide the user a form to fill out. This particular resource allows for access to different formats to download (Texts only, Texts with metadata, CSV (Excel), CSV (Others)). I will select the ‘CSV (Others)’ option so that the data is structured for easier processing downstream in subsequent processing steps. Then I save the CSV in the <em>data/original/</em> directory of my project and create a sub-directory named <em>cedel2/</em>, as seen in <a href="#exm-ad-cedel2-learners-download" class="quarto-xref">Example&nbsp;<span>5.1</span></a>.</p>
<div id="exm-ad-cedel2-learners-download" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.1</strong></span> Download CEDEL2 L2 Spanish Learners data</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis/</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> cedel2/</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> cedel2-l1-english-learners.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the file is named <em>cedel2-l1-english-learners.csv</em> to reflect the search criteria used to acquire the data. In combination with other data documentation, this will help us to maintain transparency.</p>
<p>Now, after downloading the L2 learner and the native speaker data into the appropriate directory, we move on to the next processing step, right? Not so fast! Imagine we are working on a project with a collaborator. How will they know where the data came from? What if we need to come back to this data in the future? How will we know what characteristics we used to filter the data? The directory and filenames may not be enough. To address these questions we need to document the origin of the data, and in the case of data acquired through manual downloads, we need to document the procedures we took to acquire the data to the best of our ability.</p>
<p>As discussed in <a href="../part_2/2_data.html#sec-ud-data-origin" class="quarto-xref"><span>Section 2.3.1</span></a>, all acquired data should be accompanied by a data origin file. The majority of this information can typically be identified on the resource’s website and/ or the resource’s documentation. In the case of the CEDEL2 corpus, the corpus homepage provides most of the information we need.</p>
<p>Structurally, data documentation files should be stored close to the data they describe. So for our data origin file this means adding it to the <em>data/original/</em> directory. Naming the file in a transparent way is also important. I’ve named the file <em>cedel2_do.csv</em> to reflect the name of the corpus, the meaning of the file as data origin with a suffixed *_do<em>, and the file extension </em>.csv* to reflect the file format. CSV files reflect tabular content. It is not required that data origin files are tabular, but it makes it easier to read and display them in literate programming documents.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>There are many ways to create and edit CSV files. You can use a spreadsheet program like MS Excel or Google Sheets, a text editor like Notepad or TextEdit, or a code editor like RStudio or VS Code. The <code>qtalrkit</code> package provides a convenient function, <code>create_data_origin()</code> to create a CSV file with the data origin boilerplate structure. This CSV file then can be edited to add the relevant information in any of the above mentioned programs.</p>
<p>Using a spreadsheet program is the easiest method for editing tabular data. The key is to save the file as a CSV file, and not as an Excel file, to maintain our adherence to the principle of using open formats for reproducible research.</p>
</div>
</div>
</div>
<p>In <a href="#tbl-ad-cedel2-do" class="quarto-xref">Table&nbsp;<span>5.1</span></a>, I’ve created a data origin file for the CEDEL2 corpus.</p>
<div class="cell" data-tbl-colwidths="[25,75]">
<div id="tbl-ad-cedel2-do" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ad-cedel2-do-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5.1: Data origin file for the CEDEL2 corpus
</figcaption><div aria-describedby="tbl-ad-cedel2-do-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="cell table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead><tr class="header">
<th>attribute</th>
<th>description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Resource name</td>
<td>CEDEL2: Corpus Escrito del Español como L2.</td>
</tr>
<tr class="even">
<td>Data source</td>
<td>http://cedel2.learnercorpora.com/, https://doi.org/10.1177/02676583211050522</td>
</tr>
<tr class="odd">
<td>Data sampling frame</td>
<td>Corpus that contains samples of the language produced from learners of Spanish as a second language. For comparative purposes, it also contains a native control subcorpus of the language produced by native speakers of Spanish from different varieties (peninsular Spanish and all varieties of Latin American Spanish), so it can be used as a native corpus in its own right.</td>
</tr>
<tr class="even">
<td>Data collection date(s)</td>
<td>2006-2020.</td>
</tr>
<tr class="odd">
<td>Data format</td>
<td>CSV file. Each row corresponds to a writing sample. Each column is an attribute of the writing sample.</td>
</tr>
<tr class="even">
<td>Data schema</td>
<td>A CSV file for L2 learners and a CSV file for native speakers.</td>
</tr>
<tr class="odd">
<td>License</td>
<td>CC BY-NC-ND 3.0 ES</td>
</tr>
<tr class="even">
<td>Attribution</td>
<td>Lozano, C. (2022). CEDEL2: Design, compilation and web interface of an online corpus for L2 Spanish acquisition research. Second Language Research, 38(4), 965-983. https://doi.org/10.1177/02676583211050522.</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Given this is a manual download we also need to document the procedure used to retrieve the data in prose. The script in the <em>process/</em> directory that is typically used to acquire the data is not used to programmatically retrieve data in this case. However, to keep things predictable we will use this file to document the download procedure. I’ve created a Quarto file named <em>1_acquire_data.qmd</em> in the <em>process/</em> directory of my project.</p>
<p>A glimpse at the directory structure of the project at this point is seen in <a href="#exm-ad-cedel2-structure" class="quarto-xref">Example&nbsp;<span>5.2</span></a>.</p>
<div id="exm-ad-cedel2-structure" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.2</strong></span> Project structure for the CEDEL2 corpus data acquisition</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">project/</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> process/</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 1_acquire_data.qmd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── ...</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> data/</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── analysis/</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── derived/</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── original/</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       ├── cedel2_do.csv</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── cedel2/</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>           ├── cedel2-l1-english-learners.csv</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>           └── cedel2-native-spanish-speakers.csv</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> reports/</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> DESCRIPTION</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> Makefile</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> README</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Even though the <em>1_acquire_data.qmd</em> file is not used to programmatically retrieve the data, it is still a useful place to document the download procedure. This includes the URL of the resource, the search criteria used to filter the data, and the file format and location of the data. It is also good to include and display your data origin file in this file as a formatted table.</p>
<p>Manually downloading other resources will inevitably include unique processes for obtaining the data, but in the end the data should be archived in the project structure in the <em>data/original/</em> directory and documented in the appropriate places. Note that acquired data is always treated as ‘read-only’, meaning it is not modified in any way. This gives us a fixed starting point for subsequent steps in the data preparation process.</p>
</section><section id="programmatic" class="level3"><h3 class="anchored" data-anchor-id="programmatic">Programmatic</h3>
<p>There are many resources that provide corpus data that is directly accessible for which programmatic downloads can be applied. A <strong>programmatic download</strong> is a download in which the process can be automated through code. Thus, this is a reproducible process. The data can be acquired by anyone with access to the necessary code.</p>
<p>In this case, and subsquent data acquisition procedures in this chapter, we use the <em>1_acquire_data.qmd</em> Quarto file to its full potential intermingling prose, code, and code comments to execute and document the download procedure.</p>
<p>To illustrate how this works to conduct a programmatic download, we will work with the Switchboard Dialog Act Corpus (SWDA) <span class="citation" data-cites="SWDA2008">(<a href="../references.html#ref-SWDA2008" role="doc-biblioref">University of Colorado Boulder 2008</a>)</span>. The version that we will use is found on the Linguistic Data Consortium under the <a href="https://catalog.ldc.upenn.edu/LDC97S62">Switchboard-1 Release 2 Corpus</a>. The corpus and related documentation are linked on the catalog page <a href="https://catalog.ldc.upenn.edu/docs/LDC97S62/" class="uri">https://catalog.ldc.upenn.edu/docs/LDC97S62/</a>.</p>
<p>From the documentation we learn that the corpus contains transcripts for 1155 5-minute two-way telephone conversations among English speakers for all areas of the United States. The speakers were given a topic to discuss and the conversations were recorded. The corpus metadata and annotations for sociolinguistic and discourse features.</p>
<p>This corpus, as you can image, could support a wide range of interesting reseach questions. Let’s assume we are following research conducted by <span class="citation" data-cites="Tottie2011">Tottie (<a href="../references.html#ref-Tottie2011" role="doc-biblioref">2011</a>)</span> to explore the use of filled pauses such as “um” and “uh” and traditional sociolinguistic variables such as sex, age, and education in spontaneous speech by American English speakers.</p>
<p>With this goal in mind, let’s get started writing the code to download and organize the data in our project directory. First, we need to identify the URL (Uniform Resource Locator) for the data that we want to download. More often than not this file will be some type of compressed archive file with an extension such as <em>.zip</em> (Zipped file), <em>.tar</em> (Tarball file), or <em>tar.gz</em> (Gzipped tarball file), which is the case for the SWDA corpus. Compressed files make downloading multiple files easy by grouping files and directories into one file.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-lightbulb" aria-label="lightbulb"></i> Consider this</strong></p>
<p>You may be wondering what the difference betwen <em>.zip</em>, <em>.tar</em>, and <em>.tar.gz</em> files are. The <em>.zip</em> file format is the most common. It groups file and directories into one file (an archive) and compresses it to reduce the size of the file in one step when the file is created.</p>
<p>The <em>.tar</em> file format is used archive files and folders, it does not perform compression. Gzipping peforms the compression to the <em>.tar</em> file resulting in a file with the <em>.tar.gz</em> extension. Notably the <em>.gz</em> compression is highly efficient for large files. Take the <em>swda.tar.gz</em> file for example. It has a compressed file size of 4.6 MB, but when uncompressed it is 16.9 MB. This is a 73% reduction in file size.</p>
</div>
</div>
</div>
<p>In R, we can use the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function from base R. The <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function minimally requires two arguments: <code>url</code> and <code>destfile</code>. These correspond to the file to download and the location where it is to be saved to disk. To break out the process a bit, I will assign the URL and destination file path to variables and then use the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function to download the file.</p>
<div id="exm-ad-swda-download-file" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.3</strong></span> &nbsp;</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># URL to SWDA corpus compressed file</span></span>
<span><span class="va">file_url</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"https://catalog.ldc.upenn.edu/docs/LDC97S62/swb1_dialogact_annot.tar.gz"</span></span>
<span></span>
<span><span class="co"># Relative path to project/data/original directory</span></span>
<span><span class="va">file_path</span> <span class="op">&lt;-</span> <span class="st">"../data/original/swda.tar.gz"</span></span>
<span></span>
<span><span class="co"># Download SWDA corpus compressed file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">file_url</span>, destfile <span class="op">=</span> <span class="va">file_path</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i> Warning</strong></p>
<p>Note that the <code>file_path</code> variable in <a href="#exm-ad-swda-download-file" class="quarto-xref">Example&nbsp;<span>5.3</span></a> is a relative path to the <em>data/original/</em> directory. This is because the <em>1_acquire_data.qmd</em> file that we are using for this code is located in the <em>process/</em> directory and the <em>data/</em> directory is a sibling directory to the <em>process/</em> directory.</p>
<p>It is also possible to use an absolute path to the <em>data/original/</em> directory. I will have more to say about the advantages and disadvantages of relative and absolute paths in reproducible research in <a href="../part_5/11_contribute.html" class="quarto-xref"><span>Chapter 11</span></a>.</p>
</div>
</div>
</div>
<p>As we can see looking at the directory structure, in <a href="#exm-ad-swda-download-location" class="quarto-xref">Example&nbsp;<span>5.4</span></a>, the <em>swda.tar.zip</em> file has been added to the <em>data/original/</em> directory.</p>
<div id="exm-ad-swda-download-location" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.4</strong></span> Downloaded SWDA corpus compressed file</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis/</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> swda.tar.zip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once an compressed file is downloaded, however, the file needs to be ‘decompressed’ to reveal the directory structure and files. To decompress this <em>.tar.gz</em> file we use the <code><a href="https://rdrr.io/r/utils/untar.html">untar()</a></code> function with the arguments <code>tarfile</code> pointing to the <em>.tar.gz</em> file and <code>exdir</code> specifying the directory where we want the files to be extracted to. Again, I will assign the arguments to variables. Then we can decompress the file using the <code><a href="https://rdrr.io/r/utils/untar.html">untar()</a></code> function.</p>
<div id="exm-ad-swda-decompress-file" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.5</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Relative path to the compressed file</span></span>
<span><span class="va">tar_file</span> <span class="op">&lt;-</span> <span class="st">"../data/original/swda.tar.gz"</span></span>
<span></span>
<span><span class="co"># Relative path to the directory to extract to</span></span>
<span><span class="va">extract_to_dir</span> <span class="op">&lt;-</span> <span class="st">"../data/original/swda/"</span></span>
<span></span>
<span><span class="co"># Decompress .zip file and extract to our target directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/untar.html">untar</a></span><span class="op">(</span><span class="va">tar_file</span>, <span class="va">extract_to_dir</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The directory structure of <em>data/</em> in <a href="#exm-ad-swda-decompress-location" class="quarto-xref">Example&nbsp;<span>5.6</span></a> now shows the <em>swda.tar.gz</em> file and the <em>swda</em> directory that contains the decompressed directories and files.</p>
<div id="exm-ad-swda-decompress-location" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.6</strong></span> &nbsp;</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis/</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> swda/</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── README</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── doc/</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw00utt/</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw01utt/</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw02utt/</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw03utt/</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw04utt/</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw05utt/</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw06utt/</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw07utt/</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw08utt/</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw09utt/</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw10utt/</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw11utt/</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── sw12utt/</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── sw13utt/</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> swda.tar.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point we have acquired the data programmatically and with this code as part of our workflow anyone could run this code and reproduce the same results.</p>
<p>The code as it is, however, is not ideally efficient. First, the <em>swda.tar.gz</em> file is not strictly needed after we decompress it and it occupies disk space, if we keep it. And second, each time we run this code the file will be downloaded from the remote server and overwrite the existing data. This leads to unnecessary data transfer and server traffic and will overwrite the data if it already exists in our project directory which could be problematic if the data changes on the remote server. Let’s tackle each of these issues in turn.</p>
<p>To avoid writing the <em>swda.tar.gz</em> file to disk (long-term) we can use the <code><a href="https://rdrr.io/r/base/tempfile.html">tempfile()</a></code> function to open a temporary holding space for the file in the computing environment. This space can then be used to store the file, decompress it, and then the temporary file will automatically be deleted. We assign the temporary space to an R object we will name <code>temp_file</code> with the <code><a href="https://rdrr.io/r/base/tempfile.html">tempfile()</a></code> function. This object can now be used as the value of the argument <code>destfile</code> in the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function.</p>
<div id="exm-ad-swda-temp-file" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.7</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># URL to SWDA corpus compressed file</span></span>
<span><span class="va">file_url</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"https://catalog.ldc.upenn.edu/docs/LDC97S62/swb1_dialogact_annot.tar.gz"</span></span>
<span></span>
<span><span class="co"># Create a temporary file space for our .tar.gz file</span></span>
<span><span class="va">temp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download SWDA corpus compressed file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">file_url</span>, <span class="va">temp_file</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>In <a href="#exm-ad-swda-temp-file" class="quarto-xref">Example&nbsp;<span>5.7</span></a>, I’ve used the values stored in the objects <code>file_url</code> and <code>temp_file</code> in the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function without specifying the argument names –only providing the names of the objects. R will assume that values of a function map to the ordering of the arguments. If your values do not map to ordering of the arguments you are required to specify the argument name and the value. To view the ordering of objects hit <kbd aria-hidden="true">tab</kbd><span class="visually-hidden">tab</span> after entering the function name or consult the function documentation by prefixing the function name with <code>?</code> and hitting <kbd aria-hidden="true">enter</kbd><span class="visually-hidden">enter</span>.</p>
</div>
</div>
</div>
<p>At this point our downloaded file is stored temporarily on disk and can be accessed and decompressed to our target directory using <em>temp_file</em> as the value for the argument <code>tarfile</code> from the <code><a href="https://rdrr.io/r/utils/untar.html">untar()</a></code> function. I’ve assigned our target directory path to <code>extract_to_dir</code> and used it as the value for the argument <code>exdir</code>.</p>
<div id="exm-ad-swda-untar-temp" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.8</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Assign our target directory to `extract_to_dir`</span></span>
<span><span class="va">extract_to_dir</span> <span class="op">&lt;-</span> <span class="st">"../data/original/swda/"</span></span>
<span></span>
<span><span class="co"># Decompress .tar.gz file and extract to our target directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/untar.html">untar</a></span><span class="op">(</span>tarfile <span class="op">=</span> <span class="va">temp_file</span>, exdir <span class="op">=</span> <span class="va">target_dir</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Our directory structure in <a href="#exm-ad-swda-untar-temp" class="quarto-xref">Example&nbsp;<span>5.8</span></a> is the same as in <a href="#exm-ad-swda-decompress-location" class="quarto-xref">Example&nbsp;<span>5.6</span></a>, minus the <em>swda.tar.gz</em> file.</p>
<p>The second issue I raised concerns the fact that running this code as part of our project will repeat the download each time our script is run. Since we would like to be good citizens and avoid unnecessary traffic on the web and avoid potential issues in overwriting data, it would be nice if our code checked to see if we already have the data on disk and if it exists, then skip the download, if not then download it.</p>
<p>The desired functionality we’ve described can be implemented using the <code>if()</code> function. The <code>if()</code> function is one of a class of functions known as control statements. <strong>Control statments</strong> allow us to control the flow of our code by evaluating logical statements and processing subsequent code based on the logical value it is passed as an argument.</p>
<p>So in this case we want to evaluate whether the data directory exists on disk. If it does then skip the download, if not, proceed with the download. In combination with <code>else</code> which provides the ‘if not’ part of the statement, we have the following logical flow in <a href="#exm-ad-if-dir-exists" class="quarto-xref">Example&nbsp;<span>5.9</span></a>.</p>
<div id="exm-ad-if-dir-exists" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.9</strong></span> &nbsp;</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">DIRECTORY_EXISTS</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Do nothing</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Download data</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can simplify this statement by using the <code>!</code> operator which negates the logical value of the statement it precedes. So if the directory exists, <code>!DIRECTORY_EXISTS</code> will return <code>FALSE</code> and if the directory does not exist, <code>!DIRECTORY_EXISTS</code> will return <code>TRUE</code>. In other words, if the directory does not exist, download the data. This is shown in <a href="#exm-ad-if-dir-exists-simplified" class="quarto-xref">Example&nbsp;<span>5.10</span></a>.</p>
<div id="exm-ad-if-dir-exists-simplified" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.10</strong></span> &nbsp;</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">DIRECTORY_EXISTS</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Download data</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, to determine if a directory exists in our project directory we will turn to the <code>fs</code> package <span class="citation" data-cites="R-fs">(<a href="../references.html#ref-R-fs" role="doc-biblioref">Hester, Wickham, and Csárdi 2023</a>)</span>. The <code>fs</code> package provides a set of functions for interacting with the file system, including <code><a href="https://fs.r-lib.org/reference/file_access.html">dir_exists()</a></code>. <code><a href="https://fs.r-lib.org/reference/file_access.html">dir_exists()</a></code> takes a path to a directory as an argument and returns the logical value, <code>TRUE</code>, if that directory exists, and <code>FALSE</code> if it does not.</p>
<p>We can use this function to evaluate whether the directory exists and then use the <code>if()</code> function to process the subsequent code based on the logical flow we set out in <a href="#exm-ad-if-dir-exists-simplified" class="quarto-xref">Example&nbsp;<span>5.10</span></a>. Applied to our project, the code will look like <a href="#exm-ad-swda-if-dir-exists" class="quarto-xref">Example&nbsp;<span>5.11</span></a>.</p>
<div id="exm-ad-swda-if-dir-exists" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.11</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the `fs` package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org">fs</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># URL to SWDA corpus compressed file</span></span>
<span><span class="va">file_url</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"https://catalog.ldc.upenn.edu/docs/LDC97S62/swb1_dialogact_annot.tar.gz"</span></span>
<span></span>
<span><span class="co"># Create a temporary file space for our .tar.gz file</span></span>
<span><span class="va">temp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign our target directory to `extract_to_dir`</span></span>
<span><span class="va">extract_to_dir</span> <span class="op">&lt;-</span> <span class="st">"../data/original/swda/"</span></span>
<span></span>
<span><span class="co"># Check if our target directory exists</span></span>
<span><span class="co"># If it does not exist, download the file and extract it</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_access.html">dir_exists</a></span><span class="op">(</span><span class="va">extract_to_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Download SWDA corpus compressed file</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">file_url</span>, <span class="va">temp_file</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Decompress .tar.gz file and extract to our target directory</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/untar.html">untar</a></span><span class="op">(</span>tarfile <span class="op">=</span> <span class="va">temp_file</span>, exdir <span class="op">=</span> <span class="va">extract_to_dir</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The code in <a href="#exm-ad-swda-if-dir-exists" class="quarto-xref">Example&nbsp;<span>5.11</span></a> is added to the <em>1_acquire_data.qmd</em> file. When this file is run, the SWDA corpus data will be downloaded and extracted to our project directory. If the data already exists, the download will be skipped, just as we wanted.</p>
<p>Now, before we move on, we need to make sure to document the process. Now that our Quarto document includes code we can review, explain, and comment this process. And, as always, create a data origin file as with the relevant information. The data origin file will be stored in the <em>data/original/</em> directory and the Quarto file will be stored in the <em>process/</em> directory.</p>
<p>We’ve leveraged R to automate the download and extraction of the data, depending on the existence of the data in our project directory. But you may be asking yourself, “Can’t I just navigate to the corpus page and download the data manually myself?” The simple answer is, “Yes, you can.” The more nuanced answer is, “Yes, but consider the trade-offs.”</p>
<p>The following scenarios highlight the some advantages to automating the process. If you are acquiring data from multiple files, it can become tedious to document the manual process for each file such that it is reproducible. It’s possible, but it’s error prone.</p>
<p>Now, if you are collaborating with others, you will want to share this data with them. It is very common to find data that has limited restrictions for use in academic projects, but the most common limitation is redistribution. This means that you can use the data for your own research, but you cannot share it with others. If you plan on publishing your project to a code repository to share the data as part of your reproducible project, you would be violating the terms of use for the data. By including the programmatic download in your project, you can ensure that your collaborators can easily and effectively acquire the data themselves and that you are not violating the terms of use.</p>
</section></section><section id="sec-apis" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="sec-apis">
<span class="header-section-number">5.2</span> APIs</h2>
<p>A convenient alternative method for acquiring data in R is through package interfaces to web services. These interfaces are built using R code to make connections with resources on the web through <strong>Application Programming Interfaces</strong> (APIs). Websites such as Project Gutenberg, Twitter, Reddit, and many others provide APIs to allow access to their data under certain conditions, some more limiting for data collection than others. Programmers (like you!) in the R community take up the task of wrapping calls to an API with R code to make accessing that data from R convenient, and of course reproducible.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-medal" aria-label="medal"></i> Dive deeper</strong></p>
<p>Many, many web services provide API access. These APIs span all kinds of data, from text to images to video to audio. Visit the <a href="https://publicapis.io/">Public APIs website</a> to explore the diversity of APIs available.</p>
<p>ROpenSci maintains a curated list of R packages that provide access to data from web services. Visit the <a href="https://ropensci.org/packages/data-access/">ROpenSci website</a> to explore the packages available.</p>
</div>
</div>
</div>
<!-- APIs of interest to linguists -->
<p>In addition to popular public APIs, there are also APIs that provide access to repositories and databases which are of particular interest to linguists. For example, <a href="http://wordbank.stanford.edu/">Wordbank</a> provides access to a large collection of child language corpora through the <code>wordbankr</code> package <span class="citation" data-cites="R-wordbankr">(<a href="../references.html#ref-R-wordbankr" role="doc-biblioref">Braginsky 2024</a>)</span>, and <a href="https://glottolog.org/">Glottolog</a>, <a href="https://wals.info/">World Atlas of Language Structures</a> (WALS), and <a href="https://phoible.org/">PHOIBLE</a> provide access to large collections of language metadata that can be accessed through the <code>lingtypology</code> package <span class="citation" data-cites="R-lingtypology">(<a href="../references.html#ref-R-lingtypology" role="doc-biblioref">Moroz 2024</a>)</span>.</p>
<!-- TalkBank -->
<p>Let’s work with an R package that provides access to the <a href="https://talkbank.org/">TalkBank</a> database. The TalkBank project <span class="citation" data-cites="Macwhinney2003">(<a href="../references.html#ref-Macwhinney2003" role="doc-biblioref">Macwhinney 2003</a>)</span> contains a large collection of spoken language corpora from various contexts: conversation, child language, multilinguals, <em>etc</em>. Resource information, web interfaces, and links to download data in various formats can be found by perusing individual resources linked from the main page. However, the <code>TBDBr</code> package <span class="citation" data-cites="R-TBDBr">(<a href="../references.html#ref-R-TBDBr" role="doc-biblioref">Kowalski and Cavanaugh 2022</a>)</span> provides convenient access to corpora using R once a corpus resource is identified.</p>
<!-- CABNC -->
<p>The CABNC <span class="citation" data-cites="Albert2015">(<a href="../references.html#ref-Albert2015" role="doc-biblioref">Albert, de Ruiter, and de Ruiter 2015</a>)</span> contains the <a href="http://www.natcorp.ox.ac.uk/docs/URG/BNCdes.html#body.1_div.1_div.5_div.1">demographically sampled portion</a> of the spoken portion of the British National Corpus (BNC) <span class="citation" data-cites="Leech1992">(<a href="../references.html#ref-Leech1992" role="doc-biblioref">Leech 1992</a>)</span>.</p>
<p>Useful for a study aiming to research spoken British English, either in isoloation or in comparison to American English (SWDA).</p>
<p>First, we need to install and load the <code>TBDBr</code> package. <a href="#exm-ad-load-pacman" class="quarto-xref">Example&nbsp;<span>5.12</span></a>.</p>
<div id="exm-ad-load-pacman" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.12</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the TBDBr package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TalkBank/TalkBankDB-R">TBDBr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<!-- TBDBr functions -->
<p>The <code>TBDBr</code> package provides a set of common <code>get*()</code> functions for acquiring data from the TalkBank corpus resources. These include:</p>
<ul>
<li><code><a href="https://rdrr.io/pkg/TBDBr/man/getParticipants.html">getParticipants()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/TBDBr/man/getTranscripts.html">getTranscripts()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/TBDBr/man/getTokens.html">getTokens()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/TBDBr/man/getTokenTypes.html">getTokenTypes()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/TBDBr/man/getUtterances.html">getUtterances()</a></code></li>
</ul>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong> List functions and arguments</p>
<p>For any package loaded in your R session, you can list all of its functions and datasets using the <code><a href="https://rdrr.io/r/base/ls.html">ls()</a></code> function. For example, <code>ls("package:TBDBr")</code> will list all of the functions and datasets in the <code>TBDBr</code> package.</p>
<p>To view all of the arguments for a function, use the <code><a href="https://rdrr.io/r/base/args.html">args()</a></code> function. For example, <code>args(getUtterances)</code> will list all of the arguments for the <code><a href="https://rdrr.io/pkg/TBDBr/man/getUtterances.html">getUtterances()</a></code> function.</p>
</div>
</div>
</div>
<p>For each of these function the first argument is <code>corpusName</code>, which is the name of the corpus resource as it appears in the TalkBank database. The second argument is <code>corpora</code>, which takes a character vector describing the path to the data. For the CABNC, these arguments are <code>"ca"</code> and <code>c("ca", "CABNC")</code> respectively. To determine these values, TBDBr provides the <code><a href="https://rdrr.io/pkg/TBDBr/man/getLegalValues.html">getLegalValues()</a></code> interactive function which allows you to interactively select the repository name, corpus name, and transcript name (if necessary).</p>
<p>Another important aspect of these function is that they return data frame objects. Since we are accessing data that is in a structured database, this makes sense. However, we should always check the documentation for the object type that is returned by function to be aware of how to work with the data.</p>
<p>Let’s start by retrieving the utterance data for the CABNC and preview the data frame it returns using <code>glimpse()</code>.</p>
<div id="exm-ad-get-utterances" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.13</strong></span> &nbsp;</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Set corpus_name and corpus_path</span></span>
<span><span class="va">corpus_name</span> <span class="op">&lt;-</span> <span class="st">"ca"</span></span>
<span><span class="va">corpus_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ca"</span>, <span class="st">"CABNC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get utterance data</span></span>
<span><span class="va">utterances</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/TBDBr/man/getUtterances.html">getUtterances</a></span><span class="op">(</span></span>
<span>    corpusName <span class="op">=</span> <span class="va">corpus_name</span>,</span>
<span>    corpora <span class="op">=</span> <span class="va">corpus_path</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the data</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">utterances</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 235,901
&gt; Columns: 10
&gt; $ filename  &lt;list&gt; "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE000",…
&gt; $ path      &lt;list&gt; "ca/CABNC/KB0/KB0RE000", "ca/CABNC/KB0/KB0RE000", "ca/CABNC…
&gt; $ utt_num   &lt;list&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
&gt; $ who       &lt;list&gt; "PS002", "PS006", "PS002", "PS006", "PS002", "PS006", "PS00…
&gt; $ role      &lt;list&gt; "Unidentified", "Unidentified", "Unidentified", "Unidentifi…
&gt; $ postcodes &lt;list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NU…
&gt; $ gems      &lt;list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NU…
&gt; $ utterance &lt;list&gt; "You enjoyed yourself in America", "Eh", "did you", "Oh I c…
&gt; $ startTime &lt;list&gt; "0.208", "2.656", "2.896", "3.328", "5.088", "6.208", "8.32…
&gt; $ endTime   &lt;list&gt; "2.672", "2.896", "3.328", "5.264", "6.016", "8.496", "9.31…</code></pre>
</div>
</div>
</div>
<!-- Inspecting data  -->
<p>Inspecting the output from <a href="#exm-ad-get-utterances" class="quarto-xref">Example&nbsp;<span>5.13</span></a>, we see that the data frame contains 235,901 observations and 10 variables.</p>
<p>The summary provided by <code>glimpse()</code> also provides other useful information. First, we see the data type of each variable. Interestingly, the data type for each variable in the data frame is a list object. Being that a list is two-dimensional data type, like a data frame, we have two-dimensional data inside two-dimensional data. This is known as a <strong>nested structure</strong>. We will work with nested structures in more depth later, but for now it will suffice to say that we would like to ‘unnest’ these lists and reveal the list-contained vector types at the data frame level.</p>
<p>To do this we will pass the <code>utterances</code> data frame to the, appropriately named, <code>unnest()</code> function from the <code>tidyr</code> package <span class="citation" data-cites="R-tidyr">(<a href="../references.html#ref-R-tidyr" role="doc-biblioref">Wickham, Vaughan, and Girlich 2024</a>)</span>. <code>unnest()</code> takes a data frame and a vector of variable names to unnest, <code>cols = c()</code>. To unnest all variables, we will use the <code>everything()</code> function from <code>dplyr</code> to select all variables at once. We will use the result to overwrite the <code>utterances</code> object with the unnested data frame.</p>
<div id="exm-ad-unnest" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.14</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Unnest the data frame</span></span>
<span><span class="va">utterances</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">utterances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the data</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">utterances</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 235,901
&gt; Columns: 10
&gt; $ filename  &lt;chr&gt; "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE000", …
&gt; $ path      &lt;chr&gt; "ca/CABNC/KB0/KB0RE000", "ca/CABNC/KB0/KB0RE000", "ca/CABNC/…
&gt; $ utt_num   &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17…
&gt; $ who       &lt;chr&gt; "PS002", "PS006", "PS002", "PS006", "PS002", "PS006", "PS002…
&gt; $ role      &lt;chr&gt; "Unidentified", "Unidentified", "Unidentified", "Unidentifie…
&gt; $ postcodes &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
&gt; $ gems      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
&gt; $ utterance &lt;chr&gt; "You enjoyed yourself in America", "Eh", "did you", "Oh I co…
&gt; $ startTime &lt;chr&gt; "0.208", "2.656", "2.896", "3.328", "5.088", "6.208", "8.32"…
&gt; $ endTime   &lt;chr&gt; "2.672", "2.896", "3.328", "5.264", "6.016", "8.496", "9.312…</code></pre>
</div>
</div>
</div>
<p>The output from <a href="#exm-ad-unnest" class="quarto-xref">Example&nbsp;<span>5.14</span></a> shows that the variables are now one-dimensional vector types.</p>
<p>Returning to the information about our data frame from <code>glimpse()</code>, the second thing to notice is we get a short preview of the values for each variable. There are a couple things we can gleen from this. One is that we can confirm or clarify the meaning of the variable names by looking at the values. The other thing to consider is whether the values show any patterns that may be worthy of more scrutiny. For example, various variables appear to contain the same values for each observation. For a variable like <code>filename</code>, this is expected as the first values likely correspond to the same file. However, for the variables <code>postcodes</code> and <code>gems</code> the values are ‘NA’. This suggests that these variables may not contain any useful information and we may want to remove them later.</p>
<!-- Writing data -->
<p>For now, however, we want to acquire and store the data in its original form (or as closely as possible). So now, we have acquired the utterances data and have it in our R session as a data frame. To store this data in a file, we will first need to consider the file format. Data frames are tabular, so that gives us a few options.</p>
<p>Since we are working in R, we could store this data as an R object, in the form of an RDS file. An RDS file is a binary file that can be read back into R as an R object. This is a good option if we want to store the data for use in R, but not if we want to share the data with others or use it in other software. Another option is to store the data as a spreadsheet file, such as XSLX (MS Excel). This may make viewing and editing the contents more convenient, but it depends on the software available to you and others. A third, more viable option, is to store the data as a CSV file. CSV files are plain text files that can be read and written by most software. This makes CSV files one of the most popular for sharing tablular data. For this reason, we will store the data as a CSV file.</p>
<p>The <code>readr</code> package provides the <code>write_csv()</code> function for writing data frames to CSV files. The first argument is the data frame to write, and the second argument is the path to the file to write. Note, however, that the directories in the path we specify need to exist. If they do not, we will get an error.</p>
<p>In this case, I would like to write the file <em>utterances.csv</em> to the <em>../data/original/cabnc/</em> directory. The original project structure does not contain a <em>cabnc/</em> directory, so I need to create one. To do this, I will use <code><a href="https://fs.r-lib.org/reference/create.html">dir_create()</a></code> from the <code>fs</code> package.</p>
<div id="exm-ad-write-csv" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.15</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create the target directory</span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span><span class="st">"../data/original/cabnc/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write the data frame to a CSV file</span></span>
<span><span class="fu">write_csv</span><span class="op">(</span><span class="va">utterances</span>, <span class="st">"../data/original/cabnc/utterances.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Chaining the steps covered in Examples <a href="#exm-ad-get-utterances" class="quarto-xref"><span>5.13</span></a>, <a href="#exm-ad-unnest" class="quarto-xref"><span>5.14</span></a>, and <a href="#exm-ad-write-csv" class="quarto-xref"><span>5.15</span></a>, we have a succinct and legible code to acquire, adjust, and write utterances from the CABNC in <a href="#exm-ad-get-unnest-write-csv" class="quarto-xref">Example&nbsp;<span>5.16</span></a>.</p>
<div id="exm-ad-get-unnest-write-csv" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.16</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Set corpus_name and corpus_path</span></span>
<span><span class="va">corpus_name</span> <span class="op">&lt;-</span> <span class="st">"ca"</span></span>
<span><span class="va">corpus_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ca"</span>, <span class="st">"CABNC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the target directory</span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span><span class="st">"../data/original/cabnc/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get utterance data</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/TBDBr/man/getUtterances.html">getUtterances</a></span><span class="op">(</span></span>
<span>  corpusName <span class="op">=</span> <span class="va">corpus_name</span>,</span>
<span>  corpora <span class="op">=</span> <span class="va">corpus_path</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">write_csv</span><span class="op">(</span><span class="st">"../data/original/cabnc/utterances.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<!-- Function -->
<p>If our goal is just to acquire utterances, then we are done acquiring data and we move on to the next step. However, if we want to acquire other datasets from the CABNC, say participants, tokens, <em>etc.</em>, then we can either repeat the steps in <a href="#exm-ad-get-unnest-write-csv" class="quarto-xref">Example&nbsp;<span>5.16</span></a> for each data type, or we can write a function to do this for us!</p>
<p>A function serves us to make our code more legible and reusable for the CABNC, and since the TalkBank data is structured similarly across corpora, we can also use the function to acquire data from other corpora, if need be.</p>
<p>To write a function, we need to consider the following:</p>
<ol type="1">
<li>What is the name of the function?</li>
<li>What arguments does the function take?</li>
<li>What functionality does the function provide?</li>
<li>Does the function have optional arguments?</li>
<li>How does the function return the results?</li>
</ol>
<p>Taking each in turn, the name of the function should be descriptive of what the function does. In this case, we are acquiring and writing data from Talkbank corpora. A possible name is <code>get_talkbank_data()</code>. The required arguments of the the <code>get*()</code> functions will definitely figure in our function. In addition, we will need to specify the path to the directory to write the data. With these considerations, we can write the function signature in <a href="#exm-ad-get-talkbank-data-1" class="quarto-xref">Example&nbsp;<span>5.17</span></a>.</p>
<div id="exm-ad-get-talkbank-data-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.17</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">get_talkbank_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">corpus_name</span>, <span class="va">corpus_path</span>, <span class="va">target_dir</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># ...</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The next thing to consider is what functionality the function provides. In this case, we want to acquire and write data from Talkbank corpora. We can start by leveraging the code steps in <a href="#exm-ad-get-unnest-write-csv" class="quarto-xref">Example&nbsp;<span>5.16</span></a>, making some adjustments to the code replacing the hard-coded values with the function arguments and adding code to create the target file name based on the <code>target_dir</code> argument.</p>
<div id="exm-ad-get-talkbank-data-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.18</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">get_talkbank_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">corpus_name</span>, <span class="va">corpus_path</span>, <span class="va">target_dir</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Create the target directory</span></span>
<span>  <span class="fu"><a href="https://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span><span class="va">target_dir</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Set up file path name</span></span>
<span>  <span class="va">utterances_file</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://fs.r-lib.org/reference/path.html">path</a></span><span class="op">(</span><span class="va">target_dir</span>, <span class="st">"utterances.csv"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Acquire data and write to file</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/TBDBr/man/getUtterances.html">getUtterances</a></span><span class="op">(</span>corpusName <span class="op">=</span> <span class="va">corpus_name</span>, corpora <span class="op">=</span> <span class="va">corpus_path</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">write_csv</span><span class="op">(</span><span class="va">utterances_file</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Before we address the obvious feature missing, which is the fact that this function in <a href="#exm-ad-get-talkbank-data-2" class="quarto-xref">Example&nbsp;<span>5.18</span></a> only acquires and writes data for utterances, let’s consider some functionality which would make this function more user-friendly.</p>
<p>What if the data is already acquired? Do we want to overwrite it, or should the function skip the process for files that already exist? By skipping the process, we can save time and computing resources. If the files are periodically updated, then we might want to overwrite existing files.</p>
<p>To achieve this functionality we will use an <code>if()</code> statement to check if the file exists. If it does, then we will skip the process. If it does not, then we will acquire and write the data.</p>
<div id="exm-ad-get-talkbank-data-3" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.19</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">get_talkbank_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">corpus_name</span>, <span class="va">corpus_path</span>, <span class="va">target_dir</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Create the target directory</span></span>
<span>  <span class="fu"><a href="https://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span><span class="va">target_dir</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Set up file path name</span></span>
<span>  <span class="va">utterances_file</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://fs.r-lib.org/reference/path.html">path</a></span><span class="op">(</span><span class="va">target_dir</span>, <span class="st">"utterances.csv"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># If the file does not exist, then...</span></span>
<span>  <span class="co"># Acquire data and write to file</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_access.html">file_exists</a></span><span class="op">(</span><span class="va">utterances_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/TBDBr/man/getUtterances.html">getUtterances</a></span><span class="op">(</span>corpusName <span class="op">=</span> <span class="va">corpus_name</span>, corpora <span class="op">=</span> <span class="va">corpus_path</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">write_csv</span><span class="op">(</span><span class="va">utterances_file</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We can also add functionality to <a href="#exm-ad-get-talkbank-data-3" class="quarto-xref">Example&nbsp;<span>5.19</span></a> to force overwrite existing files, if need be. To do this, we will add an optional argument to the function, <code>force</code>, which will be a logical value. We will set the default to <code>force = FALSE</code> to preserve the existing functionality. If <code>force = TRUE</code>, then we will overwrite existing files. Then we add another condition to the <code>if()</code> statement to check if <code>force = TRUE</code>. If it is, then we will overwrite existing files.</p>
<div id="exm-ad-get-talkbank-data-4" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.20</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">get_talkbank_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">corpus_name</span>, <span class="va">corpus_path</span>, <span class="va">target_dir</span>, <span class="va">force</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Create the target directory</span></span>
<span>  <span class="fu"><a href="https://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span><span class="va">target_dir</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Set up file path name</span></span>
<span>  <span class="va">utterances_file</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://fs.r-lib.org/reference/path.html">path</a></span><span class="op">(</span><span class="va">target_dir</span>, <span class="st">"utterances.csv"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># If the file does not exist, then...</span></span>
<span>  <span class="co"># Acquire data and write to file</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_access.html">file_exists</a></span><span class="op">(</span><span class="va">utterances_file</span><span class="op">)</span> <span class="op">|</span> <span class="va">force</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/TBDBr/man/getUtterances.html">getUtterances</a></span><span class="op">(</span>corpusName <span class="op">=</span> <span class="va">corpus_name</span>, corpora <span class="op">=</span> <span class="va">corpus_path</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">write_csv</span><span class="op">(</span><span class="va">utterances_file</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>From this point, we add the functionality to acquire and write the other data available from Talkbank corpora, such as participants, tokens, <em>etc.</em> This involves adding additional file path names and <code>if()</code> statements to check if the files exist surrounding the processing steps to <a href="#exm-ad-get-talkbank-data-4" class="quarto-xref">Example&nbsp;<span>5.20</span></a>. It may be helpful to perform other input checks, print messages, <em>etc.</em> for functions that we plan to share with others. I will leave these enhancements as an exercise for the reader.</p>
<!-- Function location -->
<p>Before we leave the topic of functions, let’s consider where to put functions after we write them. Here are a few options:</p>
<ol type="1">
<li>In the same script as the code that uses the function.</li>
<li>In a separate script, such as <em>functions.R</em>.</li>
<li>In a package, which is loaded by the script that uses the function.</li>
</ol>
<p>The general heuristic for choosing where to put functions is to put them in the same script as the code that uses them if the function is only used in that script. If the function is used in multiple scripts or the function or number of functions clutters the readability of the code, then put it in a separate script. If the function is used in multiple projects, then put it in an R package.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-medal" aria-label="medal"></i> Dive deeper</strong></p>
<p>If you are interested in learning more about writing functions, check out the <a href="https://r4ds.had.co.nz/functions.html">Writing Functions chapter</a> in the <a href="https://r4ds.had.co.nz/">R for Data Science</a> book.</p>
<p>If you find yourself writing functions that are useful for multiple projects, you may want to consider creating an R package. R packages are a great way to share your code with others. If you are interested in learning more about creating R packages, check out the <a href="https://r-pkgs.org/">R Packages book</a> by Hadley Wickham and Jenny Bryan.</p>
</div>
</div>
</div>
<p>In this case, we will put the function in a separate file, <em>functions.R</em>, in the same directory as the other process files as in <a href="#exm-ad-functions-r" class="quarto-xref">Example&nbsp;<span>5.23</span></a>.</p>
<div id="exm-ad-functions-r" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.21</strong></span> &nbsp;</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">process/</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">│</span>   ├── 1_acquire_data.qmd</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">│</span>   ├── ...</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">│</span>   └── functions.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>Note that that the <em>functions.R</em> file is an R script, not a Quarto document. Therefore code blocks that are used in <em>.qmd</em> files are not used, only the R code and code comments.</p>
</div>
</div>
</div>
<p>To include this, or other functions in in the R session of the process file that uses them, use the <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> function, as seen in <a href="#exm-ad-source-functions" class="quarto-xref">Example&nbsp;<span>5.22</span></a>.</p>
<div id="exm-ad-source-functions" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.22</strong></span> &nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Source functions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"functions.R"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>It is common to source functions at the top of the process file as part of the package setup.</p>
<p>Given the utility of this function to my projects and potentially others’, I’ve included the <code>get_talkbank_data()</code> function in the <code>qtalrkit</code> package. You can view the source code by calling the function without parentheses <code>()</code>, or on the <code>qtalrkit</code> GitHub repository.</p>
<p>After running the <code>get_talkbank_data()</code> function, we can see that the data has been acquired and written to the <em>data/original/cabnc/</em> directory.</p>
<div id="exm-ad-functions-r" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.23</strong></span> &nbsp;</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> cabnc</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> participants.csv</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> token_types.csv</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> tokens.csv</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> transcripts.csv</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> utterances.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- Note on documentation -->
<p>Add comments to your code in <em>1-acquire-data.qmd</em> and create and complete the data origin documentation file for this resource, and the acquisition is complete.</p>
</section><section id="activities" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="activities">Activities</h2>
<p>Building on the activities in the previous chapter, these activities will focus on the implementation of the data acquisition process. Key programming concepts include writing custom functions, control statements, and applying functions iteratively will be covered in addition to packages and functions which provide access to data from the web.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-file-code" aria-label="file-code"></i> Recipe</strong></p>
<p><strong>What</strong>: <a href="https://qtalr.github.io/qtalrkit/articles/recipe-5.html">Collecting and documenting data</a><br><strong>How</strong>: Read Recipe 5, complete comprehension check, and prepare for Lab 5.<br><strong>Why</strong>: To refine programming strategies introduced in the lesson for controlling program flow and making code more reusable in the service of programmatically acquiring and documenting data.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-flask" aria-label="flask"></i> Lab</strong></p>
<p><strong>What</strong>: <a href="https://github.com/qtalr/lab-05">Harvesting research data</a><br><strong>How</strong>: Fork, clone, and complete the steps in Lab 5.<br><strong>Why</strong>: To investigate data sources, plan data collection strategies, and apply skills and knowledge to use R to collect and document data.</p>
</div>
</div>
</div>
</section><section id="summary" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="summary">Summary</h2>
<p>In this chapter, we have covered a lot of ground. On the surface we have discussed a few methods for acquiring corpus data for use in text analysis. In the process we have delved into various aspects of the R programming language. Some key concepts include writing control statements and custom functions. We have also considered topics that are more general in nature and concern interacting with data found on the internet.</p>
<p>Each of these methods should be approached in a way that is transparent to the researcher and to would-be collaborators and the general research community. For this reason the documentation of the steps taken to acquire data are key both in the code and in human-facing documentation.</p>
<p>At this point you have both a bird’s eye view of the data available on the web and strategies on how to access a great majority of it. It is now time to turn to the next step in our data analysis project: data curation. In the next chapter, I will cover how to wrangle your raw data into a tidy dataset.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Albert2015" class="csl-entry" role="listitem">
Albert, Saul, Laura E. de Ruiter, and J. P. de Ruiter. 2015. <span>“CABNC: The Jeffersonian Transcription of the Spoken British National Corpus.”</span> TalkBank.
</div>
<div id="ref-R-wordbankr" class="csl-entry" role="listitem">
Braginsky, Mika. 2024. <em>Wordbankr: Accessing the Wordbank Database</em>. <a href="https://langcog.github.io/wordbankr/">https://langcog.github.io/wordbankr/</a>.
</div>
<div id="ref-R-fs" class="csl-entry" role="listitem">
Hester, Jim, Hadley Wickham, and Gábor Csárdi. 2023. <em>Fs: Cross-Platform File System Operations Based on Libuv</em>. <a href="https://fs.r-lib.org">https://fs.r-lib.org</a>.
</div>
<div id="ref-R-TBDBr" class="csl-entry" role="listitem">
Kowalski, John, and Rob Cavanaugh. 2022. <em>TBDBr: Easy Access to TalkBankDB via r API</em>. <a href="https://github.com/TalkBank/TalkBankDB-R">https://github.com/TalkBank/TalkBankDB-R</a>.
</div>
<div id="ref-Leech1992" class="csl-entry" role="listitem">
Leech, Geoffrey. 1992. <span>“100 Million Words of English: The British National Corpus (BNC),”</span> no. 1991: 1–13.
</div>
<div id="ref-Lozano2009" class="csl-entry" role="listitem">
Lozano, Cristóbal. 2009. <span>“CEDEL2: Corpus Escrito Del Espa<span>ñ</span>ol L2.”</span> <em>Applied Linguistics Now: Understanding Language and Mind/La Ling<span>ü</span><span>í</span>stica Aplicada Hoy: Comprendiendo El Lenguaje y La Mente. Almer<span>í</span>a: Universidad de Almer<span>í</span>a</em>, 197–212.
</div>
<div id="ref-Macwhinney2003" class="csl-entry" role="listitem">
Macwhinney, Brian. 2003. <span>“TalkBank.”</span> Repository. <em>The TalkBank System</em>. https://www.talkbank.org/.
</div>
<div id="ref-R-lingtypology" class="csl-entry" role="listitem">
Moroz, George. 2024. <em>Lingtypology: Linguistic Typology and Mapping</em>. <a href="https://CRAN.R-project.org/package=lingtypology">https://CRAN.R-project.org/package=lingtypology</a>.
</div>
<div id="ref-Tottie2011" class="csl-entry" role="listitem">
Tottie, Gunnel. 2011. <span>“Uh and Um as Sociolinguistic Markers in British English.”</span> <em>International Journal of Corpus Linguistics</em> 16 (2): 173–97.
</div>
<div id="ref-SWDA2008" class="csl-entry" role="listitem">
University of Colorado Boulder. 2008. <span>“Switchboard Dialog Act Corpus. Web Download.”</span> Linguistic Data Consortium.
</div>
<div id="ref-R-tidyr" class="csl-entry" role="listitem">
Wickham, Hadley, Davis Vaughan, and Maximilian Girlich. 2024. <em>Tidyr: Tidy Messy Data</em>. <a href="https://tidyr.tidyverse.org">https://tidyr.tidyverse.org</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../part_3/index.html" class="pagination-link" aria-label="Preparation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preparation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../part_3/6_curate.html" class="pagination-link" aria-label="Curate">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/qtalr/book/blob/main/part_3/5_acquire.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/qtalr/book/edit/main/part_3/5_acquire.qmd" target="_blank" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/qtalr/book/issues" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>
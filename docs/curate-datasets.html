<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>An Introduction to Quantitative Text Analysis for Linguistics - 6&nbsp; Curate datasets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./transform-datasets.html" rel="next">
<link href="./acquire-data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="stylesheet" href="assets/css/mini.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./preparation.html">Preparation</a></li><li class="breadcrumb-item"><a href="./curate-datasets.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">An Introduction to Quantitative Text Analysis for Linguistics</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/qtalr/book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./qtalr-manuscript.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./orientation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Orientation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text analysis in context</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./understanding-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Understanding data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./approaching-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Approaching analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./framing-research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Framing research</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acquire-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./curate-datasets.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transform-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Reports</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collaboration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Collaboration</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feedback.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Feedback <i class="fa-solid fa-comment" aria-label="comment"></i></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#unstructured" id="toc-unstructured" class="nav-link active" data-scroll-target="#unstructured"><span class="header-section-number">6.1</span> Unstructured</a>
  <ul class="collapse">
<li><a href="#reading-data" id="toc-reading-data" class="nav-link" data-scroll-target="#reading-data"><span class="header-section-number">6.1.1</span> Reading data</a></li>
  <li><a href="#orientation" id="toc-orientation" class="nav-link" data-scroll-target="#orientation"><span class="header-section-number">6.1.2</span> Orientation</a></li>
  <li><a href="#tidy-the-data" id="toc-tidy-the-data" class="nav-link" data-scroll-target="#tidy-the-data"><span class="header-section-number">6.1.3</span> Tidy the data</a></li>
  <li><a href="#write-dataset" id="toc-write-dataset" class="nav-link" data-scroll-target="#write-dataset"><span class="header-section-number">6.1.4</span> Write dataset</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">6.1.5</span> Summary</a></li>
  </ul>
</li>
  <li>
<a href="#structured" id="toc-structured" class="nav-link" data-scroll-target="#structured"><span class="header-section-number">6.2</span> Structured</a>
  <ul class="collapse">
<li><a href="#reading-data-1" id="toc-reading-data-1" class="nav-link" data-scroll-target="#reading-data-1"><span class="header-section-number">6.2.1</span> Reading data</a></li>
  <li><a href="#orientation-1" id="toc-orientation-1" class="nav-link" data-scroll-target="#orientation-1"><span class="header-section-number">6.2.2</span> Orientation</a></li>
  <li><a href="#tidy-the-dataset" id="toc-tidy-the-dataset" class="nav-link" data-scroll-target="#tidy-the-dataset"><span class="header-section-number">6.2.3</span> Tidy the dataset</a></li>
  <li><a href="#write-dataset-1" id="toc-write-dataset-1" class="nav-link" data-scroll-target="#write-dataset-1"><span class="header-section-number">6.2.4</span> Write dataset</a></li>
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1"><span class="header-section-number">6.2.5</span> Summary</a></li>
  </ul>
</li>
  <li>
<a href="#semi-structured" id="toc-semi-structured" class="nav-link" data-scroll-target="#semi-structured"><span class="header-section-number">6.3</span> Semi-structured</a>
  <ul class="collapse">
<li><a href="#reading-data-2" id="toc-reading-data-2" class="nav-link" data-scroll-target="#reading-data-2"><span class="header-section-number">6.3.1</span> Reading data</a></li>
  <li><a href="#orientation-2" id="toc-orientation-2" class="nav-link" data-scroll-target="#orientation-2"><span class="header-section-number">6.3.2</span> Orientation</a></li>
  <li><a href="#tidy-the-data-1" id="toc-tidy-the-data-1" class="nav-link" data-scroll-target="#tidy-the-data-1"><span class="header-section-number">6.3.3</span> Tidy the data</a></li>
  <li><a href="#write-dataset-2" id="toc-write-dataset-2" class="nav-link" data-scroll-target="#write-dataset-2"><span class="header-section-number">6.3.4</span> Write dataset</a></li>
  <li><a href="#summary-2" id="toc-summary-2" class="nav-link" data-scroll-target="#summary-2"><span class="header-section-number">6.3.5</span> Summary</a></li>
  </ul>
</li>
  <li><a href="#summary-3" id="toc-summary-3" class="nav-link" data-scroll-target="#summary-3">Summary</a></li>
  <li><a href="#activities" id="toc-activities" class="nav-link" data-scroll-target="#activities">Activities</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/qtalr/book/edit/main/curate-datasets.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/qtalr/book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-curate-datasets" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-default callout-caution callout-titled" title="Caution">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><i class="fa-solid fa-route" aria-label="route"></i> In progress…</p>
</div>
</div>
<!-- 

Content:

- [ ] adding a description of the importance of the 'unit of analysis' in the structuring of the curated dataset
  - Note: this is touched upon in the 'Foundations' part, but it is important to see how this is implemented in the curation process. 
  - Also it should be mentioned that many times you want to keep the unit of observation and sometimes the unit of analysis somewhat flexible, so that you can explore different ways of framing the data (especially in the case of IDA approaches).
- [ ] the unit of analysis is tied with the research question --so consider how to frame the curation process for the various data/ datasets so that the unit of analysis
  - [ ] Note: the unit of observation is where we are going in the next chapter with "Transform datasets". So we need to make sure that we are clear about the distinction between the two.

Exercises:

- [ ] add concept questions to Activities
- [ ] add exercises to Activities
- [ ] add thought questions/ case studies to prose sections

Formatting:

- [ ] cite the packages used
- [ ] cite the europarl Corpus 
- [ ] correct the file names for Switchboard to reflect the dataset_curated.csv, and dataset_data_dictionary.csv format

-->
<blockquote class="blockquote">
<p>The hardest bit of information to extract is the first piece.</p>
<p>— Robert Ferrigno</p>
</blockquote>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-list-alt" aria-label="list-alt"></i> Outcomes</strong></p>
<!-- Remember and understand verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] change to outcomes -->
<ul>
<li>what are some of the formats that data can take?</li>
<li>what R programming strategies are used to read these formats into tabular, tidy dataset structures?</li>
<li>what is the importance of maintaining modularity between data and data processing in a reproducible research project?</li>
</ul>
</div>
</div>
</div>
<ul class="task-list">
<li>
<input type="checkbox">Revise: to reflect the new structure/ content of the chapter</li>
</ul>
<p>In this chapter we will now look at the next step in a text analysis project: data curation. That is, the process of converting the original data we acquire to a tidy dataset. Acquired data can come in a wide variety of formats. These formats tend to signal the richness of the metadata that is included in the file content. In this chapter we will consider three general types of content formats: (1) unstructured data, (2) structured data, and (3) semi-structured data. Regardless of the file type and the structure of the data, it will be necessary to consider how to curate a dataset that such that the structure reflects the basic the unit of analysis that we wish to investigate. The resulting dataset will form the base from which we will work to further transform the dataset such that it aligns with the unit(s) of observation required for the analysis method(s) that we will implement. Once the dataset is curated, we will create a data dictionary that describes the dataset and the variables that are included in the dataset for transparency and reproducibility.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-terminal" aria-label="terminal"></i> Swirl lesson</strong></p>
<!-- Remember and understand verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- Learn how to use regular expressions to match patterns in text using the *stringr* package. Learn how to manipulate data using the `dplyr` package. -->
<p><strong>What</strong>: <a href="https://github.com/qtalr/lessons">Pattern Matching and Manipulate Datasets</a><br><strong>How</strong>: In the R Console pane load <code>swirl</code>, run <code>swirl()</code>, and follow prompts to select the lesson.<br><strong>Why</strong>: To familiarize yourself with the basics of using the pattern matching syntax Regular Expressions and the <code>dplyr</code> package to manipulate datasets.</p>
</div>
</div>
</div>
<section id="unstructured" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="unstructured">
<span class="header-section-number">6.1</span> Unstructured</h2>
<p>The bulk of text ever created is of the unstructured variety. Unstructured data is data that has not been organized to make the information contained within machine-readable. Remember that text in itself is not information. Only when given explicit context does text become informative. The explicit contextual information that is included with data is called metadata. Metadata can be linguistic or non-linguistic in nature. So for unstructured data there is little to no metadata directly associated with the data. This information needs to be added or derived for the purposes of the research, either through manual inspection or (semi-)automatic processes. For now, however, our job is just to get the unstructured data into a structured format with a minimal set of metadata that we can derive from the resource.</p>
<section id="reading-data" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="reading-data">
<span class="header-section-number">6.1.1</span> Reading data</h3>
<p>Let’s consider some of the common file formats which contain unstructured data, such as TXT, PDF, and DOCX, and how to read these formats into an R session.</p>
<p>It is very common for unstructured data resources to include data that is in TXT files. These are the simplest of file formats which contain no formatting or explicit metadata. Many times TXT files have the <em>.txt</em> extension, but it is not required. There are many ways to read TXT files into R and many packages that can be used to do so. For example, using the <code>readr</code> package, we can choose to read the entire file into a single vector of character strings with <code>read_file()</code> or read the file by lines with <code>read_lines()</code> in which each line is a character string in a vector.</p>
<p>Less commonly used in prepared data resources, PDF and DOCX files are also formats for unstructured data. These formats are often more complex than TXT files as they contain formatting and embedded metadata. However, these attributes are primarily for visual presentation and not for machine-readability. Therefore, we need to use packages and functions that can extract the text content from these files and potentially some of the metadata. For example, using the <code>readtext</code> package <span class="citation" data-cites="R-readtext">(<a href="references.html#ref-R-readtext" role="doc-biblioref">Benoit and Obeng 2023</a>)</span>, we can read the text content from PDF and DOCX files into a single vector of character strings with <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code>.</p>
<p>Whether in TXT, PDF, or DOCX format, the resulting data structure will require further processing to convert the data into a tidy dataset. For example, we may need to split the data into multiple columns or rows, or extract metadata from the text content.</p>
</section><section id="orientation" class="level3" data-number="6.1.2"><h3 data-number="6.1.2" class="anchored" data-anchor-id="orientation">
<span class="header-section-number">6.1.2</span> Orientation</h3>
<p>As an example of curating an unstructured source of corpus data, let’s take a look at the <a href="https://www.statmt.org/europarl/">Europarl Parallel Corpus</a> <span class="citation" data-cites="Koehn2005">(<a href="references.html#ref-Koehn2005" role="doc-biblioref">Koehn 2005</a>)</span>. This corpus contains parallel texts (source and translated documents) from the European Parliamentary proceedings between 1996-2011 for some 21 European languages.</p>
<p>Let’s assuming we selected this corpus data because we are interested in researching Spanish to English translations. After consulting the corpus website, downloading the compressed file, and inspecting the decompressed structure, we have the the file structure seen in <a href="#exm-cd-europarl-file-structure">Example&nbsp;<span>6.1</span></a>.</p>
<div id="exm-cd-europarl-file-structure" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.1 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">project/</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> code/</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 1-acquire-data.qmd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 2-curate-data.qmd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── ...</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> data/</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── analysis/</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── derived/</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── original/</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       │── europarl_do.csv</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── europarl/</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>           ├── europarl-v7.es-en.en</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>           └── europarl-v7.es-en.es</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> output/</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── figures/</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── reports/</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── results/</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── tables/</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> _main.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <em>europarl_do.csv</em> file contains the data origin information documented as part of the acquisition process. The contents are seen in <a href="#tbl-cd-europarl-data-origin">Table&nbsp;<span>6.1</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-cd-europarl-data-origin" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.1: Data origin: Europarl Corpus</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">attribute</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Resource name</td>
<td style="text-align: left;">Europarl Parallel Corpus</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data source</td>
<td style="text-align: left;">&lt;https://www.statmt.org/europarl/&gt;</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Data sampling frame</td>
<td style="text-align: left;">Spanish transcripts from the European Parliament proceedings</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data collection date(s)</td>
<td style="text-align: left;">1996-2011</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Data format</td>
<td style="text-align: left;">TXT files with '.es' for source (Spanish) and '.en' for target (English) files.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data schema</td>
<td style="text-align: left;">Line-by-line unannotated parallel text</td>
</tr>
<tr class="odd">
<td style="text-align: left;">License</td>
<td style="text-align: left;">See: &lt;https://www.europarl.europa.eu/legal-notice/en/&gt;</td>
</tr>
<tr class="even">
<td style="text-align: left;">Attribution</td>
<td style="text-align: left;">Please cite the paper: Koehn, P. 2005. 'Europarl: A Parallel Corpus for Statistical Machine Translation.' MT Summit X, 12-16.</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<!-- [x] Update directory structure and reference to the data -->
<p>Now let’s get familiar with the corpus directory structure and the files. In <a href="#exm-cd-europarl-file-structure">Example&nbsp;<span>6.1</span></a>, we see that there are two corpus files, <em>europarl-v7.es-en.es</em> and <em>europarl-v7.es-en.en</em>, that contain the source and target language texts, respectively. The file names indicate that the files contain Spanish-English parallel texts. The <em>.es</em> and <em>.en</em> extensions indicate the language of the text.</p>
<p>Looking at the beginning of the <em>.es</em> and <em>.en</em> files, in <a href="#exm-cd-europarl-sample-source">Example&nbsp;<span>6.2</span></a> and <a href="#exm-cd-europarl-sample-target">Example&nbsp;<span>6.3</span></a>, we see that the files contain a series of lines in either the source or target language.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="exm-cd-europarl-sample-source" class="theorem example quarto-layout-cell" style="flex-basis: 49.5%;justify-content: flex-start;">
<p><span class="theorem-title"><strong>Example 6.2 </strong></span><em>europarl-v7.es-en.es</em> sample</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Reanudación del período de sesiones</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Declaro reanudado el período de sesiones del Parlamento Europeo, interrumpido el viernes 17 de diciembre pasado, y reitero a Sus Señorías mi deseo de que hayan tenido unas buenas vacaciones.</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>Como todos han podido comprobar, el gran "efecto del año 2000" no se ha producido. En cambio, los ciudadanos de varios de nuestros países han sido víctimas de catástrofes naturales verdaderamente terribles.</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Sus Señorías han solicitado un debate sobre el tema para los próximos días, en el curso de este período de sesiones.</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>A la espera de que se produzca, de acuerdo con muchos colegas que me lo han pedido, pido que hagamos un minuto de silencio en memoria de todas las víctimas de las tormentas, en los distintos países de la Unión Europea afectados.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 1.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div id="exm-cd-europarl-sample-target" class="theorem example quarto-layout-cell" style="flex-basis: 49.5%;justify-content: flex-start;">
<p><span class="theorem-title"><strong>Example 6.3 </strong></span><em>europarl-v7.es-en.en</em> sample</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Resumption of the session</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>I declare resumed the session of the European Parliament adjourned on Friday 17 December 1999, and I would like once again to wish you a happy new year in the hope that you enjoyed a pleasant festive period.</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>Although, as you will have seen, the dreaded 'millennium bug' failed to materialise, still the people in a number of countries suffered a series of natural disasters that truly were dreadful.</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>You have requested a debate on this subject in the course of the next few days, during this part-session.</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>In the meantime, I should like to observe a minute' s silence, as a number of Members have requested, on behalf of all the victims concerned, particularly those of the terrible storms, in the various countries of the European Union.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>We can clearly appreciate that the data is unstructured. That is, there is no explicit metadata associated with the data. The data is just a series of lines. The only information that we can surmise from structure of the data is that the texts are line-aligned and that the data in each file corresponds to source and target languages.</p>
<p>Now, before embarking on a data curation process, it is recommendable to define the structure of the data that we want to create. I call this the “idealized structure” of the data. For a curated dataset there are two considerations. First, we want to maintain the original structure of the data as much as possible. This provides a link to the original data and gives us a default dataset structure from which we can derive other structures that fit our analysis needs. Second, we want to add structure to the data that makes it easier to work with. This is the ‘tidy’ part of the data curation process. The aim is to embue the dataset with as much of the metadata the data resource makes available.</p>
<p>Given what we know about the data, we can define the idealized structure of the data as seen in <a href="#tbl-cd-europarl-structure-example">Table&nbsp;<span>6.2</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-cd-europarl-structure-example" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.2: Idealized structure for the europarl Corpus dataset.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">doc_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">line_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">line</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Source</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">...line from source language</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Source</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">...</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Source</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">...</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Target</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">...line from target language</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Target</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">...</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">Target</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">...</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>The dataset structure in <a href="#tbl-cd-europarl-structure-example">Table&nbsp;<span>6.2</span></a> has four columns. The first column, <code>doc_id</code> is a unique identifier for each line in the corpus. <code>type</code>, indicates whether the line is from the source or target language. The third column, <code>line_id</code>, is a unique identifier for each line for each <code>type</code>. The last column, <code>line</code>, contains the text of the line, and maintains the structure of the original data. The observations are lines.</p>
<p>Our task now is to develop code that will read the original data and render the idealized structure as a curated dataset we will write to the <em>data/derived/</em> directory. The code we develop will be added to the <em>2-curate-data.qmd</em> file. And finally, the dataset will be documented with a data dictionary file.</p>
</section><section id="tidy-the-data" class="level3" data-number="6.1.3"><h3 data-number="6.1.3" class="anchored" data-anchor-id="tidy-the-data">
<span class="header-section-number">6.1.3</span> Tidy the data</h3>

<!-- 
- [x] make clear reference to "idealized structure" table, for each of the sections (unstructured, structured, semi-structured)
-->
<p>To create the idealized dataset structure in <a href="#tbl-cd-europarl-structure-example">Table&nbsp;<span>6.2</span></a>, lets’s start by reading the files into R. We will use the <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function from the <code>readtext</code> package. <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> is a versatile function that can read many different types of text files (<em>e.g.</em> <em>.txt</em>, <em>.csv</em>, <em>xml</em>, <em>etc.</em>). It can also read multiple files at once using wildcard matching. We will use it to read the <em>.es</em> and <em>.en</em> files by passing the path to the directory where the files are located, and then use the <code>*</code> wildcard to read all the files in the directory.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/quanteda/readtext">readtext</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read Europarl files .es and .en</span></span>
<span><span class="va">europarl_docs_tbl</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext</a></span><span class="op">(</span><span class="st">"../data/original/europarl/*"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># read in files</span></span>
<span>  <span class="fu">tibble</span><span class="op">(</span><span class="op">)</span> <span class="co"># convert to tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exm-cd-europarl-readtext" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.4 </strong></span>&nbsp;</p>
</div>
<p>In <a href="#exm-cd-europarl-readtext">Example&nbsp;<span>6.4</span></a>, the <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function reads all the files in the <em>../data/curate-datasets/europarl/</em> directory and returns a tibble.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i> Warning</strong></p>
<p>The <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function can read many different types of file formats, from structured to unstructured. However, it depends in large part on the extension of the file to recognize what algorithm to use when reading a file. In this particular case, the Europarl files do not have a typical extension (they have <code>.en</code> and <code>.es</code>). The <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function will treat them as plain text (<code>.txt</code>), but it will throw a warning message. To suppress the warning message you can add the <code>verbosity = 0</code> argument or set <code>readtext_options(verbosity = 0)</code>.</p>
</div>
</div>
</div>
<p>Let’s inspect the <code>europarl_docs_tbl</code> object with the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function, in <a href="#exm-cd-europarl-readtext-str">Example&nbsp;<span>6.5</span></a>.</p>
<div id="exm-cd-europarl-readtext-str" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.5 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Preview data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">europarl_docs_tbl</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; tibble [2 × 2] (S3: tbl_df/tbl/data.frame)
&gt;  $ doc_id: chr [1:2] "europarl-v7.es-en.en" "europarl-v7.es-en.es"
&gt;  $ text  : chr [1:2] "Resumption of the session\nI declare resumed the session of the European Parliament adjourned on Friday 17 Dece"| __truncated__ "Reanudación del período de sesiones\nDeclaro reanudado el período de sesiones del Parlamento Europeo, interrump"| __truncated__</code></pre>
</div>
</div>
</div>
<p>We see that the output from <a href="#exm-cd-europarl-readtext-str">Example&nbsp;<span>6.5</span></a> is a tibble with two columns, <code>doc_id</code> and <code>text</code>. The <code>doc_id</code> column contains the name of the file from which the text was read. The <code>text</code> column contains the text of the file. There are two observations, one for each file.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>Note that the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function from base R is similar to <code>glimpse()</code>. However, <code>glimpse()</code> will attempt to show you as much data as possible. In this case since our column <code>text</code> is a very long character vector it will take a long time to render. I’ve chosen the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function as it will automatically truncate the data.</p>
</div>
</div>
</div>
<!-- [x] I need to standardize how I refer to packages `readtext` -->
<p>The fact that we only have one row for each file means that all the text in each file is contained in one cell! We want to break these cells up into rows for each line, as they appear in the original data. You may be wondering why the <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function did not do this for us, after all the original data was already separated into lines. The reason is that the <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function chose to read the files as plain text, and plain text does not have any structure. The line breaks, however, are still there, they are just represented as a special character, <code>\n</code>. Comparing <a href="#exm-cd-europarl-text-lines">Example&nbsp;<span>6.6</span></a> and <a href="#exm-cd-europarl-text-lines-raw">Example&nbsp;<span>6.7</span></a>, we can see that the text is a single long character vector, and that the line breaks are represented as <code>\n</code>.</p>
<div id="exm-cd-europarl-text-lines" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.6 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Preview first 50 characters</span></span>
<span><span class="va">europarl_docs_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">str_trunc</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">str_view</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] │ Resumption of the session
&gt;     │ I declare resumed the...
&gt; [2] │ Reanudación del período de sesiones
&gt;     │ Declaro rea...</code></pre>
</div>
</div>
</div>
<div id="exm-cd-europarl-text-lines-raw" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.7 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Preview first 50 raw characters</span></span>
<span><span class="va">europarl_docs_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">str_trunc</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">str_view</span><span class="op">(</span>use_escapes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] │ Resumption of the session\nI declare resumed the...
&gt; [2] │ Reanudaci\u00f3n del per\u00edodo de sesiones\nDeclaro rea...</code></pre>
</div>
</div>
</div>
<p>In <a href="#exm-cd-europarl-text-lines">Example&nbsp;<span>6.6</span></a>, we can see a truncated version of the text as it is in a printed format. The <code>str_trunc()</code> function from the <code>stringr</code> package <span class="citation" data-cites="R-stringr">(<a href="references.html#ref-R-stringr" role="doc-biblioref">Wickham 2022</a>)</span> truncates the text to the first 50 characters. The <code>str_view()</code> function from the same package allows us to see the text in a viewer pane.</p>
<p>In <a href="#exm-cd-europarl-text-lines-raw">Example&nbsp;<span>6.7</span></a>, we can see the raw text, that is, the text as it is stored in the computer. The <code>use_escapes = TRUE</code> argument tells the <code>str_view()</code> function to show the special characters as they are stored in the computer. This includes the <code>\n</code> line-feed character, which represents a line break.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>The <code>str_view()</code> with the argument <code>use_escapes = TRUE</code> also allows you to see other special characters, such as <code>\t</code> (tab) and <code>\r</code> (carriage return) as well as Unicode characters, such as <code>\u00f3n</code> (ó), <code>\u00ed</code> (í), <em>etc.</em>. These characters are not visible in the printed version of the text, but they are there in the raw text.</p>
</div>
</div>
</div>
<p>We can see that the text is a single long character vector, and that the line breaks are represented as <code>\n</code>. So our goal is to split the text for each file into lines creating a new row for each line created.</p>
<p>To do this we will use another function from the <code>stringr</code> package, <code>str_split()</code>, whose function is to split a character vector into smaller character vectors based on some splitting criteria. In <a href="#exm-cd-europarl-text-lines-tbl">Example&nbsp;<span>6.8</span></a>, we use the <code>str_split()</code> function to split the text into lines based on the <code>\n</code> character and assign it to the new column <code>lines</code> using <code>mutate()</code>. Since we will not need the <code>text</code> column anymore, we can use <code>select()</code> to drop it.</p>
<div id="exm-cd-europarl-text-lines-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.8 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Split text into lines</span></span>
<span><span class="va">europarl_lines_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_docs_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lines <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">text</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">text</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="va">europarl_lines_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 2 × 2
&gt;   doc_id               lines            
&gt;   &lt;chr&gt;                &lt;list&gt;           
&gt; 1 europarl-v7.es-en.en &lt;chr [1,965,734]&gt;
&gt; 2 europarl-v7.es-en.es &lt;chr [1,965,734]&gt;</code></pre>
</div>
</div>
</div>
<p>Previewing the output in <a href="#exm-cd-europarl-text-lines-tbl">Example&nbsp;<span>6.8</span></a>, we can see that the <code>lines</code> column contains a list of character vectors. Why is this so? <code>str_split()</code> takes a character vector and splits it, as we know. It is a vectorized function, meaning that it can take a vector of character vectors and split each one into subsegments. Since any given input character vector can have a different number of subsegments, the number of subsegments in each file could be different. The ideal object for such data is a list. So <code>str_split()</code> returns a list of character vectors.</p>
<p>The list of character vectors, lines in our case, is still associated with the respective <code>doc_id</code> value. However, we want to create a new row for each line in the list. To do this, we will use the <code>unnest()</code> function from the <code>tidyr</code> package <span class="citation" data-cites="R-tidyr">(<a href="references.html#ref-R-tidyr" role="doc-biblioref">Wickham, Vaughan, and Girlich 2023</a>)</span>. The <code>unnest()</code> function takes a list column and creates a new row for each element in the list. We use the <code>unnest()</code> function to create a new row for each line in the <code>lines</code> column. We can see the output from <a href="#exm-cd-europarl-text-lines-tbl-unnest">Example&nbsp;<span>6.9</span></a>.</p>
<div id="exm-cd-europarl-text-lines-tbl-unnest" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.9 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a new row for each line</span></span>
<span><span class="va">europarl_lines_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">lines</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="va">europarl_lines_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 2
&gt;   doc_id               lines                                                    
&gt;   &lt;chr&gt;                &lt;chr&gt;                                                    
&gt; 1 europarl-v7.es-en.en Resumption of the session                                
&gt; 2 europarl-v7.es-en.en I declare resumed the session of the European Parliament…
&gt; 3 europarl-v7.es-en.en Although, as you will have seen, the dreaded 'millennium…
&gt; 4 europarl-v7.es-en.en You have requested a debate on this subject in the cours…
&gt; 5 europarl-v7.es-en.en In the meantime, I should like to observe a minute' s si…</code></pre>
</div>
</div>
</div>
<p>Remember that the data in the Europarl corpus is aligned, meaning that each line in the source file is aligned with a line in the target file. So we need to make sure that the number of lines in each file is the same. We can do this by grouping the data by <code>doc_id</code> and then counting the number of lines in each file. We can do this using the <code>group_by()</code> and <code>count()</code> functions from the <code>dplyr</code> package <span class="citation" data-cites="R-dplyr">(<a href="references.html#ref-R-dplyr" role="doc-biblioref">Wickham et al. 2023</a>)</span>. We can see the output in <a href="#exm-cd-europarl-text-lines-tbl-count">Example&nbsp;<span>6.10</span></a>.</p>
<div id="exm-cd-europarl-text-lines-tbl-count" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.10 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Count the number of lines in each file</span></span>
<span><span class="va">europarl_lines_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">doc_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 2 × 2
&gt; # Groups:   doc_id [2]
&gt;   doc_id                     n
&gt;   &lt;chr&gt;                  &lt;int&gt;
&gt; 1 europarl-v7.es-en.en 1965734
&gt; 2 europarl-v7.es-en.es 1965734</code></pre>
</div>
</div>
</div>
<p>The output of <a href="#exm-cd-europarl-text-lines-tbl-count">Example&nbsp;<span>6.10</span></a> shows that the number of lines in each file is the same. This is good. If the number of lines in each file was different, we would need to figure out why and fix it.</p>
<p>We now have our <code>lines</code> column and the associated observations for our idealized dataset, in <a href="#tbl-cd-europarl-structure-example">Table&nbsp;<span>6.2</span></a>. Let’s now leverage the existing <code>doc_id</code> to create the <code>type</code> column. The goal is to assign the value of <code>type</code> according to the <code>doc_id</code> value. Specifically, when <code>doc_id</code> is ‘europarl-v7.es-en.es’ type should be ‘Source’ and when <code>doc_id</code> is ‘europarl-v7.es-en.en’ type should be ‘Target’.</p>
<p>We can do this using the <code>case_when()</code> function from the <code>dplyr</code> package <span class="citation" data-cites="R-dplyr">(<a href="references.html#ref-R-dplyr" role="doc-biblioref">Wickham et al. 2023</a>)</span>. The <code>case_when()</code> function takes a series of conditions and assigns a value based on the first condition that is met. In this case, we will use <code>mutate()</code> to create the <code>type</code> column and then use the <code>doc_id</code> column to create the conditions and the <code>type</code> column to assign the values from <code>case_when()</code>. We will store the output in a new object called <code>europarl_lines_type_tbl</code>, as seen in <a href="#exm-cd-europarl-text-lines-type-tbl">Example&nbsp;<span>6.11</span></a>.</p>
<div id="exm-cd-europarl-text-lines-type-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.11 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create `type` column</span></span>
<span><span class="va">europarl_lines_type_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>type <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">doc_id</span> <span class="op">==</span> <span class="st">"europarl-v7.es-en.es"</span> <span class="op">~</span> <span class="st">"Source"</span>,</span>
<span>    <span class="va">doc_id</span> <span class="op">==</span> <span class="st">"europarl-v7.es-en.en"</span> <span class="op">~</span> <span class="st">"Target"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarl_lines_type_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 3,931,468
&gt; Columns: 3
&gt; $ doc_id &lt;chr&gt; "europarl-v7.es-en.en", "europarl-v7.es-en.en", "europarl-v7.es…
&gt; $ lines  &lt;chr&gt; "Resumption of the session", "I declare resumed the session of …
&gt; $ type   &lt;chr&gt; "Target", "Target", "Target", "Target", "Target", "Target", "Ta…</code></pre>
</div>
</div>
</div>
<p>The preview output from <a href="#exm-cd-europarl-text-lines-type-tbl">Example&nbsp;<span>6.11</span></a> shows us that we now have three columns, <code>doc_id</code>, <code>lines</code>, and <code>type</code>. The <code>type</code> column has been created and the values have been assigned according to the <code>doc_id</code> values.</p>
<p>We can now overwrite the <code>doc_id</code> column with a unique identifier for each line. A numeric identifier makes sense. We can do this by using the <code>mutate()</code> function to assign <code>doc_id</code> a sequential number with <code>row_number()</code>, which increments by 1 for each row. We will store the output in a new object called <code>europarl_lines_type_id_tbl</code>, as seen in <a href="#exm-cd-europarl-text-lines-type-id-tbl">Example&nbsp;<span>6.12</span></a>.</p>
<div id="exm-cd-europarl-text-lines-type-id-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.12 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create new `doc_id` column</span></span>
<span><span class="va">europarl_lines_type_id_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_type_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>doc_id <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarl_lines_type_id_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 3,931,468
&gt; Columns: 3
&gt; $ doc_id &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, …
&gt; $ lines  &lt;chr&gt; "Resumption of the session", "I declare resumed the session of …
&gt; $ type   &lt;chr&gt; "Target", "Target", "Target", "Target", "Target", "Target", "Ta…</code></pre>
</div>
</div>
</div>
<p>The preview output from <a href="#exm-cd-europarl-text-lines-type-id-tbl">Example&nbsp;<span>6.12</span></a> shows us that we now have the same three columns, <code>doc_id</code>, <code>lines</code>, and <code>type</code>. However, the values in the <code>doc_id</code> column now reflect a unique identifier for each line.</p>
<p>The last step to get to our envisioned dataset structure is to add the <code>line_id</code> column which will be calculated by grouping the data by <code>type</code> and then assigning a row number to each of the lines in each group. We use the <code>group_by()</code> function to perform the grouping as seen in <a href="#exm-cd-europarl-text-lines-type-id-line-id-tbl">Example&nbsp;<span>6.13</span></a>.</p>
<div id="exm-cd-europarl-text-lines-type-id-line-id-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.13 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create `line_id` column</span></span>
<span><span class="va">europarl_lines_type_id_line_id_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_type_id_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">type</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>line_id <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarl_lines_type_id_line_id_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 3,931,468
&gt; Columns: 4
&gt; $ doc_id  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,…
&gt; $ lines   &lt;chr&gt; "Resumption of the session", "I declare resumed the session of…
&gt; $ type    &lt;chr&gt; "Target", "Target", "Target", "Target", "Target", "Target", "T…
&gt; $ line_id &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,…</code></pre>
</div>
</div>
</div>
<p>The preview output from <a href="#exm-cd-europarl-text-lines-type-id-line-id-tbl">Example&nbsp;<span>6.13</span></a> shows us that we now have the desired four columns, <code>doc_id</code>, <code>lines</code>, <code>type</code>, and <code>line_id</code>.</p>
<p>Before we get to writing the dataset to disk, let’s organized it in a way that the columns are in the order we want and the rows are sorted in a way that makes sense.</p>
<p>Reordering the columns involves using the <code>select()</code> function and list the order of the columns. To sort by columns, we will use <code>arrange()</code> and specify the columns to order by. We store the results in a more legible object, <code>europarl_curated_tbl</code>, as seen in <a href="#exm-cd-europarl-curated-tbl">Example&nbsp;<span>6.14</span></a>.</p>
<div id="exm-cd-europarl-curated-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.14 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Reorder columns and sort rows</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_type_id_line_id_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">type</span>, <span class="va">line_id</span>, <span class="va">lines</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">line_id</span>, <span class="va">type</span>, <span class="va">doc_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarl_curated_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 3,931,468
&gt; Columns: 4
&gt; $ doc_id  &lt;int&gt; 1965735, 1, 1965736, 2, 1965737, 3, 1965738, 4, 1965739, 5, 19…
&gt; $ type    &lt;chr&gt; "Source", "Target", "Source", "Target", "Source", "Target", "S…
&gt; $ line_id &lt;int&gt; 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, …
&gt; $ lines   &lt;chr&gt; "Reanudación del período de sesiones", "Resumption of the sess…</code></pre>
</div>
</div>
</div>
<p>The preview output from <a href="#exm-cd-europarl-curated-tbl">Example&nbsp;<span>6.14</span></a> shows us that we now have the desired four columns, <code>doc_id</code>, <code>type</code>, <code>line_id</code>, and <code>lines</code>. The rows are sorted by <code>line_id</code>, <code>type</code>, and <code>doc_id</code>. This gives us a dataset that reads left to right from document to line oriented attributes and top to bottom by source-target line pairs.</p>
</section><section id="write-dataset" class="level3" data-number="6.1.4"><h3 data-number="6.1.4" class="anchored" data-anchor-id="write-dataset">
<span class="header-section-number">6.1.4</span> Write dataset</h3>
<p>At this point we have the curated dataset (<code>europarl_curated_tbl</code>) in a tidy format. This dataset, however, is only in the current R session. We will want to write this dataset to disk so that in the next step of the text analysis workflow (transformation) we will be able to start work on this dataset and make changes as needed to fit our analysis needs.</p>
<p>We will leverage the project directory structure which has distinct directories for <code>original/</code> and <code>derived/</code> data(sets), seen in <a href="#exm-cd-europarl-write-directory">Example&nbsp;<span>6.15</span></a>.</p>
<div id="exm-cd-europarl-write-directory" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.15 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">│──</span> analysis/</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│──</span> europarl_do.csv</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> europarl/</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> europarl-v7.es-en.es</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> europarl-v7.es-en.en</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since this is a tabular, tidy dataset we have various options for the file type to write. Many of these formats are software-specific, such as <code>*.xlsx</code> for Microsoft Excel, <code>*.sav</code> for SPSS, <code>*.dta</code> for Stata, and <code>*.rds</code> for R. We will use the <code>*.csv</code> format since it is a common format that can be read by many software packages. We will use the <code>write_csv()</code> function from the <code>readr</code> package to write the dataset to disk.</p>
<p>Now the question is where to save our CSV file. Since our <code>europarl_curated_tbl</code> dataset is derived by our work, we will added it to the <code>derived/</code> directory. I’ll create a <code>europarl/</code> directory with <code>dir_create()</code> just to keep things organized.</p>
<div id="exm-cd-unstructured-write-europarl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.16 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create the europarl/ directory</span></span>
<span><span class="fu">dir_create</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../data/derived/europarl/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write the curated dataset to disk</span></span>
<span><span class="fu">write_csv</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">europarl_curated_tbl</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"../data/derived/europarl/europarl_curated.csv"</span></span>
<span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>After running the code in <a href="#exm-cd-unstructured-write-europarl">Example&nbsp;<span>6.16</span></a>, the directory structure under the <code>derived/</code> directory should look like <a href="#exm-cd-unstructured-write-europarl-directory">Example&nbsp;<span>6.17</span></a>.</p>
<div id="exm-cd-unstructured-write-europarl-directory" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.17 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">│──</span> analysis/</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── europarl/</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── europarl_curated.csv</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──europarl</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> europarl-v7.es-en.en</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> europarl-v7.es-en.es</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="summary" class="level3" data-number="6.1.5"><h3 data-number="6.1.5" class="anchored" data-anchor-id="summary">
<span class="header-section-number">6.1.5</span> Summary</h3>
<p>In this section we worked with unstructured data and looked at how to read the data into an R session and manipulate the data to form a tidy dataset with a few columns that we could derive based on the information we have about the corpus.</p>
<p>In our discussion we worked step by step to curate the europarl Corpus, adding in intermediate steps for illustration purposes. However, in a more realistic case the code would most likely make more extensive use of piping (<code>|&gt;</code>) to reduce the number of intermediate objects and make the code more legible. The final code base is added to the <em>2-curate-data.qmd</em> file in the <em>code/</em> directory.</p>
<p>The final step, as always, is to document the dataset. For datasets the documentation is a data dictionary, as discussed in <a href="understanding-data.html#sec-ud-data-dictionaries"><span>Section&nbsp;2.3.2</span></a>. As with data origin files, you can use spreadsheet software to create and/ or edit the data dictionary.</p>
<p>In the <code>qtalrkit</code> package we have a function, <code>create_data_dictionary()</code> that will generate the scaffolding for a data dictionary. The function takes two arguments, <code>data</code> and <code>file_path</code>. It reads the dataset columns and provides a template for the data dictionary.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-medal" aria-label="medal"></i> Dive deeper</strong></p>
<p>The <code>create_data_dictionary()</code> function provides a rudimentary data dictionary template by default. However, you can take advantage of OpenAI’s text generation models to generate a more detailed data dictionary for you to edit. To do this create <a href="https://platform.openai.com/signup">an OpenAI account</a> and <a href="https://platform.openai.com/account/api-keys">an API key</a> and add this key to your R environment (<code>Sys.setenv(OPENAI_API_KEY = "sk..."</code>). Then you can specify the model you would like to use in the function with the <code>model =</code> argument. For example, <code>model = "gpt-3.5-turbo"</code> will use the GPT-3.5 Turbo model.</p>
</div>
</div>
</div>
<div id="exm-cd-unstructured-data-dictionary" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.18 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create the data dictionary</span></span>
<span><span class="fu">create_data_dictionary</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">europarl_curated_tbl</span>,</span>
<span>  <span class="va">file_path</span> <span class="op">&lt;-</span> <span class="st">"../data/derived/europarl/europarl_curated_dd.csv"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>An example of the data dictionary for the <code>europarl_curated_tbl</code> dataset is shown in <a href="#tbl-cd-unstructured-data-dictionary-example">Table&nbsp;<span>6.3</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-cd-unstructured-data-dictionary-example" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.3: Data dictionary for the <code>europarl_curated_tbl</code> dataset.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_id</td>
<td style="text-align: left;">Document ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Unique identification number for each document</td>
</tr>
<tr class="even">
<td style="text-align: left;">type</td>
<td style="text-align: left;">Document Type</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Type of document; either 'Source' or 'Target'</td>
</tr>
<tr class="odd">
<td style="text-align: left;">line_id</td>
<td style="text-align: left;">Line ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Unique identification number for each line in each document type</td>
</tr>
<tr class="even">
<td style="text-align: left;">lines</td>
<td style="text-align: left;">Lines</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Content of the lines in the document</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section></section><section id="structured" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="structured">
<span class="header-section-number">6.2</span> Structured</h2>
<p>Structured data already reflects the physical and semantic structure of a tidy dataset. This means that the data is already in a tabular format and the relationships between columns and rows are already well-defined. Therefore the heavy lifting of curating the data is already done. There are two remaining questions, however, that need to be taken into account. One, logistical question, is what file format the dataset is in and how to read it into R. And the second, more research-based, is whether the data may benefit from some additional curation and documentation to make it more amenable to analysis and more understandable to others.</p>
<section id="reading-data-1" class="level3" data-number="6.2.1"><h3 data-number="6.2.1" class="anchored" data-anchor-id="reading-data-1">
<span class="header-section-number">6.2.1</span> Reading data</h3>
<p>Let’s consider some common formats for structured data and how to read them into R. First, we will consider R-native formats, such as package datasets and RDS files. Then will consider non-native formats, such as relational databases and datasets produced by other software. Finally, we will consider software agnostic formats, such as CSV.</p>
<p>R and some R packages provide structured datasets that are available for use directly within R. For example, the <code>languageR</code> package <span class="citation" data-cites="R-languageR">(<a href="references.html#ref-R-languageR" role="doc-biblioref">Baayen and Shafaei-Bajestan 2019</a>)</span> provides the <code>dative</code> dataset, which is a dataset containing the realization of the dative as NP or PP in the Switchboard corpus and the Treebank Wall Street Journal collection. The <code>janeaustenr</code> package <span class="citation" data-cites="R-janeaustenr">(<a href="references.html#ref-R-janeaustenr" role="doc-biblioref">Silge 2022</a>)</span> provides the <code>austen_books</code> dataset, which is a dataset of Jane Austen’s novels. Package datasets are loaded into an R session using either the <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> function, if the package is loaded, or the <code>::</code> operator, if the package is not loaded. For example, <code>data(dative)</code> or <code><a href="https://rdrr.io/pkg/languageR/man/dative.html">languageR::dative</a></code>.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-medal" aria-label="medal"></i> Dive deeper</strong></p>
<p>To explore the available datasets in a package, you can use the <code>data(package = "package_name")</code> function. For example, <code>data(package = "languageR")</code> will list the datasets available in the <code>languageR</code> package. You can also explore all the datasets available in the loaded packages with the <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> function using no arguments. For example, <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code>.</p>
</div>
</div>
</div>
<p>R also provides a native file format for storing R objects, the RDS file. Any R object, including data frames, can be written from an R session to disk by using the <code>write_rds()</code> function from <code>readr</code>. The <em>.rds</em> files will be written to disk in a binary format that is not human-readable, which is not ideal for transparent data sharing. However, the files and the R objects can be read back into an R session using the <code>read_rds()</code> function with all the attributes intact, such as vector types, factor levels, <em>etc.</em>.</p>
<p>R provides a suite of tools for importing data from non-native structured sources such as databases and datasets from software such as SPSS, SAS, and Stata. For instance, if you are working with data stored in a relational database such as MySQL, PostgreSQL, or SQLite, you can use the <code>DBI</code> package <span class="citation" data-cites="R-DBI">(<a href="references.html#ref-R-DBI" role="doc-biblioref">R Special Interest Group on Databases (R-SIG-DB), Wickham, and Müller 2022</a>)</span> to connect to the database and the <code>dbplyr</code> package <span class="citation" data-cites="R-dbplyr">(<a href="references.html#ref-R-dbplyr" role="doc-biblioref">Wickham, Girlich, and Ruiz 2023</a>)</span> to query the database using the SQL language. Files from SPSS (<em>.sav</em>), SAS (<em>.sas7bdat</em>), and Stata (<em>.dta</em>) can be read into R using the <code>haven</code> package <span class="citation" data-cites="R-haven">(<a href="references.html#ref-R-haven" role="doc-biblioref">Wickham, Miller, and Smith 2023</a>)</span>.</p>
<p>Software agnostic file formats include delimited files, such as CSV, TSV, <em>etc.</em>. These file formats lack the robust structural attributes of the other formats, but balance this shortcoming by storing structured data in more accessible, human-readable format. Delimited files are plain text files which use a delimiter, such as a comma (<code>,</code>), tab (<code>\t</code>), or pipe (<code>|</code>), to separate the columns and rows. For example, a CSV file is a delimited file where the columns and rows are separated by commas, as seen in <a href="#exm-cd-csv-example">Example&nbsp;<span>6.19</span></a>.</p>
<div id="exm-cd-csv-example" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.19 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>column_1,column_2,column_3</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>row 1 value 1,row 1 value 2,row 1 value 3</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>row 2 value 1,row 2 value 2,row 2 value 3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given the accessibility of delimited files, they are a common format for sharing structured data in reproducible research. It is not surprising, then, that this is the format which we have chosen for the derived datasets in this book.</p>
</section><section id="orientation-1" class="level3" data-number="6.2.2"><h3 data-number="6.2.2" class="anchored" data-anchor-id="orientation-1">
<span class="header-section-number">6.2.2</span> Orientation</h3>
<!-- [ ] rethink the opening sentence -->
<p>With an understanding of the various structured formats, we can now turn to considerations about how the original dataset is structured and how that structure is to be used for a given research project. As an example, we will work with the CABNC datasets acquired in <a href="acquire-data.html"><span>Chapter&nbsp;5</span></a>. The structure of the original dataset is shown in <a href="#exm-cd-cabnc-structure">Example&nbsp;<span>6.20</span></a>.</p>
<div id="exm-cd-cabnc-structure" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.20 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis/</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> cabnc_do.csv</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> cabnc/</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> participants.csv</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> token_types.csv</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> tokens.csv</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> transcripts.csv</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> utterances.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition to other important information, the data origin file <em>cabnc_do.csv</em> shown in <a href="#tbl-cd-cabnc-do">Table&nbsp;<span>6.4</span></a> informs us the the datasets are related by a common variable.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-cd-cabnc-do" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.4: Data origin: CABNC datasets</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">attribute</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Resource name</td>
<td style="text-align: left;">CABNC.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data source</td>
<td style="text-align: left;">&lt;https://ca.talkbank.org/access/CABNC.html&gt;, &lt;doi:10.21415/T55Q5R&gt;</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Data sampling frame</td>
<td style="text-align: left;">Over 400 British English Speakers from across the UK stratified age, gender, social group, and region, and recording their language output over a set period of time.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data collection date(s)</td>
<td style="text-align: left;">1992.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Data format</td>
<td style="text-align: left;">CSV Files</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data schema</td>
<td style="text-align: left;">The recordings are linked by `filename` and the participants are linked by `who`.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">License</td>
<td style="text-align: left;">CC BY NC SA 3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Attribution</td>
<td style="text-align: left;">Saul Albert, Laura E. de Ruiter, and J.P. de Ruiter (2015) CABNC: the Jeffersonian transcription of the Spoken British National Corpus. https://saulalbert.github.io/CABNC/.</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>The CABNC datasets are structured in a relational format, which means that the data is stored in multiple tables that are related to each other. The tables are related by a common column or set of columns, which are called a keys. A key is used to join the tables together to create a single dataset. There are two keys in the CABNC datasets, <code>filename</code> and <code>who</code>. Each variable corresponds to recording- and/ or participant-oriented datasets.</p>
<p>Now, let’s envision a scenario in which we want to organize a dataset that can be used in a study that aims to investigate the relationship between speaker demographics and utterances. An ideal dataset would contain information about speakers and their utterances. In their original format, the CABNC datasets separate information about utterances and speakers in separate tables, <code>cabnc_utterances</code> and <code>cabnc_participants</code>, respectively. The idealized dataset, then, will combine the variables from each of these tables into a single dataset.</p>
</section><section id="tidy-the-dataset" class="level3" data-number="6.2.3"><h3 data-number="6.2.3" class="anchored" data-anchor-id="tidy-the-dataset">
<span class="header-section-number">6.2.3</span> Tidy the dataset</h3>
<p>With our idealized dataset in mind, let’s start the process of curation by reading the relevant datasets into an R session. Since we are working with CSV files will will use the <code>read_csv()</code> function, as seen in <a href="#exm-cd-cabnc-read">Example&nbsp;<span>6.21</span></a>.</p>
<div id="exm-cd-cabnc-read" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.21 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Read the relevant datasets</span></span>
<span><span class="va">cabnc_utterances</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/curate-datasets/cabnc/utterances.csv"</span><span class="op">)</span></span>
<span><span class="va">cabnc_participants</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/curate-datasets/cabnc/participants.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The next step is to inspect the structure of the datasets. We can use the <code>glimpse()</code> function for this task.</p>
<div id="exm-cd-cabnc-glimpse" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.22 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Preview the structure of the datasets</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">cabnc_utterances</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 235,901
&gt; Columns: 10
&gt; $ filename  &lt;chr&gt; "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE000", …
&gt; $ path      &lt;chr&gt; "ca/CABNC/KB0/KB0RE000", "ca/CABNC/KB0/KB0RE000", "ca/CABNC/…
&gt; $ utt_num   &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17…
&gt; $ who       &lt;chr&gt; "PS002", "PS006", "PS002", "PS006", "PS002", "PS006", "PS002…
&gt; $ role      &lt;chr&gt; "Unidentified", "Unidentified", "Unidentified", "Unidentifie…
&gt; $ postcodes &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
&gt; $ gems      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
&gt; $ utterance &lt;chr&gt; "You enjoyed yourself in America", "Eh", "did you", "Oh I co…
&gt; $ startTime &lt;dbl&gt; 0.208, 2.656, 2.896, 3.328, 5.088, 6.208, 8.320, 8.480, 10.2…
&gt; $ endTime   &lt;dbl&gt; 2.67, 2.90, 3.33, 5.26, 6.02, 8.50, 9.31, 11.23, 14.34, 15.9…</code></pre>
</div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">glimpse</span><span class="op">(</span><span class="va">cabnc_participants</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 6,190
&gt; Columns: 13
&gt; $ filename  &lt;chr&gt; "KB0RE004", "KB0RE004", "KB0RE004", "KB0RE006", "KB0RE006", …
&gt; $ path      &lt;chr&gt; "ca/CABNC/0missing/KB0RE004", "ca/CABNC/0missing/KB0RE004", …
&gt; $ who       &lt;chr&gt; "PS008", "PS009", "KB0PSUN", "PS007", "PS008", "PS009", "KB0…
&gt; $ name      &lt;chr&gt; "John", "Gethyn", "Unknown_speaker", "Alan", "John", "Gethyn…
&gt; $ role      &lt;chr&gt; "Unidentified", "Unidentified", "Unidentified", "Unidentifie…
&gt; $ language  &lt;chr&gt; "eng", "eng", "eng", "eng", "eng", "eng", "eng", "eng", "eng…
&gt; $ monthage  &lt;dbl&gt; 481, 481, 13, 949, 481, 481, 13, 637, 565, 13, 637, 565, 13,…
&gt; $ age       &lt;chr&gt; "40;01.01", "40;01.01", "1;01.01", "79;01.01", "40;01.01", "…
&gt; $ sex       &lt;chr&gt; "male", "male", "male", "male", "male", "male", "male", "mal…
&gt; $ numwords  &lt;dbl&gt; 28, 360, 156, 1610, 791, 184, 294, 93, 3, 0, 128, 24, 0, 150…
&gt; $ numutts   &lt;dbl&gt; 1, 9, 27, 7, 5, 7, 6, 5, 1, 0, 11, 6, 0, 110, 74, 96, 12, 1,…
&gt; $ avgutt    &lt;dbl&gt; 28.00, 40.00, 5.78, 230.00, 158.20, 26.29, 49.00, 18.60, 3.0…
&gt; $ medianutt &lt;dbl&gt; 28, 39, 5, 84, 64, 9, 3, 15, 3, 0, 9, 3, 0, 7, 6, 4, 3, 12, …</code></pre>
</div>
</div>
</div>
<p>From visual inspection of the output of <a href="#exm-cd-cabnc-glimpse">Example&nbsp;<span>6.22</span></a> we can see that there are common variables in both datasets. It is also possible to intersect the datasets to see which variables are common using the <code><a href="https://rdrr.io/r/base/sets.html">intersect()</a></code> function to intersect the column names of each data frame with the <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> function, as seen in <a href="#exm-cd-cabnc-intersect">Example&nbsp;<span>6.23</span></a>.</p>
<div id="exm-cd-cabnc-intersect" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.23 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find the common variables</span></span>
<span><span class="va">common_vars</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cabnc_utterances</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cabnc_participants</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the common variables</span></span>
<span><span class="va">common_vars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] "filename" "path"     "who"      "role"</code></pre>
</div>
</div>
</div>
<p>Using both visual inspection and column name intersection, we can make sure that the variable names and the values are consistent across the datasets. For example, if the variable <code>filename</code> in one dataset is called <code>file_name</code> in another dataset, then we will need to rename the variable in one of the datasets so that the variable names are consistent. Furthermore, if the values in the <code>filename</code> variable are not consistent across the datasets, then we will need to make the values consistent, if possible, before joining the datasets.</p>
<p>In this case, the variable names and values are consistent across the datasets. Therefore, we can join the datasets together using the <code>left_join()</code> function from the <code>dplyr</code> package, as seen in <a href="#exm-cd-cabnc-join">Example&nbsp;<span>6.24</span></a>. This function will take the dataset on the left (<code>x =</code>) and join it to the dataset on the right (<code>y =</code>). The <code>by</code> argument specifies the variables to join on. The choice of which dataset to put on the left usually depends on which dataset has the most detailed information. In this case, the <code>cabnc_utterances</code> dataset has more detailed information about the utterances so we will put this dataset on the left.</p>
<div id="exm-cd-cabnc-join" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.24 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Join the datasets</span></span>
<span><span class="va">cabnc_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">cabnc_utterances</span>, </span>
<span>    y <span class="op">=</span> <span class="va">cabnc_participants</span>, </span>
<span>    by <span class="op">=</span> <span class="va">common_vars</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the dimensions of the joined dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">cabnc_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 235901     19</code></pre>
</div>
</div>
</div>
<p>The result of <a href="#exm-cd-cabnc-join">Example&nbsp;<span>6.24</span></a> should produce a dataset with the same number of observations as the <code>cabnc_utterances</code> dataset, seen in <a href="#exm-cd-cabnc-glimpse">Example&nbsp;<span>6.22</span></a>, and a combined number of unique variables from both datasets, that is 23 minus the four common variables, seen in <a href="#exm-cd-cabnc-intersect">Example&nbsp;<span>6.23</span></a>. The output of <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code> confirms this.</p>
<p>Now we will consider the variables that will be useful for future analysis. Since we are creating a curated dataset, the goal will be to retain as much information as possible from the original datasets. There are cases, however, in which there may be variables that are not informative and thus, will not prove useful for any analysis. These removable variables tend to be of one of two types: variables which show no variation across observations and variables where the information is redundant.</p>
<p>Let’s get a high-level summary of the variables in the dataset. We can use the <code><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim()</a></code> function from the <code>skimr</code> package <span class="citation" data-cites="R-skimr">(<a href="references.html#ref-R-skimr" role="doc-biblioref">Waring et al. 2022</a>)</span> to get a summary of the variables in the dataset<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div id="exm-cd-cabnc-skim" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.25 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/skimr/">skimr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarize the variables in the dataset</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">cabnc_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-cd-cabnc-skim-run" class="cell tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p>Table&nbsp;6.5: Summary of variables in the CABNC dataset</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-cd-cabnc-skim-run-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-cd-cabnc-skim-run" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-cd-cabnc-skim-run-1" data-ref-parent="tbl-cd-cabnc-skim-run" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(a) Categorical variables</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">complete_rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n_unique</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">filename</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">path</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">who</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">568</td>
</tr>
<tr class="even">
<td style="text-align: left;">role</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">utterance</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">174414</td>
</tr>
<tr class="even">
<td style="text-align: left;">name</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">269</td>
</tr>
<tr class="odd">
<td style="text-align: left;">language</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
<p><strong>?(caption)</strong></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">


</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-cd-cabnc-skim-run-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-cd-cabnc-skim-run" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-cd-cabnc-skim-run-2" data-ref-parent="tbl-cd-cabnc-skim-run" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(b) Logical variables</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">complete_rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">postcodes</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">gems</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
<p><strong>?(caption)</strong></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">


</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-cd-cabnc-skim-run-3" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-cd-cabnc-skim-run" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-cd-cabnc-skim-run-3" data-ref-parent="tbl-cd-cabnc-skim-run" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(c) Numeric variables</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">complete_rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">utt_num</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">231.67</td>
</tr>
<tr class="even">
<td style="text-align: left;">startTime</td>
<td style="text-align: right;">0.841</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">endTime</td>
<td style="text-align: right;">0.841</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">monthage</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">448.61</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numwords</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">1387.47</td>
</tr>
<tr class="even">
<td style="text-align: left;">numutts</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">156.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">avgutt</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">9.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">medianutt</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">6.06</td>
</tr>
</tbody>
</table>
</div>
<p><strong>?(caption)</strong></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">


</div>
</div>
</div>
</div>
<p>We see from the <code><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim()</a></code> output in <a href="#tbl-cd-cabnc-skim-run-2">Table&nbsp;<span>6.5 (b)</span></a>, that the variables <code>postcodes</code> and <code>gems</code> have no values. Therefore we can remove these variables from the dataset. On the other hand, in <a href="#tbl-cd-cabnc-skim-run-1">Table&nbsp;<span>6.5 (a)</span></a>, the variables <code>role</code> and <code>language</code> have the same value for every observation as the output shows <code>n_unique</code> is <code>1</code>. We can also remove these variables from the dataset.</p>
<p>Another set of variables of potential interest are the <code>startTime</code> and <code>endTime</code> variables, in <a href="#tbl-cd-cabnc-skim-run-3">Table&nbsp;<span>6.5 (c)</span></a>. These each have a completion rate of less than 100%, specifically 84%. On first blush, it would seem that we would go ahead and remove them. However, we should pause and consider that these variables may still be of some use. At the curation stage, however, it is best to err on the side of caution and leave them in the dataset. We will decide later whether to keep or remove them as we explore the dataset further in the research.</p>
<p>Another consideration is whether we have variables that are clearly redundant. For example, the variables <code>age</code> and <code>monthage</code> are both measures of age, stated in different measures, looking back at <a href="#exm-cd-cabnc-glimpse">Example&nbsp;<span>6.22</span></a>. As such, we can remove one of these variables from the dataset. In this case, we will remove the <code>age</code> variable as it is the least straightforward to interpret.</p>
<p>Another potentially redundant set of variables are <code>who</code> and <code>name</code> –both of which are speaker identifiers. The <code>who</code> variable is a unique identifier, but there may be some redundancy with the <code>name</code> variable, that is there may be two speakers with the same name. We can check this by looking at the number of unique values in the <code>who</code> and <code>name</code> variables from the <code><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim()</a></code> output in <a href="#tbl-cd-cabnc-skim-run-1">Table&nbsp;<span>6.5 (a)</span></a>. <code>who</code> has 568 unique values and <code>name</code> has 269 unique values. This suggests that there are multiple speakers with the same name.</p>
<p>Another way to explore this is to look at the number of unique values in the <code>who</code> variable for each unique value in the <code>name</code> variable. We can do this using the <code>group_by()</code> and <code>summarize()</code> functions from the <code>dplyr</code> package. For each value of <code>name</code>, we will count the number of unique values in <code>who</code> and then sort the results in descending order.</p>
<div id="exm-cd-cabnc-who-name" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.26 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cabnc_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">who</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 269 × 2
&gt;    name                          n
&gt;    &lt;chr&gt;                     &lt;int&gt;
&gt;  1 None                         59
&gt;  2 Unknown_speaker              57
&gt;  3 Group_of_unknown_speakers    10
&gt;  4 Chris                         9
&gt;  5 David                         9
&gt;  6 Margaret                      8
&gt;  7 Ann                           7
&gt;  8 John                          7
&gt;  9 Alan                          6
&gt; 10 Jackie                        5
&gt; # ℹ 259 more rows</code></pre>
</div>
</div>
</div>
<p>It is good that we performed the check in <a href="#exm-cd-cabnc-who-name">Example&nbsp;<span>6.26</span></a> beforehand. In addition to speakers with the same name, such as ‘Chris’ and ‘David’, we also have multiple speakers with generic codes, such as ‘None’ and ‘Unknown_speaker’. It is clear that <code>name</code> is redundant and we can safely remove it from the dataset.</p>
<p>Another redundant variable is the <code>path</code> variable. This variable is not more informative than the <code>filename</code>, for our purposes. We will remove the <code>path</code> variable from the dataset too.</p>
<p>In all, we will remove the following variables from the dataset: <code>postcodes</code>, <code>gems</code>, <code>role</code>, <code>language</code>, <code>age</code>, <code>name</code>, and <code>path</code>. To drop variables from a data frame we can use the <code>select()</code> function in combination with the <code>-</code> operator. The <code>-</code> operator tells the <code>select()</code> function to drop the variables that follow it.</p>
<div id="exm-cd-cabnc-drop-vars" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.27 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Drop variables</span></span>
<span><span class="va">cabnc_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">cabnc_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">postcodes</span>, <span class="op">-</span><span class="va">gems</span>, <span class="op">-</span><span class="va">role</span>, <span class="op">-</span><span class="va">language</span>, <span class="op">-</span><span class="va">age</span>, <span class="op">-</span><span class="va">name</span>, <span class="op">-</span><span class="va">path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">cabnc_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 235,901
&gt; Columns: 12
&gt; $ filename  &lt;chr&gt; "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE000", …
&gt; $ utt_num   &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17…
&gt; $ who       &lt;chr&gt; "PS002", "PS006", "PS002", "PS006", "PS002", "PS006", "PS002…
&gt; $ utterance &lt;chr&gt; "You enjoyed yourself in America", "Eh", "did you", "Oh I co…
&gt; $ startTime &lt;dbl&gt; 0.208, 2.656, 2.896, 3.328, 5.088, 6.208, 8.320, 8.480, 10.2…
&gt; $ endTime   &lt;dbl&gt; 2.67, 2.90, 3.33, 5.26, 6.02, 8.50, 9.31, 11.23, 14.34, 15.9…
&gt; $ monthage  &lt;dbl&gt; 721, 601, 721, 601, 721, 601, 721, 601, 721, 601, 721, 601, …
&gt; $ sex       &lt;chr&gt; "female", "male", "female", "male", "female", "male", "femal…
&gt; $ numwords  &lt;dbl&gt; 759, 399, 759, 399, 759, 399, 759, 399, 759, 399, 759, 399, …
&gt; $ numutts   &lt;dbl&gt; 74, 64, 74, 64, 74, 64, 74, 64, 74, 64, 74, 64, 74, 2, 74, 6…
&gt; $ avgutt    &lt;dbl&gt; 10.26, 6.23, 10.26, 6.23, 10.26, 6.23, 10.26, 6.23, 10.26, 6…
&gt; $ medianutt &lt;dbl&gt; 7, 5, 7, 5, 7, 5, 7, 5, 7, 5, 7, 5, 7, 1, 7, 5, 7, 5, 7, 5, …</code></pre>
</div>
</div>
</div>
<p>Now we have a dataset with 12 informative variables which describe the utterances for each recording. There are variables about the recordings, such as the <code>filename</code>, about the speakers, such as the <code>sex</code> and <code>who</code>, and about the utterances, such as the <code>utterance</code>, <code>utt_num</code>, <em>etc.</em>. Let’s organize the columns to read left to right from most general to most specific. Again we turn to the <code>select()</code> function, this time including the variables in the order we want them to appear in the dataset. We will take this opportunity to rename some of the variable names so that they are more informative.</p>
<div id="exm-cd-cabnc-rename-vars" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.28 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Rename variables</span></span>
<span><span class="va">cabnc_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">cabnc_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span></span>
<span>    doc_id <span class="op">=</span> <span class="va">filename</span>,</span>
<span>    <span class="va">utt_num</span>,</span>
<span>    utt_start <span class="op">=</span> <span class="va">startTime</span>,</span>
<span>    utt_end <span class="op">=</span> <span class="va">endTime</span>,</span>
<span>    <span class="va">utterance</span>,</span>
<span>    part_id <span class="op">=</span> <span class="va">who</span>,</span>
<span>    part_age <span class="op">=</span> <span class="va">monthage</span>,</span>
<span>    part_sex <span class="op">=</span> <span class="va">sex</span>,</span>
<span>    num_words <span class="op">=</span> <span class="va">numwords</span>,</span>
<span>    num_utts <span class="op">=</span> <span class="va">numutts</span>,</span>
<span>    avg_utt_len <span class="op">=</span> <span class="va">avgutt</span>,</span>
<span>    median_utt_len <span class="op">=</span> <span class="va">medianutt</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">cabnc_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 235,901
&gt; Columns: 12
&gt; $ doc_id         &lt;chr&gt; "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE000", "KB0RE0…
&gt; $ utt_num        &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…
&gt; $ utt_start      &lt;dbl&gt; 0.208, 2.656, 2.896, 3.328, 5.088, 6.208, 8.320, 8.480,…
&gt; $ utt_end        &lt;dbl&gt; 2.67, 2.90, 3.33, 5.26, 6.02, 8.50, 9.31, 11.23, 14.34,…
&gt; $ utterance      &lt;chr&gt; "You enjoyed yourself in America", "Eh", "did you", "Oh…
&gt; $ part_id        &lt;chr&gt; "PS002", "PS006", "PS002", "PS006", "PS002", "PS006", "…
&gt; $ part_age       &lt;dbl&gt; 721, 601, 721, 601, 721, 601, 721, 601, 721, 601, 721, …
&gt; $ part_sex       &lt;chr&gt; "female", "male", "female", "male", "female", "male", "…
&gt; $ num_words      &lt;dbl&gt; 759, 399, 759, 399, 759, 399, 759, 399, 759, 399, 759, …
&gt; $ num_utts       &lt;dbl&gt; 74, 64, 74, 64, 74, 64, 74, 64, 74, 64, 74, 64, 74, 2, …
&gt; $ avg_utt_len    &lt;dbl&gt; 10.26, 6.23, 10.26, 6.23, 10.26, 6.23, 10.26, 6.23, 10.…
&gt; $ median_utt_len &lt;dbl&gt; 7, 5, 7, 5, 7, 5, 7, 5, 7, 5, 7, 5, 7, 1, 7, 5, 7, 5, 7…</code></pre>
</div>
</div>
</div>
<p>The variable order is organized after running <a href="#exm-cd-cabnc-rename-vars">Example&nbsp;<span>6.28</span></a>. Now let’s sort the rows by <code>doc_id</code> and <code>utt_num</code> so that the utterances are in order. The <code>arrange()</code> function takes a data frame and a list of variables to sort by, in the order they are listed.</p>
<div id="exm-cd-cabnc-sort-rows" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.29 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sort rows</span></span>
<span><span class="va">cabnc_tbl</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cabnc_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">utt_num</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the dataset</span></span>
<span><span class="va">cabnc_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 12
&gt;    doc_id   utt_num utt_start utt_end utterance        part_id part_age part_sex
&gt;    &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;   
&gt;  1 KB0RE000       0     0.208    2.67 You enjoyed you… PS002        721 female  
&gt;  2 KB0RE000       1     2.66     2.90 Eh               PS006        601 male    
&gt;  3 KB0RE000       2     2.90     3.33 did you          PS002        721 female  
&gt;  4 KB0RE000       3     3.33     5.26 Oh I covered a … PS006        601 male    
&gt;  5 KB0RE000       4     5.09     6.02 Oh very good ye… PS002        721 female  
&gt;  6 KB0RE000       5     6.21     8.50 Er saw Mary and… PS006        601 male    
&gt;  7 KB0RE000       6     8.32     9.31 Yes you did      PS002        721 female  
&gt;  8 KB0RE000       7     8.48    11.2  in fact the who… PS006        601 male    
&gt;  9 KB0RE000       8    10.3     14.3  Oh very nice ve… PS002        721 female  
&gt; 10 KB0RE000       9    14.3     16.0  It is horrible … PS006        601 male    
&gt; # ℹ 4 more variables: num_words &lt;dbl&gt;, num_utts &lt;dbl&gt;, avg_utt_len &lt;dbl&gt;,
&gt; #   median_utt_len &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<p>Applying the sorting in <a href="#exm-cd-cabnc-sort-rows">Example&nbsp;<span>6.29</span></a>, we can see that the utterances are now our desired order. We have now completed the curation of the structured dataset aiming to provide a base for further analysis into the recorded utterances of speakers from the CABNC corpus.</p>
</section><section id="write-dataset-1" class="level3" data-number="6.2.4"><h3 data-number="6.2.4" class="anchored" data-anchor-id="write-dataset-1">
<span class="header-section-number">6.2.4</span> Write dataset</h3>
<p>Let’s now write this dataset to disk. Again, since this is a dataset we have created, we will store the dataset in the <em>data/derived/</em> directory. To keep the CABNC separate from any other datasets that we may need for our research project, I will create a subdirectory called <em>cabnc/</em> to store the dataset. Into this directory we can write a CSV file with our <code>cabnc_tbl</code> data frame with the <code>write_csv()</code> function, as seen in <a href="#exm-cd-cabnc-write-csv">Example&nbsp;<span>6.30</span></a>.</p>
<div id="exm-cd-cabnc-write-csv" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.30 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create cabnc directory</span></span>
<span><span class="fu">dir_create</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../data/derived/cabnc"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write dataset to disk</span></span>
<span><span class="va">cabnc_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">write_csv</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../data/derived/cabnc/cabnc_curated.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section><section id="summary-1" class="level3" data-number="6.2.5"><h3 data-number="6.2.5" class="anchored" data-anchor-id="summary-1">
<span class="header-section-number">6.2.5</span> Summary</h3>
<p>In this section we covered the steps to curate a structured dataset. We started by loading the raw data into R using the <code>read_csv()</code> function. We then performed some exploratory data analysis to get a sense of the data. We then removed redundant variables and renamed the remaining variables to be more informative. Finally, we sorted the rows by <code>doc_id</code> and <code>utt_num</code> and wrote the dataset to disk.</p>
<p>The final step is to create a data dictionary file for this dataset. We can do this using the <code>create_data_dictionary()</code> function, passing the data frame object name and a path to the directory where we want to store the data dictionary. The <code>create_data_dictionary()</code> function will create a CSV file with a data dictionary template in the specified directory.</p>
<div id="exm-cd-cabnc-create-data-dict" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.31 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create data dictionary</span></span>
<span><span class="fu">create_data_dictionary</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">cabnc_tbl</span>,</span>
<span>  file_path <span class="op">=</span> <span class="st">"../data/derived/cabnc_curated_dd.csv"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>After running the code in <a href="#exm-cd-cabnc-create-data-dict">Example&nbsp;<span>6.31</span></a>, we can open the <em>cabnc_curated_dd.csv</em> file in the <em>data/derived/cabnc/</em> directory and fill in the data dictionary template. An example of an edited data dictionary is shown in <a href="#tbl-cd-cabnc-dd-example">Table&nbsp;<span>6.6</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-cd-cabnc-dd-example" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.6: Data dictionary example for the curated CABNC dataset.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_id</td>
<td style="text-align: left;">Document ID</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Unique identifier for each document</td>
</tr>
<tr class="even">
<td style="text-align: left;">utt_num</td>
<td style="text-align: left;">Utterance Number</td>
<td style="text-align: left;">ordinal</td>
<td style="text-align: left;">Sequential number assigned to each utterance in a document</td>
</tr>
<tr class="odd">
<td style="text-align: left;">utt_start</td>
<td style="text-align: left;">Utterance Start Time</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Timestamp indicating the start time of an utterance, measured in seconds</td>
</tr>
<tr class="even">
<td style="text-align: left;">utt_end</td>
<td style="text-align: left;">Utterance End Time</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Timestamp indicating the end time of an utterance, measured in seconds</td>
</tr>
<tr class="odd">
<td style="text-align: left;">utterance</td>
<td style="text-align: left;">Utterance Text</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Textual content of an utterance</td>
</tr>
<tr class="even">
<td style="text-align: left;">part_id</td>
<td style="text-align: left;">Participant ID</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Unique identifier for each participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">part_age</td>
<td style="text-align: left;">Participant Age</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Age of the participant, measured in months</td>
</tr>
<tr class="even">
<td style="text-align: left;">part_sex</td>
<td style="text-align: left;">Participant Sex</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Sex of the participant. (male/ female)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">num_words</td>
<td style="text-align: left;">Number of Words</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Total number of words in utterances in the document</td>
</tr>
<tr class="even">
<td style="text-align: left;">num_utts</td>
<td style="text-align: left;">Number of Utterances</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Total number of utterances in the document</td>
</tr>
<tr class="odd">
<td style="text-align: left;">avg_utt_len</td>
<td style="text-align: left;">Average Utterance Length</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Average length of an utterance in the document, measured in words</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_utt_len</td>
<td style="text-align: left;">Median Utterance Length</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Median length of an utterance in the document, measured in words</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>And the final directory structure for the <em>data/</em> directory is shown in <a href="#exm-cd-cabnc-final-dir">Example&nbsp;<span>6.32</span></a>.</p>
<div id="exm-cd-cabnc-final-dir" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.32 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis/</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── cabnc_curated_dd.csv</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── cabnc/</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── cabnc_curated.csv</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> cabnc_do.csv</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> cabnc/</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> participants.csv</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> token_types.csv</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> tokens.csv</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> transcripts.csv</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> utterances.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="semi-structured" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="semi-structured">
<span class="header-section-number">6.3</span> Semi-structured</h2>
<p>At this point we have discussed curating unstructured data and structured datasets. Between these two extremes falls semi-structured data. And as the name suggests, it is a hybrid between unstructured and structured data. This means that there will be important structured metadata included with unstructured elements. The file formats and approaches to encoding the structured aspects of the data vary widely from resource to resource and therefore often requires more detailed attention to the structure of the data and often includes more sophisticated programming strategies to curate the data to produce a tidy dataset.</p>
<section id="reading-data-2" class="level3" data-number="6.3.1"><h3 data-number="6.3.1" class="anchored" data-anchor-id="reading-data-2">
<span class="header-section-number">6.3.1</span> Reading data</h3>
<p>The file formats associated with semi-structured data include a wide range. These include file formats conducive to more structured-leaning data, such as XML, HTML, and JSON, and file formats with more unstructured-leaning data, such as annotated TXT files. Annotated TXT files may in fact appear with the <em>.txt</em> extension, but may also appear with other, sometimes resource-specific, extensions, such as <em>.utt</em> for the Switchboard Dialogue Act Corpus or <em>.cha</em> for the CHILDES corpus annotation files, for example.</p>
<p>The more structured file formats use standard conventions and therefore can be read into an R session with format-specific functions. Say, for example, we are working with data in a JSON file format, as in <a href="#lst-cd-json-example">File&nbsp;<span>6.1</span></a>. We can read the data into an R session with the <code>read_json()</code> function from the <code>jsonlite</code> package <span class="citation" data-cites="R-jsonlite">(<a href="references.html#ref-R-jsonlite" role="doc-biblioref">Ooms 2023</a>)</span>. For XML and HTML files, the <code>rvest</code> package provides the <code>read_xml()</code> and <code>read_html()</code> functions.</p>
<div class="code-with-filename listing">
<p>File&nbsp;6.1: Example JSON file</p>
<div class="code-with-filename-file">
<pre><strong>data.json</strong></pre>
</div>
<div class="sourceCode" id="lst-cd-json-example" data-lst-cap="Example JSON file"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="lst-cd-json-example-1"><a href="#lst-cd-json-example-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="lst-cd-json-example-2"><a href="#lst-cd-json-example-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"data"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="lst-cd-json-example-3"><a href="#lst-cd-json-example-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="lst-cd-json-example-4"><a href="#lst-cd-json-example-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"speaker"</span><span class="fu">:</span> <span class="st">"Alice"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-5"><a href="#lst-cd-json-example-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"age"</span><span class="fu">:</span> <span class="dv">27</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-6"><a href="#lst-cd-json-example-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"sex"</span><span class="fu">:</span> <span class="st">"Female"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-7"><a href="#lst-cd-json-example-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"word_form"</span><span class="fu">:</span> <span class="st">"running"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-8"><a href="#lst-cd-json-example-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lemma_form"</span><span class="fu">:</span> <span class="st">"run"</span></span>
<span id="lst-cd-json-example-9"><a href="#lst-cd-json-example-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="lst-cd-json-example-10"><a href="#lst-cd-json-example-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="lst-cd-json-example-11"><a href="#lst-cd-json-example-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"speaker"</span><span class="fu">:</span> <span class="st">"Bob"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-12"><a href="#lst-cd-json-example-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"age"</span><span class="fu">:</span> <span class="dv">35</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-13"><a href="#lst-cd-json-example-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"sex"</span><span class="fu">:</span> <span class="st">"Male"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-14"><a href="#lst-cd-json-example-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"word_form"</span><span class="fu">:</span> <span class="st">"jumped"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-15"><a href="#lst-cd-json-example-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lemma_form"</span><span class="fu">:</span> <span class="st">"jump"</span></span>
<span id="lst-cd-json-example-16"><a href="#lst-cd-json-example-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="lst-cd-json-example-17"><a href="#lst-cd-json-example-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="lst-cd-json-example-18"><a href="#lst-cd-json-example-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"speaker"</span><span class="fu">:</span> <span class="st">"Charlie"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-19"><a href="#lst-cd-json-example-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"age"</span><span class="fu">:</span> <span class="dv">42</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-20"><a href="#lst-cd-json-example-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"sex"</span><span class="fu">:</span> <span class="st">"Male"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-21"><a href="#lst-cd-json-example-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"word_form"</span><span class="fu">:</span> <span class="st">"singing"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-22"><a href="#lst-cd-json-example-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lemma_form"</span><span class="fu">:</span> <span class="st">"sing"</span></span>
<span id="lst-cd-json-example-23"><a href="#lst-cd-json-example-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="lst-cd-json-example-24"><a href="#lst-cd-json-example-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="lst-cd-json-example-25"><a href="#lst-cd-json-example-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"speaker"</span><span class="fu">:</span> <span class="st">"Diane"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-26"><a href="#lst-cd-json-example-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"age"</span><span class="fu">:</span> <span class="dv">32</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-27"><a href="#lst-cd-json-example-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"sex"</span><span class="fu">:</span> <span class="st">"Female"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-28"><a href="#lst-cd-json-example-28" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"word_form"</span><span class="fu">:</span> <span class="st">"walked"</span><span class="fu">,</span></span>
<span id="lst-cd-json-example-29"><a href="#lst-cd-json-example-29" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lemma_form"</span><span class="fu">:</span> <span class="st">"walk"</span></span>
<span id="lst-cd-json-example-30"><a href="#lst-cd-json-example-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="lst-cd-json-example-31"><a href="#lst-cd-json-example-31" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="lst-cd-json-example-32"><a href="#lst-cd-json-example-32" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Semi-structured data in TXT files can be read either as an entire file with <code>read_file()</code> or line-by-line with <code>read_lines()</code>. The choice of which approach to take depends on the structure of the data. If the data structure is line-based, then <code>read_lines()</code> often makes more sense than <code>read_file()</code>. However, in some cases, the data may be structured in a way that requires the entire file to be read into an R session and then subsequently parsed.</p>
</section><section id="orientation-2" class="level3" data-number="6.3.2"><h3 data-number="6.3.2" class="anchored" data-anchor-id="orientation-2">
<span class="header-section-number">6.3.2</span> Orientation</h3>
</section><section id="tidy-the-data-1" class="level3" data-number="6.3.3"><h3 data-number="6.3.3" class="anchored" data-anchor-id="tidy-the-data-1">
<span class="header-section-number">6.3.3</span> Tidy the data</h3>
</section><section id="write-dataset-2" class="level3" data-number="6.3.4"><h3 data-number="6.3.4" class="anchored" data-anchor-id="write-dataset-2">
<span class="header-section-number">6.3.4</span> Write dataset</h3>
</section><section id="summary-2" class="level3" data-number="6.3.5"><h3 data-number="6.3.5" class="anchored" data-anchor-id="summary-2">
<span class="header-section-number">6.3.5</span> Summary</h3>
<p>In this section we looked at semi-structured data. This type of data often requires the most work to organize into a tidy dataset. We continued to work with many of the R programming strategies introduced to this point in the textbook.</p>
<p>…</p>
</section></section><section id="summary-3" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="summary-3">Summary</h2>
<p>In this chapter we looked at the process of structuring data into a dataset. This included a discussion on three main types of data –unstructured, structured, and semi-structured. The level of structure of the original data(set) will vary from resource to resource and by the same token so will the file format used to support the level of metadata included. The results from data curation results in a dataset that is saved separate from the original data to maintain modularity between what the data(set) looked like before we intervene and afterwards. Since there can be multiple analysis approaches applied the original data in a research project, this curated dataset serves as the point of departure for each of the subsequent datasets derived from the transformational steps. In addition to the code we use to derived the curated dataset’s structure, we also include a data dictionary which documents the curated dataset.</p>
<ul class="task-list">
<li>
<input type="checkbox">emphasize the importance of ahereing to the unit of analysis for the research, and how this is reflected in the curated dataset. And how unit of observation derived from the transformational steps in the next chapter.</li>
</ul></section><section id="activities" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="activities">Activities</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-file-code" aria-label="file-code"></i> Recipe</strong></p>
<!-- Understand, apply, and analyze verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] edit links and goals/ outcomes -->
<p><strong>What</strong>: <a href="https://lin380.github.io/tadr/articles/recipe_7.html">Organizing and documenting datasets</a><br><strong>How</strong>: Read Recipe 7 and participate in the Hypothes.is online social annotation.<br><strong>Why</strong>: To rehearse methods for deriving tidying datasets to use a the base for further project-specific purposes. We will explore how regular expressions are helpful in developing strategies for matching, extracting, and/ or replacing patterns in character sequences and how to change the dimensions of a dataset to either expand or collapse columns or rows.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-flask" aria-label="flask"></i> Lab</strong></p>
<!-- Analyze, evaluate, and create verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] edit links and goals/ outcomes -->
<!-- [ ] update name of lab to something more lively -->
<p><strong>What</strong>: <a href="https://github.com/lin380/lab_7">Pattern Matching and Manipulate Datasets</a><br><strong>How</strong>: Clone, fork, and complete the steps in Lab 7.<br><strong>Why</strong>: To gain experience working with coding strategies reshaping data using tidyverse functions and regular expressions, to practice reading/ writing data from/ to disk, and to implement organizational strategies for organizing and documenting a dataset in reproducible fashion.</p>
</div>
</div>
</div>
</section><section id="questions" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="questions">Questions</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="fa-solid fa-wrench" aria-label="wrench"></i> <strong>Conceptual questions</strong></p>
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="fa-solid fa-wrench" aria-label="wrench"></i> <strong>Technical questions</strong></p>
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-R-languageR" class="csl-entry" role="listitem">
Baayen, R. H., and Elnaz Shafaei-Bajestan. 2019. <em>languageR: Analyzing Linguistic Data: A Practical Introduction to Statistics</em>. <a href="https://CRAN.R-project.org/package=languageR">https://CRAN.R-project.org/package=languageR</a>.
</div>
<div id="ref-R-readtext" class="csl-entry" role="listitem">
Benoit, Kenneth, and Adam Obeng. 2023. <em>Readtext: Import and Handling for Plain and Formatted Text Files</em>. <a href="https://github.com/quanteda/readtext">https://github.com/quanteda/readtext</a>.
</div>
<div id="ref-Koehn2005" class="csl-entry" role="listitem">
Koehn, P. 2005. <span>“Europarl: A Parallel Corpus for Statistical Machine Translation.”</span> <em>MT Summit X</em>, 12–16.
</div>
<div id="ref-R-jsonlite" class="csl-entry" role="listitem">
Ooms, Jeroen. 2023. <em>Jsonlite: A Simple and Robust JSON Parser and Generator for r</em>. <a href="https://jeroen.r-universe.dev/jsonlite%0Ahttps://arxiv.org/abs/1403.2805">https://jeroen.r-universe.dev/jsonlite https://arxiv.org/abs/1403.2805</a>.
</div>
<div id="ref-R-DBI" class="csl-entry" role="listitem">
R Special Interest Group on Databases (R-SIG-DB), Hadley Wickham, and Kirill Müller. 2022. <em>DBI: R Database Interface</em>. <a href="https://CRAN.R-project.org/package=DBI">https://CRAN.R-project.org/package=DBI</a>.
</div>
<div id="ref-R-janeaustenr" class="csl-entry" role="listitem">
Silge, Julia. 2022. <em>Janeaustenr: Jane Austen’s Complete Novels</em>. <a href="https://github.com/juliasilge/janeaustenr">https://github.com/juliasilge/janeaustenr</a>.
</div>
<div id="ref-R-skimr" class="csl-entry" role="listitem">
Waring, Elin, Michael Quinn, Amelia McNamara, Eduardo Arino de la Rubia, Hao Zhu, and Shannon Ellis. 2022. <em>Skimr: Compact and Flexible Summaries of Data</em>. <a href="https://CRAN.R-project.org/package=skimr">https://CRAN.R-project.org/package=skimr</a>.
</div>
<div id="ref-R-stringr" class="csl-entry" role="listitem">
Wickham, Hadley. 2022. <em>Stringr: Simple, Consistent Wrappers for Common String Operations</em>. <a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>.
</div>
<div id="ref-R-dplyr" class="csl-entry" role="listitem">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis Vaughan. 2023. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-R-dbplyr" class="csl-entry" role="listitem">
Wickham, Hadley, Maximilian Girlich, and Edgar Ruiz. 2023. <em>Dbplyr: A Dplyr Back End for Databases</em>. <a href="https://CRAN.R-project.org/package=dbplyr">https://CRAN.R-project.org/package=dbplyr</a>.
</div>
<div id="ref-R-haven" class="csl-entry" role="listitem">
Wickham, Hadley, Evan Miller, and Danny Smith. 2023. <em>Haven: Import and Export SPSS, Stata and SAS Files</em>. <a href="https://CRAN.R-project.org/package=haven">https://CRAN.R-project.org/package=haven</a>.
</div>
<div id="ref-R-tidyr" class="csl-entry" role="listitem">
Wickham, Hadley, Davis Vaughan, and Maximilian Girlich. 2023. <em>Tidyr: Tidy Messy Data</em>. <a href="https://CRAN.R-project.org/package=tidyr">https://CRAN.R-project.org/package=tidyr</a>.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Note I’ve modified the output of <code><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim()</a></code> for display purposes.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./acquire-data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./transform-datasets.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>
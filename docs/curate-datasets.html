<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>An Introduction to Quantitative Text Analysis for Linguistics - 6&nbsp; Curate datasets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./transform-datasets.html" rel="next">
<link href="./acquire-data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="stylesheet" href="assets/css/mini.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./preparation.html">Preparation</a></li><li class="breadcrumb-item"><a href="./curate-datasets.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">An Introduction to Quantitative Text Analysis for Linguistics</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/qtalr/book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./qtalr-manuscript.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./orientation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Orientation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text analysis in context</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./understanding-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Understanding data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./approaching-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Approaching analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./framing-research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Framing research</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acquire-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./curate-datasets.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transform-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Reports</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collaboration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Collaboration</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feedback.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Feedback <i class="fa-solid fa-comment" aria-label="comment"></i></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#unstructured" id="toc-unstructured" class="nav-link active" data-scroll-target="#unstructured"><span class="header-section-number">6.1</span> Unstructured</a>
  <ul class="collapse">
<li><a href="#orientation" id="toc-orientation" class="nav-link" data-scroll-target="#orientation"><span class="header-section-number">6.1.1</span> Orientation</a></li>
  <li><a href="#tidy-the-data" id="toc-tidy-the-data" class="nav-link" data-scroll-target="#tidy-the-data"><span class="header-section-number">6.1.2</span> Tidy the data</a></li>
  <li><a href="#write-dataset" id="toc-write-dataset" class="nav-link" data-scroll-target="#write-dataset"><span class="header-section-number">6.1.3</span> Write dataset</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">6.1.4</span> Summary</a></li>
  </ul>
</li>
  <li>
<a href="#structured" id="toc-structured" class="nav-link" data-scroll-target="#structured"><span class="header-section-number">6.2</span> Structured</a>
  <ul class="collapse">
<li><a href="#orientation-1" id="toc-orientation-1" class="nav-link" data-scroll-target="#orientation-1"><span class="header-section-number">6.2.1</span> Orientation</a></li>
  <li><a href="#read-the-dataset" id="toc-read-the-dataset" class="nav-link" data-scroll-target="#read-the-dataset"><span class="header-section-number">6.2.2</span> Read the dataset</a></li>
  <li><a href="#explore-the-dataset" id="toc-explore-the-dataset" class="nav-link" data-scroll-target="#explore-the-dataset"><span class="header-section-number">6.2.3</span> Explore the dataset</a></li>
  <li><a href="#tidy-the-datasets" id="toc-tidy-the-datasets" class="nav-link" data-scroll-target="#tidy-the-datasets"><span class="header-section-number">6.2.4</span> Tidy the datasets</a></li>
  <li><a href="#write-dataset-1" id="toc-write-dataset-1" class="nav-link" data-scroll-target="#write-dataset-1"><span class="header-section-number">6.2.5</span> Write dataset</a></li>
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1"><span class="header-section-number">6.2.6</span> Summary</a></li>
  <li><a href="#tidy-the-datasets-1" id="toc-tidy-the-datasets-1" class="nav-link" data-scroll-target="#tidy-the-datasets-1"><span class="header-section-number">6.2.7</span> Tidy the datasets</a></li>
  <li><a href="#write-dataset-2" id="toc-write-dataset-2" class="nav-link" data-scroll-target="#write-dataset-2"><span class="header-section-number">6.2.8</span> Write dataset</a></li>
  <li><a href="#summary-2" id="toc-summary-2" class="nav-link" data-scroll-target="#summary-2"><span class="header-section-number">6.2.9</span> Summary</a></li>
  </ul>
</li>
  <li>
<a href="#semi-structured" id="toc-semi-structured" class="nav-link" data-scroll-target="#semi-structured"><span class="header-section-number">6.3</span> Semi-structured</a>
  <ul class="collapse">
<li><a href="#orientation-2" id="toc-orientation-2" class="nav-link" data-scroll-target="#orientation-2"><span class="header-section-number">6.3.1</span> Orientation</a></li>
  <li><a href="#tidy-the-data-1" id="toc-tidy-the-data-1" class="nav-link" data-scroll-target="#tidy-the-data-1"><span class="header-section-number">6.3.2</span> Tidy the data</a></li>
  <li><a href="#write-datasets" id="toc-write-datasets" class="nav-link" data-scroll-target="#write-datasets"><span class="header-section-number">6.3.3</span> Write datasets</a></li>
  <li><a href="#summary-3" id="toc-summary-3" class="nav-link" data-scroll-target="#summary-3"><span class="header-section-number">6.3.4</span> Summary</a></li>
  </ul>
</li>
  <li><a href="#documentation" id="toc-documentation" class="nav-link" data-scroll-target="#documentation"><span class="header-section-number">6.4</span> Documentation</a></li>
  <li><a href="#summary-4" id="toc-summary-4" class="nav-link" data-scroll-target="#summary-4">Summary</a></li>
  <li><a href="#activities" id="toc-activities" class="nav-link" data-scroll-target="#activities">Activities</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/qtalr/book/edit/main/curate-datasets.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/qtalr/book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-curate-datasets" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-default callout-caution callout-titled" title="Caution">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><i class="fa-solid fa-route" aria-label="route"></i> In progress…</p>
</div>
</div>
<!-- 

Content:

- [ ] adding a description of the importance of the 'unit of analysis' in the structuring of the curated dataset
  - Note: this is touched upon in the 'Foundations' part, but it is important to see how this is implemented in the curation process. 
  - Also it should be mentioned that many times you want to keep the unit of observation and sometimes the unit of analysis somewhat flexible, so that you can explore different ways of framing the data (especially in the case of IDA approaches).
- [ ] the unit of analysis is tied with the research question --so consider how to frame the curation process for the various data/ datasets so that the unit of analysis
  - [ ] Note: the unit of observation is where we are going in the next chapter with "Transform datasets". So we need to make sure that we are clear about the distinction between the two.

Exercises:

- [ ] add concept questions to Activities
- [ ] add exercises to Activities
- [ ] add thought questions/ case studies to prose sections

Formatting:

- [ ] cite the packages used
- [ ] cite the europarl Corpus 
- [ ] correct the file names for Switchboard to reflect the dataset_curated.csv, and dataset_data_dictionary.csv format

-->
<blockquote class="blockquote">
<p>The hardest bit of information to extract is the first piece.</p>
<p>— Robert Ferrigno</p>
</blockquote>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-list-alt" aria-label="list-alt"></i> Outcomes</strong></p>
<!-- Remember and understand verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] change to outcomes -->
<ul>
<li>what are some of the formats that data can take?</li>
<li>what R programming strategies are used to read these formats into tabular, tidy dataset structures?</li>
<li>what is the importance of maintaining modularity between data and data processing in a reproducible research project?</li>
</ul>
</div>
</div>
</div>
<ul class="task-list">
<li>
<input type="checkbox">Revise: to reflect the new structure/ content of the chapter</li>
</ul>
<p>In this chapter we will now look at the next step in a text analysis project: data curation. That is, the process of converting the original data we acquire to a tidy dataset. Acquired data can come in a wide variety of formats. These formats tend to signal the richness of the metadata that is included in the file content. In this chapter we will consider three general types of content formats: (1) unstructured data, (2) structured data, and (3) semi-structured data. Regardless of the file type and the structure of the data, it will be necessary to consider how to curate a dataset that such that the structure reflects the basic the unit of analysis that we wish to investigate. The resulting dataset will form the base from which we will work to further transform the dataset such that it aligns with the unit(s) of observation required for the analysis method(s) that we will implement. Once the dataset is curated, we will create a data dictionary that describes the dataset and the variables that are included in the dataset for transparency and reproducibility.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-terminal" aria-label="terminal"></i> Swirl lesson</strong></p>
<!-- Remember and understand verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- Learn how to use regular expressions to match patterns in text using the *stringr* package. Learn how to manipulate data using the `dplyr` package. -->
<p><strong>What</strong>: <a href="https://github.com/qtalr/lessons">Pattern Matching and Manipulate Datasets</a><br><strong>How</strong>: In the R Console pane load <code>swirl</code>, run <code>swirl()</code>, and follow prompts to select the lesson.<br><strong>Why</strong>: To familiarize yourself with the basics of using the pattern matching syntax Regular Expressions and the <code>dplyr</code> package to manipulate datasets.</p>
</div>
</div>
</div>
<section id="unstructured" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="unstructured">
<span class="header-section-number">6.1</span> Unstructured</h2>
<p>The bulk of text ever created is of the unstructured variety. Unstructured data is data that has not been organized to make the information contained within machine-readable. Remember that text in itself is not information. Only when given explicit context does text become informative. The explicit contextual information that is included with data is called metadata. Metadata can be linguistic or non-linguistic in nature. So for unstructured data there is little to no metadata directly associated with the data. This information needs to be added or derived for the purposes of the research, either through manual inspection or (semi-)automatic processes. For now, however, our job is just to get the unstructured data into a structured format with a minimal set of metadata that we can derive from the resource.</p>
<section id="orientation" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="orientation">
<span class="header-section-number">6.1.1</span> Orientation</h3>
<p>As an example of an unstructured source of corpus data, let’s take a look at the <a href="https://www.statmt.org/europarl/">Europarl Parallel Corpus</a> <span class="citation" data-cites="Koehn2005">(<a href="references.html#ref-Koehn2005" role="doc-biblioref">Koehn 2005</a>)</span>. This corpus contains parallel texts (source and translated documents) from the European Parliamentary proceedings between 1996-2011 for some 21 European languages.</p>
<p>Let’s assuming we selected this corpus data because we are interested in researching Spanish to English translations. After consulting the corpus website, downloading the compressed file, and inspecting the decompressed structure, we have the the file structure seen in <a href="#exm-cd-europarl-file-structure">Example&nbsp;<span>6.1</span></a>.</p>
<div id="exm-cd-europarl-file-structure" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.1 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">project/</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> code/</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 1-acquire-data.qmd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 2-curate-data.qmd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── ...</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> data/</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── analysis/</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── derived/</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── original/</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       │── europarl_do.csv</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── europarl/</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>           ├── europarl-v7.es-en.en</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>           └── europarl-v7.es-en.es</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> output/</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── figures/</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── reports/</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── results/</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── tables/</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> _main.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <em>europarl_do.csv</em> file contains the data origin information documented as part of the acquisition process. The contents are seen in <a href="#tbl-cd-europarl-data-origin">Table&nbsp;<span>6.1</span></a>.</p>
<div class="cell" data-hash="curate-datasets_cache/html/tbl-cd-europarl-data-origin_8fff548e6c15d9f8bf6eaa7551f13ddd">
<div class="cell-output-display">
<div id="tbl-cd-europarl-data-origin" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.1: Data origin: Europarl Corpus</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">attribute</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Resource name</td>
<td style="text-align: left;">Europarl Parallel Corpus</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data source</td>
<td style="text-align: left;">&lt;https://www.statmt.org/europarl/&gt;</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Data sampling frame</td>
<td style="text-align: left;">Spanish transcripts from the European Parliament proceedings</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data collection date(s)</td>
<td style="text-align: left;">1996-2011</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Data format</td>
<td style="text-align: left;">TXT files with '.es' for source (Spanish) and '.en' for target (English) files.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data schema</td>
<td style="text-align: left;">Line-by-line unannotated parallel text</td>
</tr>
<tr class="odd">
<td style="text-align: left;">License</td>
<td style="text-align: left;">See: &lt;https://www.europarl.europa.eu/legal-notice/en/&gt;</td>
</tr>
<tr class="even">
<td style="text-align: left;">Attribution</td>
<td style="text-align: left;">Please cite the paper: Koehn, P. 2005. 'Europarl: A Parallel Corpus for Statistical Machine Translation.' MT Summit X, 12-16.</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<!-- [x] Update directory structure and reference to the data -->
<p>Now let’s get familiar with the corpus directory structure and the files. In <a href="#exm-cd-europarl-file-structure">Example&nbsp;<span>6.1</span></a>, we see that there are two corpus files, <em>europarl-v7.es-en.es</em> and <em>europarl-v7.es-en.en</em>, that contain the source and target language texts, respectively. The file names indicate that the files contain Spanish-English parallel texts. The <em>.es</em> and <em>.en</em> extensions indicate the language of the text.</p>
<p>Looking at the beginning of the <em>.es</em> and <em>.en</em> files, in <a href="#exm-cd-europarl-sample-source">Example&nbsp;<span>6.2</span></a> and <a href="#exm-cd-europarl-sample-target">Example&nbsp;<span>6.3</span></a>, we see that the files contain a series of lines in either the source or target language.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="exm-cd-europarl-sample-source" class="theorem example quarto-layout-cell" style="flex-basis: 49.5%;justify-content: flex-start;">
<p><span class="theorem-title"><strong>Example 6.2 </strong></span><em>europarl-v7.es-en.es</em> sample</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Reanudación del período de sesiones</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Declaro reanudado el período de sesiones del Parlamento Europeo, interrumpido el viernes 17 de diciembre pasado, y reitero a Sus Señorías mi deseo de que hayan tenido unas buenas vacaciones.</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>Como todos han podido comprobar, el gran "efecto del año 2000" no se ha producido. En cambio, los ciudadanos de varios de nuestros países han sido víctimas de catástrofes naturales verdaderamente terribles.</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Sus Señorías han solicitado un debate sobre el tema para los próximos días, en el curso de este período de sesiones.</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>A la espera de que se produzca, de acuerdo con muchos colegas que me lo han pedido, pido que hagamos un minuto de silencio en memoria de todas las víctimas de las tormentas, en los distintos países de la Unión Europea afectados.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 1.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div id="exm-cd-europarl-sample-target" class="theorem example quarto-layout-cell" style="flex-basis: 49.5%;justify-content: flex-start;">
<p><span class="theorem-title"><strong>Example 6.3 </strong></span><em>europarl-v7.es-en.en</em> sample</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Resumption of the session</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>I declare resumed the session of the European Parliament adjourned on Friday 17 December 1999, and I would like once again to wish you a happy new year in the hope that you enjoyed a pleasant festive period.</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>Although, as you will have seen, the dreaded 'millennium bug' failed to materialise, still the people in a number of countries suffered a series of natural disasters that truly were dreadful.</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>You have requested a debate on this subject in the course of the next few days, during this part-session.</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>In the meantime, I should like to observe a minute' s silence, as a number of Members have requested, on behalf of all the victims concerned, particularly those of the terrible storms, in the various countries of the European Union.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>We can clearly appreciate that the data is unstructured. That is, there is no explicit metadata associated with the data. The data is just a series of lines. The only information that we can surmise from structure of the data is that the texts are line-aligned and that the data in each file corresponds to source and target languages.</p>
<p>Now, before embarking on a data curation process, it is recommendable to define the structure of the data that we want to create. I call this the “idealized structure” of the data. For a curated dataset there are two considerations. First, we want to maintain the original structure of the data as much as possible. This provides a link to the original data and gives us a default dataset structure from which we can derive other structures that fit our analysis needs. Second, we want to add structure to the data that makes it easier to work with. This is the ‘tidy’ part of the data curation process. The aim is to embue the dataset with as much of the metadata the data resource makes available.</p>
<p>Given what we know about the data, we can define the idealized structure of the data as seen in <a href="#tbl-cd-europarl-structure-example">Table&nbsp;<span>6.2</span></a>.</p>
<div class="cell" data-hash="curate-datasets_cache/html/tbl-cd-europarl-structure-example_663e30a624b24975b654d9ed015a7e3b">
<div class="cell-output-display">
<div id="tbl-cd-europarl-structure-example" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.2: Idealized structure for the europarl Corpus dataset.</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">doc_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">line_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">line</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Source</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">...line from source language</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Source</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">...</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Source</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">...</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Target</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">...line from target language</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Target</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">...</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">Target</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">...</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>The dataset structure in <a href="#tbl-cd-europarl-structure-example">Table&nbsp;<span>6.2</span></a> has four columns. The first column, <code>doc_id</code> is a unique identifier for each line in the corpus. <code>type</code>, indicates whether the line is from the source or target language. The third column, <code>line_id</code>, is a unique identifier for each line for each <code>type</code>. The last column, <code>line</code>, contains the text of the line, and maintains the structure of the original data. The observations are lines.</p>
<p>Our task now is to develop code that will read the original data and render the idealized structure as a curated dataset we will write to the <em>data/derived/</em> directory. The code we develop will be added to the <em>2-curate-data.qmd</em> file. And finally, the dataset will be documented with a data dictionary file.</p>
</section><section id="tidy-the-data" class="level3" data-number="6.1.2"><h3 data-number="6.1.2" class="anchored" data-anchor-id="tidy-the-data">
<span class="header-section-number">6.1.2</span> Tidy the data</h3>

<!-- 
- [x] make clear reference to "idealized structure" table, for each of the sections (unstructured, structured, semi-structured)
-->
<p>To create the idealized dataset structure in <a href="#tbl-cd-europarl-structure-example">Table&nbsp;<span>6.2</span></a>, lets’s start by reading the files into R. There are many ways to read data, but for illustrative purposes we will use the <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function from the <code>readtext</code> package <span class="citation" data-cites="R-readtext">(<a href="references.html#ref-R-readtext" role="doc-biblioref">Benoit and Obeng 2023</a>)</span>. <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> is a versatile function that can read many different types of text files (<em>e.g.</em> <em>.txt</em>, <em>.csv</em>, <em>xml</em>, <em>etc.</em>). It can also read multiple files at once using wildcard matching. We will use it to read the <em>.es</em> and <em>.en</em> files by passing the path to the directory where the files are located, and then use the <code>*</code> wildcard to read all the files in the directory.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-readtext-show_add5fb4a30d71c3e3e2b74910ac083b3">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/quanteda/readtext">readtext</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read Europarl files .es and .en</span></span>
<span><span class="va">europarl_docs_tbl</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext</a></span><span class="op">(</span><span class="st">"../data/original/europarl/*"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># read in files</span></span>
<span>  <span class="fu">tibble</span><span class="op">(</span><span class="op">)</span> <span class="co"># convert to tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exm-cd-europarl-readtext" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.4 </strong></span>&nbsp;</p>
</div>
<p>In <a href="#exm-cd-europarl-readtext">Example&nbsp;<span>6.4</span></a>, the <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function reads all the files in the <em>../data/curate-datasets/europarl/</em> directory and returns a tibble.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i> Warning</strong></p>
<p>The <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function can read many different types of file formats, from structured to unstructured. However, it depends in large part on the extension of the file to recognize what algorithm to use when reading a file. In this particular case, the Europarl files do not have a typical extension (they have <code>.en</code> and <code>.es</code>). The <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function will treat them as plain text (<code>.txt</code>), but it will throw a warning message. To suppress the warning message you can add the <code>verbosity = 0</code> argument or set <code>readtext_options(verbosity = 0)</code>.</p>
</div>
</div>
</div>
<p>Let’s inspect the <code>europarl_docs_tbl</code> object with the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function, in <a href="#exm-cd-europarl-readtext-str">Example&nbsp;<span>6.5</span></a>.</p>
<div id="exm-cd-europarl-readtext-str" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.5 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-readtext-str_f6f75e337188d8cd350e26016e0e1ed2">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Preview data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">europarl_docs_tbl</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; tibble [2 × 2] (S3: tbl_df/tbl/data.frame)
&gt;  $ doc_id: chr [1:2] "europarl-v7.es-en.en" "europarl-v7.es-en.es"
&gt;  $ text  : chr [1:2] "Resumption of the session\nI declare resumed the session of the European Parliament adjourned on Friday 17 Dece"| __truncated__ "Reanudación del período de sesiones\nDeclaro reanudado el período de sesiones del Parlamento Europeo, interrump"| __truncated__</code></pre>
</div>
</div>
</div>
<p>We see that the output from <a href="#exm-cd-europarl-readtext-str">Example&nbsp;<span>6.5</span></a> is a tibble with two columns, <code>doc_id</code> and <code>text</code>. The <code>doc_id</code> column contains the name of the file from which the text was read. The <code>text</code> column contains the text of the file. There are two observations, one for each file.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>Note that the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function from base R is similar to <code>glimpse()</code>. However, <code>glimpse()</code> will attempt to show you as much data as possible. In this case since our column <code>text</code> is a very long character vector it will take a long time to render. I’ve chosen the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function as it will automatically truncate the data.</p>
</div>
</div>
</div>
<!-- [x] I need to standardize how I refer to packages `readtext` -->
<p>The fact that we only have one row for each file means that all the text in each file is contained in one cell! We want to break these cells up into rows for each line, as they appear in the original data. You may be wondering why the <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function did not do this for us, after all the original data was already separated into lines. The reason is that the <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function chose to read the files as plain text, and plain text does not have any structure. The line breaks, however, are still there, they are just represented as a special character, <code>\n</code>. Comparing <a href="#exm-cd-europarl-text-lines">Example&nbsp;<span>6.6</span></a> and <a href="#exm-cd-europarl-text-lines-raw">Example&nbsp;<span>6.7</span></a>, we can see that the text is a single long character vector, and that the line breaks are represented as <code>\n</code>.</p>
<div id="exm-cd-europarl-text-lines" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.6 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-text-lines_fd5b9ddb0cabf4a28aa432a0d819ee97">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Preview first 50 characters</span></span>
<span><span class="va">europarl_docs_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">str_trunc</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">str_view</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] │ Resumption of the session
&gt;     │ I declare resumed the...
&gt; [2] │ Reanudación del período de sesiones
&gt;     │ Declaro rea...</code></pre>
</div>
</div>
</div>
<div id="exm-cd-europarl-text-lines-raw" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.7 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-text-lines-raw_df56cb768cfeeb515bda56c9c0432006">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Preview first 50 raw characters</span></span>
<span><span class="va">europarl_docs_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">str_trunc</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">str_view</span><span class="op">(</span>use_escapes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] │ Resumption of the session\nI declare resumed the...
&gt; [2] │ Reanudaci\u00f3n del per\u00edodo de sesiones\nDeclaro rea...</code></pre>
</div>
</div>
</div>
<p>In <a href="#exm-cd-europarl-text-lines">Example&nbsp;<span>6.6</span></a>, we can see a truncated version of the text as it is in a printed format. The <code>str_trunc()</code> function from the <code>stringr</code> package <span class="citation" data-cites="R-stringr">(<a href="references.html#ref-R-stringr" role="doc-biblioref">Wickham 2022</a>)</span> truncates the text to the first 50 characters. The <code>str_view()</code> function from the same package allows us to see the text in a viewer pane.</p>
<p>In <a href="#exm-cd-europarl-text-lines-raw">Example&nbsp;<span>6.7</span></a>, we can see the raw text, that is, the text as it is stored in the computer. The <code>use_escapes = TRUE</code> argument tells the <code>str_view()</code> function to show the special characters as they are stored in the computer. This includes the <code>\n</code> line-feed character, which represents a line break.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>The <code>str_view()</code> with the argument <code>use_escapes = TRUE</code> also allows you to see other special characters, such as <code>\t</code> (tab) and <code>\r</code> (carriage return) as well as Unicode characters, such as <code>\u00f3n</code> (ó), <code>\u00ed</code> (í), <em>etc.</em>. These characters are not visible in the printed version of the text, but they are there in the raw text.</p>
</div>
</div>
</div>
<p>We can see that the text is a single long character vector, and that the line breaks are represented as <code>\n</code>. So our goal is to split the text for each file into lines creating a new row for each line created.</p>
<p>To do this we will use another function from the stringr package, <code>str_split()</code>, whose function is to split a character vector into smaller character vectors based on some splitting criteria. In <a href="#exm-cd-europarl-text-lines-tbl">Example&nbsp;<span>6.8</span></a>, we use the <code>str_split()</code> function to split the text into lines based on the <code>\n</code> character and assign it to the new column <code>lines</code> using <code>mutate()</code>. Since we will not need the <code>text</code> column anymore, we can use <code>select()</code> to drop it.</p>
<div id="exm-cd-europarl-text-lines-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.8 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-text-lines-tbl_bcc748bf3070bbc136d8f46430ce8aa7">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Split text into lines</span></span>
<span><span class="va">europarl_lines_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_docs_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lines <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">text</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">text</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="va">europarl_lines_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 2 × 2
&gt;   doc_id               lines            
&gt;   &lt;chr&gt;                &lt;list&gt;           
&gt; 1 europarl-v7.es-en.en &lt;chr [1,965,734]&gt;
&gt; 2 europarl-v7.es-en.es &lt;chr [1,965,734]&gt;</code></pre>
</div>
</div>
</div>
<p>Previewing the output in <a href="#exm-cd-europarl-text-lines-tbl">Example&nbsp;<span>6.8</span></a>, we can see that the <code>lines</code> column contains a list of character vectors. Why is this so? <code>str_split()</code> takes a character vector and splits it, as we know. It is a vectorized function, meaning that it can take a vector of character vectors and split each one into subsegments. Since any given input character vector can have a different number of subsegments, the number of subsegments in each file could be different. The ideal object for such data is a list. So <code>str_split()</code> returns a list of character vectors.</p>
<p>The list of character vectors, lines in our case, is still associated with the respective <code>doc_id</code> value. However, we want to create a new row for each line in the list. To do this, we will use the <code>unnest()</code> function from the <code>tidyr</code> package <span class="citation" data-cites="R-tidyr">(<a href="references.html#ref-R-tidyr" role="doc-biblioref">Wickham, Vaughan, and Girlich 2023</a>)</span>. The <code>unnest()</code> function takes a list column and creates a new row for each element in the list. We use the <code>unnest()</code> function to create a new row for each line in the <code>lines</code> column. We can see the output from <a href="#exm-cd-europarl-text-lines-tbl-unnest">Example&nbsp;<span>6.9</span></a>.</p>
<div id="exm-cd-europarl-text-lines-tbl-unnest" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.9 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-text-lines-tbl-unnest_86a56ae86c89b157f43c29fa27f048d5">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a new row for each line</span></span>
<span><span class="va">europarl_lines_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">lines</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="va">europarl_lines_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 2
&gt;   doc_id               lines                                                    
&gt;   &lt;chr&gt;                &lt;chr&gt;                                                    
&gt; 1 europarl-v7.es-en.en Resumption of the session                                
&gt; 2 europarl-v7.es-en.en I declare resumed the session of the European Parliament…
&gt; 3 europarl-v7.es-en.en Although, as you will have seen, the dreaded 'millennium…
&gt; 4 europarl-v7.es-en.en You have requested a debate on this subject in the cours…
&gt; 5 europarl-v7.es-en.en In the meantime, I should like to observe a minute' s si…</code></pre>
</div>
</div>
</div>
<p>Remember that the data in the Europarl corpus is aligned, meaning that each line in the source file is aligned with a line in the target file. So we need to make sure that the number of lines in each file is the same. We can do this by grouping the data by <code>doc_id</code> and then counting the number of lines in each file. We can do this using the <code>group_by()</code> and <code>count()</code> functions from the <code>dplyr</code> package <span class="citation" data-cites="R-dplyr">(<a href="references.html#ref-R-dplyr" role="doc-biblioref">Wickham et al. 2023</a>)</span>. We can see the output in <a href="#exm-cd-europarl-text-lines-tbl-count">Example&nbsp;<span>6.10</span></a>.</p>
<div id="exm-cd-europarl-text-lines-tbl-count" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.10 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-text-lines-tbl-count_d752d3738d0db15b86db85fd11ea7d6f">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Count the number of lines in each file</span></span>
<span><span class="va">europarl_lines_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">doc_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 2 × 2
&gt; # Groups:   doc_id [2]
&gt;   doc_id                     n
&gt;   &lt;chr&gt;                  &lt;int&gt;
&gt; 1 europarl-v7.es-en.en 1965734
&gt; 2 europarl-v7.es-en.es 1965734</code></pre>
</div>
</div>
</div>
<p>The output of <a href="#exm-cd-europarl-text-lines-tbl-count">Example&nbsp;<span>6.10</span></a> shows that the number of lines in each file is the same. This is good. If the number of lines in each file was different, we would need to figure out why and fix it.</p>
<p>We now have our <code>lines</code> column and the associated observations for our idealized dataset, in <a href="#tbl-cd-europarl-structure-example">Table&nbsp;<span>6.2</span></a>. Let’s now leverage the existing <code>doc_id</code> to create the <code>type</code> column. The goal is to assign the value of <code>type</code> according to the <code>doc_id</code> value. Specifically, when <code>doc_id</code> is ‘europarl-v7.es-en.es’ type should be ‘Source’ and when <code>doc_id</code> is ‘europarl-v7.es-en.en’ type should be ‘Target’.</p>
<p>We can do this using the <code>case_when()</code> function from the <code>dplyr</code> package <span class="citation" data-cites="R-dplyr">(<a href="references.html#ref-R-dplyr" role="doc-biblioref">Wickham et al. 2023</a>)</span>. The <code>case_when()</code> function takes a series of conditions and assigns a value based on the first condition that is met. In this case, we will use <code>mutate()</code> to create the <code>type</code> column and then use the <code>doc_id</code> column to create the conditions and the <code>type</code> column to assign the values from <code>case_when()</code>. We will store the output in a new object called <code>europarl_lines_type_tbl</code>, as seen in <a href="#exm-cd-europarl-text-lines-type-tbl">Example&nbsp;<span>6.11</span></a>.</p>
<div id="exm-cd-europarl-text-lines-type-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.11 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-text-lines-type-tbl_da7735fc88fc7c81d6b5ed7b0cd494f8">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create `type` column</span></span>
<span><span class="va">europarl_lines_type_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>type <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">doc_id</span> <span class="op">==</span> <span class="st">"europarl-v7.es-en.es"</span> <span class="op">~</span> <span class="st">"Source"</span>,</span>
<span>    <span class="va">doc_id</span> <span class="op">==</span> <span class="st">"europarl-v7.es-en.en"</span> <span class="op">~</span> <span class="st">"Target"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarl_lines_type_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 3,931,468
&gt; Columns: 3
&gt; $ doc_id &lt;chr&gt; "europarl-v7.es-en.en", "europarl-v7.es-en.en", "europarl-v7.es…
&gt; $ lines  &lt;chr&gt; "Resumption of the session", "I declare resumed the session of …
&gt; $ type   &lt;chr&gt; "Target", "Target", "Target", "Target", "Target", "Target", "Ta…</code></pre>
</div>
</div>
</div>
<p>The preview output from <a href="#exm-cd-europarl-text-lines-type-tbl">Example&nbsp;<span>6.11</span></a> shows us that we now have three columns, <code>doc_id</code>, <code>lines</code>, and <code>type</code>. The <code>type</code> column has been created and the values have been assigned according to the <code>doc_id</code> values.</p>
<p>We can now overwrite the <code>doc_id</code> column with a unique identifier for each line. A numeric identifier makes sense. We can do this by using the <code>mutate()</code> function to assign <code>doc_id</code> a sequential number with <code>row_number()</code>, which increments by 1 for each row. We will store the output in a new object called <code>europarl_lines_type_id_tbl</code>, as seen in <a href="#exm-cd-europarl-text-lines-type-id-tbl">Example&nbsp;<span>6.12</span></a>.</p>
<div id="exm-cd-europarl-text-lines-type-id-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.12 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-text-lines-type-id-tbl_8a915577fe631ce68d3d2722fd7fa0ac">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create new `doc_id` column</span></span>
<span><span class="va">europarl_lines_type_id_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_type_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>doc_id <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarl_lines_type_id_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 3,931,468
&gt; Columns: 3
&gt; $ doc_id &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, …
&gt; $ lines  &lt;chr&gt; "Resumption of the session", "I declare resumed the session of …
&gt; $ type   &lt;chr&gt; "Target", "Target", "Target", "Target", "Target", "Target", "Ta…</code></pre>
</div>
</div>
</div>
<p>The preview output from <a href="#exm-cd-europarl-text-lines-type-id-tbl">Example&nbsp;<span>6.12</span></a> shows us that we now have the same three columns, <code>doc_id</code>, <code>lines</code>, and <code>type</code>. However, the values in the <code>doc_id</code> column now reflect a unique identifier for each line.</p>
<p>The last step to get to our envisioned dataset structure is to add the <code>line_id</code> column which will be calculated by grouping the data by <code>type</code> and then assigning a row number to each of the lines in each group. We use the <code>group_by()</code> function to perform the grouping as seen in <a href="#exm-cd-europarl-text-lines-type-id-line-id-tbl">Example&nbsp;<span>6.13</span></a>.</p>
<div id="exm-cd-europarl-text-lines-type-id-line-id-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.13 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-text-lines-type-id-line-id-tbl_cff20cbd392611e0bfda70a83b8e3c8f">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create `line_id` column</span></span>
<span><span class="va">europarl_lines_type_id_line_id_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_type_id_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">type</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>line_id <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarl_lines_type_id_line_id_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 3,931,468
&gt; Columns: 4
&gt; $ doc_id  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,…
&gt; $ lines   &lt;chr&gt; "Resumption of the session", "I declare resumed the session of…
&gt; $ type    &lt;chr&gt; "Target", "Target", "Target", "Target", "Target", "Target", "T…
&gt; $ line_id &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,…</code></pre>
</div>
</div>
</div>
<p>The preview output from <a href="#exm-cd-europarl-text-lines-type-id-line-id-tbl">Example&nbsp;<span>6.13</span></a> shows us that we now have the desired four columns, <code>doc_id</code>, <code>lines</code>, <code>type</code>, and <code>line_id</code>.</p>
<p>Before we get to writing the dataset to disk, let’s organized it in a way that the columns are in the order we want and the rows are sorted in a way that makes sense.</p>
<p>Reordering the columns involves using the <code>select()</code> function and list the order of the columns. To sort by columns, we will use <code>arrange()</code> and specify the columns to order by. We store the results in a more legible object, <code>europarl_curated_tbl</code>, as seen in <a href="#exm-cd-europarl-curated-tbl">Example&nbsp;<span>6.14</span></a>.</p>
<div id="exm-cd-europarl-curated-tbl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.14 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-europarl-text-lines-type-id-line-id-tbl-reorder_baf8876eeb693abc2ca6e7ea4a19f1ea">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Reorder columns and sort rows</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_lines_type_id_line_id_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">type</span>, <span class="va">line_id</span>, <span class="va">lines</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">line_id</span>, <span class="va">type</span>, <span class="va">doc_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview dataset</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarl_curated_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; Rows: 3,931,468
&gt; Columns: 4
&gt; $ doc_id  &lt;int&gt; 1965735, 1, 1965736, 2, 1965737, 3, 1965738, 4, 1965739, 5, 19…
&gt; $ type    &lt;chr&gt; "Source", "Target", "Source", "Target", "Source", "Target", "S…
&gt; $ line_id &lt;int&gt; 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, …
&gt; $ lines   &lt;chr&gt; "Reanudación del período de sesiones", "Resumption of the sess…</code></pre>
</div>
</div>
</div>
<p>The preview output from <a href="#exm-cd-europarl-curated-tbl">Example&nbsp;<span>6.14</span></a> shows us that we now have the desired four columns, <code>doc_id</code>, <code>type</code>, <code>line_id</code>, and <code>lines</code>. The rows are sorted by <code>line_id</code>, <code>type</code>, and <code>doc_id</code>. This gives us a dataset that reads left to right from document to line oriented attributes and top to bottom by source-target line pairs.</p>
</section><section id="write-dataset" class="level3" data-number="6.1.3"><h3 data-number="6.1.3" class="anchored" data-anchor-id="write-dataset">
<span class="header-section-number">6.1.3</span> Write dataset</h3>
<p>At this point we have the curated dataset (<code>europarl_lines_type_id_line_id_tbl</code>) in a tidy format. This dataset, however, is only in the current R session. We will want to write this dataset to disk so that in the next step of the text analysis workflow (transformation) we will be able to start work on this dataset and make changes as needed to fit our analysis needs.</p>
<p>We will leverage the project directory structure which has distinct directories for <code>original/</code> and <code>derived/</code> data(sets), seen in <a href="#exm-cd-europarl-write-directory">Example&nbsp;<span>6.15</span></a>.</p>
<div id="exm-cd-europarl-write-directory" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.15 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">│──</span> analysis/</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│──</span> europarl_do.csv</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> europarl/</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> europarl-v7.es-en.es</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> europarl-v7.es-en.en</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since this is a tabular, tidy dataset we have various options for the file type to write. Many of these formats are software-specific, such as <code>*.xlsx</code> for Microsoft Excel, <code>*.sav</code> for SPSS, <code>*.dta</code> for Stata, and <code>*.rds</code> for R. We will use the <code>*.csv</code> format since it is a common format that can be read by many software packages. We will use the <code>write_csv()</code> function from the <code>readr</code> package to write the dataset to disk.</p>
<p>Now the question is where to save our CSV file. Since our <code>europarl_curated_tbl</code> dataset is derived by our work, we will added it to the <code>derived/</code> directory. I’ll create a <code>europarl/</code> directory with <code>dir_create()</code> just to keep things organized.</p>
<div id="exm-cd-unstructured-write-europarl" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.16 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-unstructured-write-europarl_3da587daee8341590dead1938acc6865">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create the europarl/ directory</span></span>
<span><span class="fu">dir_create</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../data/derived/europarl/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write the curated dataset to disk</span></span>
<span><span class="fu">write_csv</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">europarl_curated_tbl</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"../data/derived/europarl/europarl_curated.csv"</span></span>
<span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>After running the code in <a href="#exm-cd-unstructured-write-europarl">Example&nbsp;<span>6.16</span></a>, the directory structure under the <code>derived/</code> directory should look like <a href="#exm-cd-unstructured-write-europarl-directory">Example&nbsp;<span>6.17</span></a>.</p>
<div id="exm-cd-unstructured-write-europarl-directory" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.17 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">│──</span> analysis/</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── europarl/</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── europarl_curated.csv</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──europarl</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> europarl-v7.es-en.en</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> europarl-v7.es-en.es</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="summary" class="level3" data-number="6.1.4"><h3 data-number="6.1.4" class="anchored" data-anchor-id="summary">
<span class="header-section-number">6.1.4</span> Summary</h3>
<p>In this section we worked with unstructured data and looked at how to read the data into an R session and manipulate the data to form a tidy dataset with a few columns that we could derive based on the information we have about the corpus.</p>
<p>In our discussion we worked step by step to curate the europarl Corpus, adding in intermediate steps for illustration purposes. However, in a more realistic case the code would most likely make more extensive use of piping (<code>|&gt;</code>) to reduce the number of intermediate objects and make the code more legible. The final code base would be added to the <em>2-curate-data.qmd</em> file in the <em>code/</em> directory.</p>
<p>The final step, as always, is to document the dataset. For datasets the documentation is a data dictionary, as discussed in <a href="understanding-data.html#sec-ud-data-dictionaries"><span>Section&nbsp;2.3.2</span></a>. As with data origin files, you can use spreadsheet software to create and/ or edit the data dictionary.</p>
<p>In the <code>qtalrkit</code> package we have a function, <code>create_data_dictionary()</code> that will generate the scaffolding for a data dictionary. The function takes two arguments, <code>data</code> and <code>file_path</code>. It reads the dataset columns and provides a template for the data dictionary.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-medal" aria-label="medal"></i> Dive deeper</strong></p>
<p>The <code>create_data_dictionary()</code> function provides a rudimentary data dictionary template by default. However, you can take advantage of OpenAI’s text generation models to generate a more detailed data dictionary for you to edit. To do this create <a href="https://platform.openai.com/signup">an OpenAI account</a> and <a href="https://platform.openai.com/account/api-keys">an API key</a> and add this key to your R environment (<code>Sys.setenv(OPENAI_API_KEY = "sk..."</code>). Then you can specify the model you would like to use in the function with the <code>model =</code> argument. For example, <code>model = "gpt-3.5-turbo"</code> will use the GPT-3.5 Turbo model.</p>
</div>
</div>
</div>
<div id="exm-cd-unstructured-data-dictionary" class="theorem example">
<p><span class="theorem-title"><strong>Example 6.18 </strong></span>&nbsp;</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-unstructured-data-dictionary_89179ee9671554bae4833b72051bffbc">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create the data dictionary</span></span>
<span><span class="fu">create_data_dictionary</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">europarl_curated_tbl</span>,</span>
<span>  <span class="va">file_path</span> <span class="op">&lt;-</span> <span class="st">"../data/derived/europarl/europarl_curated_dd.csv"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>An example of the data dictionary for the <code>europarl_curated_tbl</code> dataset is shown in <a href="#tbl-cd-unstructured-data-dictionary-example">Table&nbsp;<span>6.3</span></a>.</p>
<div class="cell" data-hash="curate-datasets_cache/html/tbl-cd-unstructured-data-dictionary-example_0b0310e24cd856825ad0fe9caa3c1eb2">
<div class="cell-output-display">
<div id="tbl-cd-unstructured-data-dictionary-example" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;6.3: Data dictionary for the <code>europarl_curated_tbl</code> dataset.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_id</td>
<td style="text-align: left;">Document ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Unique identification number for each document</td>
</tr>
<tr class="even">
<td style="text-align: left;">type</td>
<td style="text-align: left;">Document Type</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Type of document; either 'Source' or 'Target'</td>
</tr>
<tr class="odd">
<td style="text-align: left;">line_id</td>
<td style="text-align: left;">Line ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Unique identification number for each line in each document type</td>
</tr>
<tr class="even">
<td style="text-align: left;">lines</td>
<td style="text-align: left;">Lines</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Content of the lines in the document</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section></section><section id="structured" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="structured">
<span class="header-section-number">6.2</span> Structured</h2>
<ul class="task-list">
<li>
<input type="checkbox">revise this section: include R package (languageR::datives) and CSV file?
<ul class="task-list">
<li>
<input type="checkbox">is is not clear that a truly structured dataset would need any curation. What could I say about structured data that would be useful? I could talk about verifying the data structure is as expected.</li>
</ul>
</li>
</ul>
<p>On the opposite side of the spectrum from unstructured data, structured data includes more metadata information –often much more. The association of metadata with the language to be analyzed means that the data has already be curated to some degree, therefore it is more apt to discuss structured data as a dataset. There are two questions, however, that need to be taken into account. One, logistical question, is what file format the dataset is in and how to we read it into R. And the second, more research-based, is whether the data is curated in a fashion that makes sense for the current research. Let’s look at each of these questions briefly and then get to a practical example.</p>
<p>Formats … file types</p>
<ul class="task-list">
<li><p><input type="checkbox">only databases, R datasets/ RDS files, and potentially .csv files are structured data. I need to make this clear.</p></li>
<li>
<p><input type="checkbox">add example case(s):</p>
<ul class="task-list">
<li>
<input type="checkbox">R package datasets
<ul class="task-list">
<li>
<input type="checkbox">languageR::dative</li>
<li>
<input type="checkbox">janeaustenr::austen_books</li>
<li>
<input type="checkbox">…</li>
</ul>
</li>
<li>
<input type="checkbox">R package corpora (quanteda::corpus) + tidytext::tidy()</li>
<li>
<input type="checkbox">CABNC CSV files</li>
</ul>
</li>
</ul>
<p>CSV There are file formats which are purposely designed for storing structured datasets. Some very common file types are .csv, .xml, .json, etc. The data within these files is explicitly organized. For example, in a .csv file, the dataset structure is represented by delimiting the columns and rows by commas.</p>
<pre class="text"><code>column_1,column_2,column_3
row 1 value 1,row 1 value 2,row 1 value 3
row 2 value 1,row 2 value 2,row 2 value 3</code></pre>
<p>When read into R, the .csv file format is converted to a data frame with the appropriate structure.</p>
<div id="tbl-cd-structured-example-table-csv" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Example .csv file in R" data-hash="curate-datasets_cache/html/tbl-cd-structured-example-table-csv_005e2dc8586a1b49523ce9cd2cfcd361">

</div>
<p>With an understanding of how the information is encoded in various formats, we can now turn to considerations about how the original dataset is structured and how that structure is to be used for a given research project. The curation process that is reflected in a structured dataset may or may not initially align with the goals of our research either in terms of the type(s) of information or the unit of analysis of the structured dataset. The aim, then, is to take advantage of the information and curate it such that it does align.</p>
<p>As an example case of curating structured datasets, we will look at …</p>
<ul class="task-list">
<li>
<input type="checkbox">R package datasets
<ul class="task-list">
<li>
<input type="checkbox">languageR::dative</li>
<li>
<input type="checkbox">janeaustenr::austen_books</li>
<li>
<input type="checkbox">…</li>
</ul>
</li>
<li>
<input type="checkbox">R package corpora (quanteda::corpus) + tidytext::tidy()</li>
<li>
<input type="checkbox">CABNC CSV files</li>
</ul>
<section id="orientation-1" class="level3" data-number="6.2.1"><h3 data-number="6.2.1" class="anchored" data-anchor-id="orientation-1">
<span class="header-section-number">6.2.1</span> Orientation</h3>
</section><section id="read-the-dataset" class="level3" data-number="6.2.2"><h3 data-number="6.2.2" class="anchored" data-anchor-id="read-the-dataset">
<span class="header-section-number">6.2.2</span> Read the dataset</h3>
</section><section id="explore-the-dataset" class="level3" data-number="6.2.3"><h3 data-number="6.2.3" class="anchored" data-anchor-id="explore-the-dataset">
<span class="header-section-number">6.2.3</span> Explore the dataset</h3>
<div class="cell" data-hash="curate-datasets_cache/html/cd-structured-code-explore_0b1b2b65817ac7bdf30016fdb365782d">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="tidy-the-datasets" class="level3" data-number="6.2.4"><h3 data-number="6.2.4" class="anchored" data-anchor-id="tidy-the-datasets">
<span class="header-section-number">6.2.4</span> Tidy the datasets</h3>
<ul class="task-list">
<li>
<input type="checkbox">Add idealized structure for the dataset(s)</li>
</ul>
<p>So our objectives are set, let’s …</p>
</section><section id="write-dataset-1" class="level3" data-number="6.2.5"><h3 data-number="6.2.5" class="anchored" data-anchor-id="write-dataset-1">
<span class="header-section-number">6.2.5</span> Write dataset</h3>
<p>We now have a curated dataset that we can write to disk.</p>
</section><section id="summary-1" class="level3" data-number="6.2.6"><h3 data-number="6.2.6" class="anchored" data-anchor-id="summary-1">
<span class="header-section-number">6.2.6</span> Summary</h3>
<p>Again, to summarize, here is the code that will accomplish the steps we covered in this section on curating structured datasets.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-structured-code-summary_bc9474e2bbc796caf9670ce40541ff77">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="tidy-the-datasets-1" class="level3" data-number="6.2.7"><h3 data-number="6.2.7" class="anchored" data-anchor-id="tidy-the-datasets-1">
<span class="header-section-number">6.2.7</span> Tidy the datasets</h3>
<ul class="task-list">
<li>
<input type="checkbox">Add idealized structure for the dataset(s)</li>
</ul>
<p>So our objectives are set, let’s …</p>
</section><section id="write-dataset-2" class="level3" data-number="6.2.8"><h3 data-number="6.2.8" class="anchored" data-anchor-id="write-dataset-2">
<span class="header-section-number">6.2.8</span> Write dataset</h3>
<p>We now have a curated dataset that we can write to disk.</p>
</section><section id="summary-2" class="level3" data-number="6.2.9"><h3 data-number="6.2.9" class="anchored" data-anchor-id="summary-2">
<span class="header-section-number">6.2.9</span> Summary</h3>
<p>Again, to summarize, here is the code that will accomplish the steps we covered in this section on curating structured datasets.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-structured-code-summary-unstructured_884a20c7d495453e2dd810560504dc34">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="semi-structured" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="semi-structured">
<span class="header-section-number">6.3</span> Semi-structured</h2>
<p>At this point we have discussed curating unstructured data and structured datasets. Between these two extremes falls semi-structured data. And as the name suggests, it is a hybrid between unstructured and structured data. This means that there will be important structured metadata included with unstructured elements. The file formats and approaches to encoding the structured aspects of the data vary widely from resource to resource and therefore often requires more detailed attention to the structure of the data and often includes more sophisticated programming strategies to curate the data to produce a tidy dataset.</p>
<section id="orientation-2" class="level3" data-number="6.3.1"><h3 data-number="6.3.1" class="anchored" data-anchor-id="orientation-2">
<span class="header-section-number">6.3.1</span> Orientation</h3>
<ul class="task-list">
<li>
<input type="checkbox">this SWDA data has been mentioned, reference is all that is needed.</li>
</ul>
<p>As an example we will work with the The Switchboard Dialog Act Corpus (SDAC) which extends the <a href="https://catalog.ldc.upenn.edu/LDC97S62">Switchboard Corpus</a> with speech act annotation. <strong>(ADD CITATION)</strong></p>
<p>The main directory structure of the SDAC data looks like this:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> sdac/</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> doc/</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw00utt/</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw01utt/</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw02utt/</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw03utt/</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw04utt/</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw05utt/</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw06utt/</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw07utt/</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw08utt/</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw09utt/</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw10utt/</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw11utt/</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw12utt/</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> sw13utt/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>README</code> file contains basic information about the resource, the <code>doc/</code> directory contains more detailed information about the dialog annotations, and each of the following directories prefixed with <code>sw...</code> contain individual conversation files. Here’s a peek at internal structure of the first couple directories.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> doc</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── manual.august1.html</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> sw00utt</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0001_4325.utt</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0002_4330.utt</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0003_4103.utt</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0004_4327.utt</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0005_4646.utt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s take a look at the first conversation file (<code>sw_0001_4325.utt</code>) to see how it is structured.</p>
<p>There are few things to take note of here. First we see that the conversation files have a meta-data header offset from the conversation text by a line of <code>=</code> characters. Second the header contains meta-information of various types. Third, the text is interleaved with an annotation scheme.</p>
<p>Some of the information may be readily understandable, such as the various pieces of meta-data in the header, but to get a better understanding of what information is encoded here let’s take a look at the <code>README</code> file. In this file we get a birds eye view of what is going on. In short, the data includes 1155 telephone conversations between two people annotated with 42 ‘DAMSL’ dialog act labels. The <code>README</code> file refers us to the <code>doc/manual.august1.html</code> file for more information on this scheme.</p>
<p>At this point we open the the <code>doc/manual.august1.html</code> file in a browser and do some investigation. We find out that ‘DAMSL’ stands for ‘Discourse Annotation and Markup System of Labeling’ and that the first characters of each line of the conversation text correspond to one or a combination of labels for each utterance. So for our first utterances we have:</p>
<pre class="plain"><code>o = "Other"
qw = "Wh-Question"
qy^d = "Declarative Yes-No-Question"
+ = "Segment (multi-utterance)"</code></pre>
<p>Each utterance is also labeled for speaker (‘A’ or ‘B’), speaker turn (‘1’, ‘2’, ‘3’, etc.), and each utterance within that turn (‘utt1’, ‘utt2’, etc.). There is other annotation provided withing each utterance, but this should be enough to get us started on the conversations.</p>
<p>Now let’s turn to the meta-data in the header. We see here that there is information about the creation of the file: ‘FILENAME’, ‘TOPIC’, ‘DATE’, etc. The <code>doc/manual.august1.html</code> file doesn’t have much to say about this information so I returned to the <a href="https://catalog.ldc.upenn.edu/docs/LDC97S62/">LDC Documentation</a> and found more information in the <a href="https://catalog.ldc.upenn.edu/docs/LDC97S62/">Online Documentation</a> section. After some poking around in this documentation I discovered that that meta-data for each speaker in the corpus is found in the <code>caller_tab.csv</code> file. This tabular file does not contain column names, but the <code>caller_doc.txt</code> does. After inspecting these files manually and comparing them with the information in the conversation file I noticed that the ‘FILENAME’ information contained three pieces of useful information delimited by underscores <code>_</code>.</p>
<pre class="plain"><code>*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*


FILENAME:   4325_1632_1519
TOPIC#:     323
DATE:       920323
TRANSCRIBER:    glp</code></pre>
<p>The first information is the document id (<code>4325</code>), the second and third correspond to the speaker number: the first being speaker A (<code>1632</code>) and the second speaker B (<code>1519</code>).</p>
<p>In sum, we have 1155 conversation files. Each file has two parts, a header and text section, separated by a line of <code>=</code> characters. The header section contains a ‘FILENAME’ line which has the document id, and ids for speaker A and speaker B. The text section is annotated with DAMSL tags beginning each line, followed by speaker, turn number, utterance number, and the utterance text. With this knowledge in hand, let’s set out to create a tidy dataset with the following column structure:</p>
<div class="cell" data-hash="curate-datasets_cache/html/tbl-cd-semi-sdac-idealized-dataset_f02db450efe123cac5d2d78420dd4879">
<div class="cell-output-display">
<div id="tbl-cd-semi-sdac-idealized-dataset" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;6.4: Idealized structure for the SDAC dataset.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">doc_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">damsl_tag</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">speaker</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">turn_num</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">utterance_num</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">utterance_text</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">speaker_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">4325</td>
<td style="text-align: left;">o</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Okay. /</td>
<td style="text-align: left;">1632</td>
</tr>
<tr class="even">
<td style="text-align: left;">4325</td>
<td style="text-align: left;">qw</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">{D So, }</td>
<td style="text-align: left;">1632</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4325</td>
<td style="text-align: left;">qy^d</td>
<td style="text-align: left;">B</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">[ [ I guess, +</td>
<td style="text-align: left;">1519</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="tidy-the-data-1" class="level3" data-number="6.3.2"><h3 data-number="6.3.2" class="anchored" data-anchor-id="tidy-the-data-1">
<span class="header-section-number">6.3.2</span> Tidy the data</h3>
<ul class="task-list">
<li>
<input type="checkbox">Add idealized structure for the SWDA dataset</li>
</ul>
<p>Let’s begin by reading one of the conversation files into R as a character vector using the <code>read_lines()</code> function from the readr package.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-read-example-file-show_7664ba19089b0d4c6d1f9efa62f553fd">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># [ ] is it possible to use readtext, if not, then we need to explain why before jumping in to readr::read_lines()</span></span>
<span></span>
<span><span class="va">doc</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read_lines</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/original/sdac/sw00utt/sw_0001_4325.utt"</span><span class="op">)</span> <span class="co"># read a single file as character vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To isolate the vector element that contains the document and speaker ids, we use <code>str_detect()</code> from the stringr package. This function takes two arguments, a string and a pattern, and returns a logical value, <code>TRUE</code> if the pattern is matched or <code>FALSE</code> if not. We can use the output of this function, then, to subset the <code>doc</code> character vector and only return the vector element (line) that contains <code>digits_digits_digits</code> with a regular expression. The expression combines the digit matching operator <code>\\d</code> with the <code>+</code> operator to match 1 or more contiguous digits. We then separate three groups of <code>\\d+</code> with underscores <code>_</code>. The result is <code>\\d+_\\d+_\\d+</code>.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-doc-info-1_1c5ba7ff3d406e77c2a5190febb2fa01">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doc</span><span class="op">[</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">doc</span>, pattern <span class="op">=</span> <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span><span class="op">]</span> <span class="co"># isolate pattern</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>Regular Expressions are a powerful pattern matching syntax. They are used extensively in text manipulation and we will see them again and again.</p>
<p>To develop regular expressions, it is helpful to have a tool that allows you to interactively test your pattern matching. The stringr package has a handy function <code>str_view()</code> and <code>str_view_all()</code> which allow for interactive pattern matching. A good website to practice Regular Expressions is <a href="https://regex101.com/">RegEx101</a>. You can also install the regexplain package in R to get access to a useful <a href="https://rstudio.github.io/rstudioaddins/">RStudio Addin</a>.</p>
</div>
</div>
</div>
<p>The next step is to extract the three digit sequences that correspond to the <code>doc_id</code>, <code>speaker_a_id</code>, and <code>speaker_b_id</code>. First we extract the pattern that we have identified with <code>str_extract()</code> and then we can break up the single character vector into multiple parts based on the underscore <code>_</code>. The <code>str_split()</code> function takes a string and then a pattern to use to split a character vector. It will return a list of character vectors.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-doc-info-2_7a41273a024c010af63473732a71eea5">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doc</span><span class="op">[</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">doc</span>, <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="co"># isolate pattern</span></span>
<span>  <span class="fu">str_extract</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract the pattern</span></span>
<span>  <span class="fu">str_split</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="co"># split the character vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>[] I will have introduced lists in earlier material (swirl Objects), at least.</li>
</ul>
<p>A <strong>list</strong> is a special object type in R. It is an unordered collection of objects whose lengths can differ (contrast this with a data frame which is a collection of objects whose lengths are the same –hence the tabular format). In this case we have a list of length 1, whose sole element is a character vector of length 3 –one element per segment returned from our split. This is a desired result in most cases as if we were to pass multiple character vectors to our <code>str_split()</code> function we don’t want the results to be conflated as a single character vector blurring the distinction between the individual character vectors. If we <em>would</em> like to conflate, or <em>flatten</em> a list, we can use the <code><a href="https://rdrr.io/r/base/unlist.html">unlist()</a></code> function.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-doc-info-3_22f000a3859f8ab06a32dec884b75e86">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doc</span><span class="op">[</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">doc</span>, <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="co"># isolate pattern</span></span>
<span>  <span class="fu">str_extract</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract the pattern</span></span>
<span>  <span class="fu">str_split</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># split the character vector</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># flatten the list to a character vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s flatten the list in this case, as we have a single character vector, and assign this result to <code>doc_speaker_info</code>.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-doc-info-4_d06f0af44dc312700d10a1712d587343">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doc_speaker_info</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">doc</span><span class="op">[</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">doc</span>, <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="co"># isolate pattern</span></span>
<span>  <span class="fu">str_extract</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract the pattern</span></span>
<span>  <span class="fu">str_split</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># split the character vector</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># flatten the list to a character vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>doc_speaker_info</code> is now a character vector of length three. Let’s subset each of the elements and assign them to meaningful variable names so we can conveniently use them later on in the tidying process.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-doc-info-5_8d7b36bc02c6ca6650f78d42349e65ca">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doc_id</span> <span class="op">&lt;-</span> <span class="va">doc_speaker_info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># extract by index</span></span>
<span><span class="va">speaker_a_id</span> <span class="op">&lt;-</span> <span class="va">doc_speaker_info</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="co"># extract by index</span></span>
<span><span class="va">speaker_b_id</span> <span class="op">&lt;-</span> <span class="va">doc_speaker_info</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="co"># extract by index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next step is to isolate the text section extracting it from rest of the document. As noted previously, a sequence of <code>=</code> separates the header section from the text section. What we need to do is to index the point in our character vector <code>doc</code> where that line occurs and then subset the <code>doc</code> from that point until the end of the character vector. Let’s first find the point where the <code>=</code> sequence occurs. We will again use the <code>str_detect()</code> function to find the pattern we are looking for (a contiguous sequence of <code>=</code>), but then we will pass the logical result to the <code><a href="https://rdrr.io/r/base/which.html">which()</a></code> function which will return the element index number of this match.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text_a60cbbfda23e87b8f236f7c8b1687fe8">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doc</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">str_detect</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"=+"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># match 1 or more `=`</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># find vector index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So for this file <code>31</code> is the index in <code>doc</code> where the <code>=</code> sequence occurs. Now it is important to keep in mind that we are working with a single file from the <code>sdac/</code> data. We need to be cautious to not create a pattern that may be matched multiple times in another document in the corpus. As the <code>=+</code> pattern will match <code>=</code>, or <code>==</code>, or <code>===</code>, etc. it is not implausible to believe that there might be a <code>=</code> character on some other line in one of the other files. Let’s update our regular expression to avoid this potential scenario by only matching sequences of three or more <code>=</code>. In this case we will make use of the curly bracket operators <code><a href="https://rdrr.io/r/base/Paren.html">{}</a></code>.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text-2_3fe95209b76e694b2e5ce7ad8016b1e5">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doc</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">str_detect</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"={3,}"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># match 3 or more `=`</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># find vector index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will get the same result for this file, but will safeguard ourselves a bit as it is unlikely we will find multiple matches for <code>===</code>, <code>====</code>, etc.</p>
<p><code>31</code> is the index for the <code>=</code> sequence, but we want the next line to be where we start reading the text section. To do this we increment the index by 1.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text-3_08294f42af39f98ebb045ab73f22c68d">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">text_start_index</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">doc</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">str_detect</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"={3,}"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># match 3 or more `=`</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># find vector index</span></span>
<span><span class="va">text_start_index</span> <span class="op">&lt;-</span> <span class="va">text_start_index</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># increment index by 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The index for the end of the text is simply the length of the <code>doc</code> vector. We can use the <code><a href="https://rdrr.io/r/base/length.html">length()</a></code> function to get this index.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text-4_83656cb22c474a108ad920024ac7a528">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">text_end_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have the bookends, so to speak, for our text section. To extract the text we subset the <code>doc</code> vector by these indices.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text-5_80a68df6a8dd4829b7053cb9f76f933f">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">text</span> <span class="op">&lt;-</span> <span class="va">doc</span><span class="op">[</span><span class="va">text_start_index</span><span class="op">:</span><span class="va">text_end_index</span><span class="op">]</span> <span class="co"># extract text</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="co"># preview first lines of `text`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The text has some extra whitespace on some lines and there are blank lines as well. We should do some cleaning up before moving forward to organize the data. To get rid of the whitespace we use the <code>str_trim()</code> function which by default will remove leading and trailing whitespace from each line.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text-6_b67889d1ed4ff9a5f316503d4203d0c8">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">str_trim</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="co"># remove leading and trailing whitespace</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="co"># preview first lines of `text`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To remove blank lines we will use the a logical expression to subset the <code>text</code> vector. <code>text != ""</code> means return TRUE where lines are not blank, and FALSE where they are.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text-7_92865777543648366ea752f3959d69e8">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">text</span> <span class="op">&lt;-</span> <span class="va">text</span><span class="op">[</span><span class="va">text</span> <span class="op">!=</span> <span class="st">""</span><span class="op">]</span> <span class="co"># remove blank lines</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="co"># preview first lines of `text`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our first step towards a tidy dataset is to now combine the <code>doc_id</code> and each element of <code>text</code> in a data frame.</p>
<div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">text</span><span class="op">)</span> <span class="co"># tidy format `doc_id` and `text`</span></span>
<span><span class="fu">slice_head</span><span class="op">(</span><span class="va">data</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># preview first lines of `text`</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-cd-semi-sdac-text-8" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="First 5 observations of prelim data curation of the SDAC data." data-hash="curate-datasets_cache/html/tbl-cd-semi-sdac-text-8_ad4b758fd4781256ca4d589ef0586666">
<div class="panel-caption table-caption">
<p><strong>?(caption)</strong></p>
</div>
</div>
</div>
<p>With our data now in a data frame, its time to parse the <code>text</code> column and extract the damsl tags, speaker, speaker turn, utterance number, and the utterance text itself into separate columns. To do this we will make extensive use of regular expressions. Our aim is to find a consistent pattern that distinguishes each piece of information from other other text in a given row of <code>data$text</code> and extract it.</p>
<p>The best way to learn regular expressions is to use them. To this end I’ve included a link to the interactive regular expression practice website <a href="https://regex101.com">regex101</a>.</p>
<p>Open this site and copy the text below into the ‘TEST STRING’ field.</p>
<pre class="plain"><code>o          A.1 utt1: Okay.  /
qw          A.1 utt2: {D So, }
qy^d          B.2 utt1: [ [ I guess, +
+          A.3 utt1: What kind of experience [ do you, + do you ] have, then with child care? /
+          B.4 utt1: I think, ] + {F uh, } I wonder ] if that worked. /
qy          A.5 utt1: Does it say something? /
sd          B.6 utt1: I think it usually does.  /
ad          B.6 utt2: You might try, {F uh, }  /
h          B.6 utt3: I don't know,  /
ad          B.6 utt4: hold it down a little longer,  /</code></pre>
<p>Now manually type the following regular expressions into the ‘REGULAR EXPRESSION’ field one-by-one (each is on a separate line). Notice what is matched as you type and when you’ve finished typing. You can find out exactly what the component parts of each expression are doing by toggling the top right icon in the window or hovering your mouse over the relevant parts of the expression.</p>
<pre class="plain"><code>^.+?\s
[AB]\.\d+
utt\d+
:.+$</code></pre>
<p>As you can now see, we have regular expressions that will match the damsl tags, speaker and speaker turn, utterance number, and the utterance text. To apply these expressions to our data and extract this information into separate columns we will make use of the <code>mutate()</code> and <code>str_extract()</code> functions. <code>mutate()</code> will take our data frame and create new columns with values we match and extract from each row in the data frame with <code>str_extract()</code>. Notice that <code>str_extract()</code> is different than <code>str_extract_all()</code>. When we work with <code>mutate()</code> each row will be evaluated in turn, therefore we only need to make one match per row in <code>data$text</code>.</p>
<p>I’ve chained each of these steps in the code below, dropping the original <code>text</code> column with <code>select(-text)</code>, and overwriting <code>data</code> with the results.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text-parse_04aa0b2e5b28932b6d35200a18886b4f">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract column information from `text`</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>damsl_tag <span class="op">=</span> <span class="fu">str_extract</span><span class="op">(</span>string <span class="op">=</span> <span class="va">text</span>, pattern <span class="op">=</span> <span class="st">"^.+?\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract damsl tags</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>speaker_turn <span class="op">=</span> <span class="fu">str_extract</span><span class="op">(</span>string <span class="op">=</span> <span class="va">text</span>, pattern <span class="op">=</span> <span class="st">"[AB]\\.\\d+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract speaker_turn pairs</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>utterance_num <span class="op">=</span> <span class="fu">str_extract</span><span class="op">(</span>string <span class="op">=</span> <span class="va">text</span>, pattern <span class="op">=</span> <span class="st">"utt\\d+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract utterance number</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu">str_extract</span><span class="op">(</span>string <span class="op">=</span> <span class="va">text</span>, pattern <span class="op">=</span> <span class="st">":.+$"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract utterance text</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">text</span><span class="op">)</span> <span class="co"># drop the `text` column</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co"># preview the data set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>One twist you will notice is that regular expressions in R require double backslashes (<code>\\\\</code>) where other programming environments use a single backslash (<code>\\</code>).</p>
</div>
</div>
</div>
<p>There are a couple things left to do to the columns we extracted from the text before we move on to finishing up our tidy dataset. First, we need to separate the <code>speaker_turn</code> column into <code>speaker</code> and <code>turn_num</code> columns and second we need to remove unwanted characters from the <code>damsl_tag</code>, <code>utterance_num</code>, and <code>utterance_text</code> columns.</p>
<p>To separate the values of a column into two columns we use the <code>separate()</code> function. It takes a column to separate and character vector of the names of the new columns to create. By default the values of the input column will be separated by non-alphanumeric characters. In our case this means the <code>.</code> will be our separator.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text-organize_123c3cc52c80f7cfc4e876570425f416">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span></span>
<span>    col <span class="op">=</span> <span class="va">speaker_turn</span>, <span class="co"># source column</span></span>
<span>    into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"speaker"</span>, <span class="st">"turn_num"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># separate speaker_turn into distinct columns: speaker and turn_num</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co"># preview the data set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To remove unwanted leading or trailing whitespace we apply the <code>str_trim()</code> function. For removing other characters we matching the character(s) and replace them with an empty string (<code>""</code>) with the <code>str_replace()</code> function. Again, I’ve chained these functions together and overwritten <code>data</code> with the results.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-text-clean_65d1f76b71cb424d9c38f5c728f334ad">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Clean up column information</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>damsl_tag <span class="op">=</span> <span class="fu">str_trim</span><span class="op">(</span><span class="va">damsl_tag</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove leading/ trailing whitespace</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>utterance_num <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span>string <span class="op">=</span> <span class="va">utterance_num</span>, pattern <span class="op">=</span> <span class="st">"utt"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove 'utt'</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span>string <span class="op">=</span> <span class="va">utterance_text</span>, pattern <span class="op">=</span> <span class="st">":\\s"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove ': '</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu">str_trim</span><span class="op">(</span><span class="va">utterance_text</span><span class="op">)</span><span class="op">)</span> <span class="co"># trim leading/ trailing whitespace</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co"># preview the data set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To round out our tidy dataset for this single conversation file we will connect the <code>speaker_a_id</code> and <code>speaker_b_id</code> with speaker A and B in our current dataset adding a new column <code>speaker_id</code>. The <code>case_when()</code> function does exactly this: allows us to map rows of <code>speaker</code> with the value “A” to <code>speaker_a_id</code> and rows with value “B” to <code>speaker_b_id</code>.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-speaker-ids_da8c2fb7d4a90ce38a1e7ac7e349abc6">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Link speaker with speaker_id</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>speaker_id <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span> <span class="co"># create speaker_id</span></span>
<span>    <span class="va">speaker</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">~</span> <span class="va">speaker_a_id</span>, <span class="co"># speaker_a_id value when A</span></span>
<span>    <span class="va">speaker</span> <span class="op">==</span> <span class="st">"B"</span> <span class="op">~</span> <span class="va">speaker_b_id</span> <span class="co"># speaker_b_id value when B</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co"># preview the data set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have the tidy dataset we set out to create. But this dataset only includes one conversation file! We want to apply this code to all 1155 conversation files in the <code>sdac/</code> corpus. The approach will be to create a custom function which groups the code we’ve done for this single file and then iterative send each file from the corpus through this function and combine the results into one data frame.</p>
<p>Here’s the custom function with some extra code to print a progress message for each file when it runs.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-extract-sdac-metadata-function_977048b701cb1d58489b28eb37a24a0f">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># [ ] rename to `extract_swda_data()`.</span></span>
<span><span class="co"># [ ] add to `qtalrkit` package, note the convention of `extract_` prefix for curation functions. In combination with `get_compressed_data()` this corpus can be curated with few steps.</span></span>
<span></span>
<span><span class="va">extract_sdac_metadata</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function: to read a Switchboard Corpus Dialogue file and extract meta-data</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Reading"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>, <span class="st">"..."</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Read `file` by lines</span></span>
<span>  <span class="va">doc</span> <span class="op">&lt;-</span> <span class="fu">read_lines</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># Extract `doc_id`, `speaker_a_id`, and `speaker_b_id`</span></span>
<span>  <span class="va">doc_speaker_info</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">doc</span><span class="op">[</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">doc</span>, <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="co"># isolate pattern</span></span>
<span>    <span class="fu">str_extract</span><span class="op">(</span><span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract the pattern</span></span>
<span>    <span class="fu">str_split</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># split the character vector</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># flatten the list to a character vector</span></span>
<span>  <span class="va">doc_id</span> <span class="op">&lt;-</span> <span class="va">doc_speaker_info</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># extract `doc_id`</span></span>
<span>  <span class="va">speaker_a_id</span> <span class="op">&lt;-</span> <span class="va">doc_speaker_info</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="co"># extract `speaker_a_id`</span></span>
<span>  <span class="va">speaker_b_id</span> <span class="op">&lt;-</span> <span class="va">doc_speaker_info</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="co"># extract `speaker_b_id`</span></span>
<span>  </span>
<span>  <span class="co"># Extract `text`</span></span>
<span>  <span class="va">text_start_index</span> <span class="op">&lt;-</span> <span class="co"># find where header info stops</span></span>
<span>    <span class="va">doc</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">str_detect</span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"={3,}"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># match 3 or more `=`</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># find vector index</span></span>
<span>  </span>
<span>  <span class="va">text_start_index</span> <span class="op">&lt;-</span> <span class="va">text_start_index</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># increment index by 1</span></span>
<span>  <span class="va">text_end_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span> <span class="co"># get the end of the text section</span></span>
<span>  </span>
<span>  <span class="va">text</span> <span class="op">&lt;-</span> <span class="va">doc</span><span class="op">[</span><span class="va">text_start_index</span><span class="op">:</span><span class="va">text_end_index</span><span class="op">]</span> <span class="co"># extract text</span></span>
<span>  <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">str_trim</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="co"># remove leading and trailing whitespace</span></span>
<span>  <span class="va">text</span> <span class="op">&lt;-</span> <span class="va">text</span><span class="op">[</span><span class="va">text</span> <span class="op">!=</span> <span class="st">""</span><span class="op">]</span> <span class="co"># remove blank lines</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">text</span><span class="op">)</span> <span class="co"># tidy format `doc_id` and `text`</span></span>
<span>  </span>
<span>  <span class="co"># Extract column information from `text`</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>damsl_tag <span class="op">=</span> <span class="fu">str_extract</span><span class="op">(</span>string <span class="op">=</span> <span class="va">text</span>, pattern <span class="op">=</span> <span class="st">"^.+?\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># extract damsl tags</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>speaker_turn <span class="op">=</span> <span class="fu">str_extract</span><span class="op">(</span>string <span class="op">=</span> <span class="va">text</span>, pattern <span class="op">=</span> <span class="st">"[AB]\\.\\d+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract speaker_turn pairs</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>utterance_num <span class="op">=</span> <span class="fu">str_extract</span><span class="op">(</span>string <span class="op">=</span> <span class="va">text</span>, pattern <span class="op">=</span> <span class="st">"utt\\d+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract utterance number</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu">str_extract</span><span class="op">(</span>string <span class="op">=</span> <span class="va">text</span>, pattern <span class="op">=</span> <span class="st">":.+$"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># extract utterance text</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">text</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Separate speaker_turn into distinct columns</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">data</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>    <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">speaker_turn</span>, <span class="co"># source column</span></span>
<span>             into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"speaker"</span>, <span class="st">"turn_num"</span><span class="op">)</span><span class="op">)</span> <span class="co"># separate speaker_turn into distinct columns: speaker and turn_num</span></span>
<span>  </span>
<span>  <span class="co"># Clean up column information</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>damsl_tag <span class="op">=</span> <span class="fu">str_trim</span><span class="op">(</span><span class="va">damsl_tag</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove leading/ trailing whitespace</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>utterance_num <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span>string <span class="op">=</span> <span class="va">utterance_num</span>, pattern <span class="op">=</span> <span class="st">"utt"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove 'utt'</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span>string <span class="op">=</span> <span class="va">utterance_text</span>, pattern <span class="op">=</span> <span class="st">":\\s"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove ': '</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu">str_trim</span><span class="op">(</span><span class="va">utterance_text</span><span class="op">)</span><span class="op">)</span> <span class="co"># trim leading/ trailing whitespace</span></span>
<span>  </span>
<span>  <span class="co"># Link speaker with speaker_id</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">data</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>speaker_id <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span> <span class="co"># create speaker_id</span></span>
<span>      <span class="va">speaker</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">~</span> <span class="va">speaker_a_id</span>, <span class="co"># speaker_a_id value when A</span></span>
<span>      <span class="va">speaker</span> <span class="op">==</span> <span class="st">"B"</span> <span class="op">~</span> <span class="va">speaker_b_id</span> <span class="co"># speaker_b_id value when B</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">" done.\n"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co"># return the data frame object</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As a sanity check we will run the <code>extract_sdac_metadata()</code> function on a the conversation file we were just working on to make sure it works as expected.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-extract-sdac-metadata-test-show_76ddbf6a6fa98ce02c1b78a2df0b37cc">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">extract_sdac_metadata</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/original/sdac/sw00utt/sw_0001_4325.utt"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looks good!</p>
<p>So now it’s time to create a vector with the paths to all of the conversation files. <code><a href="https://fs.r-lib.org/reference/dir_ls.html">fs::dir_ls()</a></code> interfaces with our OS file system and will return the paths to the files in the specified directory. We also add a pattern to match conversation files (<code>regexp = \\.utt$</code>) so we don’t accidentally include other files in the corpus. <code>recurse</code> set to <code>TRUE</code> means we will get the full path to each file.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-list-files-show_f3f9016bae69ce0978acc98aad22e3d0">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_files</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_ls.html">dir_ls</a></span><span class="op">(</span></span>
<span>    path <span class="op">=</span> <span class="st">"../data/original/sdac/"</span>, <span class="co"># source directory</span></span>
<span>    recurse <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># traverse all sub-directories</span></span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>, <span class="co"># only return files</span></span>
<span>    regexp <span class="op">=</span> <span class="st">"\\.utt$"</span></span>
<span>  <span class="op">)</span> <span class="co"># only return files ending in .utt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sdac_files</span><span class="op">)</span> <span class="co"># preview file paths</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre class="plain"><code>../data/original/sdac/sw00utt/sw_0001_4325.utt
../data/original/sdac/sw00utt/sw_0002_4330.utt
../data/original/sdac/sw00utt/sw_0003_4103.utt
../data/original/sdac/sw00utt/sw_0004_4327.utt
../data/original/sdac/sw00utt/sw_0005_4646.utt
../data/original/sdac/sw00utt/sw_0006_4108.utt</code></pre>
<p>o pass each conversation file in the vector of paths to our conversation files iteratively to the <code>extract_sdac_metadata()</code> function we use <code>map()</code>. This will apply the function to each conversation file and return a data frame for each. <code>bind_rows()</code> will then join the resulting data frames by rows to give us a single tidy dataset for all 1155 conversations. Note there is a lot of processing going on here we have to be patient.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-tidy-all_f7ac143e43aaf6e304a6a7fd2d25a32c">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Read files and return a tidy dataset</span></span>
<span><span class="va">sdac</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdac_files</span> <span class="op">|&gt;</span> <span class="co"># pass file names</span></span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="va">extract_sdac_metadata</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># read and tidy iteratively</span></span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="op">)</span> <span class="co"># bind the results into a single data frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now see that we have <code>nrow(sdac)</code> observations (individual utterances in this dataset).</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-preview-complete_b0954a14a0e6a83511878c8e5f3bdbdf">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">glimpse</span><span class="op">(</span><span class="va">sdac</span><span class="op">)</span> <span class="co"># preview complete curated dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="write-datasets" class="level3" data-number="6.3.3"><h3 data-number="6.3.3" class="anchored" data-anchor-id="write-datasets">
<span class="header-section-number">6.3.3</span> Write datasets</h3>
<p>Again as in the previous cases, we will write this dataset to disk to prepare for the next step in our text analysis project.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-sdac-write_1ccfaca4fa9a33b07a65f5f0382a0a22">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../data/derived/sdac/"</span><span class="op">)</span> <span class="co"># create sdac subdirectory</span></span>
<span><span class="fu">write_csv</span><span class="op">(</span><span class="va">sdac</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"../data/derived/sdac/sdac_curated.csv"</span></span>
<span><span class="op">)</span> <span class="co"># write sdac to disk and label as the curated dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The directory structure now looks like this:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── sdac/</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── sdac_curated.csv</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> sdac/</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> doc/</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw00utt/</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw01utt/</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw02utt/</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw03utt/</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw04utt/</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw05utt/</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw06utt/</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw07utt/</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw08utt/</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw09utt/</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw10utt/</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw11utt/</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sw12utt/</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> sw13utt/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="summary-3" class="level3" data-number="6.3.4"><h3 data-number="6.3.4" class="anchored" data-anchor-id="summary-3">
<span class="header-section-number">6.3.4</span> Summary</h3>
<p>In this section we looked at semi-structured data. This type of data often requires the most work to organize into a tidy dataset. We continued to work with many of the R programming strategies introduced to this point in the coursebook. We also made more extensive use of regular expressions to pick out information from a semi-structured document format.</p>
<p>To round out this section I’ve provided a code summary of the steps involved to conduct the curation of the Switchboard Dialogue Act Corpus files. Note that I’ve added the <code>extract_sdac_metadata()</code> custom function to a file called <code>curate_functions.R</code> and sourced this file. This will make the code more succinct and legible here, as well in your own research projects.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-semi-structured-code-summary_6210bb31736473c2ca96a0a055c8e26e">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Source the `extract_sdac_metadata()` function</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"../functions/curate_functions.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get list of the corpus files (.utt)</span></span>
<span><span class="va">sdac_files</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_ls.html">dir_ls</a></span><span class="op">(</span></span>
<span>    path <span class="op">=</span> <span class="st">"../data/original/sdac/"</span>, <span class="co"># source directory</span></span>
<span>    recurse <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># traverse all sub-directories</span></span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>, <span class="co"># only return files</span></span>
<span>    regexp <span class="op">=</span> <span class="st">"\\.utt$"</span></span>
<span>  <span class="op">)</span> <span class="co"># only return files ending in .utt</span></span>
<span></span>
<span><span class="co"># Read files and return a tidy dataset</span></span>
<span><span class="va">sdac</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdac_files</span> <span class="op">|&gt;</span> <span class="co"># pass file names</span></span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="va">extract_sdac_metadata</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># read and tidy iteratively</span></span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="op">)</span> <span class="co"># bind the results into a single data frame</span></span>
<span></span>
<span><span class="co"># Write curated dataset to disk</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../data/derived/sdac/"</span><span class="op">)</span> <span class="co"># create sdac subdirectory</span></span>
<span><span class="fu">write_csv</span><span class="op">(</span><span class="va">sdac</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"../data/derived/sdac/sdac_curated.csv"</span></span>
<span><span class="op">)</span> <span class="co"># write sdac to disk and label as the curated dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="documentation" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="documentation">
<span class="header-section-number">6.4</span> Documentation</h2>
<ul class="task-list">
<li>
<input type="checkbox">consider whether to leave this section, or integrate into the previous sections (most likely, the first section ‘unstructured data’)
<ul class="task-list">
<li>
<input type="checkbox">note that the description of what a data dictionary is for and is in it, has already been covered in a previous chapter.</li>
<li>
<input type="checkbox">however, the function <code>data_dic_starter()</code> is new and should be introduced (somewhere), again, probably in the first section ‘unstructured data’</li>
</ul>
</li>
</ul>
<p>At this stage we again want to ensure that the data that we have derived is well-documented. Where in the data acquisition process the documentation was focused on the sampling frame, curated datasets require documentation that describes the structure of the now rectangular dataset and its attributes. This documentation is known as a <strong>data dictionary</strong>. At the curation stage this documentation often contains the following information <span class="citation" data-cites="HowMakeData10-2021">(<a href="references.html#ref-HowMakeData10-2021" role="doc-biblioref"><span>“How to Make a Data Dictionary”</span> 2021</a>)</span>:</p>
<ul>
<li>names of the variables (as they appear in the dataset)</li>
<li>human-readable names for the variables</li>
<li>short prose descriptions of the variables, including units of measurement (where applicable)</li>
</ul>
<p>A data dictionary will take the format of a table and can be stored in a tabular-oriented file format (such as .csv). It is often easier to work with a spreadsheet to create this documentation. I suggest creating a .csv file with the basic structure of the documentation. You can do this however you choose, but I suggest using something along these lines as seen in the following custom function, <code>data_dic_starter()</code>.</p>
<div class="cell" data-hash="curate-datasets_cache/html/cd-documentation-dic-starter-function&quot;_a56d694d8ae6af40cfd7148ac951063b">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_dic_starter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function:</span></span>
<span>  <span class="co"># Creates a .csv file with the basic information</span></span>
<span>  <span class="co"># to document a curated dataset</span></span>
<span>  </span>
<span>  <span class="fu">tibble</span><span class="op">(</span>variable_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="co"># column with existing variable names </span></span>
<span>       name <span class="op">=</span> <span class="st">""</span>, <span class="co"># column for human-readable names</span></span>
<span>       description <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># column for prose description</span></span>
<span>  <span class="fu">write_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="va">file_path</span><span class="op">)</span> <span class="co"># write to disk</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Running this function in the R Console on the curated dataset (in this case the <code>sdac</code> dataset), will provide this structure.</p>
<div id="tbl-cd-documentation-dic-starter-structure" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Data dictionary starter structure for the SDAC curated dataset." data-hash="curate-datasets_cache/html/tbl-cd-documentation-dic-starter-structure_370c3c2e3263ca1e864db5fd22c9aea1">

</div>
<p>The resulting .csv file can then be opened with spreadsheet software (such as MS Excel, Google Sheets, etc.) and edited.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Save this file as a .csv file and replace the original starter file. Note that it is important to use a plain-text file format for the official documentation file and avoid proprietary formats to ensure open accessibility and future compatibility.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>Our <code>data/derived/</code> directory now looks like this.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> derived/</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> sdac/</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> sdac_curated.csv</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> data_dictionary_sdac.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="summary-4" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="summary-4">Summary</h2>
<p>In this chapter we looked at the process of structuring data into a dataset. This included a discussion on three main types of data –unstructured, structured, and semi-structured. The level of structure of the original data(set) will vary from resource to resource and by the same token so will the file format used to support the level of meta-information included. The results from our data curation resulted in a curated dataset that is saved separate from the original data to maintain modularity between what the data(set) looked like before we intervene and afterwards. In addition to the code we use to derived the curated dataset’s structure, we also include a data dictionary which documents the names of the variables and provides sufficient description of these variables so that it is clear what our dataset contains.</p>
<ul class="task-list">
<li>
<input type="checkbox">emphasize the importance of ahereing to the unit of analysis for the research, and how this is reflected in the curated dataset. And how unit of observation derived from the transformational steps in the next chapter.</li>
</ul>
<p>It is important to recognized that this curated dataset will form the base for the next step in our text analysis project and the last step in data preparation for analysis: dataset transformation. This last step in preparing data for analysis is to convert this curated dataset into a dataset that is directly aligned with the research aims (i.e.&nbsp;analysis method(s)) of the project. Since there can be multiple analysis approaches applied the original data in a research project, this curated dataset serves as the point of departure for each of the subsequent datasets derived from the transformational steps.</p>
</section><section id="activities" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="activities">Activities</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-file-code" aria-label="file-code"></i> Recipe</strong></p>
<!-- Understand, apply, and analyze verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] edit links and goals/ outcomes -->
<p><strong>What</strong>: <a href="https://lin380.github.io/tadr/articles/recipe_7.html">Organizing and documenting datasets</a><br><strong>How</strong>: Read Recipe 7 and participate in the Hypothes.is online social annotation.<br><strong>Why</strong>: To rehearse methods for deriving tidying datasets to use a the base for further project-specific purposes. We will explore how regular expressions are helpful in developing strategies for matching, extracting, and/ or replacing patterns in character sequences and how to change the dimensions of a dataset to either expand or collapse columns or rows.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-flask" aria-label="flask"></i> Lab</strong></p>
<!-- Analyze, evaluate, and create verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] edit links and goals/ outcomes -->
<!-- [ ] update name of lab to something more lively -->
<p><strong>What</strong>: <a href="https://github.com/lin380/lab_7">Pattern Matching and Manipulate Datasets</a><br><strong>How</strong>: Clone, fork, and complete the steps in Lab 7.<br><strong>Why</strong>: To gain experience working with coding strategies reshaping data using tidyverse functions and regular expressions, to practice reading/ writing data from/ to disk, and to implement organizational strategies for organizing and documenting a dataset in reproducible fashion.</p>
</div>
</div>
</div>
</section><section id="questions" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="questions">Questions</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="fa-solid fa-wrench" aria-label="wrench"></i> <strong>Conceptual questions</strong></p>
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="fa-solid fa-wrench" aria-label="wrench"></i> <strong>Technical questions</strong></p>
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-R-readtext" class="csl-entry" role="listitem">
Benoit, Kenneth, and Adam Obeng. 2023. <em>Readtext: Import and Handling for Plain and Formatted Text Files</em>. <a href="https://github.com/quanteda/readtext">https://github.com/quanteda/readtext</a>.
</div>
<div id="ref-Broman2018" class="csl-entry" role="listitem">
Broman, Karl W., and Kara H. Woo. 2018. <span>“Data Organization in Spreadsheets.”</span> <em>The American Statistician</em> 72 (1): 2–10. <a href="https://doi.org/10.1080/00031305.2017.1375989">https://doi.org/10.1080/00031305.2017.1375989</a>.
</div>
<div id="ref-HowMakeData10-2021" class="csl-entry" role="listitem">
<span>“How to Make a Data Dictionary.”</span> 2021. <em>OSF Guides</em>. https://help.osf.io/hc/en-us/articles/360019739054-How-to-Make-a-Data-Dictionary.
</div>
<div id="ref-Koehn2005" class="csl-entry" role="listitem">
Koehn, P. 2005. <span>“Europarl: A Parallel Corpus for Statistical Machine Translation.”</span> <em>MT Summit X</em>, 12–16.
</div>
<div id="ref-R-stringr" class="csl-entry" role="listitem">
Wickham, Hadley. 2022. <em>Stringr: Simple, Consistent Wrappers for Common String Operations</em>. <a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>.
</div>
<div id="ref-R-dplyr" class="csl-entry" role="listitem">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis Vaughan. 2023. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-R-tidyr" class="csl-entry" role="listitem">
Wickham, Hadley, Davis Vaughan, and Maximilian Girlich. 2023. <em>Tidyr: Tidy Messy Data</em>. <a href="https://CRAN.R-project.org/package=tidyr">https://CRAN.R-project.org/package=tidyr</a>.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Note on RStudio Cloud you will need to download the .csv file and, after editing, upload the complete data dictionary file. Make sure to save the edited file as a .csv file.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Although based on spreadsheets, <span class="citation" data-cites="Broman2018">Broman and Woo (<a href="references.html#ref-Broman2018" role="doc-biblioref">2018</a>)</span> outlines many of the best for good data organization regardless of the technology.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./acquire-data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./transform-datasets.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>An Introduction to Quantitative Text Analysis for Linguistics - 7&nbsp; Transform datasets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./analysis.html" rel="next">
<link href="./curate-datasets.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="assets/css/mini.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./preparation.html">Preparation</a></li><li class="breadcrumb-item"><a href="./transform-datasets.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">An Introduction to Quantitative Text Analysis for Linguistics</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/qtalr/book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./qtalr-manuscript.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./orientation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Orientation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text analysis in context</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./understanding-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Understanding data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./approaching-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Approaching analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./framing-research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Framing research</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acquire-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./curate-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transform-datasets.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Reports</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collaboration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Collaboration</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feedback.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Feedback <i class="fa-solid fa-comment" aria-label="comment"></i></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-td-normalization" id="toc-sec-td-normalization" class="nav-link active" data-scroll-target="#sec-td-normalization"><span class="header-section-number">7.1</span> Normalization</a>
  <ul class="collapse">
<li><a href="#sec-td-normalization-orientation" id="toc-sec-td-normalization-orientation" class="nav-link" data-scroll-target="#sec-td-normalization-orientation"><span class="header-section-number">7.1.1</span> Orientation</a></li>
  <li><a href="#sec-td-normalization-application" id="toc-sec-td-normalization-application" class="nav-link" data-scroll-target="#sec-td-normalization-application"><span class="header-section-number">7.1.2</span> Application</a></li>
  </ul>
</li>
  <li>
<a href="#sec-td-recoding" id="toc-sec-td-recoding" class="nav-link" data-scroll-target="#sec-td-recoding"><span class="header-section-number">7.2</span> Recoding</a>
  <ul class="collapse">
<li><a href="#sec-td-recoding-orientation" id="toc-sec-td-recoding-orientation" class="nav-link" data-scroll-target="#sec-td-recoding-orientation"><span class="header-section-number">7.2.1</span> Orientation</a></li>
  <li><a href="#sec-td-recoding-application" id="toc-sec-td-recoding-application" class="nav-link" data-scroll-target="#sec-td-recoding-application"><span class="header-section-number">7.2.2</span> Application</a></li>
  </ul>
</li>
  <li>
<a href="#sec-td-tokenization" id="toc-sec-td-tokenization" class="nav-link" data-scroll-target="#sec-td-tokenization"><span class="header-section-number">7.3</span> Tokenization</a>
  <ul class="collapse">
<li><a href="#sec-td-tokenization-orientation" id="toc-sec-td-tokenization-orientation" class="nav-link" data-scroll-target="#sec-td-tokenization-orientation"><span class="header-section-number">7.3.1</span> Orientation</a></li>
  <li><a href="#sec-td-tokenization-application" id="toc-sec-td-tokenization-application" class="nav-link" data-scroll-target="#sec-td-tokenization-application"><span class="header-section-number">7.3.2</span> Application</a></li>
  </ul>
</li>
  <li><a href="#sec-td-generation" id="toc-sec-td-generation" class="nav-link" data-scroll-target="#sec-td-generation"><span class="header-section-number">7.4</span> Generatation</a></li>
  <li><a href="#sec-td-merging" id="toc-sec-td-merging" class="nav-link" data-scroll-target="#sec-td-merging"><span class="header-section-number">7.5</span> Merging</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#activities" id="toc-activities" class="nav-link" data-scroll-target="#activities">Activities</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/qtalr/book/edit/main/transform-datasets.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/qtalr/book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-transform-datasets" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-default callout-caution callout-titled" title="Caution">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><i class="fa-solid fa-route" aria-label="route"></i> In progress…</p>
</div>
</div>
<!--

Content:

- [x] Add normalization section
- [x] Add recoding section
- [ ] Add tokenization section
- [ ] Add generation section
- [ ] Add merging section

Exercises:

- [ ] add concept questions to Activities
- [ ] add exercises to Activities
- [ ] add thought questions/ case studies to prose sections

Formatting:

- [ ] Add a description of the importance of the unit of analysis and unit of observation in the transformation process.
  - In the curation process, the original data and utility of the dataset is priority. In the transformation process, the focus is on the analysis and the unit of analysis and unit of observation are the primary considerations.
- [ ] Point out that some units of observation will require that the data have more textual context (e.g. syntactic parsing) than others (e.g. word frequencies). It is important that the presentation of the transformation steps are no necessarily in the order in which they are applied.

-->
<blockquote class="blockquote">
<p>Nothing is lost. Everything is transformed.</p>
<p>— Michael Ende, The Neverending Story</p>
</blockquote>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-list-alt" aria-label="list-alt"></i> Outcomes</strong></p>
<!-- Remember and understand verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] update to outcomes -->
<ul>
<li>What is the role of data transformation in a text analysis project?</li>
<li>What are the general processes for preparing datasets for analysis?</li>
<li>How do each of these general processes transform datasets?</li>
</ul>
</div>
</div>
</div>
<!-- 
- Transformation: goals
  - Prepare curated dataset for analysis
  - Manipulate dataset row-wise and/ or column-wise
  - Focus on particular analysis needs: unit of analysis, unit of observation, operationalization of variables, etc.
-->
<p>In this chapter, we will focus on transforming a curated dataset to refine and possibly expand its relational characteristics to align with our research. The transformation process is divided into four categories: text normalization, variable recoding, text tokenization, variable generation, and observation/ variable merging. These categories are not sequential but may occur in any order based on the researcher’s evaluation of the dataset characteristics and the desired outcome.</p>
<p>It is sometimes necessary to create several transformed datasets from one curated dataset in cases where there are multiple analyses to be performed. This why we start with a curated dataset rather than directly deriving a transformed dataset from the original data. It allows for various transformation methods to produce different formats for different analyses.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-terminal" aria-label="terminal"></i> Swirl lesson</strong></p>
<!-- Remember and understand verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- 
- [ ] Update lesson name, 
- [ ] update lesson purpose
-->
<p><strong>What</strong>: <a href="https://github.com/qtalr/lessons">Reshape dataset rows, Reshape dataset columns</a><br><strong>How</strong>: In the R Console pane load <code>swirl</code>, run <code>swirl()</code>, and follow prompts to select the lesson.<br><strong>Why</strong>: …</p>
</div>
</div>
</div>
<!-- 

- Normalization (column-wise):  to standardize or simplify the text to reduce variability
  - Artifact removal
- Recoding (column-wise)
  - Classify
  - Derive
- Tokenization (row-wise): to segment the text into meaningful components
  - Words, n-grams, sentences
- Generation (row-wise and column-wise)
  - Lexical annotation
  - Syntactic annotation
- Merging (row-wise/ column-wise)
  - Joining datasets

---

- Summary
- Activities

-->
<section id="sec-td-normalization" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="sec-td-normalization">
<span class="header-section-number">7.1</span> Normalization</h2>
<!--  

column-wise: 

- Standardize text and remove unwanted variation
  - Artifact removal
  - Case conversion (lowercasing)
  - Punctuation and extraneous character removal
  - Adjustment of forms (e.g. contractions, numbers, abbreviations,  )

- Data:
  - Europarl

- R: 
  - stringr::str_replace_all()
  - stringr::str_remove_all()
-->
<p>The process of normalizing datasets in essence is to sanitize the values of variable or set of variables such that there are no artifacts that will contaminate subsequent processing. It may be the case that non-linguistic metadata may require normalization but more often than not linguistic information is the most common target for normalization as text often includes artifacts from the acquisition process which will not be desired in the analysis.</p>
<section id="sec-td-normalization-orientation" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="sec-td-normalization-orientation">
<span class="header-section-number">7.1.1</span> Orientation</h3>
<p>To explore some of the strategies of normalization, we will look at the Europarl Corpus. As we are working working towards transforming a curated dataset, we will start by getting oriented to the dataset. Following the reproducible research principles, I will assume that the curated dataset and its associated data dictionary are in the <em>data/derived/</em> directory, as seen in <a href="#exm-td-europarl-curated-structure">Example&nbsp;<span>7.1</span></a>.</p>
<div id="exm-td-europarl-curated-structure" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.1 </strong></span>&nbsp;</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis/</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── europarl_curated_dd.csv</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── europarl/</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── europarl_curated.csv</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The contents of the data dictionary for this dataset appears in <a href="#tbl-td-europarl-dd">Table&nbsp;<span>7.1</span></a>.</p>
<div class="cell" data-hash="transform-datasets_cache/html/tbl-td-europarl-dd_38c5f48a11ec0de73dcf07bc152a3685">
<div class="cell-output-display">
<div id="tbl-td-europarl-dd" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;7.1: Data dictionary for the Europarl Corpus.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_id</td>
<td style="text-align: left;">Document ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Unique identification number for each document</td>
</tr>
<tr class="even">
<td style="text-align: left;">type</td>
<td style="text-align: left;">Document Type</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Type of document; either 'Source' (Spanish) or 'Target' (English)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">line_id</td>
<td style="text-align: left;">Line ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Unique identification number for each line in each document type</td>
</tr>
<tr class="even">
<td style="text-align: left;">lines</td>
<td style="text-align: left;">Lines</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Content of the lines in the document</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>This dataset contains transcribed source language (Spanish) and translated target language (English) from the proceedings of the European Parliament. The unit of observation is the <code>lines</code> variable whose values are are lines of dialog.</p>
<p>Let’s read in the dataset CSV file with <code>read_csv()</code> and inspect the first lines of the dataset with <code>slice_head()</code> in <a href="#exm-tb-europarl-preview">Example&nbsp;<span>7.2</span></a>.</p>
<div id="exm-tb-europarl-preview" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.2 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-read-show_0ff77764a35dd1bdeac9a5759cbf410e">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Read in the dataset</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/derived/europarl_curated.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the first 10 lines</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-read-run_9c9ce96fff502b287c97fb1bcb18f0ed">
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 4
&gt;     doc_id type   line_id lines                                                 
&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;                                                 
&gt;  1 1965735 Source       1 "Reanudación del período de sesiones"                 
&gt;  2       1 Target       1 "Resumption of the session"                           
&gt;  3 1965736 Source       2 "Declaro reanudado el período de sesiones del Parlame…
&gt;  4       2 Target       2 "I declare resumed the session of the European Parlia…
&gt;  5 1965737 Source       3 "Como todos han podido comprobar, el gran \"efecto de…
&gt;  6       3 Target       3 "Although, as you will have seen, the dreaded 'millen…
&gt;  7 1965738 Source       4 "Sus Señorías han solicitado un debate sobre el tema …
&gt;  8       4 Target       4 "You have requested a debate on this subject in the c…
&gt;  9 1965739 Source       5 "A la espera de que se produzca, de acuerdo con mucho…
&gt; 10       5 Target       5 "In the meantime, I should like to observe a minute' …</code></pre>
</div>
</div>
</div>
<p>Simply looking at the first 10 lines of this dataset gives us a clearer sense of the dataset structure, but, in terms of normalization procedures we might apply, it is likely not sufficient. We want to get a sense of any potential inconsistencies in the dataset, in particular in the <code>lines</code> variable. Since this is a large dataset with 3931468 observations, we will need to explore the dataset in manageable chunks. The <code>slice_sample()</code> function will allow us to randomly sample a subset of the dataset of a certain number of observations specified by the <code>n =</code> argument, as seen in <a href="#exm-td-europarl-sample-1">Example&nbsp;<span>7.3</span></a>.</p>
<div id="exm-td-europarl-sample-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.3 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Randomly sample 5 observations</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 5 × 4
&gt;    doc_id type   line_id lines                                                  
&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;                                                  
&gt; 1 1979130 Source   13396 Nosotros no apostamos aquí, en este Parlamento, por lo…
&gt; 2 3322228 Source 1356494 (SK) Señor Presidente, me he abstenido de votar porque…
&gt; 3  140652 Target  140652 It is these last two, however, together with Finland, …
&gt; 4 2145661 Source  179927 Son las mujeres de esos mismos países: Egipto, Somalia…
&gt; 5 2269815 Source  304081 Permítanme añadir que, en nuestro último llamamiento p…</code></pre>
</div>
</div>
</div>
<p>We should run the code in <a href="#exm-td-europarl-sample-1">Example&nbsp;<span>7.3</span></a> multiple times to get a sense of the variation in the dataset.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-hand-point-up" aria-label="hand-point-up"></i> Tip</strong></p>
<p>R functions which return samples (<em>e.g.</em> <code>slice_sample()</code>) are generated using pseudo-random number generators. These generators are initialized with a seed value. You can control the seed value R uses to generate the random numbers by using the <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> function and setting the seed value to a number of your choice. It is important to note that setting a seed only affects the subsequent random number generation.</p>
<p>Using <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> is useful when you want to ensure that the same random numbers are generated each time you run the code. This is particularly helpful when you want to reproduce results in a report or other document.</p>
</div>
</div>
</div>
<p>In the case of the Europarl corpus dataset, it may be useful to see the source and target lines in the same sample. Do do this, we can first sample from the <code>line_id</code> variable and then filter the <code>europarl_curated_tbl</code> wit the <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function and the <code>%in%</code> operator to select the lines that match the sampled <code>line_id</code> values, as seen in <a href="#exm-td-europarl-sample-2">Example&nbsp;<span>7.4</span></a>.</p>
<div id="exm-td-europarl-sample-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.4 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Randomly sample 5 line_id values</span></span>
<span><span class="va">line_id_sample_vec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">line_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">line_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the lines that match the sampled line_id values</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">line_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">line_id_sample_vec</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 4
&gt;     doc_id type   line_id lines                                                 
&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;                                                 
&gt;  1 1992525 Source   26791 La sociedad del conocimiento es algo más, y también p…
&gt;  2   26791 Target   26791 The knowledge society is more than that, and it may a…
&gt;  3 2247038 Source  281304 Especialmente en la industria de alta tecnología pued…
&gt;  4  281304 Target  281304 Particularly in the technical and hi-tech industry, t…
&gt;  5 2325587 Source  359853 - (IT) Señora Presidenta, Comisario, Señorías, quiero…
&gt;  6  359853 Target  359853 . (IT) Madam President, Commissioner, ladies and gent…
&gt;  7 2573895 Source  608161 En consecuencia, nuestro Grupo ha votado en contra.   
&gt;  8  608161 Target  608161 Consequently, our group voted against.                
&gt;  9 2581569 Source  615835 Al margen de ello, es todo el club de los seis, esos …
&gt; 10  615835 Target  615835 Beyond that, it is the whole club of six, these count…</code></pre>
</div>
</div>
</div>
<p>After running the code in <a href="#exm-td-europarl-sample-1">Example&nbsp;<span>7.3</span></a> and <a href="#exm-td-europarl-sample-2">Example&nbsp;<span>7.4</span></a> multiple times, I identified a number of artifacts that we will want to consider addressing. These are included in <a href="#tbl-td-europarl-normalization">Table&nbsp;<span>7.2</span></a>.</p>
<div id="tbl-td-europarl-normalization" class="anchored">
<table class="table-sm table-striped small table">
<caption>Table&nbsp;7.2: Characteristics of the Europarl Corpus dataset that may require normalization.</caption>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Examples</th>
<th style="text-align: left;">Concern</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Non-speech annotations</td>
<td style="text-align: left;">
<code>(Abucheos)</code>, <code>(A4-0247/98)</code>, <code>(The sitting was opened at 09:00)</code>
</td>
<td style="text-align: left;">Not of interest for our analysis</td>
</tr>
<tr class="even">
<td style="text-align: left;">Inconsistent whitespace</td>
<td style="text-align: left;">
<code>5 % ,</code>, <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>, <code>Palacio' s</code>
</td>
<td style="text-align: left;">May be problematic for tokenization</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Non-sentence punctuation</td>
<td style="text-align: left;"><code>-</code></td>
<td style="text-align: left;">May be problematic for tokenization</td>
</tr>
<tr class="even">
<td style="text-align: left;">Abbreviations</td>
<td style="text-align: left;">
<code>Mr.</code>, <code>Sr.</code>, <code>Mme.</code>, <code>Mr</code>, <code>Sr</code>, <code>Mme</code>, <code>Mister</code>, <code>Señor</code>, <code>Madam</code>
</td>
<td style="text-align: left;">May be problematic for tokenization</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Text case</td>
<td style="text-align: left;">
<code>The</code>, <code>the</code>, <code>White</code>, <code>white</code>
</td>
<td style="text-align: left;">May be problematic for tokenization</td>
</tr>
</tbody>
</table>
</div>
<p>The first three items in <a href="#tbl-td-europarl-normalization">Table&nbsp;<span>7.2</span></a> are relatively straightforward. Non-speech annotations most likely are not relevant for our research. Inconsistent whitespace and non-sentence punctuation may be problematic for tokenization that depends on whitespace and punctuation regularities.</p>
<p>The other two considerations are more contingent on our research aims. The existence of various forms for the same word, abbreviated and unabreviated, introduces variability may not be of interest for our analysis. Secondly, common conventions for capitalization in prose can introduce unwanted variability. If we leave the text as is, the tokens <code>The</code> and <code>the</code> will be treated as distinct. If we convert the text to lowercase, the tokens <code>White</code> and <code>white</code> will be treated as the same, even if <code>White</code> corresponds to a proper noun (<em>e.g.</em> <code>White House</code>).</p>
<p>These observations provide us a roadmap for the normalization process. For demonstration, let’s focus only on a couple of these cases: removing parlimentary session descriptions and extra whitespace.</p>
</section><section id="sec-td-normalization-application" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="sec-td-normalization-application">
<span class="header-section-number">7.1.2</span> Application</h3>
<p>Identifying our normalization goals is an important first step. The next step is to identify the procedures that will accomplish these goals. The majority of text normalization procedures can be accomplished with the <code>stringr</code> package <span class="citation" data-cites="R-stringr">(<a href="references.html#ref-R-stringr" role="doc-biblioref">Wickham 2022</a>)</span>. This package provides a number of functions for manipulating text. The workhorse functions we will use for our tasks are the <code>str_remove()</code> and <code>str_replace()</code> functions. As the these functions give us the ability to remove or replace text. Our task is to identify the patterns we want to remove or replace.</p>
<p>Before we modify any lines, let’s try craft a search pattern to identify the text of interest. This is done to avoid over- or under-generalizing the search pattern. If we are too general, we may end up removing or replacing text that we want to keep. If we are too specific, we may not remove or replace all the text we want to remove or replace.</p>
<!-- non-speech -->
<p>Let’s start by identifying non-parlimentary speech. Two functions from the <code>stringr</code> package come in handy here: <code>str_detect()</code> and <code>str_extract()</code>. <code>str_detect()</code> detects a pattern in a character vector and returns a logical vector, <code>TRUE</code> if the pattern is detected and <code>FALSE</code> if it is not. <code>str_extract()</code> extracts the text in a character vector that matches a pattern.</p>
<p><code>str_detect()</code> pairs well with the <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function to return observations that match a pattern in a character vector. <code>str_extract()</code> pairs well with the <code>mutate()</code> function to create a new variable which contains character vector that match a pattern.</p>
<p>Let’s start with the <code>str_detect()</code> function. We will use this function to identify the lines that contain the parliamentary session descriptions. From the examples above, we can see that these instances are wrapped with parentheses <code>(</code> and <code>)</code>. The text within the parentheses can vary, so we need a Regular Expression to do the heavy lifting. To start out we can match any one or multiple characters with <code>.+</code>. But it is important to recognize the <code>+</code> (and also the <code>*</code>) operators are ‘greedy’, meaning that if there are multiple matches, the longest match will be returned. In this case, we want to match the shortest match. To do this we can use the <code>?</code> operator to make the <code>+</code> operator ‘lazy’. This will match the shortest match.</p>
<p>Our test code appears in <a href="#exm-td-europarl-search-non-speech">Example&nbsp;<span>7.5</span></a>.</p>
<div id="exm-td-europarl-search-non-speech" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.5 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify non-speech lines</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\(.+?\\)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 4
&gt;     doc_id type   line_id lines                                                 
&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;                                                 
&gt;  1 3225772 Source 1260038 (PT) Señor Presidente, quisiera plantear dos pregunta…
&gt;  2 3715842 Source 1750108 (El Parlamento decide la devolución a la Comisión)    
&gt;  3 1961715 Target 1961715 (Parliament adopted the resolution)                   
&gt;  4 1429470 Target 1429470 27, originally Greens/EFA amendment in FEMM); binding…
&gt;  5   51632 Target   51632 Question No 8 by (H-0376/00):                         
&gt;  6 2482671 Source  516937 La Comisión propone proporcionar a las Agencias nacio…
&gt;  7 1059628 Target 1059628 (The President cut off the speaker)                   
&gt;  8 1507254 Target 1507254 in writing. - (LT) I welcomed this document, because …
&gt;  9 2765325 Source  799591 (Aplausos)                                            
&gt; 10 2668536 Source  702802 &nbsp;&nbsp; Las preguntas que, por falta de tiempo, no han rec…</code></pre>
</div>
</div>
</div>
<p>The results from <a href="#exm-td-europarl-search-non-speech">Example&nbsp;<span>7.5</span></a> show that we have identified the lines that contain at least one of the parliamentary session description annotations. A more targeted search to identify specific instances of the parliamentary session descriptions can be accomplished adding the <code>str_extract()</code> function as seen in <a href="#exm-td-europarl-search-non-speech-2">Example&nbsp;<span>7.6</span></a>.</p>
<div id="exm-td-europarl-search-non-speech-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.6 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract non-speech fragments</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\(.+?\\)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>non_speech <span class="op">=</span> <span class="fu">str_extract</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\(.+?\\)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 5
&gt;     doc_id type   line_id lines                                       non_speech
&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;                                       &lt;chr&gt;     
&gt;  1 3225772 Source 1260038 (PT) Señor Presidente, quisiera plantear d… (PT)      
&gt;  2 3715842 Source 1750108 (El Parlamento decide la devolución a la C… (El Parla…
&gt;  3 1961715 Target 1961715 (Parliament adopted the resolution)         (Parliame…
&gt;  4 1429470 Target 1429470 27, originally Greens/EFA amendment in FEM… (para. 53)
&gt;  5   51632 Target   51632 Question No 8 by (H-0376/00):               (H-0376/0…
&gt;  6 2482671 Source  516937 La Comisión propone proporcionar a las Age… (correspo…
&gt;  7 1059628 Target 1059628 (The President cut off the speaker)         (The Pres…
&gt;  8 1507254 Target 1507254 in writing. - (LT) I welcomed this documen… (LT)      
&gt;  9 2765325 Source  799591 (Aplausos)                                  (Aplausos)
&gt; 10 2668536 Source  702802 &nbsp;&nbsp; Las preguntas que, por falta de tiempo,… (Véase el…</code></pre>
</div>
</div>
</div>
<p>The results from <a href="#exm-td-europarl-search-non-speech-2">Example&nbsp;<span>7.6</span></a> show that we have identified the lines that contain parliamentary session description annotations and extracted this text –or have we? What if a given line contains more than one parliamentary session description annotation? It turns out that <code>str_extract()</code> only returns the first match. To return all matches we can use the <code>str_extract_all()</code> function. Let’s try again, in <a href="#exm-td-europarl-search-non-speech-3">Example&nbsp;<span>7.7</span></a>.</p>
<div id="exm-td-europarl-search-non-speech-3" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.7 </strong></span>&nbsp;</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract non-speech fragments</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\(.+?\\)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>non_speech <span class="op">=</span> <span class="fu">str_extract_all</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\(.+?\\)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 5
&gt;     doc_id type   line_id lines                                       non_speech
&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;                                       &lt;list&gt;    
&gt;  1 3225772 Source 1260038 (PT) Señor Presidente, quisiera plantear d… &lt;chr [1]&gt; 
&gt;  2 3715842 Source 1750108 (El Parlamento decide la devolución a la C… &lt;chr [1]&gt; 
&gt;  3 1961715 Target 1961715 (Parliament adopted the resolution)         &lt;chr [1]&gt; 
&gt;  4 1429470 Target 1429470 27, originally Greens/EFA amendment in FEM… &lt;chr [1]&gt; 
&gt;  5   51632 Target   51632 Question No 8 by (H-0376/00):               &lt;chr [1]&gt; 
&gt;  6 2482671 Source  516937 La Comisión propone proporcionar a las Age… &lt;chr [2]&gt; 
&gt;  7 1059628 Target 1059628 (The President cut off the speaker)         &lt;chr [1]&gt; 
&gt;  8 1507254 Target 1507254 in writing. - (LT) I welcomed this documen… &lt;chr [1]&gt; 
&gt;  9 2765325 Source  799591 (Aplausos)                                  &lt;chr [1]&gt; 
&gt; 10 2668536 Source  702802 &nbsp;&nbsp; Las preguntas que, por falta de tiempo,… &lt;chr [1]&gt;</code></pre>
</div>
</div>
</div>
<p>OK, that might not be what you expected. The <code>str_extract_all()</code> function returns a list of character vectors. This is because for any given line in <code>lines</code> there may be a different number of matches. To maintain the data frame as rectangular, a list is returned for each value of <code>non_speech</code>. We could expand the list into a data frame with the <code>unnest()</code> function from the <code>tidyr</code> package if our goal were to work with these matches. But that is not our aim. Rather, we want to know if we have multiple matches per line. Note that the information provided for the <code>non_speech</code> column by the tibble object tells use that we have some lines with muliple matches, as we can see in line 6 of our small sample. So good thing we checked!</p>
<p>Let’s now remove these parliamentary session description annotations from each line in the <code>lines</code> column. We turn to <code>str_remove_all()</code>, a variant of <code>str_remove()</code>, that, as you expect, will remove multiple matches in a single line. We will use the <code>mutate()</code> function to overwrite the <code>lines</code> column with the modified text. The code is seen in <a href="#exm-td-europarl-remove-non-speech">Example&nbsp;<span>7.8</span></a>.</p>
<div id="exm-td-europarl-remove-non-speech" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.8 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-remove-non-speech_c2d6c1185e0bded241bef985c7383ead">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove non-speech fragments</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lines <span class="op">=</span> <span class="fu">str_remove_all</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\(.+?\\)"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>I recommend spot checking the results of this normalization step by running the code in <a href="#exm-td-europarl-search-non-speech">Example&nbsp;<span>7.5</span></a> again, if nothing appears we’ve done our job.</p>
<!-- extra whitespace -->
<p>The second item of business to address is the extra whitespace we observed in <a href="#tbl-td-europarl-normalization">Table&nbsp;<span>7.2</span></a>. If we consider the extra whitespace cases, we can categorize them into two types: multiple spaces that should be a single space (<em>e.g.</em> <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>) and single spaces that occur within a word (<em>e.g.</em> <code>5 % ,</code> or <code>Palacio' s</code>).</p>
<p>To deal with muliple spaces, we can turn to the <code>str_replace_all()</code> function. This function will replace a pattern with a replacement string for every pattern match. In this case, we want to replace multiple spaces with a single space. We can use the <code>\\s+</code> pattern to match one or more spaces and then replace it with <code>\\s</code> or a single whitespace character <code>" "</code>.</p>
<p>Before we apply this normalization step, let’s assess how many instances of multiple spaces we have in the dataset. We can use the <code>str_count()</code> function to count the number of matches for a pattern. The pattern we want needs to be a bit more precise than <code>\\s+</code>, because this matches one or more. We want to match <em>two</em> or more. Using the regular expression operator <code>{,}</code> we can specify our pattern to be <code>\\s{2,}</code>, <em>i.e.</em> two or more continguous whitespaces. Let’s count and sum all these matches. The code is seen in <a href="#exm-td-europarl-count-whitespace">Example&nbsp;<span>7.9</span></a>.</p>
<div id="exm-td-europarl-count-whitespace" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.9 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-count-whitespace_f4b5f844a9fcb8b82952a75df115ede6">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Count multiple spaces</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>multiple_spaces <span class="op">=</span> <span class="fu">str_count</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\s{2,}"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>total_multiple_spaces <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">multiple_spaces</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 1 × 1
&gt;   total_multiple_spaces
&gt;                   &lt;int&gt;
&gt; 1                130628</code></pre>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i> Warning</strong></p>
<p>You may be wondering what the extra parameter <code>na.rm = TRUE</code> is doing in the <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> function. This parameter tells R to ignore values that are <code>NA</code> (not available). This is important because if we don’t ignore <code>NA</code> values, the <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> function will return <code>NA</code> if there are any <code>NA</code> values in the vector. The code in <a href="#exm-td-europarl-count-whitespace">Example&nbsp;<span>7.9</span></a> will return <code>NA</code> when the <code>\\s{2,}</code> doesn’t match for a given line. This is because the <code>str_count()</code> function returns <code>NA</code> when there are no matches. If we don’t ignore these <code>NA</code> values, the <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> function will return <code>NA</code> for the entire dataset.</p>
</div>
</div>
</div>
<p>The results from <a href="#exm-td-europarl-count-whitespace">Example&nbsp;<span>7.9</span></a> show that we have over 130k instances of multiple spaces. Let’s replace these with a single space. The code is seen in <a href="#exm-td-europarl-remove-multiple-whitespace">Example&nbsp;<span>7.10</span></a>.</p>
<div id="exm-td-europarl-remove-multiple-whitespace" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.10 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-remove-multiple-whitespace_5a81e47beee2d941134ee746ccabf74d">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove multiple spaces</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lines <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\s{2,}"</span>, <span class="st">"\\s"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>To check our work, we can run the code in <a href="#exm-td-europarl-count-whitespace">Example&nbsp;<span>7.9</span></a> again. We should see that there are no more instances of multiple spaces.</p>
<p>Now let’s turn to the single spaces that occur within a word. We can use the <code>str_replace_all()</code> function again to replace these single spaces with no space –but is that what we want? Probably not, we want <em>most</em> of the single spaces to remain, otherwise we would have one very, very long string on each line.</p>
<p>Instead, we want to narrow our scope and focus in on whitespace that occurs in particular contexts. One context we can focus on is the single quote <code>'</code>, as in <code>Palacio' s</code>. In this use, the single quote is an apostrophe in a possessive form, but we might want to see if other forms, such as contractions, that also may have this extra whitespace. Let’s check using a regular expression that matches a character string <code>\\w+</code> with single quote <code>'</code> at the end followed by whitespace <code>\\s</code>. To give some more context I will add a character string <code>\\w+</code> after the whitespace. Using the <code>str_extract_all()</code> function we can extract all the matches for this pattern. It returns a list, so we <code>unnest()</code> the list. Then we can pull the vector of matches and list the unique matches to get a sense of the context we are working with. The code is seen in <a href="#exm-td-europarl-search-apostrophe">Example&nbsp;<span>7.11</span></a>.</p>
<div id="exm-td-europarl-search-apostrophe" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.11 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-search-apostrophe_ec102572d0bdd5c22649ca65133c37c6">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Match apostrophe followed by whitespace</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>quote_whitespace <span class="op">=</span> <span class="fu">str_extract_all</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\w+'\\s\\w+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">quote_whitespace</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">quote_whitespace</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;   [1] "States' neo"              "nobody' s"               
&gt;   [3] "Citizens' Freedoms"       "people' s"               
&gt;   [5] "States' ministers"        "Commission' s"           
&gt;   [7] "patients' rights"         "Pensioners' Party"       
&gt;   [9] "ministers' meetings"      "Ireland' s"              
&gt;  [11] "America' s"               "representatives' report" 
&gt;  [13] "raptaglang' culture"      "workers' rights"         
&gt;  [15] "citizens' needs"          "Bowis' suggestion"       
&gt;  [17] NA                         "citizens' rights"        
&gt;  [19] "Union' s"                 "Picasso' s"              
&gt;  [21] "children' s"              "representatives' choice" 
&gt;  [23] "act' by"                  "beings' submitted"       
&gt;  [25] "Women' s"                 "person' s"               
&gt;  [27] "loin' fillets"            "shop' register"          
&gt;  [29] "doesn' t"                 "woman' and"              
&gt;  [31] "Haug' s"                  "speakers' list"          
&gt;  [33] "economists' figures"      "Members' assistants"     
&gt;  [35] "outreach' meeting"        "corridor' in"            
&gt;  [37] "Passengers' Charter"      "Abbas' indictment"       
&gt;  [39] "atypical' forms"          "innovations' within"     
&gt;  [41] "Government' s"            "one' s"                  
&gt;  [43] "Patten' s"                "Citizens' Rights"        
&gt;  [45] "communication' s"         "governments' development"
&gt;  [47] "Flexicurity' is"          "countries' markets"      
&gt;  [49] "Cornillet' s"             "industries' interests"   
&gt;  [51] "Prostitution' campaign"   "presidency' s"           
&gt;  [53] "Beekeepers' Association"  "in' label"               
&gt;  [55] "Italy' s"                 "citizens' own"           
&gt;  [57] "prudent' and"             "days' time"              
&gt;  [59] "Putin' s"                 "terrorist' operation"    
&gt;  [61] "companies' sophisticated" "Europeans' diet"         
&gt;  [63] "Move' scheme"             "hopping' of"             
&gt;  [65] "States' unanimity"        "taxpayers' money"        
&gt;  [67] "club' should"             "Parliament' s"           
&gt;  [69] "Cyprus' Greek"            "Council' s"              
&gt;  [71] "politicians' role"        "style' drugs"            
&gt;  [73] "Europe' s"                "king' held"              
&gt;  [75] "VAT' in"                  "coalitions' in"          
&gt;  [77] "Workers' Mobility"        "Prüm' Council"           
&gt;  [79] "citizens' side"           "citizens' and"           
&gt;  [81] "consumers' confidence"    "years' which"            
&gt;  [83] "year' s"                  "Members' comments"       
&gt;  [85] "countries' economies"     "appears' as"             
&gt;  [87] "States' concerns"         "carry' obligation"       
&gt;  [89] "captain' s"               "employability' and"      
&gt;  [91] "check' are"               "citizens' pension"       
&gt;  [93] "Macao' s"                 "shop' proposed"          
&gt;  [95] "others' mistakes"         "Committee' s"            
&gt;  [97] "EU' s"                    "prosecutor' and"         
&gt;  [99] "States' public"           "Partnership' expressly"  
&gt; [101] "doctors' rights"          "downwards' and"          
&gt; [103] "workers' insurance"       "model' s"                
&gt; [105] "pays' principle"          "Unions' commitment"      
&gt; [107] "People' s"                "Lipponen' s"             
&gt; [109] "Russia' s"                "procedure' inserted"     
&gt; [111] "policy' chapters"         "States' citizens"        
&gt; [113] "markets' can"             "lawyer' in"              
&gt; [115] "States' contributions"    "small' when"             
&gt; [117] "States' contract"         "citizens' initiative"    
&gt; [119] "Ruffolo' s"               "States' capacity"        
&gt; [121] "ties' between"            "values' of"              
&gt; [123] "citizens' shared"         "position' only"          
&gt; [125] "mindedness' in"           "countries' European"     
&gt; [127] "Player' but"              "institutions' knowledge" 
&gt; [129] "Bowles' proposal"         "China' policy"           
&gt; [131] "Conference' s"            "Agenda' and"             
&gt; [133] "Congress' foreign"</code></pre>
</div>
</div>
</div>
<p>In <a href="#exm-td-europarl-search-apostrophe">Example&nbsp;<span>7.11</span></a> we can see that we have many singular possessive forms we want to ammend and other forms that we may want to keep –in particular when the single quote is part of a quote or a plural or irregular singular possessive. From various runs of this code, it looks safe to remove whitespace between the single quote and the <code>s</code> in the possessive form We need to be careful not to remove whitespace in other contexts where the single quote is followed by <code>s</code>. To do this we can use the word boundary pattern <code>\\b</code> after the <code>s</code> in our pattern to ensure that the <code>s</code> is not part of a following word. The code is seen in <a href="#exm-td-europarl-remove-apostrophe">Example&nbsp;<span>7.12</span></a>.</p>
<div id="exm-td-europarl-remove-apostrophe" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.12 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-remove-apostrophe_8431ba3de35569bf5f4cdeedf5226586">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove whitespace after apostrophe</span></span>
<span><span class="va">europarl_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarl_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lines <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">lines</span>, <span class="st">"'\\ss\\b"</span>, <span class="st">"'s"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>To check our work, we can run the code in <a href="#exm-td-europarl-search-apostrophe">Example&nbsp;<span>7.11</span></a> again. We should see that there are no more instances of whitespace after the single quote in possessive forms.</p>
<p>Other normalization procedures often follow a similar line of attack. There are cases, however, in which normalization procedures are more easily accomplished after subsequent transformation steps or need to be post-poned to further the goals of other transformation steps. For example, standardizing abbreviated forms may be more easily accomplished after tokenization when each token is a word. Another example is the case of case conversion. Even if we are not directly interested in the case differences between words, certain generation procedures, Named Entity Recognition for example, may use case information to identify proper nouns. In these cases, it may be better to leave the case as is until after the generation step.</p>
</section></section><section id="sec-td-recoding" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="sec-td-recoding">
<span class="header-section-number">7.2</span> Recoding</h2>
<!--  

column-wise

Data:
  - SWDA
    - education (classify)
    - birth_year (derive)
    - utt_text (extract, disfluencies)

- R: 
  - mutate() # create new variables
  - case_when() # classify
  - str_count() # count matches
  - pivot_longer() # change wide to long

-->
<p>Normalizing text can be seen as an extension of dataset curation to some extent in that the structure of the dataset is maintained. In the Europarl case, we saw this to be true. In the case of recoding, and other transformational steps, the aim will be to modify the dataset structure either by rows, columns, or both. Recoding processes can be characterized by the creation of structural changes which are derived from values in variables effectively recasting values as new variables to enable more direct access in our analyses.</p>
<section id="sec-td-recoding-orientation" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="sec-td-recoding-orientation">
<span class="header-section-number">7.2.1</span> Orientation</h3>
<!--  
Recode: 
- education (classify)
- birth_year (derive)
- utt_text (extract, disfluencies) (derive)
-->
<p>The Switchboard dialog Act Corpus corpus contains a number of variables describing conversations between speakers of American English. A subset of this dataset provides a good example of the recoding process. The data dictionary for this dataset appears in <a href="#tbl-tr-swda-curated-dd">Table&nbsp;<span>7.3</span></a>.</p>
<div class="cell" data-hash="transform-datasets_cache/html/tbl-tr-swda-curated-dd_deab7fa5b4eda146d042ab72f970c0af">
<div class="cell-output-display">
<div id="tbl-tr-swda-curated-dd" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;7.3: Data dictionary for the Switchboard dialog Act Corpus.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable_type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_id</td>
<td style="text-align: left;">Document ID</td>
<td style="text-align: left;">The ID of the document in the dataset</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="even">
<td style="text-align: left;">speaker_id</td>
<td style="text-align: left;">Speaker ID</td>
<td style="text-align: left;">The ID of the speaker in the dataset</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">Sex</td>
<td style="text-align: left;">The gender of the speaker</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">education</td>
<td style="text-align: left;">Education</td>
<td style="text-align: left;">The level of education of the speaker</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="odd">
<td style="text-align: left;">birth_year</td>
<td style="text-align: left;">Birth Year</td>
<td style="text-align: left;">The year of birth of the speaker</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="even">
<td style="text-align: left;">utt_id</td>
<td style="text-align: left;">Utterance ID</td>
<td style="text-align: left;">The ID of the utterance in the dataset</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="odd">
<td style="text-align: left;">utt_text</td>
<td style="text-align: left;">Utterance Text</td>
<td style="text-align: left;">The text of the utterance</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">damsl_tag</td>
<td style="text-align: left;">DAMSL Tag</td>
<td style="text-align: left;">The DAMSL tag associated with the utterance</td>
<td style="text-align: left;">character</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>The data dictionary gives us a sense of the variables in the dataset. Let’s read in the dataset and preview the first 10 lines to get a sense of the values in the dataset, as in <a href="#exm-tr-swda-dataset-read-show">Example&nbsp;<span>7.19</span></a>.</p>
<div id="exm-tr-swda-dataset-read-show" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.13 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/tr-swda-dataset-read-show_50c51a497c3f4cca6b2ceb59f4283aab">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Read in the dataset</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/derived/swda/swda_curated.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the first 10 lines</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="transform-datasets_cache/html/tr-swda-dataset-read-run_6155f66b796043e0a1ae9c546e33761e">
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 8
&gt;    doc_id speaker_id sex    education birth_year utt_id utt_text       damsl_tag
&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    
&gt;  1   4325       1632 Female         2       1962      1 Okay.  /       o        
&gt;  2   4325       1632 Female         2       1962      2 {D So, }       qw       
&gt;  3   4325       1519 Female         1       1971      3 [ [ I guess, + qy^d     
&gt;  4   4325       1632 Female         2       1962      4 What kind of … +        
&gt;  5   4325       1519 Female         1       1971      5 I think, ] + … +        
&gt;  6   4325       1632 Female         2       1962      6 Does it say s… qy       
&gt;  7   4325       1519 Female         1       1971      7 I think it us… sd       
&gt;  8   4325       1519 Female         1       1971      8 You might try… ad       
&gt;  9   4325       1519 Female         1       1971      9 I don't know,… h        
&gt; 10   4325       1519 Female         1       1971     10 hold it down … ad</code></pre>
</div>
</div>
</div>
<p>Considering the data dictionary and the preview of the <code>swda_curated_tbl</code> dataset, we observe a number of metadata variables, such as <code>doc_id</code>, <code>speaker_id</code>, <code>sex</code>, <code>education</code>, <code>birth_year</code>, <code>utt_id</code>, <code>utt_text</code>, and <code>damsl_tag</code>.</p>
<p>Most of these variables and their values are readily interpretable. However, the <code>damsl_tag</code> variable and the annotation scheme that appears interleaved with the dialog in <code>utt_text</code> may require a bit more explanation. If we consult the data origin file and/ or the corpus website, we seee that the <code>damsl_tag</code> is a utterance-level annotation which indicates the dialog act type (<em>e.g.</em> statement, question, backchannel, <em>etc.</em>). The annotation interleaved with the dialog in <code>utt_text</code> is a <a href="https://staff.fnwi.uva.nl/r.fernandezrovira/teaching/DM-materials/DFL-book.pdf">disfluency annotation scheme</a>. This scheme includes annotation for non-sentence elements such as filled pauses (<em>e.g.</em> <code>{F uh}</code>), discourse markers (<em>e.g.</em> <code>{D well}</code>), repetitions/ restarts (<em>e.g.</em> <code>[I think + I believe]</code>), among others.</p>
<p>Let’s assume that we are interested in understanding the use of filled pauses in the Switchboard dialog. <span class="citation" data-cites="Tottie2011">Tottie (<a href="references.html#ref-Tottie2011" role="doc-biblioref">2011</a>)</span> investigates the relationship between speakers’ use of filled pauses <code>uh</code> and <code>um</code> and their socio-demographic background (sex, socio-economic status, and age) in British English. An American English comparison would be insightful. To do this, however, we will need to recode some of the variables in the dataset.</p>
<p>In this case, we will use <code>education</code> as a proxy for socio-economic status. As is, the values are numeric and are not maximally transparent. We can recode these values to be more interpretable. In the corpus documentation, the values for <code>education</code> are described in <a href="#tbl-tr-swda-education">Table&nbsp;<span>7.4</span></a>.</p>
<div id="tbl-tr-swda-education" class="anchored">
<table class="table-sm table-striped small table">
<caption>Table&nbsp;7.4: Values for the <code>education</code> variable in the Switchboard dialog Act Corpus.</caption>
<thead><tr class="header">
<th>Value</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>Less Than High School</td>
</tr>
<tr class="even">
<td>1</td>
<td>Less Than College</td>
</tr>
<tr class="odd">
<td>2</td>
<td>College</td>
</tr>
<tr class="even">
<td>3</td>
<td>More Than College</td>
</tr>
<tr class="odd">
<td>9</td>
<td>Unknown</td>
</tr>
</tbody>
</table>
</div>
<p>To derive a variable which reflects the age of each speaker, we will use the <code>birth_year</code> variable. This variable is a numeric value which indicates the year of birth for each speaker. We can derive a new variable <code>age</code> by subtracting the <code>birth_year</code> from the year of recordings, 1992.</p>
<p>Together <code>sex</code>, <code>education</code>, and <code>age</code> will provide us with the socio-demographic information we need to investigate the relationship between speakers’ use of filled pauses and their socio-demographic background. The last component we need to derive is the use of filled pauses. To do this we will need to extract the filled pauses from the <code>utt_text</code> variable. We also need to consider what we mean by ‘use’. In this case, we will operationalize the use of filled pauses as the number of times a filled pause is used per utterance.</p>
</section><section id="sec-td-recoding-application" class="level3" data-number="7.2.2"><h3 data-number="7.2.2" class="anchored" data-anchor-id="sec-td-recoding-application">
<span class="header-section-number">7.2.2</span> Application</h3>
<p>The plan to transform the <code>swda_curated_tbl</code> dataset is established. Now we need to implement the plan. We will start by recoding the <code>education</code> variable. Specifically, we want to map the numeric values to the descriptions in <a href="#tbl-tr-swda-education">Table&nbsp;<span>7.4</span></a>.</p>
<p>To do this we will use the <code>case_when()</code> function from the <code>dplyr</code> package. This function allows us to specify a series of conditions and the values to return if the condition is met. <code>case_when()</code> evaluates the conditions and <code>mutate()</code> writes the variable, in this case overwrites it, as seen in <a href="#exm-tr-swda-recoding-education">Example&nbsp;<span>7.14</span></a>.</p>
<div id="exm-tr-swda-recoding-education" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.14 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/tr-swda-recoding-education_c3b75a21322b24d2cf6c7334b8a89f4d">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Recode education</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    education <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">education</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"Less Than High School"</span>,</span>
<span>      <span class="va">education</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Less Than College"</span>,</span>
<span>      <span class="va">education</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"College"</span>,</span>
<span>      <span class="va">education</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"More Than College"</span>,</span>
<span>      <span class="va">education</span> <span class="op">==</span> <span class="fl">9</span> <span class="op">~</span> <span class="st">"Unknown"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># Preview the first 10 lines</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 8
&gt;    doc_id speaker_id sex    education       birth_year utt_id utt_text damsl_tag
&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    
&gt;  1   4325       1632 Female College               1962      1 Okay.  / o        
&gt;  2   4325       1632 Female College               1962      2 {D So, } qw       
&gt;  3   4325       1519 Female Less Than Coll…       1971      3 [ [ I g… qy^d     
&gt;  4   4325       1632 Female College               1962      4 What ki… +        
&gt;  5   4325       1519 Female Less Than Coll…       1971      5 I think… +        
&gt;  6   4325       1632 Female College               1962      6 Does it… qy       
&gt;  7   4325       1519 Female Less Than Coll…       1971      7 I think… sd       
&gt;  8   4325       1519 Female Less Than Coll…       1971      8 You mig… ad       
&gt;  9   4325       1519 Female Less Than Coll…       1971      9 I don't… h        
&gt; 10   4325       1519 Female Less Than Coll…       1971     10 hold it… ad</code></pre>
</div>
</div>
</div>
<p>To create the <code>age</code> variable, all we need to do is subtract the <code>birth_year</code> from the year of recording, 1992. Again we will use <code>mutate()</code> to create the <code>age</code> variable. The values are created by a subtraction operation. Since we will not need the <code>birth_year</code> variable afterwards, we will drop it from the dataset. The code is seen in <a href="#exm-tr-swda-recoding-age">Example&nbsp;<span>7.15</span></a>.</p>
<div id="exm-tr-swda-recoding-age" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.15 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/tr-swda-recoding-age_93f6e72ceb493278d2914b7813d32209">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Recode age</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>age <span class="op">=</span> <span class="fl">1992</span> <span class="op">-</span> <span class="va">birth_year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">birth_year</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the first 10 lines</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 8
&gt;    doc_id speaker_id sex    education         utt_id utt_text    damsl_tag   age
&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;
&gt;  1   4325       1632 Female College                1 Okay.  /    o            30
&gt;  2   4325       1632 Female College                2 {D So, }    qw           30
&gt;  3   4325       1519 Female Less Than College      3 [ [ I gues… qy^d         21
&gt;  4   4325       1632 Female College                4 What kind … +            30
&gt;  5   4325       1519 Female Less Than College      5 I think, ]… +            21
&gt;  6   4325       1632 Female College                6 Does it sa… qy           30
&gt;  7   4325       1519 Female Less Than College      7 I think it… sd           21
&gt;  8   4325       1519 Female Less Than College      8 You might … ad           21
&gt;  9   4325       1519 Female Less Than College      9 I don't kn… h            21
&gt; 10   4325       1519 Female Less Than College     10 hold it do… ad           21</code></pre>
</div>
</div>
</div>
<p>Our final recoding step is to derive the frequency of filled pauses per utterance. In other words, we want to match the ‘uh’ and ‘um’ and return the number of matches for each utterance. There are a number of ways to do this. We could use an approach which applies the <code>str_extract_all()</code> function, which returns a list of matches, and then <code>unnest()</code> the list and count the number of matches. An alternative approach is to use the <code>str_count()</code> function to count the number of matches for a pattern. The later approach is more efficient for our purposes.</p>
<p>In either case, a pattern to match these annotations is needed. As always with pattern matching, we need to craft an expression that is as specific as possible to avoid over- or under-matching. We know from our observation and the corpus documentation that all filled pauses are wrapped by the <code>{F ...}</code> annotation. We can use this to our advantage. Before we jump into counting the filled pauses, let’s test a regular expression that matches the entire <code>{F ...}</code> annotation. An expression like <code>{F.*}</code> might be tempting, but this will be problematic for two reasons. First, since the <code>{</code> and <code>}</code> are regular expression operators we will need to escape them with the <code>\\</code> convention. Second, the <code>*</code> operator is greedy, meaning that it will match the longest possible string. So if in a given utterance there are multiple filled pauses, the <code>*</code> operator will match all of them at once, not individually. To avoid this, we can use the <code>?</code> operator to make the <code>*</code> operator lazy. With these considerations in mind, we can move forward with <code>\\{F.*?\\}</code> as our expression.</p>
<p>We will send each utterance to the <code>str_extract_all()</code> function to match the filled pauses. This function returns a list of matches, so we will need to <code>unnest()</code> the list to get a vector of matches. Afterwards we will apply the <code>count()</code> function to summarize the number of matches for each match variation. The code is seen in <a href="#exm-tr-swda-recoding-filled-pauses-test">Example&nbsp;<span>7.16</span></a>.</p>
<div id="exm-tr-swda-recoding-filled-pauses-test" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.16 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/tr-swda-recoding-filled-pauses-test_4a0384eccb45663d4f302e564d87735c">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Test filled pause pattern</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    matches <span class="op">=</span> <span class="fu">str_extract_all</span><span class="op">(</span></span>
<span>      <span class="va">utt_text</span>, </span>
<span>      <span class="st">"\\{F.*?\\}"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">matches</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">matches</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 120 × 2
&gt;    matches            n
&gt;    &lt;chr&gt;          &lt;int&gt;
&gt;  1 "{F  Oh, }"        1
&gt;  2 "{F  uh, }"        1
&gt;  3 "{F \"Oh, }"       1
&gt;  4 "{F ((Oh)) }"      1
&gt;  5 "{F ((Oh, }"       1
&gt;  6 "{F ((Uh }"        1
&gt;  7 "{F ((Uh)), }"     1
&gt;  8 "{F ((Uh, }"       1
&gt;  9 "{F + ] Um, }"     1
&gt; 10 "{F + ] um, }"     1
&gt; # ℹ 110 more rows</code></pre>
</div>
</div>
</div>
<p>The result from our test indicates that the <code>\\{F .*?\\}</code> pattern matches a wide variety of filled pause annotations, 120 to be exact! We can see that there are a number of filled pause annotations that we are not be interested in, <em>e.g.</em> <code>{F Oh}</code>. Furthermore, the ‘uh’ and ‘um’ we are interested in sometimes include more annotation structure, <em>e.g.</em> <code>{F + ] Um, }</code>.</p>
<p>A more sophisticated pattern is needed. When faced with a pattern matching task such as this, I find it helpful to start with a simple pattern and then add complexity as needed. This is an iterative process. To speed up the process, I often extract the matches and use an online tool for developing regular expressions, such as <a href="https://regex101.com/">regex101.com</a>.</p>
<p>With a (monster) regular expression that matches the filled pauses we are interested in, and only those filled pauses, we can move forward with counting the number of matches for each utterance.</p>
<p>To do this we will use the <code>str_count()</code> function from the <code>stringr</code> package. This function counts the number of matches for a pattern in a character vector. We will use <code>mutate()</code> to create new variabled <code>uh</code> and <code>um</code> which will contain the counts for the filled pauses <code>uh</code> and <code>um</code>, respectively. The code is seen in <a href="#exm-tr-swda-recoding-filled-pauses">Example&nbsp;<span>7.17</span></a>.</p>
<div id="exm-tr-swda-recoding-filled-pauses" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.17 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/tr-swda-recoding-filled-pauses_40ea51ec17d653c32d74f52c2da73829">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Recode filled pauses</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    uh <span class="op">=</span> <span class="fu">str_count</span><span class="op">(</span></span>
<span>      <span class="va">utt_text</span>, </span>
<span>      <span class="st">"\\{F\\s+[\\(+\\s\\]]*(u|U)h[\\)\\s,\\.\\?-]*\\}"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    um <span class="op">=</span> <span class="fu">str_count</span><span class="op">(</span></span>
<span>      <span class="va">utt_text</span>, </span>
<span>      <span class="st">"\\{F\\s+[\\(+\\s\\]]*(u|U)m[\\)\\s,\\.\\?-]*\\}"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># Preview the first 10 lines</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 10
&gt;    doc_id speaker_id sex   education utt_id utt_text damsl_tag   age    uh    um
&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
&gt;  1   4325       1632 Fema… College        1 Okay.  / o            30     0     0
&gt;  2   4325       1632 Fema… College        2 {D So, } qw           30     0     0
&gt;  3   4325       1519 Fema… Less Tha…      3 [ [ I g… qy^d         21     0     0
&gt;  4   4325       1632 Fema… College        4 What ki… +            30     0     0
&gt;  5   4325       1519 Fema… Less Tha…      5 I think… +            21     1     0
&gt;  6   4325       1632 Fema… College        6 Does it… qy           30     0     0
&gt;  7   4325       1519 Fema… Less Tha…      7 I think… sd           21     0     0
&gt;  8   4325       1519 Fema… Less Tha…      8 You mig… ad           21     1     0
&gt;  9   4325       1519 Fema… Less Tha…      9 I don't… h            21     0     0
&gt; 10   4325       1519 Fema… Less Tha…     10 hold it… ad           21     0     0</code></pre>
</div>
</div>
</div>
<p>Now we have two new columns, <code>uh</code> and <code>um</code> which indicate how many times the relevant pattern was matched for a given utterance. By choosing to focus on disfluencies, however, we have made a decision to change the unit of observation from the utterance to the use of filled pauses (<code>uh</code> and <code>um</code>). This means that as the dataset stands, it is not in tidy format –where each observation corresponds to the observational unit. When datasets are misaligned in this particular way, there are in what is known as ‘wide’ format. What we want to do, then, is to restructure our dataset such that each row corresponds to the unit of observation –in this case each filled pause type.</p>
<p>To convert our current (wide) dataset to one where each filler type is listed and the counts are measured for each utterance we turn to the <code>pivot_longer()</code> function. This function creates two new columns, one in which the column names are listed and one for the values for each of the column names. The code is seen in <a href="#exm-tr-swda-recoding-filled-pauses-longer">Example&nbsp;<span>7.18</span></a>.</p>
<div id="exm-tr-swda-recoding-filled-pauses-longer" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.18 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/tr-swda-recoding-filled-pauses-longer_24984d4acfa6753ef700f548d1054a88">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Tidy filled pauses</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"uh"</span>, <span class="st">"um"</span><span class="op">)</span>, </span>
<span>    names_to <span class="op">=</span> <span class="st">"filler"</span>, </span>
<span>    values_to <span class="op">=</span> <span class="st">"count"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># Preview the first 10 lines</span></span>
<span><span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 10
&gt;    doc_id speaker_id sex    education     utt_id utt_text damsl_tag   age filler
&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; 
&gt;  1   4325       1632 Female College            1 Okay.  / o            30 uh    
&gt;  2   4325       1632 Female College            1 Okay.  / o            30 um    
&gt;  3   4325       1632 Female College            2 {D So, } qw           30 uh    
&gt;  4   4325       1632 Female College            2 {D So, } qw           30 um    
&gt;  5   4325       1519 Female Less Than Co…      3 [ [ I g… qy^d         21 uh    
&gt;  6   4325       1519 Female Less Than Co…      3 [ [ I g… qy^d         21 um    
&gt;  7   4325       1632 Female College            4 What ki… +            30 uh    
&gt;  8   4325       1632 Female College            4 What ki… +            30 um    
&gt;  9   4325       1519 Female Less Than Co…      5 I think… +            21 uh    
&gt; 10   4325       1519 Female Less Than Co…      5 I think… +            21 um    
&gt; # ℹ 1 more variable: count &lt;int&gt;</code></pre>
</div>
</div>
</div>
<p>Now we have a transformed dataset that is in tidy format. Each row corresponds to a filled pause type and the number of times it was used in a given utterance. It also includes the key socio-demographic variables we are interested in.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-lightbulb" aria-label="lightbulb"></i> Consider this</strong></p>
<p>As confident as we may be in our recoding process, it is always a good idea to perform some data checks to ensure that the recoding process was successful. In the process, we can also gain some insight into the data. Considering the structure in the transformed Switchboard dialog Act Corpus dataset, what are some data checks we might want to perform? What are some insights we might gain from these data checks?</p>
</div>
</div>
</div>
<p>Finalize the transformation process by writing the dataset to a CSV file, create a data dictionary, and review and comment your code in the transformation script.</p>
</section></section><section id="sec-td-tokenization" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="sec-td-tokenization">
<span class="header-section-number">7.3</span> Tokenization</h2>
<!--  

row-wise

The goal is to segment units of language into relevant components given the research question. This may include breaking text into smaller units, such as words, n-grams, sentences, etc. or combining text into larger units.

Data: 

- CABNC (expand)
  - tidytext::unnest_tokens()

- ?PELIC tokens (contract)
  - stringr::str_c() [w/ collapse = " "]

R: 
- start with `tokenizers` package for tokenization types (character, word, n-gram, sentence, etc.)
- introduce `tidytext` package, for tokenization and unnesting
- show how to collapse tokens with `stringr::str_c()`

Consider: 

- Adding lemmatization, stemming to this section but to make sure that it is clear that these are 'recoding' processes, they just happen to be more accessible to use after tokenization.

-->
<p>Another common transformation process that is particularly relevant for text analysis is tokenization. Tokenization is the process of segmenting units of language into components relevant for the research question. This may include breaking text in curated datasets into smaller units, such as words, <span class="math inline">\(n\)</span>-grams, sentences, <em>etc.</em> or combining text into larger units.</p>
<p>The process of tokenization is fundamentally row-wise. By scaling the text units up or down, we change the unit of observation. In turn, it is much easier to perform subsequent processing and/ or analysis. For example, if we are interested in the use of particular words, we may want to segment the text into words. If we are interested in the use of particular phrases, we may want to segment the text into <span class="math inline">\(n\)</span>-grams. If we are interested in the use of particular sentences, we may want to segment the text into sentences. Each of these levels, then, are more directly accessible than the original text units.</p>
<p>A key consideration in tokenization is the criteria for segmentation. While it may appear obvious to a human what ‘word’ or ‘sentence’ means, a computer needs a definition. This can prove tricker than it seems. For example, in English, we can segment text into words by splitting on whitespace. This works fairly well but there are some cases where this is not ideal. For example, in the case of contractions, such as <code>don't</code>, <code>won't</code>, <code>can't</code>, <em>etc.</em> the apostrophe is not a whitespace character. If we want to consider these contractions as separate words, then we need to consider a different tokenization strategy.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-lightbulb" aria-label="lightbulb"></i> Consider this</strong></p>
<p>Consider the following paragraph:</p>
<p>“As the sun dipped below the horizon, the sky was set ablaze with shades of orange-red, illuminating the landscape. It’s a sight Mr.&nbsp;Johnson, a long-time observer, never tired of. On the lakeside, he’d watch with friends, enjoying the ever-changing hues—especially those around 6:30 p.m.—and reflecting on nature’s grand display. Even in the half-light, the water’s glimmer, coupled with the echo of distant laughter, created a timeless scene. The so-called ‘magic hour’ was indeed magical, yet fleeting, like a well-crafted poem; it was the essence of life itself.”</p>
<p>What text conventions would prove insufficient for word tokenization based on a whitespace critieron?</p>
</div>
</div>
</div>
<p>Furthermore, tokenization strategies can vary between languages. For German words are often compounded together, meaning many ‘words’ will not be captured by the whitespace convention. Whitespace may not even be relevant for word tokenization in written languages, such as Chinese. The take home message is there is no one-size-fits-all tokenization strategy.</p>
<section id="sec-td-tokenization-orientation" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="sec-td-tokenization-orientation">
<span class="header-section-number">7.3.1</span> Orientation</h3>
<p>The CABNC Corpus data dictionary.</p>
<div class="cell" data-hash="transform-datasets_cache/html/tbl-td-cabnc-dd_b94d093221559ef0c9704d171126fed6">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/tr-cabnc_curated_dd.csv"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-cabnc-dd" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;7.5: Data dictionary for the CABNC Corpus.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_id</td>
<td style="text-align: left;">Document ID</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">A unique identifier for each document</td>
</tr>
<tr class="even">
<td style="text-align: left;">part_id</td>
<td style="text-align: left;">Part ID</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">A unique identifier for each part</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">Sex</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">The gender of the individual</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: left;">Age</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">The age of the individual</td>
</tr>
<tr class="odd">
<td style="text-align: left;">utt_id</td>
<td style="text-align: left;">Utterance ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">A unique identifier for each utterance</td>
</tr>
<tr class="even">
<td style="text-align: left;">utt_text</td>
<td style="text-align: left;">Utterance Text</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">The text of the utterance</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Read the dataset.</p>
<div id="exm-tr-swda-dataset-read-show" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.19 </strong></span>&nbsp;</p>
<div class="cell" data-hash="transform-datasets_cache/html/tr-cabnc-dataset-read-show_0826bf13063b4cfeb694008081b05dc2">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Read in the dataset</span></span>
<span><span class="va">cabnc_curated_tbl</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/derived/cabnc/cabnc_curated.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the first 10 lines</span></span>
<span><span class="va">cabnc_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="transform-datasets_cache/html/tr-cabnc-dataset-read-run_dbd33f006db65ea4d824cab1f4b043cb">
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 6
&gt;    doc_id   part_id sex      age utt_id utt_text                                
&gt;    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                                   
&gt;  1 KB0RE000 PS002   female   721      0 You enjoyed yourself in America         
&gt;  2 KB0RE000 PS006   male     601      1 Eh                                      
&gt;  3 KB0RE000 PS002   female   721      2 did you                                 
&gt;  4 KB0RE000 PS006   male     601      3 Oh I covered a nice trip yes            
&gt;  5 KB0RE000 PS002   female   721      4 Oh very good yeah                       
&gt;  6 KB0RE000 PS006   male     601      5 Er saw Mary and Andrew and              
&gt;  7 KB0RE000 PS002   female   721      6 Yes you did                             
&gt;  8 KB0RE000 PS006   male     601      7 in fact the whole family was together f…
&gt;  9 KB0RE000 PS002   female   721      8 Oh very nice very nice yes It 's horrib…
&gt; 10 KB0RE000 PS006   male     601      9 It is horrible is n't</code></pre>
</div>
</div>
</div>
</section><section id="sec-td-tokenization-application" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="sec-td-tokenization-application">
<span class="header-section-number">7.3.2</span> Application</h3>
<p>…</p>
<!-- 

- [ ] Add PELIC data dictionary and read dataset. 
  - [ ] ? I may just make reference to the fact that rows can be collapsed into a single string using `stringr::str_c()`. 

-->
</section></section><section id="sec-td-generation" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="sec-td-generation">
<span class="header-section-number">7.4</span> Generatation</h2>
<!--  

row- and column-wise

The goal is to augment the dataset with additional information based on the existing information, but not necessarily explicit in the dataset. This may include adding linguistic annotations, sentiment analysis, etc.

Data: 

- Europarl
  - English
  - Spanish

- Lexical annotation
  - POS, lemma, etc.
- Syntax annotation
  - Dependency parsing

Consider:

- UD models: note that there are different models for different languages and language varieties, some may be more in line with the language variety of interest than others.
- Mention `rsyntax` package for extracting/ recoding patterns from syntactic annotations.

-->
<p>The process of generating a dataset involves the addition of information to a dataset. Whereas recoding involves the transformation of information that is already explicit in a dataset, generation involves the transformation of information that is implicit in a dataset.</p>
<p>The most common type of operation involved in the generation process is the addition of linguistic annotation. This process can be accomplished manually by a researcher or research team or automatically through the use of pre-trained linguistic resources and/ or software. Ideally the annotation of linguistic information can be conducted automatically.</p>
<p>There are important considerations, however, that need to be taken into account when choosing whether linguistic annotation can be conducted automatically. First and foremost has to do with the type of annotation desired. Information such as part of speech (grammatical category) and morpho-syntactic information are the the most common types of linguistic annotation that can be conducted automatically. Second the degree to which the resource that will be used to annotate the linguistic information is aligned with the language variety and/or register is also a key consideration. As noted, automatic linguistic annotation methods are contingent on pre-trained resources. The language and language variety used to develop these resources may not be available for the language under investigation, or if it does, the language variety and/ or register may not align. The degree to which a resource does not align with the linguistic information targeted for annotation is directly related to the quality of the final annotations. To be clear, no annotation method, whether manual or automatic is guaranteed to be perfectly accurate.</p>
<p>Let’s take a look at annotation some of the language from the Europarl dataset we normalized.</p>
<div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Target"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-td-europarl-en-preview" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="First 10 lines in English from the normalized SDAC dataset." data-hash="transform-datasets_cache/html/tbl-td-europarl-en-preview_7d6528933ef2d7636f71045b105015cc">
<div class="panel-caption table-caption">
<p><strong>?(caption)</strong></p>
</div>
</div>
</div>
<p>We will use the cleanNLP package to do our linguistic annotation. The annotation process depends on the pre-trained language models. There is <a href="https://github.com/bnosac/udpipe#pre-trained-models">a list of the models available to access</a>. The <code>load_model_udpipe()</code> custom function below downloads the specified language model and initialized the <code>udpipe</code> engine (<code>cnlp_init_udpipe()</code>) for conducting annotations.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-functions-load-udpipe-model_ff5f23572c0a2b39e3de3a65c53b5141">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">load_model_udpipe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_lang</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function</span></span>
<span>  <span class="co"># Download and load the specified udpipe language model</span></span>
<span>  </span>
<span>  <span class="fu">cnlp_init_udpipe</span><span class="op">(</span><span class="va">model_lang</span><span class="op">)</span> <span class="co"># to download the model, if not downloaded</span></span>
<span><span class="va">base_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"cleanNLP"</span><span class="op">)</span> <span class="co"># get the base path</span></span>
<span>  <span class="va">model_name</span> <span class="op">&lt;-</span> <span class="co"># extract the model_name</span></span>
<span>    <span class="va">base_path</span> <span class="op">|&gt;</span> <span class="co"># extract the base path</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># get the directory</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"^"</span>, <span class="va">model_lang</span><span class="op">)</span><span class="op">)</span> <span class="co"># extract the name of the model</span></span>
<span>  </span>
<span>  <span class="va">model_path</span> <span class="op">&lt;-</span> <span class="fu">udpipe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/udpipe/man/udpipe_load_model.html">udpipe_load_model</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="va">model_name</span>, fsep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span> <span class="co"># create the path to the downloaded model stored on disk</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">model_path</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In a test case, let’s load the ‘english’ model to annotate a sentence line from the europarl dataset to illustrate the basic workflow.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-generation-europarl-en-example_6b035e53eee84cee04353d27d76852ce">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">eng_model</span> <span class="op">&lt;-</span> <span class="fu">load_model_udpipe</span><span class="op">(</span><span class="st">"english"</span><span class="op">)</span> <span class="co"># load and initialize the language model, 'english' in this case.</span></span>
<span></span>
<span><span class="va">eng_annotation</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">europarl</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Target"</span> <span class="op">&amp;</span> <span class="va">sentence_id</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># select English and sentence_id 6</span></span>
<span>  <span class="fu">cnlp_annotate</span><span class="op">(</span></span>
<span>    text_name <span class="op">=</span> <span class="st">"sentence"</span>, <span class="co"># input text (sentence)</span></span>
<span>    doc_name <span class="op">=</span> <span class="st">"sentence_id"</span></span>
<span>  <span class="op">)</span> <span class="co"># specify the grouping column (sentence_id)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">eng_annotation</span><span class="op">)</span> <span class="co"># preview structure</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We see that the structure returned by the <code>cnlp_annotate()</code> function is a list. This list contains two data frames (tibbles). One for the tokens (and there annotation information) and the document (the metadata information). We can inspect the annotation characteristics for this one sentence by targetting the <code>$tokens</code> data frame. Let’s take a look at the linguistic annotation information returned.</p>
<div id="tbl-td-generation-test-annotation-english" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Annotation information for a single English sentence from the europarl dataset." data-hash="transform-datasets_cache/html/tbl-td-generation-test-annotation-english_27713829082ef05f7117ffc67bc73320">

</div>
<p>There is quite a bit of information which is returned from <code>cnlp_annotate()</code>. First note that the input sentence has been tokenized by word. Each token includes the token, lemma, part of speech (<code>upos</code> and <code>xpos</code>), morphological features (<code>feats</code>), and syntactic relationships (<code>tid_source</code> and <code>relation</code>). It is also key to note that the <code>doc_id</code>, <code>sid</code> and <code>tid</code> maintain the relational attributes from the original dataset –and therefore maintains our annotated dataset in tidy format.</p>
<p>Let’s now annotate the same sentence from the europarl corpus for the Source (‘Spanish’) and note the similarities and differences.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-generation-europarl-es-example_a29ab659394fd79cbcff557e6569b3c9">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spa_model</span> <span class="op">&lt;-</span> <span class="fu">load_model_udpipe</span><span class="op">(</span><span class="st">"spanish"</span><span class="op">)</span> <span class="co"># load and initialize the language model, 'spanish' in this case.</span></span>
<span></span>
<span><span class="va">spa_annotation</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">europarl</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Source"</span> <span class="op">&amp;</span> <span class="va">sentence_id</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># select Spanish and sentence_id 6</span></span>
<span>  <span class="fu">cnlp_annotate</span><span class="op">(</span></span>
<span>    text_name <span class="op">=</span> <span class="st">"sentence"</span>, <span class="co"># input text (sentence)</span></span>
<span>    doc_name <span class="op">=</span> <span class="st">"sentence_id"</span></span>
<span>  <span class="op">)</span> <span class="co"># specify the grouping column (sentence_id)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-td-generation-test-annotation-spanish" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Annotation information for a single Spanish sentence from the europarl dataset." data-hash="transform-datasets_cache/html/tbl-td-generation-test-annotation-spanish_cf007885eda1392c912bf51c13efd483">

</div>
<p>For the Spanish version of this sentence, we see the same variables. However, the <code>feats</code> variable has morphological information which is specific to Spanish –notably gender and mood.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i> Warning</strong></p>
<p>The <code>rsyntax</code> package <span class="citation" data-cites="R-rsyntax">(<a href="references.html#ref-R-rsyntax" role="doc-biblioref">Welbers and van Atteveldt 2022</a>)</span> can be used to recode and extract patterns from the output from automatic linguistic annotations using cleanNLP. <a href="https://github.com/vanatteveldt/rsyntax">See the documentation for more information</a>.</p>
</div>
</div>
</div>
</section><section id="sec-td-merging" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="sec-td-merging">
<span class="header-section-number">7.5</span> Merging</h2>
<!--

Row-wise and column-wise

The goal to combine two or more datasets to create a new dataset. This may include concatenating datasets row-wise or joining datasets column-wise. The goal is to create a dataset that is more informative for the research question. In most cases this will involve the addition of information from one dataset to another. But in some cases it may be the case that the goal is to filter one dataset based on the information in another dataset.

The datasets to be merged must share attributes. In the case of concatenation, the datasets must share the same attributes. In the case of joining, the datasets must share at least one attribute, or key, to join on.

Data: 

- CEDEL2 (row-wise) "Concatenating"
  - Natives
  - Learners

- PEDC (column-wise) "Joining"
  - Wordbank: word-level `category`` and `item_kind`
  - eLexicon: word-level word frequency measures (https://elexicon.wustl.edu/index.html)

- PEDIC (column-wise) "Joining"
  - `lingtypology` package: ENNTT country/ language properties (?)

Consider: 

- Linguistic information:
  - Sentiment lexicons
  - Stopword lists
  - MRC word information to merge

---

Useful language: 

Consider the `get_sentiments()` function which returns words which have been classified as 'positive'- or 'negative'-biased, if the lexicon is set to 'bing' [@Hu2004]. This function can be used to generate a new variable which can be used to measure the sentiment of a text. 

-->
<p>One final class of transformations that can be applied to curated datasets to enhance their informativeness for a research project is the process of merging two or more datasets. To merge datasets it is required that the datasets share one or more attributes. With a common attribute two datasets can be joined to coordinate the attributes of one dataset with the other effectively adding attributes and one dataset with extended information. Another approach is to join datasets with the goal of filtering one of the datasets given the matching attribute.</p>
<p>Let’s see this in practice.</p>
<!-- ADD.... -->
<p>We can also merge datasets that we generate in our analysis or that we import from other sources. This can be useful when there are cases in which a corpus has associated metadata that is contained in files separate from the corpus itself. This is the case for the Switchboard dialog Act Corpus.</p>
<p>Our existing, disfluency recoded, version includes the following variables.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-disfluencies_43f8a008dd8b4178feeb054d7efaa793">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># preview first 10 observations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <a href="https://catalog.ldc.upenn.edu/docs/LDC97S62/">online documentation page</a> provides a key file <code>caller_tab.csv</code> which contains speaker metadata information. Included in this <code>.csv</code> file is a column <code>caller_no</code> which contains the <code>speaker_id</code> we currently have in the <code>sdac_disfluencies</code> dataset. Let’s read this file into our R session renaming <code>caller_no</code> to <code>speaker_id</code> to prepare to join these datasets.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-meta-read_4557ea371eef3a1f192417fbe1edcb45">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_speaker_meta</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read_csv</span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="st">"https://catalog.ldc.upenn.edu/docs/LDC97S62/caller_tab.csv"</span>,</span>
<span>    col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"speaker_id"</span>, <span class="co"># changed from `caller_no`</span></span>
<span>      <span class="st">"pin"</span>,</span>
<span>      <span class="st">"target"</span>,</span>
<span>      <span class="st">"sex"</span>,</span>
<span>      <span class="st">"birth_year"</span>,</span>
<span>      <span class="st">"dialect_area"</span>,</span>
<span>      <span class="st">"education"</span>,</span>
<span>      <span class="st">"ti"</span>,</span>
<span>      <span class="st">"payment_type"</span>,</span>
<span>      <span class="st">"amt_pd"</span>,</span>
<span>      <span class="st">"con"</span>,</span>
<span>      <span class="st">"remarks"</span>,</span>
<span>      <span class="st">"calls_deleted"</span>,</span>
<span>      <span class="st">"speaker_partition"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">sdac_speaker_meta</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now to join the <code>sdac_disfluencies</code> and <code>sdac_speaker_meta</code>. Let’s turn to <code>left_join()</code> again as we want to retain all the observations (rows) from <code>sdac_disfluencies</code> and add the columns for <code>sdac_speaker_meta</code> where the <code>speaker_id</code> column values match.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-join-metadata_c6ec8b2c761cd4bf60fdcf9a81327a43">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">sdac_disfluencies</span>, <span class="va">sdac_speaker_meta</span><span class="op">)</span> <span class="co"># join by ``speaker_id`</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">sdac_disfluencies</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now there are some metadata columns we may want to keep and others we may want to drop as they may not be of importance for our analysis. I’m going to assume that we want to keep <code>sex</code>, <code>birth_year</code>, <code>dialect_area</code>, and <code>education</code> and drop the rest.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-disfluencies-subset-cols_a5aad792170ac0cb2b4e456dc3d646a6">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdac_disfluencies</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">doc_id</span><span class="op">:</span><span class="va">count</span>, <span class="va">sex</span><span class="op">:</span><span class="va">education</span><span class="op">)</span> <span class="co"># subset key columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-td-sdac-disfluencies-meta-preview" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="First 10 observations for the `sdac_disfluencies` dataset with speaker metadata." data-hash="transform-datasets_cache/html/tbl-td-sdac-disfluencies-meta-preview_4a795d4e8cd0f7e9240f5843452623dd">

</div>
</section><section id="summary" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="summary">Summary</h2>
<p>In this chapter we covered the process of transforming datasets. The goal is to manipulate the curated dataset to make it align better for analysis. There are four general types of transformation steps: normalization, recoding, tokenization, generation, and merging. In any given research project some or all of these steps will be employed –but not necessarily in the order presented in this chapter. Furthermore, there may also be various datasets generated in at this stage each with a distinct analysis focus in mind.</p>
<!--  

?? Add at the end of the chapter?

[x] Add data checks
[ ] Reminder on writing the dataset and data dictionary to *data/derived/* directory
  [ ] There may be multiple transformed datasets, so it is important to di  stinguish them from one another and document them separately.
[ ] Reminder to review and document code added to the *code/* directory, within the *3-transform-dataset.qmd* file.

-->
<p>In any case, it is important to write these datasets to disk and to document them according to reproducible research principles.</p>
<p>This chapter concludes the section on data/ dataset preparation. The next section we turn to analyzing datasets. This is the stage where we interrogate the datasets to derive knowledge and insight either through exploratory, predictive, or inferential methods.</p>
</section><section id="activities" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="activities">Activities</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-file-code" aria-label="file-code"></i> Recipe</strong></p>
<!-- Understand, apply, and analyze verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] update recipe -->
<p><strong>What</strong>: <a href="https://lin380.github.io/tadr/articles/recipe_8.html">Dataset manipulation: tokenization and joining datasets</a><br><strong>How</strong>: Read Recipe 8 and participate in the Hypothes.is online social annotation.<br><strong>Why</strong>: To work with to primary types of transformations, tokenization and joins. Tokenization is the process of recasting textual units as smaller textual units. The process of joining datasets aims to incorporate other datasets to augment or filter the dataset of interest.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-flask" aria-label="flask"></i> Lab</strong></p>
<!-- Analyze, evaluate, and create verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] update lab -->
<p><strong>What</strong>: <a href="https://github.com/lin380/lab_8">Dataset manipulation: tokenization and joining datasets</a><br><strong>How</strong>: Clone, fork, and complete the steps in Lab 8.<br><strong>Why</strong>: To gain experience working with coding strategies for transforming datasets using tidyverse functions and regular expressions, practice reading/ writing data from/ to disk, and implement organizational strategies for organizing and documenting a dataset in reproducible fashion.</p>
</div>
</div>
</div>
</section><section id="questions" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="questions">Questions</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="fa-solid fa-wrench" aria-label="wrench"></i> <strong>Conceptual questions</strong></p>
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="fa-solid fa-wrench" aria-label="wrench"></i> <strong>Technical questions</strong></p>
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Tottie2011" class="csl-entry" role="listitem">
Tottie, Gunnel. 2011. <span>“Uh and Um as Sociolinguistic Markers in British English.”</span> <em>International Journal of Corpus Linguistics</em> 16 (2): 173–97.
</div>
<div id="ref-R-rsyntax" class="csl-entry" role="listitem">
Welbers, Kasper, and Wouter van Atteveldt. 2022. <em>Rsyntax: Extract Semantic Relations from Text by Querying and Reshaping Syntax</em>. <a href="https://CRAN.R-project.org/package=rsyntax">https://CRAN.R-project.org/package=rsyntax</a>.
</div>
<div id="ref-R-stringr" class="csl-entry" role="listitem">
Wickham, Hadley. 2022. <em>Stringr: Simple, Consistent Wrappers for Common String Operations</em>. <a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./curate-datasets.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./analysis.html" class="pagination-link">
        <span class="nav-page-text">Analysis</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>
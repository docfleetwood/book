<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>An Introduction to Quantitative Text Analysis for Linguistics - 7&nbsp; Transform datasets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./analysis.html" rel="next">
<link href="./curate-datasets.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="stylesheet" href="assets/css/mini.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./preparation.html">Preparation</a></li><li class="breadcrumb-item"><a href="./transform-datasets.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">An Introduction to Quantitative Text Analysis for Linguistics</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/qtalr/book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./qtalr-manuscript.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./orientation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Orientation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text analysis in context</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./understanding-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Understanding data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./approaching-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Approaching analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./framing-research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Framing research</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acquire-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./curate-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transform-datasets.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Reports</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collaboration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Collaboration</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feedback.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Feedback <i class="fa-solid fa-comment" aria-label="comment"></i></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-td-normalization" id="toc-sec-td-normalization" class="nav-link active" data-scroll-target="#sec-td-normalization"><span class="header-section-number">7.1</span> Normalization</a></li>
  <li><a href="#sec-td-recoding" id="toc-sec-td-recoding" class="nav-link" data-scroll-target="#sec-td-recoding"><span class="header-section-number">7.2</span> Recoding</a></li>
  <li><a href="#sec-td-tokenization" id="toc-sec-td-tokenization" class="nav-link" data-scroll-target="#sec-td-tokenization"><span class="header-section-number">7.3</span> Tokenization</a></li>
  <li><a href="#sec-td-generation" id="toc-sec-td-generation" class="nav-link" data-scroll-target="#sec-td-generation"><span class="header-section-number">7.4</span> Generatation</a></li>
  <li><a href="#sec-td-merging" id="toc-sec-td-merging" class="nav-link" data-scroll-target="#sec-td-merging"><span class="header-section-number">7.5</span> Merging</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#activities" id="toc-activities" class="nav-link" data-scroll-target="#activities">Activities</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/qtalr/book/edit/main/transform-datasets.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/qtalr/book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-transform-datasets" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-default callout-caution callout-titled" title="Caution">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><i class="fa-solid fa-route" aria-label="route"></i> In progress…</p>
</div>
</div>
<!--

Content:

Exercises:

- [ ] add concept questions to Activities
- [ ] add exercises to Activities
- [ ] add thought questions/ case studies to prose sections

Formatting:

- [ ] Add a description of the importance of the unit of analysis and unit of observation in the transformation process.
  - In the curation process, the original data and utility of the dataset is priority. In the transformation process, the focus is on the analysis and the unit of analysis and unit of observation are the primary considerations.
- [ ] Point out that some units of observation will require that the data have more textual context (e.g. syntactic parsing) than others (e.g. word frequencies). It is important that the presentation of the transformation steps are no necessarily in the order in which they are applied.

-->
<blockquote class="blockquote">
<p>Nothing is lost. Everything is transformed.</p>
<p>— Michael Ende, The Neverending Story</p>
</blockquote>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-list-alt" aria-label="list-alt"></i> Outcomes</strong></p>
<!-- Remember and understand verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] update to outcomes -->
<ul>
<li>What is the role of data transformation in a text analysis project?</li>
<li>What are the general processes for preparing datasets for analysis?</li>
<li>How do each of these general processes transform datasets?</li>
</ul>
</div>
</div>
</div>
<!-- 
- Transformation: goals
  - Prepare curated dataset for analysis
  - Manipulate dataset row-wise and/ or column-wise
  - Focus on particular analysis needs: unit of analysis, unit of observation, operationalization of variables, etc.
-->
<p>In this chapter, we will focus on transforming a curated dataset to refine and possibly expand its relational characteristics to align with our research. The transformation process is divided into four categories: text normalization, text tokenization, variable recoding, variable generation, and observation/ variable merging. These categories are not sequential but may occur in any order based on the researcher’s evaluation of the dataset characteristics and the desired outcome.</p>
<p>It is sometimes necessary to create several transformed datasets from one curated dataset in cases where there are multiple analyses to be performed. This why we start with a curated dataset rather than directly deriving a transformed dataset from the original data. It allows for various transformation methods to produce different formats for different analyses.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-terminal" aria-label="terminal"></i> Swirl lesson</strong></p>
<!-- Remember and understand verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- 
- [ ] Update lesson name, 
- [ ] update lesson purpose
-->
<p><strong>What</strong>: <a href="https://github.com/qtalr/lessons">Reshape dataset rows, Reshape dataset columns</a><br><strong>How</strong>: In the R Console pane load <code>swirl</code>, run <code>swirl()</code>, and follow prompts to select the lesson.<br><strong>Why</strong>: …</p>
</div>
</div>
</div>
<!-- 
New outline: 2023-08-12


(See 'Understanding data' chapter for background @sec-ud-transformation)

text normalization, text tokenization, variable recoding, variable generation, and observation/ variable merging.

- Normalization (column-wise)
  - Artifact removal
- Recoding (column-wise)
  - Classify
  - Derive
- Tokenization (row-wise)
  - Words, n-grams, sentences
- Generation (row-wise and column-wise)
  - Lexical annotation
  - Syntactic annotation
- Merging (row-wise/ column-wise)
  - Joining datasets

---

- Summary
- Activities

-->
<section id="sec-td-normalization" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="sec-td-normalization">
<span class="header-section-number">7.1</span> Normalization</h2>
<!--  

column-wise

-->
<p>The process of normalizing datasets in essence is to sanitize the values of variable or set of variables such that there are no artifacts that will contaminate subsequent processing. It may be the case that non-linguistic metadata may require normalization but more often than not linguistic information is the most common target for normalization as text often includes artifacts from the acquisition process which will not be desired in the analysis.</p>
<p><strong>Europarl Corpus</strong></p>
<p>The data dictionary for the Europarl Corpus appears in <a href="#tbl-td-europarl-dd">Table&nbsp;<span>7.1</span></a>.</p>
<div class="cell" data-hash="transform-datasets_cache/html/tbl-td-europarl-dd_1c6dc03d6ab17fce6031408736f6172e">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/cd-europarl_curated_dd.csv"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-europarl-dd" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;7.1: Data dictionary for the Europarl Corpus.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_id</td>
<td style="text-align: left;">Document ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Unique identification number for each document</td>
</tr>
<tr class="even">
<td style="text-align: left;">type</td>
<td style="text-align: left;">Document Type</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Type of document; either 'Source' or 'Target'</td>
</tr>
<tr class="odd">
<td style="text-align: left;">line_id</td>
<td style="text-align: left;">Line ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Unique identification number for each line in each document type</td>
</tr>
<tr class="even">
<td style="text-align: left;">lines</td>
<td style="text-align: left;">Lines</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Content of the lines in the document</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-read-run_59f2e701170227135499cea0b8550d40">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarl_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/europarl_curated.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Consider the curated Europarl Corpus dataset. I will read in the dataset. Since the dataset is quite large, I have also subsetted the dataset keeping only the first 1,000 observations for each of value of <code>type</code> for demonstration purposes.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-normalize-read-subset-show_e77d57b58bd4bc1d25647a65cc1742c6">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarl</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/derived/europarl/europarl_curated.csv"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># read curated dataset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">sentence_id</span> <span class="op">&lt;</span> <span class="fl">1001</span><span class="op">)</span> <span class="co"># keep first 1000 observations for each type</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Simply looking at the first 14 lines of this dataset, we can see that if our goal is to work with the transcribed (‘Source’) and translated (‘Target’) language, there are lines which do not appear to be of interest.</p>
<div id="tbl-td-europarl-preview-1" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="europarl Corpus curated dataset preview." data-hash="transform-datasets_cache/html/tbl-td-europarl-preview-1_77b31aa53ff8d70c601f91cac5f1e630">

</div>
<p><code>sentence_id</code> 1 appears to be title and <code>sentence_id</code> 7 reflects description of the parliamentary session. Both of these are artifacts that we would like to remove from the dataset.</p>
<p>To remove these lines we can turn to the programming strategies we’ve previously worked with. Namely we will use <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> to filter observations in combination with <code>str_detect()</code> to detect matches for some pattern that is indicative of these lines that we want to remove and not of the other lines that we want to keep.</p>
<p>Before we remove any lines, let’s try craft a search pattern to identify these lines, and exclude the lines we will want to keep. Condition one is lines which start with an opening parenthesis <code>(</code>. Condition two is lines that do not end in standard sentence punctuation (<code>.</code>, <code>!</code>, or <code>?</code>). I’ve added both conditions to one <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> using the logical <em>OR</em> operator (<code>|</code>) to ensure that either condition is matched in the output.</p>
<div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Identify non-speech lines</span></span>
<span><span class="va">europarl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">sentence</span>, <span class="st">"^\\("</span><span class="op">)</span> <span class="op">|</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">sentence</span>, <span class="st">"[^.!?]$"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># filter lines that detect a match for either condition 1 or 2</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># random sample of 10 observations</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-td-europarl-search-non-speech" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Non-speech lines in the europarl dataset." data-hash="transform-datasets_cache/html/tbl-td-europarl-search-non-speech_4ba410d296139753f49a1bbad72ad834">
<div class="panel-caption table-caption">
<p><strong>?(caption)</strong></p>
</div>
</div>
</div>
<p>Since this search appears to match lines that we do not want to preserve, let’s move now to eliminate these lines from the dataset. To do this we will use the same regular expression patterns, but now each condition will have it’s own <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> call and the <code>str_detect()</code> will be negated with a prefixed <code>!</code>.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-filter-non-speech_6a62ad2218616b5f223544f99d1390b2">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarl</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">europarl</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">sentence</span>, pattern <span class="op">=</span> <span class="st">"^\\("</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove lines starting with (</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">sentence</span>, pattern <span class="op">=</span> <span class="st">"[^.!?]$"</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove lines not ending in ., !, or ?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at the first 14 lines again, now that we have eliminated these artifacts.</p>
<div id="tbl-td-europarl-preview-2" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="europarl Corpus non-speech lines removed." data-hash="transform-datasets_cache/html/tbl-td-europarl-preview-2_f5911e889d85ff4350f544b85c2ad4b4">

</div>
<p>One further issue that we may want to resolve concerns the fact that there are whitespaces between possessive forms (i.e.&nbsp;“minute’ s silence”). In this case we can employ <code>str_replace_all()</code> inside the <code>mutate()</code> function to overwrite the <code>sentence</code> values that match an apostrophe <code>'</code> with whitespace (<code>\\s</code>) before <code>s</code>.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-europarl-remove-whitespace_d4d208e5eea325ce2a67838f57f18c8a">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarl</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">europarl</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sentence <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span></span>
<span>    string <span class="op">=</span> <span class="va">sentence</span>,</span>
<span>    pattern <span class="op">=</span> <span class="st">"'\\ss"</span>,</span>
<span>    replacement <span class="op">=</span> <span class="st">"'s"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="co"># replace ' s with `s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have normalized text in the <code>sentence</code> column in the europarl dataset.</p>
</section><section id="sec-td-recoding" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="sec-td-recoding">
<span class="header-section-number">7.2</span> Recoding</h2>
<!--  

column-wise

Data:
  - SWDA
    - education (classify)
    - birth_year (derive)
    - utterance_text (extract, disfluencies)
-->
<!-- Consider:

The process of recoding aims to _recast_ the values of a variable or set of variables to a new variable or set of variables to enable more direct access. This may include extracting values from a variable, stemming or lemmatization of words, tokenization of linguistic forms (words, ngrams, sentences, etc.), calculating the lengths of linguistic units, calculating type-token ratios, syntactic complexity, and/ or removing variables that will not be used in the analysis, etc.
-->
<p>Normalizing text can be seen as an extension of dataset curation to some extent in that the structure of the dataset is maintained. In the Europarl case, we saw this to be true. In the case of recoding, and other transformational steps, the aim will be to modify the dataset structure either by rows, columns, or both. Recoding processes can be characterized by the creation of structural changes which are derived from values in variables effectively recasting values as new variables to enable more direct access in our analyses.</p>
<p><strong>Switchboard Dialogue Act Corpus</strong></p>
<!--  

Recode: 

- education (classify)
- birth_year (derive)
- utterance_text (extract, disfluencies) (derive)

-->
<p>Data dictionary.</p>
<div class="cell" data-hash="transform-datasets_cache/html/tbl-tr-swda-curated-dd_126e079337641b6a3943bb715e22d35e">
<div class="cell-output-display">
<div id="tbl-tr-swda-curated-dd" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;7.2: Data dictionary for the Switchboard Dialogue Act Corpus.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable_type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_id</td>
<td style="text-align: left;">Document ID</td>
<td style="text-align: left;">Identifier for each document in the dataset</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="even">
<td style="text-align: left;">speaker_id</td>
<td style="text-align: left;">Speaker ID</td>
<td style="text-align: left;">Identifier for each speaker in the dataset</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">Sex</td>
<td style="text-align: left;">Gender of the speaker</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">education</td>
<td style="text-align: left;">Education</td>
<td style="text-align: left;">Education level of the speaker (1-5 scale)</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="odd">
<td style="text-align: left;">birth_year</td>
<td style="text-align: left;">Birth Year</td>
<td style="text-align: left;">Year of birth of the speaker</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="even">
<td style="text-align: left;">utterance_id</td>
<td style="text-align: left;">Utterance ID</td>
<td style="text-align: left;">Identifier for each utterance in the dataset</td>
<td style="text-align: left;">numeric</td>
</tr>
<tr class="odd">
<td style="text-align: left;">damsl_tag</td>
<td style="text-align: left;">DAMSL Tag</td>
<td style="text-align: left;">A tag indicating the discourse act of the utterance</td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;">utterance_text</td>
<td style="text-align: left;">Utterance Text</td>
<td style="text-align: left;">The actual text of the utterance</td>
<td style="text-align: left;">character</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Read in the curated dataset.</p>
<div class="cell" data-hash="transform-datasets_cache/html/tr-swda-dataset-read-show_fff763084b6dd27236578b1b69510093">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">swda_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/derived/swda/swda_curated.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preview the first 10 lines of the dataset.</p>
<div class="cell" data-hash="transform-datasets_cache/html/tr-swda-curated-preview_69a6f2ef590d8a22c38d4d8c1469e105">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">swda_curated_tbl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; # A tibble: 10 × 8
&gt;    doc_id speaker_id sex    education birth_year utterance_id damsl_tag
&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;    
&gt;  1   4325       1632 Female         2       1962            1 o        
&gt;  2   4325       1632 Female         2       1962            2 qw       
&gt;  3   4325       1519 Female         1       1971            3 qy^d     
&gt;  4   4325       1632 Female         2       1962            4 +        
&gt;  5   4325       1519 Female         1       1971            5 +        
&gt;  6   4325       1632 Female         2       1962            6 qy       
&gt;  7   4325       1519 Female         1       1971            7 sd       
&gt;  8   4325       1519 Female         1       1971            8 ad       
&gt;  9   4325       1519 Female         1       1971            9 h        
&gt; 10   4325       1519 Female         1       1971           10 ad       
&gt; # ℹ 1 more variable: utterance_text &lt;chr&gt;</code></pre>
</div>
</div>
<hr>
<p>The Switchboard Dialogue Act Corpus dataset that was //FIXME curated in the previous chapter contains a number of variables describing conversations between speakers of American English.</p>
<p>Let’s read in this dataset and take a closer look.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-read-show_a6cd12b528e7facd3b7db975390558ad">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/derived/sdac/sdac_curated.csv"</span><span class="op">)</span> <span class="co"># read curated dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Among a number of metadata variables, curated dataset includes the <code>utterance_text</code> column which contains dialogue from the conversations interleaved with a <a href="https://staff.fnwi.uva.nl/r.fernandezrovira/teaching/DM-materials/DFL-book.pdf">disfluency annotation scheme</a>.</p>
<div id="tbl-td-sdac-preview-curated-dataset" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="20 randomly sampled lines of the SDAC curated dataset." data-hash="transform-datasets_cache/html/tbl-td-sdac-preview-curated-dataset_d72a2a2a7202ba19dbc4884d41b46a35">

</div>
<p>Let’s drop a few variables from our dataset to rein in our focus. I will keep the <code>doc_id</code>, <code>speaker_id</code>, and <code>utterance_text</code>.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-simplified_15ee220b7a543ec0950db6ba24cd23c1">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_simplified</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdac</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">speaker_id</span>, <span class="va">utterance_text</span><span class="op">)</span> <span class="co"># columns to retain</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-td-sdac-simple-preview" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="First 10 lines of the simplified SDAC curated dataset." data-hash="transform-datasets_cache/html/tbl-td-sdac-simple-preview_dd9cf77a7ee4ec53a3f1dc941b601694">

</div>
<p>In this disfluency annotation system, there are various conventions used for non-sentence elements. If say, for example, a researcher were to be interested in understanding the use of filled pauses (‘uh’ or ‘uh’), the aim would be to identify those lines where the <code>{F ...}</code> annotation is used around the utterances ‘uh’ and ‘um’.</p>
<p>To do this we turn to the <code>str_count()</code> function. This function will count the number of matches found for a pattern. We can use a regular expression to identify the pattern of interest which is all the instances of <code>{F</code> followed by either <code>uh</code> or <code>um</code>. Since the disfluencies may start an utterance, and therefore be capitalized we need to formulate a regular expression which allows for either <code>U</code> or <code>u</code> for each disfluency type. The result from each disfluency match will be added to a new column. To create a new column we will wrap each <code>str_count()</code> with <code>mutate()</code> and give the new column a meaningful name. In this case I’ve opted for <code>uh</code> and <code>um</code>.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-count-disfluencies_dead463cc0100b024a834f8af6a5514b">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdac_simplified</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>uh <span class="op">=</span> <span class="fu">str_count</span><span class="op">(</span><span class="va">utterance_text</span>, <span class="st">"\\{F [Uu]h"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># match {F Uh or {F uh}</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>um <span class="op">=</span> <span class="fu">str_count</span><span class="op">(</span><span class="va">utterance_text</span>, <span class="st">"\\{F [Uu]m"</span><span class="op">)</span><span class="op">)</span> <span class="co"># match {F Um or {F um}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-td-sdac-count-disfluencies-show" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="First 20 lines of SDAC dataset with counts for the disfluencies 'uh' and 'um'." data-hash="transform-datasets_cache/html/tbl-td-sdac-count-disfluencies-show_230ee144d093ca503d6f2f9269c1a618">

</div>
<p>Now we have two new columns, <code>uh</code> and <code>um</code> which indicate how many times the relevant pattern was matched for a given utterance. By choosing to focus on disfluencies, however, we have made a decision to change the unit of observation from the utterance to the use of filled pauses (<code>uh</code> and <code>um</code>). This means that as the dataset stands, it is not in tidy format –where each observation corresponds to the observational unit. When datasets are misaligned in this particular way, there are in what is known as ‘wide’ format. What we want to do, then, is to restructure our dataset such that each row corresponds to the unit of observation –in this case each filled pause type.</p>
<p>To convert our current (wide) dataset to one where each filler type is listed and the counts are measured for each utterance we turn to the <code>pivot_longer()</code> function. This function creates two new columns, one in which the column names are listed and one for the values for each of the column names.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-disfluencies-longer_ed6880f4a33fda2a25f66f48f3ce44da">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdac_disfluencies</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"uh"</span>, <span class="st">"um"</span><span class="op">)</span>, <span class="co"># columns to convert</span></span>
<span>    names_to <span class="op">=</span> <span class="st">"filler"</span>, <span class="co"># column for the column names (i.e. filler types)</span></span>
<span>    values_to <span class="op">=</span> <span class="st">"count"</span></span>
<span>  <span class="op">)</span> <span class="co"># column for the column values (i.e. counts)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-td-sdac-count-disfluencies-longer-show" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="First 20 lines of SDAC dataset with tidy format for `fillers` as the unit of observation." data-hash="transform-datasets_cache/html/tbl-td-sdac-count-disfluencies-longer-show_9d660b651653e8557ee0313bdaeac0ef">

</div>
</section><section id="sec-td-tokenization" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="sec-td-tokenization">
<span class="header-section-number">7.3</span> Tokenization</h2>
<!--  

row-wise

Data: 

- CABNC (expand)
  - tidytext::unnest_tokens()
- PELIC tokens (contract)
  - stringr::str_c() [w/ collapse = " "]

-->
<p>The CABNC Corpus data dictionary.</p>
<div class="cell" data-hash="transform-datasets_cache/html/tbl-td-cabnc-dd_19590253f86dc4081797fe672eaea4c3">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># [ ] filter the data dictionary to only include the variables of interest</span></span>
<span></span>
<span><span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"data/cd-cabnc_curated_dd.csv"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-cabnc-dd" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;7.3: Data dictionary for the CABNC Corpus.</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_id</td>
<td style="text-align: left;">Document ID</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Unique identifier for each document</td>
</tr>
<tr class="even">
<td style="text-align: left;">utt_num</td>
<td style="text-align: left;">Utterance Number</td>
<td style="text-align: left;">ordinal</td>
<td style="text-align: left;">Sequential number assigned to each utterance in a document</td>
</tr>
<tr class="odd">
<td style="text-align: left;">utt_start</td>
<td style="text-align: left;">Utterance Start Time</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Timestamp indicating the start time of an utterance, measured in seconds</td>
</tr>
<tr class="even">
<td style="text-align: left;">utt_end</td>
<td style="text-align: left;">Utterance End Time</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Timestamp indicating the end time of an utterance, measured in seconds</td>
</tr>
<tr class="odd">
<td style="text-align: left;">utterance</td>
<td style="text-align: left;">Utterance Text</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Textual content of an utterance</td>
</tr>
<tr class="even">
<td style="text-align: left;">part_id</td>
<td style="text-align: left;">Participant ID</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Unique identifier for each participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">part_age</td>
<td style="text-align: left;">Participant Age</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Age of the participant, measured in months</td>
</tr>
<tr class="even">
<td style="text-align: left;">part_sex</td>
<td style="text-align: left;">Participant Sex</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Sex of the participant. (male/ female)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">num_words</td>
<td style="text-align: left;">Number of Words</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Total number of words in utterances in the document</td>
</tr>
<tr class="even">
<td style="text-align: left;">num_utts</td>
<td style="text-align: left;">Number of Utterances</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Total number of utterances in the document</td>
</tr>
<tr class="odd">
<td style="text-align: left;">avg_utt_len</td>
<td style="text-align: left;">Average Utterance Length</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Average length of an utterance in the document, measured in words</td>
</tr>
<tr class="even">
<td style="text-align: left;">median_utt_len</td>
<td style="text-align: left;">Median Utterance Length</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Median length of an utterance in the document, measured in words</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Read the dataset.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-cabnc-read-show_4981e6193c1f395a4470b4de17b8291f">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cabnc_curated_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/derived/cabnc_curated.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- [ ] Add PELIC data dictionary and read dataset. -->
</section><section id="sec-td-generation" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="sec-td-generation">
<span class="header-section-number">7.4</span> Generatation</h2>
<!--  

row- and column-wise

Data: 

- Europarl
  - English
  - Spanish

- Lexical annotation
  - POS, lemma, etc.
- Syntax annotation
  - Dependency parsing

Mention `rsyntax` package for extracting/ recoding patterns from syntactic annotations.

-->
<p>The process of generating a dataset involves the addition of information to a dataset. Whereas recoding involves the transformation of information that is already explicit in a dataset, generation involves the transformation of information that is implicit in a dataset.</p>
<p>The most common type of operation involved in the generation process is the addition of linguistic annotation. This process can be accomplished manually by a researcher or research team or automatically through the use of pre-trained linguistic resources and/ or software. Ideally the annotation of linguistic information can be conducted automatically.</p>
<p>There are important considerations, however, that need to be taken into account when choosing whether linguistic annotation can be conducted automatically. First and foremost has to do with the type of annotation desired. Information such as part of speech (grammatical category) and morpho-syntactic information are the the most common types of linguistic annotation that can be conducted automatically. Second the degree to which the resource that will be used to annotate the linguistic information is aligned with the language variety and/or register is also a key consideration. As noted, automatic linguistic annotation methods are contingent on pre-trained resources. The language and language variety used to develop these resources may not be available for the language under investigation, or if it does, the language variety and/ or register may not align. The degree to which a resource does not align with the linguistic information targeted for annotation is directly related to the quality of the final annotations. To be clear, no annotation method, whether manual or automatic is guaranteed to be perfectly accurate.</p>
<p>Let’s take a look at annotation some of the language from the Europarl dataset we normalized.</p>
<div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Target"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-td-europarl-en-preview" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="First 10 lines in English from the normalized SDAC dataset." data-hash="transform-datasets_cache/html/tbl-td-europarl-en-preview_7d6528933ef2d7636f71045b105015cc">
<div class="panel-caption table-caption">
<p><strong>?(caption)</strong></p>
</div>
</div>
</div>
<p>We will use the cleanNLP package to do our linguistic annotation. The annotation process depends on the pre-trained language models. There is <a href="https://github.com/bnosac/udpipe#pre-trained-models">a list of the models available to access</a>. The <code>load_model_udpipe()</code> custom function below downloads the specified language model and initialized the <code>udpipe</code> engine (<code>cnlp_init_udpipe()</code>) for conducting annotations.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-functions-load-udpipe-model_ff5f23572c0a2b39e3de3a65c53b5141">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">load_model_udpipe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_lang</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function</span></span>
<span>  <span class="co"># Download and load the specified udpipe language model</span></span>
<span>  </span>
<span>  <span class="fu">cnlp_init_udpipe</span><span class="op">(</span><span class="va">model_lang</span><span class="op">)</span> <span class="co"># to download the model, if not downloaded</span></span>
<span><span class="va">base_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"cleanNLP"</span><span class="op">)</span> <span class="co"># get the base path</span></span>
<span>  <span class="va">model_name</span> <span class="op">&lt;-</span> <span class="co"># extract the model_name</span></span>
<span>    <span class="va">base_path</span> <span class="op">|&gt;</span> <span class="co"># extract the base path</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># get the directory</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"^"</span>, <span class="va">model_lang</span><span class="op">)</span><span class="op">)</span> <span class="co"># extract the name of the model</span></span>
<span>  </span>
<span>  <span class="va">model_path</span> <span class="op">&lt;-</span> <span class="fu">udpipe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/udpipe/man/udpipe_load_model.html">udpipe_load_model</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="va">model_name</span>, fsep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span> <span class="co"># create the path to the downloaded model stored on disk</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">model_path</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In a test case, let’s load the ‘english’ model to annotate a sentence line from the europarl dataset to illustrate the basic workflow.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-generation-europarl-en-example_6b035e53eee84cee04353d27d76852ce">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">eng_model</span> <span class="op">&lt;-</span> <span class="fu">load_model_udpipe</span><span class="op">(</span><span class="st">"english"</span><span class="op">)</span> <span class="co"># load and initialize the language model, 'english' in this case.</span></span>
<span></span>
<span><span class="va">eng_annotation</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">europarl</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Target"</span> <span class="op">&amp;</span> <span class="va">sentence_id</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># select English and sentence_id 6</span></span>
<span>  <span class="fu">cnlp_annotate</span><span class="op">(</span></span>
<span>    text_name <span class="op">=</span> <span class="st">"sentence"</span>, <span class="co"># input text (sentence)</span></span>
<span>    doc_name <span class="op">=</span> <span class="st">"sentence_id"</span></span>
<span>  <span class="op">)</span> <span class="co"># specify the grouping column (sentence_id)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">eng_annotation</span><span class="op">)</span> <span class="co"># preview structure</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We see that the structure returned by the <code>cnlp_annotate()</code> function is a list. This list contains two data frames (tibbles). One for the tokens (and there annotation information) and the document (the metadata information). We can inspect the annotation characteristics for this one sentence by targetting the <code>$tokens</code> data frame. Let’s take a look at the linguistic annotation information returned.</p>
<div id="tbl-td-generation-test-annotation-english" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Annotation information for a single English sentence from the europarl dataset." data-hash="transform-datasets_cache/html/tbl-td-generation-test-annotation-english_27713829082ef05f7117ffc67bc73320">

</div>
<p>There is quite a bit of information which is returned from <code>cnlp_annotate()</code>. First note that the input sentence has been tokenized by word. Each token includes the token, lemma, part of speech (<code>upos</code> and <code>xpos</code>), morphological features (<code>feats</code>), and syntactic relationships (<code>tid_source</code> and <code>relation</code>). It is also key to note that the <code>doc_id</code>, <code>sid</code> and <code>tid</code> maintain the relational attributes from the original dataset –and therefore maintains our annotated dataset in tidy format.</p>
<p>Let’s now annotate the same sentence from the europarl corpus for the Source (‘Spanish’) and note the similarities and differences.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-generation-europarl-es-example_a29ab659394fd79cbcff557e6569b3c9">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spa_model</span> <span class="op">&lt;-</span> <span class="fu">load_model_udpipe</span><span class="op">(</span><span class="st">"spanish"</span><span class="op">)</span> <span class="co"># load and initialize the language model, 'spanish' in this case.</span></span>
<span></span>
<span><span class="va">spa_annotation</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">europarl</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Source"</span> <span class="op">&amp;</span> <span class="va">sentence_id</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># select Spanish and sentence_id 6</span></span>
<span>  <span class="fu">cnlp_annotate</span><span class="op">(</span></span>
<span>    text_name <span class="op">=</span> <span class="st">"sentence"</span>, <span class="co"># input text (sentence)</span></span>
<span>    doc_name <span class="op">=</span> <span class="st">"sentence_id"</span></span>
<span>  <span class="op">)</span> <span class="co"># specify the grouping column (sentence_id)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-td-generation-test-annotation-spanish" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Annotation information for a single Spanish sentence from the europarl dataset." data-hash="transform-datasets_cache/html/tbl-td-generation-test-annotation-spanish_cf007885eda1392c912bf51c13efd483">

</div>
<p>For the Spanish version of this sentence, we see the same variables. However, the <code>feats</code> variable has morphological information which is specific to Spanish –notably gender and mood.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i> Warning</strong></p>
<p>The <code>rsyntax</code> package <span class="citation" data-cites="R-rsyntax">(<a href="references.html#ref-R-rsyntax" role="doc-biblioref">Welbers and van Atteveldt 2022</a>)</span> can be used to recode and extract patterns from the output from automatic linguistic annotations using cleanNLP. <a href="https://github.com/vanatteveldt/rsyntax">See the documentation for more information</a>.</p>
</div>
</div>
</div>
<!-- Consider:


- europarl Corpus, syntactic annotation

- Syntactic parsing for last.fm music lyrics, phrasal verbs (compound:prt) a la [@Akbary2018], with automated approach
- SOTU Corpus, frequency weighting and scaling for clustering algorithm?
- ...


The process of generation aims to _augment_ a variable or set of variables. In essence this aims to make implicit attributes explicit to that they are directly accessible. This often targeted at the automatic generation of linguistic annotations such as grammatical category (part-of-speech) or syntactic structure. 


-->
</section><section id="sec-td-merging" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="sec-td-merging">
<span class="header-section-number">7.5</span> Merging</h2>
<!--

Data: 

- CEDEL2 (row-wise)
  - Natives
  - Learners

- PEDC (column-wise)
  - Wordbank: word-level `category`` and `item_kind`
  - eLexicon: word-level word frequency measures

Consider: 

- Linguistic information:
  - Sentiment lexicons
  - Stopword lists
  - MRC word information to merge
  - English Lexicon project RT times: https://elexicon.wustl.edu/index.html
  - `lingtypology` package: ENNTT country/ language properties (?)

- Non-linguistic information:
  - Demographic information
  - Geographic information
  - Time information
  - ...

---

Useful language: 

Consider the `get_sentiments()` function which returns words which have been classified as 'positive'- or 'negative'-biased, if the lexicon is set to 'bing' [@Hu2004]. This function can be used to generate a new variable which can be used to measure the sentiment of a text. 

-->
<p>One final class of transformations that can be applied to curated datasets to enhance their informativeness for a research project is the process of merging two or more datasets. To merge datasets it is required that the datasets share one or more attributes. With a common attribute two datasets can be joined to coordinate the attributes of one dataset with the other effectively adding attributes and one dataset with extended information. Another approach is to join datasets with the goal of filtering one of the datasets given the matching attribute.</p>
<p>Let’s see this in practice.</p>
<!-- ADD.... -->
<p>We can also merge datasets that we generate in our analysis or that we import from other sources. This can be useful when there are cases in which a corpus has associated metadata that is contained in files separate from the corpus itself. This is the case for the Switchboard Dialogue Act Corpus.</p>
<p>Our existing, disfluency recoded, version includes the following variables.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-disfluencies_43f8a008dd8b4178feeb054d7efaa793">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># preview first 10 observations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <a href="https://catalog.ldc.upenn.edu/docs/LDC97S62/">online documentation page</a> provides a key file <code>caller_tab.csv</code> which contains speaker metadata information. Included in this <code>.csv</code> file is a column <code>caller_no</code> which contains the <code>speaker_id</code> we currently have in the <code>sdac_disfluencies</code> dataset. Let’s read this file into our R session renaming <code>caller_no</code> to <code>speaker_id</code> to prepare to join these datasets.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-meta-read_4557ea371eef3a1f192417fbe1edcb45">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_speaker_meta</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read_csv</span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="st">"https://catalog.ldc.upenn.edu/docs/LDC97S62/caller_tab.csv"</span>,</span>
<span>    col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"speaker_id"</span>, <span class="co"># changed from `caller_no`</span></span>
<span>      <span class="st">"pin"</span>,</span>
<span>      <span class="st">"target"</span>,</span>
<span>      <span class="st">"sex"</span>,</span>
<span>      <span class="st">"birth_year"</span>,</span>
<span>      <span class="st">"dialect_area"</span>,</span>
<span>      <span class="st">"education"</span>,</span>
<span>      <span class="st">"ti"</span>,</span>
<span>      <span class="st">"payment_type"</span>,</span>
<span>      <span class="st">"amt_pd"</span>,</span>
<span>      <span class="st">"con"</span>,</span>
<span>      <span class="st">"remarks"</span>,</span>
<span>      <span class="st">"calls_deleted"</span>,</span>
<span>      <span class="st">"speaker_partition"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">sdac_speaker_meta</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now to join the <code>sdac_disfluencies</code> and <code>sdac_speaker_meta</code>. Let’s turn to <code>left_join()</code> again as we want to retain all the observations (rows) from <code>sdac_disfluencies</code> and add the columns for <code>sdac_speaker_meta</code> where the <code>speaker_id</code> column values match.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-join-metadata_c6ec8b2c761cd4bf60fdcf9a81327a43">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">sdac_disfluencies</span>, <span class="va">sdac_speaker_meta</span><span class="op">)</span> <span class="co"># join by ``speaker_id`</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">sdac_disfluencies</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now there are some metadata columns we may want to keep and others we may want to drop as they may not be of importance for our analysis. I’m going to assume that we want to keep <code>sex</code>, <code>birth_year</code>, <code>dialect_area</code>, and <code>education</code> and drop the rest.</p>
<div class="cell" data-hash="transform-datasets_cache/html/td-sdac-disfluencies-subset-cols_a5aad792170ac0cb2b4e456dc3d646a6">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdac_disfluencies</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">doc_id</span><span class="op">:</span><span class="va">count</span>, <span class="va">sex</span><span class="op">:</span><span class="va">education</span><span class="op">)</span> <span class="co"># subset key columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-td-sdac-disfluencies-meta-preview" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="First 10 observations for the `sdac_disfluencies` dataset with speaker metadata." data-hash="transform-datasets_cache/html/tbl-td-sdac-disfluencies-meta-preview_4a795d4e8cd0f7e9240f5843452623dd">

</div>
</section><section id="summary" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="summary">Summary</h2>
<p>In this chapter we covered the process of transforming datasets. The goal is to manipulate the curated dataset to make it align better for analysis. There are four general types of transformation steps: normalization, recoding, tokenization, generation, and merging. In any given research project some or all of these steps will be employed –but not necessarily in the order presented in this chapter. Furthermore, there may also be various datasets generated in at this stage each with a distinct analysis focus in mind. In any case, it is important to write these datasets to disk and to document them according to reproducible research principles.</p>
<p>This chapter concludes the section on data/ dataset preparation. The next section we turn to analyzing datasets. This is the stage where we interrogate the datasets to derive knowledge and insight either through exploratory, predictive, or inferential methods.</p>
</section><section id="activities" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="activities">Activities</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-regular fa-file-code" aria-label="file-code"></i> Recipe</strong></p>
<!-- Understand, apply, and analyze verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] update recipe -->
<p><strong>What</strong>: <a href="https://lin380.github.io/tadr/articles/recipe_8.html">Dataset manipulation: tokenization and joining datasets</a><br><strong>How</strong>: Read Recipe 8 and participate in the Hypothes.is online social annotation.<br><strong>Why</strong>: To work with to primary types of transformations, tokenization and joins. Tokenization is the process of recasting textual units as smaller textual units. The process of joining datasets aims to incorporate other datasets to augment or filter the dataset of interest.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong><i class="fa-solid fa-flask" aria-label="flask"></i> Lab</strong></p>
<!-- Analyze, evaluate, and create verbs: https://tips.uark.edu/blooms-taxonomy-verb-chart/ -->
<!-- [ ] update lab -->
<p><strong>What</strong>: <a href="https://github.com/lin380/lab_8">Dataset manipulation: tokenization and joining datasets</a><br><strong>How</strong>: Clone, fork, and complete the steps in Lab 8.<br><strong>Why</strong>: To gain experience working with coding strategies for transforming datasets using tidyverse functions and regular expressions, practice reading/ writing data from/ to disk, and implement organizational strategies for organizing and documenting a dataset in reproducible fashion.</p>
</div>
</div>
</div>
</section><section id="questions" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="questions">Questions</h2>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="fa-solid fa-wrench" aria-label="wrench"></i> <strong>Conceptual questions</strong></p>
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="fa-solid fa-wrench" aria-label="wrench"></i> <strong>Technical questions</strong></p>
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-R-rsyntax" class="csl-entry" role="listitem">
Welbers, Kasper, and Wouter van Atteveldt. 2022. <em>Rsyntax: Extract Semantic Relations from Text by Querying and Reshaping Syntax</em>. <a href="https://CRAN.R-project.org/package=rsyntax">https://CRAN.R-project.org/package=rsyntax</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./curate-datasets.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate datasets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./analysis.html" class="pagination-link">
        <span class="nav-page-text">Analysis</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Quantitative Text Analysis for Linguistics - 7&nbsp; Transform datasets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./analysis.html" rel="next">
<link href="./curate-datasets.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./preparation.html">Preparation</a></li><li class="breadcrumb-item"><a href="./transform-datasets.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Quantitative Text Analysis for Linguistics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./orientation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Orientation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text analysis in context</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./understanding-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Understanding data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./approaching-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Approaching analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./framing-research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Framing research</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acquire-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Acquire data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./curate-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate data(sets)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transform-datasets.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Reporting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collaboration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Collaboration</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#normalize" id="toc-normalize" class="nav-link active" data-scroll-target="#normalize"><span class="header-section-number">7.1</span> Normalize</a></li>
  <li><a href="#td-recode" id="toc-td-recode" class="nav-link" data-scroll-target="#td-recode"><span class="header-section-number">7.2</span> Recode</a></li>
  <li><a href="#generate" id="toc-generate" class="nav-link" data-scroll-target="#generate"><span class="header-section-number">7.3</span> Generate</a></li>
  <li><a href="#merge" id="toc-merge" class="nav-link" data-scroll-target="#merge"><span class="header-section-number">7.4</span> Merge</a></li>
  <li><a href="#documentation" id="toc-documentation" class="nav-link" data-scroll-target="#documentation"><span class="header-section-number">7.5</span> Documentation</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#activities" id="toc-activities" class="nav-link" data-scroll-target="#activities">Activities</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-transform-datasets" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transform datasets</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><!--

Content:

Exercises:

- [ ] add concept questions to Activities
- [ ] add exercises to Activities
- [ ] add thought questions/ case studies to prose sections

Formatting:

- [ ] Add a description of the importance of the unit of observation in the transformation process.
    - Note: that some units of obsevation will require that the data have more textual context (e.g. syntactic parsing) than others (e.g. word frequencies). It is important that the presntation of the transformation steps are no necessarily in the order in which they are applied.
 --><blockquote class="blockquote">
<p>Nothing is lost. Everything is transformed.</p>
<p>— Michael Ende, The Neverending Story</p>
</blockquote>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Keys
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>What is the role of data transformation in a text analysis project?</li>
<li>What are the general processes for preparing datasets for analysis?</li>
<li>How do each of these general processes transform datasets?</li>
</ul>
</div>
</div>
<p>In this chapter we turn our attention to the process of moving a curated dataset one step closer to analysis. Where in the process of curating data into a dataset the goal was to derived a tidy dataset that contained the main relational characteristics of the data for our text analysis project, the transformation step refines and potential expands these characteristics such that they are more in line with our analysis aims. In this chapter I have grouped various transformation steps into four categories: normalization, recoding, generation, and merging. It is of note that the these categories have been ordered and are covered separately for descriptive reasons. In practice the ordering of which transformation to apply before another is highly idiosyncratic and requires that the researcher evaluate the characteristics of the dataset and the desired results.</p>
<p>Furthermore, since in any given project there may be more than one analysis that may be performed on the data, there may be distinct transformation steps which correspond to each analysis approach. Therefore it is possible that there are more than one transformed dataset created from the curated dataset. This is one of the reasons that we create a curated dataset instead of derived a transformed dataset from the original data. The curated dataset serves as a point of departure from which multiple transformational methods can derive distinct formats for distinct analyses.</p>
<p>Let’s now turn to demonstrations of some common transformational steps using datasets with which we are now familiar.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Swirl
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What</strong>: <a href="https://github.com/lin380/swirl">Data manipulation</a><br><strong>How</strong>: In the R Console pane load <code>swirl</code>, run <code>swirl()</code>, and follow prompts to select the lesson.<br><strong>Why</strong>: To learn more about data frame objects in R and how to manipulate them using the <code>dplyr</code> package.</p>
</div>
</div>
<section id="normalize" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="normalize">
<span class="header-section-number">7.1</span> Normalize</h2>
<!-- Consider: 

I will need to think about how to balance what takes place at the curation stage and what happens in the transformation stage.

I think that the curation stage should be focused on the creation of a tidy dataset that is ready for analysis. This may include things that I have added here such as tokenization and lemmatization. If the analysis unit is clear, say for a IDA approach, then it is fine to move the data curation process in that direction. 

What is text normalization? Text normalization includes the process of removing artifacts from the text that are not of interest to the analysis. This may include removing non-linguistic metadata, removing non-speech lines, removing punctuation, and removing stop words -- depending on the target unit(s) of analysis. 

> So I might to add text normalization to the curation stage and then add the other three categories to the transformation stage.

What is data recoding for text analysis? Data recoding is the process of transforming the values of a variable or set of variables such that they are more in line with the analysis aims. This may include recoding values of a variable to a different value, recoding values of a variable to a different variable, and recoding values of a variable to a new variable.

What is data merging for text analysis? Data merging is the process of combining two or more datasets into a single dataset. This may include merging datasets that are in the same format, merging datasets that are in different formats, and merging datasets that are in different formats but have the same structure. For example deriving new variables from a dictionary, deriving new variables from a related dataset (lexical decision latencies), deriving new variables from a lexicon (sentiment, concreteness, etc.), 

What is data generation for text analysis? Data generation is the process of deriving new variables that stems from the inclusion of other resources. This may inclde deriving new variables from a tool such as a sentiment analyzer or syntactic parser (part of speech, dependency, etc.).

 -->
<p>The process of normalizing datasets in essence is to santize the values of variable or set of variables such that there are no artifacts that will contaminate subsequent processing. It may be the case that non-linguistic metadata may require normalization but more often than not linguistic information is the most common target for normalization as text often includes artifacts from the acquisition process which will not be desired in the analysis.</p>
<p><strong>Europarle Corpus</strong></p>
<p>Consider the curated Europarle Corpus dataset. I will read in the dataset. Since the dataset is quite large, I have also subsetted the dataset keeping only the first 1,000 observations for each of value of <code>type</code> for demonstration purposes.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-europarle-normalize-read-subset-show_1c7382647763ab5effba29e95687c597">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarle</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/derived/europarle/europarle_curated.csv"</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># read curated dataset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">sentence_id</span> <span class="op">&lt;</span> <span class="fl">1001</span><span class="op">)</span> <span class="co"># keep first 1000 observations for each type</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">europarle</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-europarle-normalize-read-subset-run_7b7bdc62da510c2928e9753eb9460e1c">
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 2,000
#&gt; Columns: 3
#&gt; $ type        &lt;chr&gt; "Source", "Target", "Source", "Target", "Source", "Target"…
#&gt; $ sentence_id &lt;dbl&gt; 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, …
#&gt; $ sentence    &lt;chr&gt; "Reanudación del período de sesiones", "Resumption of the …</code></pre>
</div>
</div>
<p>Simply looking at the first 14 lines of this dataset, we can see that if our goal is to work with the transcribed (‘Source’) and translated (‘Target’) language, there are lines which do not appear to be of interest.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-europarle-preview-1_53e55ef631dac76e2ed282931ee3ed32">
<div class="cell-output-display">
<div id="tbl-td-europarle-preview-1" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.1: Europarle Corpus curated dataset preview.</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 92%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">type</th>
<th style="text-align: right;">sentence_id</th>
<th style="text-align: left;">sentence</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Reanudación del período de sesiones</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Resumption of the session</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Declaro reanudado el período de sesiones del Parlamento Europeo, interrumpido el viernes 17 de diciembre pasado, y reitero a Sus Señorías mi deseo de que hayan tenido unas buenas vacaciones.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">I declare resumed the session of the European Parliament adjourned on Friday 17 December 1999, and I would like once again to wish you a happy new year in the hope that you enjoyed a pleasant festive period.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Como todos han podido comprobar, el gran “efecto del año 2000” no se ha producido. En cambio, los ciudadanos de varios de nuestros países han sido víctimas de catástrofes naturales verdaderamente terribles.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Although, as you will have seen, the dreaded ‘millennium bug’ failed to materialise, still the people in a number of countries suffered a series of natural disasters that truly were dreadful.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">Sus Señorías han solicitado un debate sobre el tema para los próximos días, en el curso de este período de sesiones.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">You have requested a debate on this subject in the course of the next few days, during this part-session.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">A la espera de que se produzca, de acuerdo con muchos colegas que me lo han pedido, pido que hagamos un minuto de silencio en memoria de todas las víctimas de las tormentas, en los distintos países de la Unión Europea afectados.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">In the meantime, I should like to observe a minute’ s silence, as a number of Members have requested, on behalf of all the victims concerned, particularly those of the terrible storms, in the various countries of the European Union.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Invito a todos a que nos pongamos de pie para guardar un minuto de silencio.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Please rise, then, for this minute’ s silence.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">(El Parlamento, de pie, guarda un minuto de silencio)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">(The House rose and observed a minute’ s silence)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><code>sentence_id</code> 1 appears to be title and <code>sentence_id</code> 7 reflects description of the parliamentary session. Both of these are artifacts that we would like to remove from the dataset.</p>
<p>To remove these lines we can turn to the programming strategies we’ve previously worked with. Namely we will use <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> to filter observations in combination with <code>str_detect()</code> to detect matches for some pattern that is indicative of these lines that we want to remove and not of the other lines that we want to keep.</p>
<p>Before we remove any lines, let’s try craft a search pattern to identify these lines, and exclude the lines we will want to keep. Condition one is lines which start with an opening parenthesis <code>(</code>. Condition two is lines that do not end in standard sentence punctuation (<code>.</code>, <code>!</code>, or <code>?</code>). I’ve added both conditions to one <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> using the logical <em>OR</em> operator (<code>|</code>) to ensure that either condition is matched in the output.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-europarle-search-non-speech_b684ddf47166ae0549be7068deb48b92">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Identify non-speech lines</span></span>
<span><span class="va">europarle</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">sentence</span>, <span class="st">"^\\("</span><span class="op">)</span> <span class="op">|</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">sentence</span>, <span class="st">"[^.!?]$"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># filter lines that detect a match for either condition 1 or 2</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># random sample of 10 observations</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-europarle-search-non-speech" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.2: Non-speech lines in the Europarle dataset.</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 93%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">type</th>
<th style="text-align: right;">sentence_id</th>
<th style="text-align: left;">sentence</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">669</td>
<td style="text-align: left;">(El Acta queda aprobada)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">66</td>
<td style="text-align: left;">Orden de los trabajos</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">672</td>
<td style="text-align: left;">A5-0069/1999 del Sr.&nbsp;von Wogau, en nombre de la Comisión de Asuntos Económicos y Monetarios sobre el Libro Blanco de la Comisión sobre la modernización de las normas de aplicación de los artículos 85 y 86 del Tratado CE (COM(1999) 101 - C5-0105/1999 - 1999/2108(COS));</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">69</td>
<td style="text-align: left;">Relating to Wednesday:</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">672</td>
<td style="text-align: left;">The next item is the joint debate on the following reports:</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">675</td>
<td style="text-align: left;">A5-0087/1999 by Mr Jonckheer, on behalf of the Committee on Economic and Monetary Affairs, on the seventh survey on state aid in the European Union in the manufacturing and certain other sectors. [COM(1999) 148 - C5-0107/1999 - 1999/2110(COS)] (Report 1995-1997);</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">110</td>
<td style="text-align: left;">(El Parlamento rechaza la propuesta por 164 votos a favor, 166 votos en contra y 7 abstenciones)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">671</td>
<td style="text-align: left;">De conformidad con el orden del día, se procede al debate conjunto de los siguientes informes:</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">673</td>
<td style="text-align: left;">A5-0078/1999 del Sr.&nbsp;Rapkay, en nombre de la Comisión de Asuntos Económicos y Monetarios, sobre el XXVIII Informe de la Comisión Europea sobre la política de competencia - 1998 (SEC(1999) 743 - C5-121/1999 - 1999/2124(COS));</td>
</tr>
<tr class="even">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">69</td>
<td style="text-align: left;">Miércoles :</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Since this search appears to match lines that we do not want to preserve, let’s move now to eliminate these lines from the dataset. To do this we will use the same regular expression patterns, but now each condition will have it’s own <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> call and the <code>str_detect()</code> will be negated with a prefixed <code>!</code>.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-europarle-filter-non-speech_ca3355f335f8fab71378a78a3fd75753">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarle</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarle</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">sentence</span>, pattern <span class="op">=</span> <span class="st">"^\\("</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove lines starting with (</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">sentence</span>, pattern <span class="op">=</span> <span class="st">"[^.!?]$"</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove lines not ending in ., !, or ?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at the first 14 lines again, now that we have eliminated these artifacts.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-europarle-preview-2_77b7d714c0b808f3e4585ca75f38d38c">
<div class="cell-output-display">
<div id="tbl-td-europarle-preview-2" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.3: Europarle Corpus non-speech lines removed.</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 92%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">type</th>
<th style="text-align: right;">sentence_id</th>
<th style="text-align: left;">sentence</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Declaro reanudado el período de sesiones del Parlamento Europeo, interrumpido el viernes 17 de diciembre pasado, y reitero a Sus Señorías mi deseo de que hayan tenido unas buenas vacaciones.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">I declare resumed the session of the European Parliament adjourned on Friday 17 December 1999, and I would like once again to wish you a happy new year in the hope that you enjoyed a pleasant festive period.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Como todos han podido comprobar, el gran “efecto del año 2000” no se ha producido. En cambio, los ciudadanos de varios de nuestros países han sido víctimas de catástrofes naturales verdaderamente terribles.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Although, as you will have seen, the dreaded ‘millennium bug’ failed to materialise, still the people in a number of countries suffered a series of natural disasters that truly were dreadful.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">Sus Señorías han solicitado un debate sobre el tema para los próximos días, en el curso de este período de sesiones.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">You have requested a debate on this subject in the course of the next few days, during this part-session.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">A la espera de que se produzca, de acuerdo con muchos colegas que me lo han pedido, pido que hagamos un minuto de silencio en memoria de todas las víctimas de las tormentas, en los distintos países de la Unión Europea afectados.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">In the meantime, I should like to observe a minute’ s silence, as a number of Members have requested, on behalf of all the victims concerned, particularly those of the terrible storms, in the various countries of the European Union.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Invito a todos a que nos pongamos de pie para guardar un minuto de silencio.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Please rise, then, for this minute’ s silence.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Señora Presidenta, una cuestión de procedimiento.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Madam President, on a point of order.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Source</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Sabrá usted por la prensa y la televisión que se han producido una serie de explosiones y asesinatos en Sri Lanka.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">You will be aware from the press and television that there have been a number of bomb explosions and killings in Sri Lanka.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>One further issue that we may want to resolve concerns the fact that there are whitespaces between possessive forms (i.e.&nbsp;“minute’ s silence”). In this case we can employ <code>str_replace_all()</code> inside the <code>mutate()</code> function to overwrite the <code>sentence</code> values that match an apostrophe <code>'</code> with whitespace (<code>\\s</code>) before <code>s</code>.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-europarle-remove-whitespace_d1d80a2fb1f93df12cf7b6a0a0cd5917">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarle</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarle</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sentence <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span>string <span class="op">=</span> <span class="va">sentence</span>, </span>
<span>                                    pattern <span class="op">=</span> <span class="st">"'\\ss"</span>, </span>
<span>                                    replacement <span class="op">=</span> <span class="st">"'s"</span><span class="op">)</span><span class="op">)</span> <span class="co"># replace ' s with `s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have normalized text in the <code>sentence</code> column in the Europarle dataset.</p>
<p><strong>Last FM Lyrics</strong></p>
<!-- (stanza separation, other) -->
<p>Let’s look at another dataset we have worked with during this coursebook: the Lastfm lyrics. Reading in the <code>lastfm_curated</code> dataset from the <code>data/derived/</code> directory we can see the structure for the curated structure.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-lastfm-read-show_efdf247e08c152a23b824c5c903d9afd">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lastfm</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/derived/lastfm/lastfm_curated.csv"</span><span class="op">)</span> <span class="co"># read in lastfm_curated dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-lastfm-read-preview_c0fd7db8072cdc8f6bd44ce3fc6a7c4c">
<div class="cell-output-display">
<div id="tbl-td-lastfm-read-preview" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.4: Last fm lyrics dataset preview with one artist/ song per genre and the <code>lyrics</code> text truncated at 200 characters for display purposes.</caption>
<colgroup>
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 83%">
<col style="width: 3%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">lyrics</th>
<th style="text-align: left;">genre</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">Have a little love on a little honeymoonYou got a little dish and you got a little spoonA little bitty house and a little bitty yardA little bitty dog and a little bitty car Well, it’s alright to b…</td>
<td style="text-align: left;">country</td>
</tr>
<tr class="even">
<td style="text-align: left;">50 Cent</td>
<td style="text-align: left;">In Da Club</td>
<td style="text-align: left;">Go, go, go, go, go, goGo, shortyIt’s your birthdayWe gon’ party like it’s your birthdayWe gon’ sip Bacardi like it’s your birthdayAnd you know we don’t give a fuck it’s not your birthday You can fi…</td>
<td style="text-align: left;">hip-hop</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Black Sabbath</td>
<td style="text-align: left;">Paranoid</td>
<td style="text-align: left;">Finished with my woman’Cause she couldn’t help me with my mindPeople think I’m insaneBecause I am frowning all the time All day long, I think of thingsBut nothing seems to satisfyThink I’ll lose my…</td>
<td style="text-align: left;">metal</td>
</tr>
<tr class="even">
<td style="text-align: left;">a-ha</td>
<td style="text-align: left;">Take On Me</td>
<td style="text-align: left;">Talking awayI don’t know whatWhat to sayI’ll say it anywayToday is another day to find youShying awayOh, I’ll be coming for your love, okay? Take On Me (Take On Me)Take me on (Take On Me)I’ll be go…</td>
<td style="text-align: left;">pop</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3 Doors Down</td>
<td style="text-align: left;">Here Without You</td>
<td style="text-align: left;">A hundred days have made me olderSince the last time that I saw your pretty faceA thousand lies have made me colderAnd I don’t think I can look at this the same But all the miles that separateDisap…</td>
<td style="text-align: left;">rock</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>There are a few things that we might want to clean out of the <code>lyrics</code> column’s values. First, there are lines from the original webscrape where the end of one stanza runs into the next without whitespace between them (i.e.&nbsp;“honeymoonYou”). These reflect contiguous end-new line segments where stanzas were joined in the curation process. Second, we see that there are what appear to be backing vocals which appear between parentheses (i.e.&nbsp;“(Take On Me)”).</p>
<p>In both cases we will use <code>mutate()</code>. With contiguous end-new line segments we will use <code>str_replace_all()</code> inside and for backing vocals in parentheses we will use <code>str_remove_all()</code>.</p>
<p>The pattern to match for end-new lines from the stanzas will use some regular expression magic. The base pattern includes finding a pair of lowercase-uppercase letters (i.e.&nbsp;“nY”, in “honeymoo<strong>nY</strong>ou”). For this we can use the pattern <code>[a-z][A-Z]</code>. To replace this pattern using the lowercase letter then a space and then the uppercase letter we take advantage of the grouping syntax in regular expressions <code>(...)</code>. So we add parentheses around the two groups to capture like this <code>([a-z])([A-Z])</code>. In the replacement argument of the <code>str_replace_all()</code> function we then specify to use the captured groups in the order they appear <code>\\1</code> for the lowercase letter match and <code>\\2</code> for the uppercase letter match.</p>
<p>Now, I’ve looked more extensively at the <code>lyrics</code> column and found that there are other combinations that are joined between stanzas. Namely that <code>'</code>, <code>!</code>, <code>,</code>, <code>)</code>, <code>?</code>, and <code>I</code> also may precede the uppercase letter. To make sure we capture these possibilities as well I’ve updated the regular expression to <code>([a-z'!,.)?I])([A-Z])</code>.</p>
<p>Now to remove the backing vocals, the regex pattern is <code>\\(.+?\\)</code> –match the parentheses and everything within the parentheses. The added <code>?</code> after the <code>+</code> operator is what is known as a ‘lazy’ operator. This specifies that the <code>.+</code> will match the minimal string that is enclosed by the trailing <code>)</code>. If we did not include this then we would get matches that span from the first parenthesis <code>(</code> all the way to the last, which would match real lyrics, not just the backing vocals.</p>
<p>Putting this to work let’s clean the <code>lyrics</code> column.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-lastfm-clean-end-lines_7a475388b6ce26e704b07e68cf03e703">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lastfm</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">lastfm</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lyrics <span class="op">=</span> </span>
<span>           <span class="fu">str_replace_all</span><span class="op">(</span>string <span class="op">=</span> <span class="va">lyrics</span>, </span>
<span>                           pattern <span class="op">=</span> <span class="st">"([a-z'!,.)?I])([A-Z])"</span>, <span class="co"># find contiguous end/ new line segments</span></span>
<span>                           replacement <span class="op">=</span> <span class="st">"\\1 \\2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># replace with whitespace between</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>lyrics <span class="op">=</span> <span class="fu">str_remove_all</span><span class="op">(</span><span class="va">lyrics</span>, <span class="st">"\\(.+?\\)"</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove backing vocals (Take On Me)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-lastfm-clean-end-lines-preview_11a41a5c6d9f45f8775084d592d3aaf0">
<div class="cell-output-display">
<div id="tbl-td-lastfm-clean-end-lines-preview" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.5: Last fm lyrics with cleaned lyrics…</caption>
<colgroup>
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 83%">
<col style="width: 3%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">lyrics</th>
<th style="text-align: left;">genre</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">Have a little love on a little honeymoon You got a little dish and you got a little spoon A little bitty house and a little bitty yard A little bitty dog and a little bitty car Well, it’s alright t…</td>
<td style="text-align: left;">country</td>
</tr>
<tr class="even">
<td style="text-align: left;">50 Cent</td>
<td style="text-align: left;">In Da Club</td>
<td style="text-align: left;">Go, go, go, go, go, go Go, shorty It’s your birthday We gon’ party like it’s your birthday We gon’ sip Bacardi like it’s your birthday And you know we don’t give a fuck it’s not your birthday You c…</td>
<td style="text-align: left;">hip-hop</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Black Sabbath</td>
<td style="text-align: left;">Paranoid</td>
<td style="text-align: left;">Finished with my woman’ Cause she couldn’t help me with my mind People think I’m insane Because I am frowning all the time All day long, I think of things But nothing seems to satisfy Think I’ll lo…</td>
<td style="text-align: left;">metal</td>
</tr>
<tr class="even">
<td style="text-align: left;">a-ha</td>
<td style="text-align: left;">Take On Me</td>
<td style="text-align: left;">Talking away I don’t know what What to say I’ll say it anyway Today is another day to find you Shying away Oh, I’ll be coming for your love, okay? Take On Me Take me on I’ll be gone In a day or t…</td>
<td style="text-align: left;">pop</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3 Doors Down</td>
<td style="text-align: left;">Here Without You</td>
<td style="text-align: left;">A hundred days have made me older Since the last time that I saw your pretty face A thousand lies have made me colder And I don’t think I can look at this the same But all the miles that separate D…</td>
<td style="text-align: left;">rock</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now given the fact that songs are poems, there are many lines that are not complete sentences so there is no practical way to try to segment these into grammatical sentence units. So in this case, this seems like a good stopping point for normalizing the lastfm dataset.</p>
</section><section id="td-recode" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="td-recode">
<span class="header-section-number">7.2</span> Recode</h2>
<!-- Consider:

The process of recoding aims to _recast_ the values of a variable or set of variables to a new variable or set of variables to enable more direct access. This may include extracting values from a variable, stemming or lemmatization of words, tokenization of linguistic forms (words, ngrams, sentences, etc.), calculating the lengths of linguistic units, calculating type-token ratios, syntactic complexity, and/ or removing variables that will not be used in the analysis, etc.
-->
<p>Normalizing text can be seen as an extension of dataset curation to some extent in that the structure of the dataset is maintained. In both the Europarle and Lastfm cases we saw this to be true. In the case of recoding, and other transformational steps, the aim will be to modify the dataset structure either by rows, columns, or both. Recoding processes can be characterized by the creation of structural changes which are derived from values in variables effectively recasting values as new variables to enable more direct access in our analyses.</p>
<p><strong>Switchboard Dialogue Act Corpus</strong></p>
<p>The Switchboard Dialogue Act Corpus dataset that was curated in the previous chapter contains a number of variables describing conversations between speakers of American English.</p>
<p>Let’s read in this dataset and take a closer look.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-sdac-read-show_dcde8ee497cb6bd20b8db2cc1aa256c8">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/derived/sdac/sdac_curated.csv"</span><span class="op">)</span> <span class="co"># read curated dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Among a number of metadata variables, curated dataset includes the <code>utterance_text</code> column which contains dialogue from the conversations interleaved with a <a href="https://staff.fnwi.uva.nl/r.fernandezrovira/teaching/DM-materials/DFL-book.pdf">disfluency annotation scheme</a>.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-sdac-preview-curated-dataset_a572e12af48a65b33615926537319c7b">
<div class="cell-output-display">
<div id="tbl-td-sdac-preview-curated-dataset" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.6: 20 randomly sampled lines of the SDAC curated dataset.</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 80%">
<col style="width: 3%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">doc_id</th>
<th style="text-align: left;">damsl_tag</th>
<th style="text-align: left;">speaker</th>
<th style="text-align: right;">turn_num</th>
<th style="text-align: right;">utterance_num</th>
<th style="text-align: left;">utterance_text</th>
<th style="text-align: right;">speaker_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2953</td>
<td style="text-align: left;">sd</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">127</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">{C and } it is not going to happen that way. /</td>
<td style="text-align: right;">1229</td>
</tr>
<tr class="even">
<td style="text-align: right;">3688</td>
<td style="text-align: left;">%</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">{D Well, } we’ve just, {F uh, } - /</td>
<td style="text-align: right;">1478</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2800</td>
<td style="text-align: left;">sd</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">{F Uh, } {C and } they have become, [ or, + ] also [ a, + a ] real bother sometimes. /</td>
<td style="text-align: right;">1069</td>
</tr>
<tr class="even">
<td style="text-align: right;">3266</td>
<td style="text-align: left;">ba</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;"><gasp> {F Oh, } that poor child. /</gasp></td>
<td style="text-align: right;">1373</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2524</td>
<td style="text-align: left;">b</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Uh-huh. /</td>
<td style="text-align: right;">1107</td>
</tr>
<tr class="even">
<td style="text-align: right;">2137</td>
<td style="text-align: left;">sd</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">{D Well, } it seems that there’s some things like [ the, + {F uh, } the ] programs at least just go around [ [ and, + and, ] + and ] clean up streets [ [ and, + and, ] + and ] pick up trash and even aluminum cans and some of these kinds of things. /</td>
<td style="text-align: right;">1039</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2821</td>
<td style="text-align: left;">b</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">172</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;"># Yeah. # /</td>
<td style="text-align: right;">1253</td>
</tr>
<tr class="even">
<td style="text-align: right;">4032</td>
<td style="text-align: left;">sd</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">{F Um, } I like to play tennis in the –</td>
<td style="text-align: right;">1532</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2662</td>
<td style="text-align: left;">b</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Yeah. /</td>
<td style="text-align: right;">1069</td>
</tr>
<tr class="even">
<td style="text-align: right;">2967</td>
<td style="text-align: left;">sd</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">{F Uh, } which was a, - /</td>
<td style="text-align: right;">1072</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3168</td>
<td style="text-align: left;">sv</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">{D Well, } {C and, } {D you know, } if they do find someone [ who, + who ] is, {F uh, } having a problem with drugs /</td>
<td style="text-align: right;">1361</td>
</tr>
<tr class="even">
<td style="text-align: right;">2589</td>
<td style="text-align: left;">aa</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">I definitely agree. /</td>
<td style="text-align: right;">1093</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2874</td>
<td style="text-align: left;">b</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">uh-huh. /</td>
<td style="text-align: right;">1258</td>
</tr>
<tr class="even">
<td style="text-align: right;">2482</td>
<td style="text-align: left;">%</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">149</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">They … -/</td>
<td style="text-align: right;">1209</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3453</td>
<td style="text-align: left;">sd</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">– {C because } it’s a V Six, /</td>
<td style="text-align: right;">1383</td>
</tr>
<tr class="even">
<td style="text-align: right;">2924</td>
<td style="text-align: left;">b</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">{F Oh } yeah, /</td>
<td style="text-align: right;">1028</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3019</td>
<td style="text-align: left;">sv</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">148</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">I think that is, - /</td>
<td style="text-align: right;">1264</td>
</tr>
<tr class="even">
<td style="text-align: right;">3095</td>
<td style="text-align: left;">sd</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">119</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">{D Well, } I am too. /</td>
<td style="text-align: right;">1263</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3464</td>
<td style="text-align: left;">sd</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">I think it’s put out by Landmark Productions, the same people who put out CHARIOTS OF FIRE. /</td>
<td style="text-align: right;">1446</td>
</tr>
<tr class="even">
<td style="text-align: right;">2724</td>
<td style="text-align: left;">sd</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">I didn’t know that, [ and, + ] {D you know, } until I came down here, and,</td>
<td style="text-align: right;">1237</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Let’s drop a few variables from our dataset to rein in our focus. I will keep the <code>doc_id</code>, <code>speaker_id</code>, and <code>utterance_text</code>.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-sdac-simplified_5c6c68256efa3465cd5df93d54f7b699">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_simplified</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">sdac</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">speaker_id</span>, <span class="va">utterance_text</span><span class="op">)</span> <span class="co"># columns to retain</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-sdac-simple-preview_8a5dab72d5e5bf940320e602613daf44">
<div class="cell-output-display">
<div id="tbl-td-sdac-simple-preview" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.7: First 10 lines of the simplified SDAC curated dataset.</caption>
<colgroup>
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 80%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">doc_id</th>
<th style="text-align: right;">speaker_id</th>
<th style="text-align: left;">utterance_text</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Okay. /</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">{D So, }</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">[ [ I guess, +</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">What kind of experience [ do you, + do you ] have, then with child care? /</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think, ] + {F uh, } I wonder ] if that worked. /</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Does it say something? /</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think it usually does. /</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">You might try, {F uh, } /</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I don’t know, /</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">hold it down a little longer, /</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In this disfluency annotation system, there are various conventions used for non-sentence elements. If say, for example, a researcher were to be interested in understanding the use of filled pauses (‘uh’ or ‘uh’), the aim would be to identify those lines where the <code>{F ...}</code> annotation is used around the utterances ‘uh’ and ‘um’.</p>
<p>To do this we turn to the <code>str_count()</code> function. This function will count the number of matches found for a pattern. We can use a regular expression to identify the pattern of interest which is all the instances of <code>{F</code> followed by either <code>uh</code> or <code>um</code>. Since the disfluencies may start an utterance, and therefore be capitalized we need to formulate a regular expression which allows for either <code>U</code> or <code>u</code> for each disfluency type. The result from each disfluency match will be added to a new column. To create a new column we will wrap each <code>str_count()</code> with <code>mutate()</code> and give the new column a meaningful name. In this case I’ve opted for <code>uh</code> and <code>um</code>.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-sdac-count-disfluencies_7201f5834bb3f0e7806a69b6df2fc95b">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">sdac_simplified</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>uh <span class="op">=</span> <span class="fu">str_count</span><span class="op">(</span><span class="va">utterance_text</span>, <span class="st">"\\{F [Uu]h"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># match {F Uh or {F uh}</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>um <span class="op">=</span> <span class="fu">str_count</span><span class="op">(</span><span class="va">utterance_text</span>, <span class="st">"\\{F [Uu]m"</span><span class="op">)</span><span class="op">)</span> <span class="co"># match {F Um or {F um}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-sdac-count-disfluencies-show_6d089c5a5e853ba93361b56429347d72">
<div class="cell-output-display">
<div id="tbl-td-sdac-count-disfluencies-show" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.8: First 20 lines of SDAC dataset with counts for the disfluencies ‘uh’ and ‘um’.</caption>
<colgroup>
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 75%">
<col style="width: 3%">
<col style="width: 3%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">doc_id</th>
<th style="text-align: right;">speaker_id</th>
<th style="text-align: left;">utterance_text</th>
<th style="text-align: right;">uh</th>
<th style="text-align: right;">um</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Okay. /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">{D So, }</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">[ [ I guess, +</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">What kind of experience [ do you, + do you ] have, then with child care? /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think, ] + {F uh, } I wonder ] if that worked. /</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Does it say something? /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think it usually does. /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">You might try, {F uh, } /</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I don’t know, /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">hold it down a little longer, /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">{C and } see if it, {F uh, } -/</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Okay <beep>. /</beep>
</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">&lt;<long pause="">&gt; {D Well, }</long>
</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">Okay /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">[ I, +</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Does it usually make a recording or s-, /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">{D Well, } I ] don’t remember. /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">It seemed like it did, /</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">{C but } <laughter> it might not. /</laughter>
</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">[ I guess + –</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now we have two new columns, <code>uh</code> and <code>um</code> which indicate how many times the relevant pattern was matched for a given utterance. By choosing to focus on disfluencies, however, we have made a decision to change the unit of observation from the utterance to the use of filled pauses (<code>uh</code> and <code>um</code>). This means that as the dataset stands, it is not in tidy format –where each observation corresponds to the observational unit. When datasets are misaligned in this particular way, there are in what is known as ‘wide’ format. What we want to do, then, is to restructure our dataset such that each row corresponds to the unit of observation –in this case each filled pause type.</p>
<p>To convert our current (wide) dataset to one where each filler type is listed and the counts are measured for each utterance we turn to the <code>pivot_longer()</code> function. This function creates two new columns, one in which the column names are listed and one for the values for each of the column names.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-sdac-disfluencies-longer_48c23bcc4525687f9b3f71e885f774f8">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">sdac_disfluencies</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"uh"</span>, <span class="st">"um"</span><span class="op">)</span>, <span class="co"># columns to convert</span></span>
<span>               names_to <span class="op">=</span> <span class="st">"filler"</span>, <span class="co"># column for the column names (i.e. filler types)</span></span>
<span>               values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="co"># column for the column values (i.e. counts)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-sdac-count-disfluencies-longer-show_660a30825e5515169c05783a4aafefe9">
<div class="cell-output-display">
<div id="tbl-td-sdac-count-disfluencies-longer-show" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.9: First 20 lines of SDAC dataset with tidy format for <code>fillers</code> as the unit of observation.</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 70%">
<col style="width: 6%">
<col style="width: 5%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">doc_id</th>
<th style="text-align: right;">speaker_id</th>
<th style="text-align: left;">utterance_text</th>
<th style="text-align: left;">filler</th>
<th style="text-align: right;">count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Okay. /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Okay. /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">{D So, }</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">{D So, }</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">[ [ I guess, +</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">[ [ I guess, +</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">What kind of experience [ do you, + do you ] have, then with child care? /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">What kind of experience [ do you, + do you ] have, then with child care? /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think, ] + {F uh, } I wonder ] if that worked. /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think, ] + {F uh, } I wonder ] if that worked. /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Does it say something? /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Does it say something? /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think it usually does. /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think it usually does. /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">You might try, {F uh, } /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">You might try, {F uh, } /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I don’t know, /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I don’t know, /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">hold it down a little longer, /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">hold it down a little longer, /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Last fm</strong></p>
<!-- tokenization (`unnest_tokens`, words/ n-grams) -->
<p>In the previous example, we used a matching approach to extract information embedded in one column of the dataset and recoded the dataset to maintain the fidelity between the particular unit of observation and the other metadata.</p>
<p>Another common approach for recoding datasets in text analysis projects involves recoding linguistic units as smaller units; a process known as tokenization.</p>
<p>Let’s return to the <code>lastfm</code> object we normalized earlier in the chapter to see the various ways one can choose to tokenize linguistic information.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-lastfm-clean-end-lines-preview-2_f3334ac71b799cb41a894ee61faf8e7c">
<div class="cell-output-display">
<div id="tbl-td-lastfm-clean-end-lines-preview-2" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.10: Last fm dataset with normalized lyrics.</caption>
<colgroup>
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 83%">
<col style="width: 3%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">lyrics</th>
<th style="text-align: left;">genre</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">Have a little love on a little honeymoon You got a little dish and you got a little spoon A little bitty house and a little bitty yard A little bitty dog and a little bitty car Well, it’s alright t…</td>
<td style="text-align: left;">country</td>
</tr>
<tr class="even">
<td style="text-align: left;">50 Cent</td>
<td style="text-align: left;">In Da Club</td>
<td style="text-align: left;">Go, go, go, go, go, go Go, shorty It’s your birthday We gon’ party like it’s your birthday We gon’ sip Bacardi like it’s your birthday And you know we don’t give a fuck it’s not your birthday You c…</td>
<td style="text-align: left;">hip-hop</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Black Sabbath</td>
<td style="text-align: left;">Paranoid</td>
<td style="text-align: left;">Finished with my woman’ Cause she couldn’t help me with my mind People think I’m insane Because I am frowning all the time All day long, I think of things But nothing seems to satisfy Think I’ll lo…</td>
<td style="text-align: left;">metal</td>
</tr>
<tr class="even">
<td style="text-align: left;">a-ha</td>
<td style="text-align: left;">Take On Me</td>
<td style="text-align: left;">Talking away I don’t know what What to say I’ll say it anyway Today is another day to find you Shying away Oh, I’ll be coming for your love, okay? Take On Me Take me on I’ll be gone In a day or t…</td>
<td style="text-align: left;">pop</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3 Doors Down</td>
<td style="text-align: left;">Here Without You</td>
<td style="text-align: left;">A hundred days have made me older Since the last time that I saw your pretty face A thousand lies have made me colder And I don’t think I can look at this the same But all the miles that separate D…</td>
<td style="text-align: left;">rock</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In the current <code>lastfm</code> dataset, the unit of observation is the lyrics for the entire artist, song, and genre combination. If, however, we would like to change the unit to say words, we would like each word used to appear on its own row, while still maintaining the other relevant attributes associated with each word.</p>
<p>The tidytext package includes a very useful function <code>unnest_tokens()</code> which allows us to tokenize some textual input into smaller linguistic units. The ‘unnest’ part of the the function name refers to the process of extracting the unit of interest while maintaining the other relevant attributes. Let’s see this in action.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-lastfm-tokenize-words_3207dfd90827fd600799bd78fa9103d3">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lastfm</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">unnest_tokens</span><span class="op">(</span>output <span class="op">=</span> <span class="va">word</span>, <span class="co"># column for tokenized output</span></span>
<span>                input <span class="op">=</span> <span class="va">lyrics</span>, <span class="co"># input column</span></span>
<span>                token <span class="op">=</span> <span class="st">"words"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># tokenize unit type</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># preview first 10 lines</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-lastfm-tokenize-words" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.11: First 10 observations for lastfm dataset tokenized by words.</caption>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">word</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">have</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">love</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">on</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">honeymoon</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">you</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">got</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can see from the output, each word appears on a separate line in the order of appearance in the input text (<code>lyrics</code>). Furthermore, the output is in tidy format as each of the words is still associated with the relevant attribute values (<code>artist</code>, <code>song</code>, and <code>genre</code>). By default the tokenized text output is lowercased and the original text input column is dropped. These can be overridden, however, if desired.</p>
<p>In addition to ‘words’, the <code>unnest_tokens()</code> function provides easy access to a number of common tokenized units including ‘characters’, ‘sentences’, and ‘paragraphs’.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-lastfm-tokenize-characters_a570631c0a2bdef6194dc86f81ec581c">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lastfm</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">unnest_tokens</span><span class="op">(</span>output <span class="op">=</span> <span class="va">character</span>, <span class="co"># column for tokenized output</span></span>
<span>                input <span class="op">=</span> <span class="va">lyrics</span>, <span class="co"># input column</span></span>
<span>                token <span class="op">=</span> <span class="st">"characters"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># tokenize unit type</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># preview first 10 lines</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-lastfm-tokenize-characters" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.12: First 10 observations for lastfm dataset tokenized by characters.</caption>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">character</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">h</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">v</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">e</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">l</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">i</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">t</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">t</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">l</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The other two built-in options ‘sentences’ and ‘paragraphs’ depend on punctuation and/ or line breaks to function, so in this particular dataset, these options will not work given the particular characteristics of the <code>lyrics</code> variable.</p>
<p>There are even other options which allow for the creation of sequences of linguistic units. Say we want to tokenize our lyrics into two-word sequences, we can specify the <code>token</code> as ‘ngrams’ and then add the argument <code>n = 2</code> to reflect we want two-word sequences.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-lastfm-tokenize-bigrams_7643c253fe2b43d8ae0f9709a067457b">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lastfm</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">unnest_tokens</span><span class="op">(</span>output <span class="op">=</span> <span class="va">bigram</span>, <span class="co"># column for tokenized output</span></span>
<span>                input <span class="op">=</span> <span class="va">lyrics</span>, <span class="co"># input column</span></span>
<span>                token <span class="op">=</span> <span class="st">"ngrams"</span>, <span class="co"># tokenize unit type</span></span>
<span>                n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># size of word sequences </span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># preview first 10 lines</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-lastfm-tokenize-bigrams" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.13: First 10 observations for lastfm dataset tokenized by bigrams</caption>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">bigram</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">have a</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a little</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little love</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">love on</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">on a</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a little</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little honeymoon</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">honeymoon you</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">you got</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">got a</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The ‘n’ in ‘ngram’ refers to the number of word-sequence units we want to tokenize. Two-word sequences are known as ‘bigrams’, three-word sequences ‘trigrams’, and so on.</p>
</section><section id="generate" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="generate">
<span class="header-section-number">7.3</span> Generate</h2>
<p>In the process of recoding a dataset the transformation of the dataset works with information that is already explicit. The process of generation, however, aims to make implicit information explicit. The most common type of operation involved in the generation process is the addition of linguistic annotation. This process can be accomplished manually by a researcher or research team or automatically through the use of pre-trained linguistic resources and/ or software. Ideally the annotation of linguistic information can be conducted automatically.</p>
<p>There are important considerations, however, that need to be taken into account when choosing whether linguistic annotation can be conducted automatically. First and foremost has to do with the type of annotation desired. Information such as part of speech (grammatical category) and morpho-syntactic information are the the most common types of linguistic annotation that can be conducted automatically. Second the degree to which the resource that will be used to annotate the linguistic information is aligned with the language variety and/or register is also a key consideration. As noted, automatic linguistic annotation methods are contingent on pre-trained resources. The language and language variety used to develop these resources may not be available for the language under investigation, or if it does, the language variety and/ or register may not align. The degree to which a resource does not align with the linguistic information targeted for annotation is directly related to the quality of the final annotations. To be clear, no annotation method, whether manual or automatic is guaranteed to be perfectly accurate.</p>
<p>Let’s take a look at annotation some of the language from the Europarle dataset we normalized.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-europarle-en-preview_dab50f75f5b871e80543fd1348b6ab78">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europarle</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Target"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-europarle-en-preview" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.14: First 10 lines in English from the normalized SDAC dataset.</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 93%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">type</th>
<th style="text-align: right;">sentence_id</th>
<th style="text-align: left;">sentence</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">I declare resumed the session of the European Parliament adjourned on Friday 17 December 1999, and I would like once again to wish you a happy new year in the hope that you enjoyed a pleasant festive period.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Although, as you will have seen, the dreaded ‘millennium bug’ failed to materialise, still the people in a number of countries suffered a series of natural disasters that truly were dreadful.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">You have requested a debate on this subject in the course of the next few days, during this part-session.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">In the meantime, I should like to observe a minute’s silence, as a number of Members have requested, on behalf of all the victims concerned, particularly those of the terrible storms, in the various countries of the European Union.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Please rise, then, for this minute’s silence.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Madam President, on a point of order.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">You will be aware from the press and television that there have been a number of bomb explosions and killings in Sri Lanka.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">One of the people assassinated very recently in Sri Lanka was Mr Kumar Ponnambalam, who had visited the European Parliament just a few months ago.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">Would it be appropriate for you, Madam President, to write a letter to the Sri Lankan President expressing Parliament’s regret at his and the other violent deaths in Sri Lanka and urging her to do everything she possibly can to seek a peaceful reconciliation to a very difficult situation?</td>
</tr>
<tr class="even">
<td style="text-align: left;">Target</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">Yes, Mr Evans, I feel an initiative of the type you have just suggested would be entirely appropriate.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We will use the cleanNLP package to do our linguistic annotation. The annotation process depends on the pre-trained language models. There is <a href="https://github.com/bnosac/udpipe#pre-trained-models">a list of the models available to access</a>. The <code>load_model_udpipe()</code> custom function below downloads the specified language model and initialized the <code>udpipe</code> engine (<code>cnlp_init_udpipe()</code>) for conducting annotations.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-functions-load-udpipe-model_3e840a92f0693db223809d79662b614c">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">load_model_udpipe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_lang</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function</span></span>
<span>  <span class="co"># Download and load the specified udpipe language model</span></span>
<span>  </span>
<span>  <span class="fu">cnlp_init_udpipe</span><span class="op">(</span><span class="va">model_lang</span><span class="op">)</span> <span class="co"># to download the model, if not downloaded</span></span>
<span><span class="va">base_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"cleanNLP"</span><span class="op">)</span> <span class="co"># get the base path</span></span>
<span>  <span class="va">model_name</span> <span class="op">&lt;-</span> <span class="co"># extract the model_name</span></span>
<span>    <span class="va">base_path</span> <span class="op">|&gt;</span> <span class="co"># extract the base path</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># get the directory</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"^"</span>, <span class="va">model_lang</span><span class="op">)</span><span class="op">)</span> <span class="co"># extract the name of the model</span></span>
<span>  </span>
<span>  <span class="va">model_path</span> <span class="op">&lt;-</span> <span class="fu">udpipe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/udpipe/man/udpipe_load_model.html">udpipe_load_model</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="va">model_name</span>, fsep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span><span class="op">)</span> <span class="co"># create the path to the downloaded model stored on disk</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">model_path</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In a test case, let’s load the ‘english’ model to annotate a sentence line from the Europarle dataset to illustrate the basic workflow.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-generation-europarle-en-example_853d40e0abd306fc8d586ce60af17a1a">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">eng_model</span> <span class="op">&lt;-</span> <span class="fu">load_model_udpipe</span><span class="op">(</span><span class="st">"english"</span><span class="op">)</span> <span class="co"># load and initialize the language model, 'english' in this case.</span></span>
<span></span>
<span><span class="va">eng_annotation</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarle</span> <span class="op">|&gt;</span> <span class="co"># dataset </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Target"</span> <span class="op">&amp;</span> <span class="va">sentence_id</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># select English and sentence_id 6</span></span>
<span>  <span class="fu">cnlp_annotate</span><span class="op">(</span>text_name <span class="op">=</span> <span class="st">"sentence"</span>, <span class="co"># input text (sentence)</span></span>
<span>                doc_name <span class="op">=</span> <span class="st">"sentence_id"</span><span class="op">)</span> <span class="co"># specify the grouping column (sentence_id)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">eng_annotation</span><span class="op">)</span> <span class="co"># preview structure</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; List of 2
#&gt;  $ token   : tibble [11 × 11] (S3: tbl_df/tbl/data.frame)
#&gt;   ..$ doc_id       : num [1:11] 6 6 6 6 6 6 6 6 6 6 ...
#&gt;   ..$ sid          : int [1:11] 1 1 1 1 1 1 1 1 1 1 ...
#&gt;   ..$ tid          : chr [1:11] "1" "2" "3" "4" ...
#&gt;   ..$ token        : chr [1:11] "Please" "rise" "," "then" ...
#&gt;   ..$ token_with_ws: chr [1:11] "Please " "rise" ", " "then" ...
#&gt;   ..$ lemma        : chr [1:11] "please" "rise" "," "then" ...
#&gt;   ..$ upos         : chr [1:11] "INTJ" "VERB" "PUNCT" "ADV" ...
#&gt;   ..$ xpos         : chr [1:11] "UH" "VB" "," "RB" ...
#&gt;   ..$ feats        : chr [1:11] NA "Mood=Imp|VerbForm=Fin" NA "PronType=Dem" ...
#&gt;   ..$ tid_source   : chr [1:11] "2" "0" "2" "10" ...
#&gt;   ..$ relation     : chr [1:11] "discourse" "root" "punct" "advmod" ...
#&gt;  $ document: tibble [1 × 2] (S3: tbl_df/tbl/data.frame)
#&gt;   ..$ type  : chr "Target"
#&gt;   ..$ doc_id: num 6
#&gt;  - attr(*, "class")= chr [1:2] "cnlp_annotation" "list"</code></pre>
</div>
</div>
<p>We see that the structure returned by the <code>cnlp_annotate()</code> function is a list. This list contains two data frames (tibbles). One for the tokens (and there annotation information) and the document (the metadata information). We can inspect the annotation characteristics for this one sentence by targetting the <code>$tokens</code> data frame. Let’s take a look at the linguistic annotation information returned.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-generation-test-annotation-english_6b1acf9360567782bec5cf0c387ba1af">
<div class="cell-output-display">
<div id="tbl-td-generation-test-annotation-english" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.15: Annotation information for a single English sentence from the Europarle dataset.</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 28%">
<col style="width: 10%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">doc_id</th>
<th style="text-align: right;">sid</th>
<th style="text-align: left;">tid</th>
<th style="text-align: left;">token</th>
<th style="text-align: left;">token_with_ws</th>
<th style="text-align: left;">lemma</th>
<th style="text-align: left;">upos</th>
<th style="text-align: left;">xpos</th>
<th style="text-align: left;">feats</th>
<th style="text-align: left;">tid_source</th>
<th style="text-align: left;">relation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Please</td>
<td style="text-align: left;">Please</td>
<td style="text-align: left;">please</td>
<td style="text-align: left;">INTJ</td>
<td style="text-align: left;">UH</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">discourse</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">rise</td>
<td style="text-align: left;">rise</td>
<td style="text-align: left;">rise</td>
<td style="text-align: left;">VERB</td>
<td style="text-align: left;">VB</td>
<td style="text-align: left;">Mood=Imp|VerbForm=Fin</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">root</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">,</td>
<td style="text-align: left;">,</td>
<td style="text-align: left;">,</td>
<td style="text-align: left;">PUNCT</td>
<td style="text-align: left;">,</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">punct</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">then</td>
<td style="text-align: left;">then</td>
<td style="text-align: left;">then</td>
<td style="text-align: left;">ADV</td>
<td style="text-align: left;">RB</td>
<td style="text-align: left;">PronType=Dem</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">advmod</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">,</td>
<td style="text-align: left;">,</td>
<td style="text-align: left;">,</td>
<td style="text-align: left;">PUNCT</td>
<td style="text-align: left;">,</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">punct</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">for</td>
<td style="text-align: left;">for</td>
<td style="text-align: left;">for</td>
<td style="text-align: left;">ADP</td>
<td style="text-align: left;">IN</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">case</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">this</td>
<td style="text-align: left;">this</td>
<td style="text-align: left;">this</td>
<td style="text-align: left;">DET</td>
<td style="text-align: left;">DT</td>
<td style="text-align: left;">Number=Sing|PronType=Dem</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">det</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">minute</td>
<td style="text-align: left;">minute</td>
<td style="text-align: left;">minute</td>
<td style="text-align: left;">NOUN</td>
<td style="text-align: left;">NN</td>
<td style="text-align: left;">Number=Sing</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">nmod:poss</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">’s</td>
<td style="text-align: left;">’s</td>
<td style="text-align: left;">’s</td>
<td style="text-align: left;">PART</td>
<td style="text-align: left;">POS</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">case</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">silence</td>
<td style="text-align: left;">silence</td>
<td style="text-align: left;">silence</td>
<td style="text-align: left;">NOUN</td>
<td style="text-align: left;">NN</td>
<td style="text-align: left;">Number=Sing</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">conj</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">11</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">PUNCT</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">punct</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>There is quite a bit of information which is returned from <code>cnlp_annotate()</code>. First note that the input sentence has been tokenized by word. Each token includes the token, lemma, part of speech (<code>upos</code> and <code>xpos</code>), morphological features (<code>feats</code>), and syntactic relationships (<code>tid_source</code> and <code>relation</code>). It is also key to note that the <code>doc_id</code>, <code>sid</code> and <code>tid</code> maintain the relational attributes from the original dataset –and therefore maintains our annotated dataset in tidy format.</p>
<p>Let’s now annotate the same sentence from the Europarle corpus for the Source (‘Spanish’) and note the similarities and differences.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-generation-europarle-es-example_00acd8e1141b1affb19b6be0dd38159b">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">spa_model</span> <span class="op">&lt;-</span> <span class="fu">load_model_udpipe</span><span class="op">(</span><span class="st">"spanish"</span><span class="op">)</span> <span class="co"># load and initialize the language model, 'spanish' in this case.</span></span>
<span></span>
<span><span class="va">spa_annotation</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">europarle</span> <span class="op">|&gt;</span> <span class="co"># dataset </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Source"</span> <span class="op">&amp;</span> <span class="va">sentence_id</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># select Spanish and sentence_id 6</span></span>
<span>  <span class="fu">cnlp_annotate</span><span class="op">(</span>text_name <span class="op">=</span> <span class="st">"sentence"</span>, <span class="co"># input text (sentence)</span></span>
<span>                doc_name <span class="op">=</span> <span class="st">"sentence_id"</span><span class="op">)</span> <span class="co"># specify the grouping column (sentence_id)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-generation-test-annotation-spanish_1ef6a4ac4dba4c1a0f885cfcbfde3d28">
<div class="cell-output-display">
<div id="tbl-td-generation-test-annotation-spanish" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.16: Annotation information for a single Spanish sentence from the Europarle dataset.</caption>
<colgroup>
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 55%">
<col style="width: 6%">
<col style="width: 5%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">doc_id</th>
<th style="text-align: right;">sid</th>
<th style="text-align: left;">tid</th>
<th style="text-align: left;">token</th>
<th style="text-align: left;">token_with_ws</th>
<th style="text-align: left;">lemma</th>
<th style="text-align: left;">upos</th>
<th style="text-align: left;">xpos</th>
<th style="text-align: left;">feats</th>
<th style="text-align: left;">tid_source</th>
<th style="text-align: left;">relation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Invito</td>
<td style="text-align: left;">Invito</td>
<td style="text-align: left;">Invito</td>
<td style="text-align: left;">VERB</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Gender=Masc|Number=Sing|VerbForm=Fin</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">root</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">ADP</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">case</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">todos</td>
<td style="text-align: left;">todos</td>
<td style="text-align: left;">todo</td>
<td style="text-align: left;">PRON</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Gender=Masc|Number=Plur|PronType=Tot</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">obj</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">ADP</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">mark</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">que</td>
<td style="text-align: left;">que</td>
<td style="text-align: left;">que</td>
<td style="text-align: left;">SCONJ</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">fixed</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">nos</td>
<td style="text-align: left;">nos</td>
<td style="text-align: left;">yo</td>
<td style="text-align: left;">PRON</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Case=Acc,Dat|Number=Plur|Person=1|PrepCase=Npr|PronType=Prs|Reflex=Yes</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">iobj</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">pongamos</td>
<td style="text-align: left;">pongamos</td>
<td style="text-align: left;">pongar</td>
<td style="text-align: left;">VERB</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Mood=Ind|Number=Plur|Person=1|Tense=Pres|VerbForm=Fin</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">advcl</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">de</td>
<td style="text-align: left;">de</td>
<td style="text-align: left;">de</td>
<td style="text-align: left;">ADP</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">case</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">pie</td>
<td style="text-align: left;">pie</td>
<td style="text-align: left;">pie</td>
<td style="text-align: left;">NOUN</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Gender=Masc|Number=Sing</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">obl</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">para</td>
<td style="text-align: left;">para</td>
<td style="text-align: left;">para</td>
<td style="text-align: left;">ADP</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">11</td>
<td style="text-align: left;">mark</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">11</td>
<td style="text-align: left;">guardar</td>
<td style="text-align: left;">guardar</td>
<td style="text-align: left;">guardar</td>
<td style="text-align: left;">VERB</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">VerbForm=Inf</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">advcl</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">un</td>
<td style="text-align: left;">un</td>
<td style="text-align: left;">uno</td>
<td style="text-align: left;">DET</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Definite=Ind|Gender=Masc|Number=Sing|PronType=Art</td>
<td style="text-align: left;">13</td>
<td style="text-align: left;">det</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">13</td>
<td style="text-align: left;">minuto</td>
<td style="text-align: left;">minuto</td>
<td style="text-align: left;">minuto</td>
<td style="text-align: left;">NOUN</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Gender=Masc|Number=Sing</td>
<td style="text-align: left;">11</td>
<td style="text-align: left;">obj</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">14</td>
<td style="text-align: left;">de</td>
<td style="text-align: left;">de</td>
<td style="text-align: left;">de</td>
<td style="text-align: left;">ADP</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">case</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">silencio</td>
<td style="text-align: left;">silencio</td>
<td style="text-align: left;">silencio</td>
<td style="text-align: left;">NOUN</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Gender=Masc|Number=Sing</td>
<td style="text-align: left;">13</td>
<td style="text-align: left;">nmod</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">16</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">PUNCT</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">punct</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>For the Spanish version of this sentence, we see the same variables. However, the <code>feats</code> variable has morphological information which is specific to Spanish –notably gender and mood.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The rsyntax package <span class="citation" data-cites="R-rsyntax">(<a href="references.html#ref-R-rsyntax" role="doc-biblioref">Welbers and van Atteveldt 2022</a>)</span> can be used to recode and extract patterns from the output from automatic linguistic annotations using cleanNLP. <a href="https://github.com/vanatteveldt/rsyntax">See the documentation for more information</a>.</p>
</div>
</div>
<!-- Consider:


- Europarle Corpus, syntactic annotation

- Syntactic parsing for last.fm music lyrics, phrasal verbs (compound:prt) a la [@Akbary2018], with automated approach
- SOTU Corpus, frequency weighting and scaling for clustering algorithm?
- ...


The process of generation aims to _augment_ a variable or set of variables. In essence this aims to make implicit attributes explicit to that they are directly accessible. This often targeted at the automatic generation of linguistic annotations such as grammatical category (part-of-speech) or syntactic structure. 


-->
</section><section id="merge" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="merge">
<span class="header-section-number">7.4</span> Merge</h2>
<!--
Consider: 

- MRC word information to merge
- English Lexicon project RT times: https://elexicon.wustl.edu/index.html

- Change dataset: 
  - SOTU
  - Written (Brown? Other better matched for register/ time-period) vs. Spoken (Switchboard)
-->
<p>One final class of transformations that can be applied to curated datasets to enhance their informativeness for a research project is the process of merging two or more datasets. To merge datasets it is required that the datasets share one or more attributes. With a common attribute two datasets can be joined to coordinate the attributes of one dataset with the other effectively adding attributes and one dataset with extended information. Another approach is to join datasets with the goal of filtering one of the datasets given the matching attribute.</p>
<p>Let’s see this in practice. Take the <code>lastfm</code> dataset. Let’s tokenize the dataset into words, using <code>unnest_tokens()</code> such that our unit of observation is words.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-lastfm-tokens_9789179037383118fdd92628166dfc21">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lastfm_words</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">lastfm</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">unnest_tokens</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"word"</span>, <span class="co"># output column</span></span>
<span>                input <span class="op">=</span> <span class="st">"lyrics"</span>, <span class="co"># input column</span></span>
<span>                token <span class="op">=</span> <span class="st">"words"</span><span class="op">)</span> <span class="co"># tokenized unit (words)</span></span>
<span></span>
<span><span class="va">lastfm_words</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># first 10 observations</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-lastfm-tokens" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.17: First 10 observations for <code>lastfm_words</code> dataset.</caption>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">word</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">have</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">love</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">on</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">honeymoon</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">you</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">got</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Consider the <code>get_sentiments()</code> function which returns words which have been classified as ‘positive’- or ‘negative’-biased, if the lexicon is set to ‘bing’ <span class="citation" data-cites="Hu2004">(<a href="references.html#ref-Hu2004" role="doc-biblioref">Hu and Liu 2004</a>)</span>.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-get-sentiment-lexicon_fadac57100e3e1c2c898ca02f02b77b9">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sentiments_bing</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tidytext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/get_sentiments.html">get_sentiments</a></span><span class="op">(</span>lexicon <span class="op">=</span> <span class="st">"bing"</span><span class="op">)</span> <span class="co"># get 'bing' lexicon from get_sentiments</span></span>
<span></span>
<span><span class="va">sentiments_bing</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># preview first 10 observations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 10 × 2
#&gt;    word        sentiment
#&gt;    &lt;chr&gt;       &lt;chr&gt;    
#&gt;  1 2-faces     negative 
#&gt;  2 abnormal    negative 
#&gt;  3 abolish     negative 
#&gt;  4 abominable  negative 
#&gt;  5 abominably  negative 
#&gt;  6 abominate   negative 
#&gt;  7 abomination negative 
#&gt;  8 abort       negative 
#&gt;  9 aborted     negative 
#&gt; 10 aborts      negative</code></pre>
</div>
</div>
<p>Since the <code>sentiments_bing</code> dataset and the <code>lastfm_words</code> dataset both share a column <code>word</code> (which has the same type of values) we can join these two datasets. The <code>sentiments_bing</code> dataset has 6786 unique words. Let’s check how many distinct words our <code>lastfm_words</code> dataset has.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-view-distinct-words_4f87f8fcf8515e55474d6551cf61c263">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lastfm_words</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># find unique words</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># count distinct rows/ words</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 4614</code></pre>
</div>
</div>
<p>One thing to note is that the <code>sentiments_bing</code> dataset does not include function words, that is words that are associated with closed-class categories (pronouns, determiners, prepositions, etc.) as these words do not have semantic content along the lines of positive and negative. So many of the words that appear in the <code>lastfm_words</code> will not be matched. Other thing to note is that the <code>sentiments_bing</code> lexicon will undoubtly have words that do not appear in the <code>lastfm_words</code> and vice versa.</p>
<p>If we want to keep all the words in the <code>lastfm_words</code> and add the sentiment information for those words that do match in both datasets, we can use the <code>left_join()</code> function. <code>lastfm_words</code> will be the dataset on the ‘left’ and therefore all rows in this dataset will be retained.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-lastfm-words-bing-left-joing_bd9843f61f0a37e46fda0dd7179e219d">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">left_join</span><span class="op">(</span><span class="va">lastfm_words</span>, <span class="va">sentiments_bing</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># first 10 observations</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-lastfm-words-bing-left-joing" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.18: First 10 observations for the <code>lastfm_words</code> sentiments_bing` left join.</caption>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">word</th>
<th style="text-align: left;">sentiment</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">have</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">love</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">on</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">honeymoon</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">you</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">got</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>So we see that quite a few of the words from <code>lastfm_words</code> are not matched. To focus in on those words in <code>lastfm_words</code> that do match, we’ll run the same join operation and filter for rows where <code>sentiment</code> is not empty (i.e.&nbsp;that there is a match in the <code>sentiments_bing</code> lexicon).</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbltd-lastfm-words-bing-left-joing-filter_18bafb4defb16f35f3f3eb5fcbe9b760">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">left_join</span><span class="op">(</span><span class="va">lastfm_words</span>, <span class="va">sentiments_bing</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">sentiment</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># return matched sentiments</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># first 10 observations</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>First 10 observations for the <code>lastfm_words</code> sentiments_bing` left join. </caption>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">word</th>
<th style="text-align: left;">sentiment</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">love</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">well</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">well</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">well</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">smile</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">well</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">well</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">well</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">smile</td>
<td style="text-align: left;">positive</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">good</td>
<td style="text-align: left;">positive</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s turn to another type of join: an anti-join. The purpose of an anti-join is to eliminate matches. This makes sense for a quick and dirty approach to removing function words (i.e.&nbsp;those grammatical words with little semantic content). In this case we use the <code>get_stopwords()</code> function to get the dataset. We’ll specify English as the language and we’ll use the default lexicon (‘Snowball’).</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-get-stopwords-english_d1ebf6092b7e660a23314a198d630fc8">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">english_stopwords</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">get_stopwords</span><span class="op">(</span>language <span class="op">=</span> <span class="st">"en"</span><span class="op">)</span> <span class="co"># get English stopwords from the Snowball lexicon</span></span>
<span></span>
<span><span class="va">english_stopwords</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># preview first 10 observations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 10 × 2
#&gt;    word      lexicon 
#&gt;    &lt;chr&gt;     &lt;chr&gt;   
#&gt;  1 i         snowball
#&gt;  2 me        snowball
#&gt;  3 my        snowball
#&gt;  4 myself    snowball
#&gt;  5 we        snowball
#&gt;  6 our       snowball
#&gt;  7 ours      snowball
#&gt;  8 ourselves snowball
#&gt;  9 you       snowball
#&gt; 10 your      snowball</code></pre>
</div>
</div>
<p>Now if we want to eliminate stopwords from our <code>lastfm_words</code> dataset we use <code>anti_join()</code>. All the observations in the <code>lastfm_words</code> where there is not a match in <code>english_stopwords</code> will be returned.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-lastfm-words-stopwords-anti-join_7f35af583ec55b3c5562ee31108259b2">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">anti_join</span><span class="op">(</span><span class="va">lastfm_words</span>, <span class="va">english_stopwords</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">kable</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-td-lastfm-words-stopwords-anti-join" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.19: First 10 observations in <code>lastfm_words</code> after filtering for English stopwords.</caption>
<thead><tr class="header">
<th style="text-align: left;">artist</th>
<th style="text-align: left;">song</th>
<th style="text-align: left;">genre</th>
<th style="text-align: left;">word</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">love</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">honeymoon</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">got</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">dish</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">got</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">little</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alan Jackson</td>
<td style="text-align: left;">Little Bitty</td>
<td style="text-align: left;">country</td>
<td style="text-align: left;">spoon</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can also merge datasets that we generate in our analysis or that we import from other sources. This can be useful when there are cases in which a corpus has associated metadata that is contained in files separate from the corpus itself. This is the case for the Switchboard Dialogue Act Corpus.</p>
<p>Our existing, disfluency recoded, version includes the following variables.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-sdac-disfluencies_c8c851c7c46b90818f950fd73ea45d45">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># preview first 10 observations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 10 × 5
#&gt;    doc_id speaker_id utterance_text                                 filler count
#&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                                          &lt;chr&gt;  &lt;int&gt;
#&gt;  1   4325       1632 Okay.  /                                       uh         0
#&gt;  2   4325       1632 Okay.  /                                       um         0
#&gt;  3   4325       1632 {D So, }                                       uh         0
#&gt;  4   4325       1632 {D So, }                                       um         0
#&gt;  5   4325       1519 [ [ I guess, +                                 uh         0
#&gt;  6   4325       1519 [ [ I guess, +                                 um         0
#&gt;  7   4325       1632 What kind of experience [ do you, + do you ] … uh         0
#&gt;  8   4325       1632 What kind of experience [ do you, + do you ] … um         0
#&gt;  9   4325       1519 I think, ] + {F uh, } I wonder ] if that work… uh         1
#&gt; 10   4325       1519 I think, ] + {F uh, } I wonder ] if that work… um         0</code></pre>
</div>
</div>
<p>The <a href="https://catalog.ldc.upenn.edu/docs/LDC97S62/">online documentation page</a> provides a key file <code>caller_tab.csv</code> which contains speaker metadata information. Included in this <code>.csv</code> file is a column <code>caller_no</code> which contains the <code>speaker_id</code> we currently have in the <code>sdac_disfluencies</code> dataset. Let’s read this file into our R session renaming <code>caller_no</code> to <code>speaker_id</code> to prepare to join these datasets.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-sdac-meta-read_ea15086ab80b2f8f1347f3761e8f1d9f">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_speaker_meta</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"https://catalog.ldc.upenn.edu/docs/LDC97S62/caller_tab.csv"</span>, </span>
<span>           col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"speaker_id"</span>, <span class="co"># changed from `caller_no`</span></span>
<span>                         <span class="st">"pin"</span>,</span>
<span>                         <span class="st">"target"</span>,</span>
<span>                         <span class="st">"sex"</span>,</span>
<span>                         <span class="st">"birth_year"</span>,</span>
<span>                         <span class="st">"dialect_area"</span>,</span>
<span>                         <span class="st">"education"</span>,</span>
<span>                         <span class="st">"ti"</span>,</span>
<span>                         <span class="st">"payment_type"</span>,</span>
<span>                         <span class="st">"amt_pd"</span>,</span>
<span>                         <span class="st">"con"</span>,</span>
<span>                         <span class="st">"remarks"</span>,</span>
<span>                         <span class="st">"calls_deleted"</span>,</span>
<span>                         <span class="st">"speaker_partition"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">sdac_speaker_meta</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 543
#&gt; Columns: 14
#&gt; $ speaker_id        &lt;dbl&gt; 1000, 1001, 1002, 1003, 1004, 1005, 1007, 1008, 1010…
#&gt; $ pin               &lt;dbl&gt; 32, 102, 104, 5656, 123, 166, 274, 322, 445, 461, 57…
#&gt; $ target            &lt;chr&gt; "N", "N", "N", "N", "N", "Y", "N", "N", "N", "N", "Y…
#&gt; $ sex               &lt;chr&gt; "FEMALE", "MALE", "FEMALE", "MALE", "FEMALE", "FEMAL…
#&gt; $ birth_year        &lt;dbl&gt; 1954, 1940, 1963, 1947, 1958, 1956, 1965, 1939, 1932…
#&gt; $ dialect_area      &lt;chr&gt; "SOUTH MIDLAND", "WESTERN", "SOUTHERN", "NORTH MIDLA…
#&gt; $ education         &lt;dbl&gt; 1, 3, 2, 2, 2, 2, 2, 1, 1, 2, 2, 1, 2, 2, 3, 3, 2, 3…
#&gt; $ ti                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
#&gt; $ payment_type      &lt;chr&gt; "CASH", "GIFT", "GIFT", "NONE", "GIFT", "GIFT", "CAS…
#&gt; $ amt_pd            &lt;dbl&gt; 15, 10, 11, 7, 11, 22, 20, 3, 11, 9, 25, 9, 1, 16, 1…
#&gt; $ con               &lt;chr&gt; "N", "N", "N", "Y", "N", "Y", "N", "Y", "N", "N", "N…
#&gt; $ remarks           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ calls_deleted     &lt;dbl&gt; 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0…
#&gt; $ speaker_partition &lt;chr&gt; "DN2", "XP", "XP", "DN2", "XP", "ET", "DN1", "DN1", …</code></pre>
</div>
</div>
<p>Now to join the <code>sdac_disfluencies</code> and <code>sdac_speaker_meta</code>. Let’s turn to <code>left_join()</code> again as we want to retain all the observations (rows) from <code>sdac_disfluencies</code> and add the columns for <code>sdac_speaker_meta</code> where the <code>speaker_id</code> column values match.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-sdac-join-metadata_f0d78c094662ed79a1810d6388729890">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">sdac_disfluencies</span>, <span class="va">sdac_speaker_meta</span><span class="op">)</span> <span class="co"># join by ``speaker_id`</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">sdac_disfluencies</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 447,212
#&gt; Columns: 18
#&gt; $ doc_id            &lt;dbl&gt; 4325, 4325, 4325, 4325, 4325, 4325, 4325, 4325, 4325…
#&gt; $ speaker_id        &lt;dbl&gt; 1632, 1632, 1632, 1632, 1519, 1519, 1632, 1632, 1519…
#&gt; $ utterance_text    &lt;chr&gt; "Okay.  /", "Okay.  /", "{D So, }", "{D So, }", "[ […
#&gt; $ filler            &lt;chr&gt; "uh", "um", "uh", "um", "uh", "um", "uh", "um", "uh"…
#&gt; $ count             &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0…
#&gt; $ pin               &lt;dbl&gt; 7713, 7713, 7713, 7713, 775, 775, 7713, 7713, 775, 7…
#&gt; $ target            &lt;chr&gt; "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N…
#&gt; $ sex               &lt;chr&gt; "FEMALE", "FEMALE", "FEMALE", "FEMALE", "FEMALE", "F…
#&gt; $ birth_year        &lt;dbl&gt; 1962, 1962, 1962, 1962, 1971, 1971, 1962, 1962, 1971…
#&gt; $ dialect_area      &lt;chr&gt; "WESTERN", "WESTERN", "WESTERN", "WESTERN", "SOUTH M…
#&gt; $ education         &lt;dbl&gt; 2, 2, 2, 2, 1, 1, 2, 2, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1…
#&gt; $ ti                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
#&gt; $ payment_type      &lt;chr&gt; "CASH", "CASH", "CASH", "CASH", "CASH", "CASH", "CAS…
#&gt; $ amt_pd            &lt;dbl&gt; 10, 10, 10, 10, 4, 4, 10, 10, 4, 4, 10, 10, 4, 4, 4,…
#&gt; $ con               &lt;chr&gt; "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y…
#&gt; $ remarks           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ calls_deleted     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
#&gt; $ speaker_partition &lt;chr&gt; "UNC", "UNC", "UNC", "UNC", "UNC", "UNC", "UNC", "UN…</code></pre>
</div>
</div>
<p>Now there are some metadata columns we may want to keep and others we may want to drop as they may not be of importance for our analysis. I’m going to assume that we want to keep <code>sex</code>, <code>birth_year</code>, <code>dialect_area</code>, and <code>education</code> and drop the rest.</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-sdac-disfluencies-subset-cols_c5a0e9459e9f2624a2537d9ac01598ee">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sdac_disfluencies</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">sdac_disfluencies</span> <span class="op">|&gt;</span> <span class="co"># dataset</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">doc_id</span><span class="op">:</span><span class="va">count</span>, <span class="va">sex</span><span class="op">:</span><span class="va">education</span><span class="op">)</span> <span class="co"># subset key columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/tbl-td-sdac-disfluencies-meta-preview_7686d4b58840f773d99ac5940c2921db">
<div class="cell-output-display">
<div id="tbl-td-sdac-disfluencies-meta-preview" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;7.20: First 10 observations for the <code>sdac_disfluencies</code> dataset with speaker metadata.</caption>
<colgroup>
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 50%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">doc_id</th>
<th style="text-align: right;">speaker_id</th>
<th style="text-align: left;">utterance_text</th>
<th style="text-align: left;">filler</th>
<th style="text-align: right;">count</th>
<th style="text-align: left;">sex</th>
<th style="text-align: right;">birth_year</th>
<th style="text-align: left;">dialect_area</th>
<th style="text-align: right;">education</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Okay. /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1962</td>
<td style="text-align: left;">WESTERN</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">Okay. /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1962</td>
<td style="text-align: left;">WESTERN</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">{D So, }</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1962</td>
<td style="text-align: left;">WESTERN</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">{D So, }</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1962</td>
<td style="text-align: left;">WESTERN</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">[ [ I guess, +</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1971</td>
<td style="text-align: left;">SOUTH MIDLAND</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">[ [ I guess, +</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1971</td>
<td style="text-align: left;">SOUTH MIDLAND</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">What kind of experience [ do you, + do you ] have, then with child care? /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1962</td>
<td style="text-align: left;">WESTERN</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1632</td>
<td style="text-align: left;">What kind of experience [ do you, + do you ] have, then with child care? /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1962</td>
<td style="text-align: left;">WESTERN</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think, ] + {F uh, } I wonder ] if that worked. /</td>
<td style="text-align: left;">uh</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1971</td>
<td style="text-align: left;">SOUTH MIDLAND</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4325</td>
<td style="text-align: right;">1519</td>
<td style="text-align: left;">I think, ] + {F uh, } I wonder ] if that worked. /</td>
<td style="text-align: left;">um</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">FEMALE</td>
<td style="text-align: right;">1971</td>
<td style="text-align: left;">SOUTH MIDLAND</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="documentation" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="documentation">
<span class="header-section-number">7.5</span> Documentation</h2>
<p>Documentation of the transformed dataset is just as important as the curated dataset. Therefore we use the same process as covered in the previous chapter. First we write the transformed dataset to disk and then we work to provide a data dictionary for this dataset. I’ve included the <code>data_dic_starter()</code> custom function to apply to our dataset(s).</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-documentation-dic-starter-function_716b0eabfa396e02a2e4d623892e7060">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_dic_starter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Function:</span></span>
<span>  <span class="co"># Creates a .csv file with the basic information</span></span>
<span>  <span class="co"># to document a curated dataset</span></span>
<span>  </span>
<span>  <span class="fu">tibble</span><span class="op">(</span>variable_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="co"># column with existing variable names </span></span>
<span>       name <span class="op">=</span> <span class="st">""</span>, <span class="co"># column for human-readable names</span></span>
<span>       description <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># column for prose description</span></span>
<span>  <span class="fu">write_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="va">file_path</span><span class="op">)</span> <span class="co"># write to disk</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s apply our function to the <code>sdac_disfluencies</code> dataset using the R console (not part of our project script to avoid overwriting our documentation!).</p>
<div class="cell" data-layout-align="center" data-hash="transform-datasets_cache/html/td-sdac-disfluencies-data-dictionary-starter_05144c3c88ae0aeb432cd36f94094464">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">data_dic_starter</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sdac_disfluencies</span>, file_path <span class="op">=</span> <span class="st">"../data/derived/sdac/sdac_disfluencies_data_dictionary.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data/derived/</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> sdac/</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> data_dictionary_sdac.csv</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> sdac_curated.csv</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> sdac_disfluencies.csv</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> sdac_disfluencies_data_dictionary.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Open the <code>data_dictionary_sdac_disfluencies.csv</code> file in spreadsheet software and add the relevant description of the dataset.</p>
</section><section id="summary" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="summary">Summary</h2>
<p>In this chapter we covered the process of transforming datasets. The goal is to manipulate the curated dataset to make it align better for analysis. There are four general types of transformation steps: normalization, recoding, generation, and merging. In any given research project some or all of these steps will be employed –but not necessarily in the order presented in this chapter. Furthermore there may also be various datasets generated in at this stage each with a distinct analysis focus in mind. In any case it is important to write these datasets to disk and to document them according to the principles that we have established in the previous chapter.</p>
<p>This chapter concludes the section on data/ dataset preparation. The next section we turn to analyzing datasets. This is the stage where we interrogate the datasets to derive knowledge and insight either through inference, prediction, and/ or exploratory methods.</p>
</section><section id="activities" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="activities">Activities</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Recipe
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What</strong>: <a href="https://lin380.github.io/tadr/articles/recipe_8.html">Dataset manipulation: tokenization and joining datasets</a><br><strong>How</strong>: Read Recipe 8 and participate in the Hypothes.is online social annotation.<br><strong>Why</strong>: To work with to primary types of transformations, tokenization and joins. Tokenization is the process of recasting textual units as smaller textual units. The process of joining datasets aims to incorporate other datasets to augment or filter the dataset of interest.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lab
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What</strong>: <a href="https://github.com/lin380/lab_8">Dataset manipulation: tokenization and joining datasets</a><br><strong>How</strong>: Clone, fork, and complete the steps in Lab 8.<br><strong>Why</strong>: To gain experience working with coding strategies for transforming datasets using tidyverse functions and regular expressions, practice reading/ writing data from/ to disk, and implement organizational strategies for organizing and documenting a dataset in reproducible fashion.</p>
</div>
</div>
</section><section id="questions" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="questions">Questions</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conceptual questions
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Technical exercises
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>…</li>
<li>…</li>
</ol>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Hu2004" class="csl-entry" role="listitem">
Hu, Minqing, and Bing Liu. 2004. <span>“Mining and Summarizing Customer Reviews.”</span> In <em>Proceedings of the Tenth ACM SIGKDD International Conference on Knowledge Discovery and Data Mining</em>, 168–77.
</div>
<div id="ref-R-rsyntax" class="csl-entry" role="listitem">
Welbers, Kasper, and Wouter van Atteveldt. 2022. <em>Rsyntax: Extract Semantic Relations from Text by Querying and Reshaping Syntax</em>. <a href="https://CRAN.R-project.org/package=rsyntax">https://CRAN.R-project.org/package=rsyntax</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./curate-datasets.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Curate data(sets)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./analysis.html" class="pagination-link">
        <span class="nav-page-text">Analysis</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>